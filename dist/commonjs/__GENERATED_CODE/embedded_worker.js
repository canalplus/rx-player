"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.EMBEDDED_WORKER = void 0;
var blob = new Blob(["(function(){" + "\"use strict\";(()=>{var mu=Object.defineProperty,pu=Object.defineProperties;var gu=Object.getOwnPropertyDescriptors;var Ja=Object.getOwnPropertySymbols;var hu=Object.prototype.hasOwnProperty,Iu=Object.prototype.propertyIsEnumerable;var eo=(n,e,t)=>e in n?mu(n,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):n[e]=t,J=(n,e)=>{for(var t in e||(e={}))hu.call(e,t)&&eo(n,t,e[t]);if(Ja)for(var t of Ja(e))Iu.call(e,t)&&eo(n,t,e[t]);return n},ie=(n,e)=>pu(n,gu(e));var b={PRODUCTION:0,DEV:1,CURRENT_ENV:0};var Su={DEFAULT_REQUEST_TIMEOUT:3e4,DEFAULT_CONNECTION_TIMEOUT:15e3,DEFAULT_TEXT_TRACK_MODE:\"native\",DEFAULT_ENABLE_FAST_SWITCHING:!0,DELTA_POSITION_AFTER_RELOAD:{bitrateSwitch:-.1,trackSwitch:{audio:0,video:0,other:0}},DEFAULT_CODEC_SWITCHING_BEHAVIOR:\"continue\",DEFAULT_AUTO_PLAY:!1,DEFAULT_WANTED_BUFFER_AHEAD:30,DEFAULT_MAX_BUFFER_AHEAD:1/0,DEFAULT_MAX_BUFFER_BEHIND:1/0,DEFAULT_MAX_VIDEO_BUFFER_SIZE:1/0,MAXIMUM_MAX_BUFFER_AHEAD:{text:18e3},MINIMUM_MAX_BUFFER_AHEAD:{text:120},MAXIMUM_MAX_BUFFER_BEHIND:{text:18e3},DEFAULT_BASE_BANDWIDTH:0,INACTIVITY_DELAY:6e4,DEFAULT_THROTTLE_VIDEO_BITRATE_WHEN_HIDDEN:!1,DEFAULT_VIDEO_RESOLUTION_LIMIT:\"none\",DEFAULT_LIVE_GAP:{DEFAULT:10,LOW_LATENCY:3.5},BUFFER_DISCONTINUITY_THRESHOLD:.2,BITRATE_REBUFFERING_RATIO:1.5,DEFAULT_MAX_MANIFEST_REQUEST_RETRY:4,DEFAULT_CDN_DOWNGRADE_TIME:60,DEFAULT_MAX_REQUESTS_RETRY_ON_ERROR:4,INITIAL_BACKOFF_DELAY_BASE:{REGULAR:200,LOW_LATENCY:50},MAX_BACKOFF_DELAY_BASE:{REGULAR:3e3,LOW_LATENCY:1e3},SAMPLING_INTERVAL_MEDIASOURCE:1e3,SAMPLING_INTERVAL_LOW_LATENCY:500,SAMPLING_INTERVAL_NO_MEDIASOURCE:500,ABR_ENTER_BUFFER_BASED_ALGO:10,ABR_EXIT_BUFFER_BASED_ALGO:5,ABR_MINIMUM_TOTAL_BYTES:15e4,ABR_MINIMUM_CHUNK_SIZE:16e3,ABR_STARVATION_FACTOR:{DEFAULT:.72,LOW_LATENCY:.72},ABR_REGULAR_FACTOR:{DEFAULT:.72,LOW_LATENCY:.72},ABR_STARVATION_GAP:{DEFAULT:5,LOW_LATENCY:5},OUT_OF_STARVATION_GAP:{DEFAULT:7,LOW_LATENCY:7},ABR_STARVATION_DURATION_DELTA:.1,ABR_FAST_EMA:2,ABR_SLOW_EMA:10,RESUME_GAP_AFTER_SEEKING:{DEFAULT:1.5,LOW_LATENCY:.5},RESUME_GAP_AFTER_NOT_ENOUGH_DATA:{DEFAULT:.5,LOW_LATENCY:.5},RESUME_GAP_AFTER_BUFFERING:{DEFAULT:5,LOW_LATENCY:.5},REBUFFERING_GAP:{DEFAULT:.5,LOW_LATENCY:.2},MINIMUM_BUFFER_AMOUNT_BEFORE_FREEZING:2,UNFREEZING_SEEK_DELAY:6e3,FREEZING_STALLED_DELAY:600,UNFREEZING_DELTA_POSITION:.001,SEGMENT_SYNCHRONIZATION_DELAY:1500,MISSING_DATA_TRIGGER_SYNC_DELAY:.1,MAX_TIME_MISSING_FROM_COMPLETE_SEGMENT:.15,MAX_MANIFEST_BUFFERED_START_END_DIFFERENCE:.4,MAX_MANIFEST_BUFFERED_DURATION_DIFFERENCE:.3,MINIMUM_SEGMENT_SIZE:.001,APPEND_WINDOW_SECURITIES:{START:.2,END:.1},MAXIMUM_HTML_TEXT_TRACK_UPDATE_INTERVAL:50,TEXT_TRACK_SIZE_CHECKS_INTERVAL:250,BUFFER_PADDING:{audio:1,video:3,other:1},SEGMENT_PRIORITIES_STEPS:[2,4,8,12,18,25],MAX_HIGH_PRIORITY_LEVEL:1,MIN_CANCELABLE_PRIORITY:3,EME_DEFAULT_VIDEO_CODECS:['video/mp4;codecs=\"avc1.4d401e\"','video/mp4;codecs=\"avc1.42e01e\"','video/webm;codecs=\"vp8\"'],EME_DEFAULT_AUDIO_CODECS:['audio/mp4;codecs=\"mp4a.40.2\"',\"audio/webm;codecs=opus\"],EME_DEFAULT_WIDEVINE_ROBUSTNESSES:[\"HW_SECURE_ALL\",\"HW_SECURE_DECODE\",\"HW_SECURE_CRYPTO\",\"SW_SECURE_DECODE\",\"SW_SECURE_CRYPTO\"],EME_DEFAULT_PLAYREADY_RECOMMENDATION_ROBUSTNESSES:[\"3000\",\"2000\"],EME_KEY_SYSTEMS:{clearkey:[\"webkit-org.w3.clearkey\",\"org.w3.clearkey\"],widevine:[\"com.widevine.alpha\"],playready:[\"com.microsoft.playready.recommendation\",\"com.microsoft.playready\",\"com.chromecast.playready\",\"com.youtube.playready\"],fairplay:[\"com.apple.fps.1_0\"]},MAX_CONSECUTIVE_MANIFEST_PARSING_IN_UNSAFE_MODE:10,MIN_MANIFEST_PARSING_TIME_TO_ENTER_UNSAFE_MODE:200,MIN_DASH_S_ELEMENTS_TO_PARSE_UNSAFELY:300,OUT_OF_SYNC_MANIFEST_REFRESH_DELAY:3e3,FAILED_PARTIAL_UPDATE_MANIFEST_REFRESH_DELAY:3e3,DASH_FALLBACK_LIFETIME_WHEN_MINIMUM_UPDATE_PERIOD_EQUAL_0:3,EME_DEFAULT_MAX_SIMULTANEOUS_MEDIA_KEY_SESSIONS:15,EME_MAX_STORED_PERSISTENT_SESSION_INFORMATION:1e3,EME_WAITING_DELAY_LOADED_SESSION_EMPTY_KEYSTATUSES:100,FORCED_ENDED_THRESHOLD:8e-4,ADAP_REP_SWITCH_BUFFER_PADDINGS:{video:{before:5,after:5},audio:{before:2,after:2.5},text:{before:0,after:0}},SOURCE_BUFFER_FLUSHING_INTERVAL:500,CONTENT_REPLACEMENT_PADDING:1.2,CACHE_LOAD_DURATION_THRESHOLDS:{video:50,audio:10},STREAM_EVENT_EMITTER_POLL_INTERVAL:250,DEFAULT_MAXIMUM_TIME_ROUNDING_ERROR:.001,BUFFERED_HISTORY_RETENTION_TIME:6e4,BUFFERED_HISTORY_MAXIMUM_ENTRIES:200,MIN_BUFFER_AHEAD:5,UPTO_CURRENT_POSITION_CLEANUP:5,DEFAULT_VIDEO_REPRESENTATIONS_SWITCHING_MODE:\"seamless\",DEFAULT_AUDIO_REPRESENTATIONS_SWITCHING_MODE:\"seamless\",DEFAULT_VIDEO_TRACK_SWITCHING_MODE:\"reload\",DEFAULT_AUDIO_TRACK_SWITCHING_MODE:\"seamless\"},to=Su;function yu(n,...e){if(n==null)throw new TypeError(\"Cannot convert undefined or null to object\");let t=Object(n);for(let r=0;r<e.length;r++){let i=e[r];for(let a in i)Object.prototype.hasOwnProperty.call(i,a)&&(t[a]=i[a])}return t}var H=typeof Object.assign==\"function\"?Object.assign:yu;function $r(n){return n!=null&&!Array.isArray(n)&&typeof n==\"object\"}function Zt(n,...e){if(e.length===0)return n;let t=e.shift();if($r(n)&&$r(t))for(let r in t)if($r(t[r])){let i=n[r];i===void 0&&(i={},n[r]=i),Zt(i,t[r])}else H(n,{[r]:t[r]});return Zt(n,...e)}var Xr=class{constructor(){this._config=to}update(e){let t=Zt(this._config,e);this._config=t}getCurrent(){return this._config}},_u=new Xr,L=_u;var je=class n extends Error{constructor(e,t,r){super(e),Object.setPrototypeOf(this,n.prototype),this.name=\"CustomLoaderError\",this.canRetry=t,this.xhr=r}};function v(n){return n==null}var fe=class{constructor(){this._listeners={}}addEventListener(e,t,r){let i=this._listeners[e];Array.isArray(i)?i.push(t):this._listeners[e]=[t],r!==void 0&&r.register(()=>{this.removeEventListener(e,t)})}removeEventListener(e,t){if(v(e)){this._listeners={};return}let r=this._listeners[e];if(!Array.isArray(r))return;if(v(t)){delete this._listeners[e];return}let i=r.indexOf(t);i!==-1&&r.splice(i,1),r.length===0&&delete this._listeners[e]}trigger(e,t){let r=this._listeners[e];Array.isArray(r)&&r.slice().forEach(i=>{try{i(t)}catch(a){if(b.CURRENT_ENV===b.DEV)throw a instanceof Error?a:new Error(\"EventEmitter: listener error\");console.error(\"RxPlayer: EventEmitter error\",a instanceof Error?a:null)}})}};function re(n,e,t){if(typeof Array.prototype.findIndex==\"function\")return n.findIndex(e,t);let r=n.length>>>0;for(let i=0;i<r;i++)if(e.call(t,n[i],i,n))return i;return-1}function B(){}var ir=class{constructor(e,t){this._value=e,this._listeners=[],this._isFinished=!1,this._onFinishCbs=[],t!==void 0&&(this._deregisterCancellation=t.register(()=>this.finish()))}getValue(){return this._value}setValue(e){if(this._isFinished){b.CURRENT_ENV===b.DEV&&console.error(\"Finished shared references cannot be updated\");return}if(this._value=e,this._listeners.length===0)return;let t=this._listeners.slice();for(let r of t)try{r.hasBeenCleared||r.trigger(e,r.complete)}catch(i){}}setValueIfChanged(e){e!==this._value&&this.setValue(e)}onUpdate(e,t){let r=()=>{if((t==null?void 0:t.clearSignal)!==void 0&&t.clearSignal.deregister(r),i.hasBeenCleared)return;i.hasBeenCleared=!0;let a=this._listeners.indexOf(i);a>=0&&this._listeners.splice(a,1)},i={trigger:e,complete:r,hasBeenCleared:!1};if(this._listeners.push(i),(t==null?void 0:t.emitCurrentValue)===!0&&e(this._value,r),this._isFinished||i.hasBeenCleared){r();return}(t==null?void 0:t.clearSignal)!==void 0&&t.clearSignal.register(r)}waitUntilDefined(e,t){this.onUpdate((r,i)=>{r!==void 0&&(i(),e(this._value))},{clearSignal:t==null?void 0:t.clearSignal,emitCurrentValue:!0})}_onFinished(e,t){if(t.isCancelled())return B;let r=()=>{let o=re(this._onFinishCbs,s=>s.trigger===i);o>=0&&(this._onFinishCbs[o].hasBeenCleared=!0,this._onFinishCbs.splice(o,1))},i=()=>{r(),e()},a=t.register(r);return this._onFinishCbs.push({trigger:i,hasBeenCleared:!1}),a}finish(){this._deregisterCancellation!==void 0&&this._deregisterCancellation(),this._isFinished=!0;let e=this._listeners.slice();for(let t of e)try{t.hasBeenCleared||(t.complete(),t.hasBeenCleared=!0)}catch(r){}if(this._listeners.length=0,this._onFinishCbs.length>0){let t=this._onFinishCbs.slice();for(let r of t)try{r.hasBeenCleared||(r.trigger(),r.hasBeenCleared=!0)}catch(i){}this._onFinishCbs.length=0}}};function Jt(n,e,t){let r=new ir(e(n.getValue()),t);return n.onUpdate(function(a){r.setValue(e(a))},{clearSignal:t}),n._onFinished(()=>{r.finish()},t),r}var j=ir;var Zr=new j(0);function no({date:n,timestamp:e}){let t=n-e,r=typeof performance!=\"undefined\"?Date.now()-performance.now():0;Zr.setValueIfChanged(r-t)}var Tu=typeof performance!=\"undefined\"?()=>performance.now()+Zr.getValue():()=>Date.now()+Zr.getValue(),U=Tu;var Eu=\"NONE\",en=class extends fe{constructor(){super(),this.error=B,this.warn=B,this.info=B,this.debug=B,this._levels={NONE:0,ERROR:1,WARNING:2,INFO:3,DEBUG:4},this._currentFormat=\"standard\",this._currentLevel=Eu}setLevel(e,t,r){let i,a=this._levels[e];typeof a==\"number\"?(i=a,this._currentLevel=e):(i=0,this._currentLevel=\"NONE\");let o;if(t===\"standard\"||t===\"full\"?o=t:o=\"standard\",o===\"full\"&&o!==this._currentFormat){let u=U();console.log(String(u.toFixed(2)),\"[Init]\",`Local-Date: ${Date.now()}`)}this._currentFormat=o;let s=this._currentFormat===\"full\"?(u,f)=>(...l)=>{let d=U();return f(String(d.toFixed(2)),`[${u}]`,...l)}:(u,f)=>f;if(r===void 0)this.error=i>=this._levels.ERROR?s(\"error\",console.error.bind(console)):B,this.warn=i>=this._levels.WARNING?s(\"warn\",console.warn.bind(console)):B,this.info=i>=this._levels.INFO?s(\"info\",console.info.bind(console)):B,this.debug=i>=this._levels.DEBUG?s(\"log\",console.log.bind(console)):B;else{let u=(f,l)=>i>=this._levels[f]?(...d)=>{let c=U();return r(f,[c,l,...d])}:B;this.error=u(\"ERROR\",\"error\"),this.warn=u(\"WARNING\",\"warn\"),this.info=u(\"INFO\",\"info\"),this.debug=u(\"DEBUG\",\"log\")}this.trigger(\"onLogLevelChange\",{level:this._currentLevel,format:this._currentFormat})}getLevel(){return this._currentLevel}getFormat(){return this._currentFormat}hasLevel(e){return this._levels[e]>=this._levels[this._currentLevel]}};var Ru=new en,m=Ru;var lt=typeof WorkerGlobalScope!=\"undefined\"&&self instanceof WorkerGlobalScope;var Pu=typeof window==\"undefined\"&&!lt,ar=Pu;var or;lt?or=self:ar?or=global:or=window;var se=or;var ae=class n extends Error{constructor(e,t,r){let i;switch(r){case\"TIMEOUT\":i=\"The request timed out\";break;case\"ERROR_EVENT\":i=\"An error prevented the request to be performed successfully\";break;case\"PARSE_ERROR\":i=\"An error happened while formatting the response data\";break;case\"ERROR_HTTP_CODE\":i=\"An HTTP status code indicating failure was received: \"+String(t);break}super(i),Object.setPrototypeOf(this,n.prototype),this.name=\"RequestError\",this.url=e,this.status=t,this.type=r}serialize(){return{url:this.url,status:this.status,type:this.type}}},Te={TIMEOUT:\"TIMEOUT\",ERROR_EVENT:\"ERROR_EVENT\",ERROR_HTTP_CODE:\"ERROR_HTTP_CODE\",PARSE_ERROR:\"PARSE_ERROR\"};var Jr=typeof Headers==\"function\"?Headers:null,ei=typeof AbortController==\"function\"?AbortController:null;function sr(n){var c,p;let e;if(!v(n.headers))if(v(Jr))e=n.headers;else{e=new Jr;let g=Object.keys(n.headers);for(let h=0;h<g.length;h++){let I=g[h];e.append(I,n.headers[I])}}m.debug(\"Fetch: Called with URL\",n.url);let t=null,r=!1,i=!1,a=U(),o=v(ei)?null:new ei;function s(){if(v(o)){m.warn(\"Fetch: AbortController API not available.\");return}o.abort()}let u;n.timeout!==void 0&&(u=setTimeout(()=>{r=!0,f!==void 0&&clearTimeout(f),s()},n.timeout));let f;n.connectionTimeout!==void 0&&(f=setTimeout(()=>{i=!0,u!==void 0&&clearTimeout(u),s()},n.connectionTimeout));let l=n.cancelSignal.register(function(h){t=h,s()}),d={method:\"GET\"};if(e!==void 0&&(d.headers=e),d.signal=v(o)?null:o.signal,m.hasLevel(\"DEBUG\")){let g=\"FETCH: Sending GET \"+n.url;n.timeout!==void 0&&(g+=\" to=\"+String(n.timeout/1e3)),n.connectionTimeout!==void 0&&(g+=\" cto=\"+String(n.connectionTimeout/1e3)),((c=n.headers)==null?void 0:c.Range)!==void 0&&(g+=\" Range=\"+((p=n.headers)==null?void 0:p.Range)),m.debug(g)}return fetch(n.url,d).then(g=>{if(f!==void 0&&clearTimeout(f),g.status>=300)throw m.warn(\"Fetch: Request HTTP Error\",g.status,g.url),new ae(g.url,g.status,Te.ERROR_HTTP_CODE);if(v(g.body))throw new ae(g.url,g.status,Te.PARSE_ERROR);let h=g.headers.get(\"Content-Length\"),I=!v(h)&&!isNaN(+h)?+h:void 0,y=g.body.getReader(),_=0;return R();async function R(){let T=await y.read();if(!T.done&&!v(T.value)){_+=T.value.byteLength;let C=U(),E={url:g.url,currentTime:C,duration:C-a,sendingTime:a,chunkSize:T.value.byteLength,chunk:T.value.buffer,size:_,totalSize:I};return n.onData(E),R()}else if(T.done){u!==void 0&&clearTimeout(u),l();let C=U();return{requestDuration:C-a,receivedTime:C,sendingTime:a,size:_,status:g.status,url:g.url}}return R()}}).catch(g=>{throw t!==null?t:(l(),r?(m.warn(\"Fetch: Request timed out.\"),new ae(n.url,0,Te.TIMEOUT)):i?(m.warn(\"Fetch: Request connection timed out.\"),new ae(n.url,0,Te.TIMEOUT)):g instanceof ae?g:(m.warn(\"Fetch: Request Error\",g instanceof Error?g.toString():\"\"),new ae(n.url,0,Te.ERROR_EVENT)))})}function tn(){return typeof se.fetch==\"function\"&&!v(ei)&&!v(Jr)}function ee(n){return typeof n==\"string\"&&n.length>0}var vu=\"json\";function ti(n){let e={url:n.url,headers:n.headers,responseType:v(n.responseType)?vu:n.responseType,timeout:n.timeout,connectionTimeout:n.connectionTimeout};return new Promise((t,r)=>{let{onProgress:i,cancelSignal:a}=n,{url:o,headers:s,responseType:u,timeout:f,connectionTimeout:l}=e,d=new XMLHttpRequest;d.open(\"GET\",o,!0);let c;f!==void 0&&(d.timeout=f,c=setTimeout(()=>{I(),r(new ae(o,d.status,Te.TIMEOUT))},f+3e3));let p;if(l!==void 0&&(p=setTimeout(()=>{I(),d.readyState!==XMLHttpRequest.DONE&&d.abort(),r(new ae(o,d.status,Te.TIMEOUT))},l)),d.responseType=u,d.responseType===\"document\"&&d.overrideMimeType(\"text/xml\"),!v(s)){let y=s;for(let _ in y)y.hasOwnProperty(_)&&d.setRequestHeader(_,y[_])}let g=U(),h=null;if(a!==void 0&&(h=a.register(function(_){I(),d.readyState!==XMLHttpRequest.DONE&&d.abort(),r(_)}),a.isCancelled()))return;if(d.onerror=function(){I(),r(new ae(o,d.status,Te.ERROR_EVENT))},d.ontimeout=function(){I(),r(new ae(o,d.status,Te.TIMEOUT))},l!==void 0&&(d.onreadystatechange=function(){d.readyState>=XMLHttpRequest.HEADERS_RECEIVED&&clearTimeout(p)}),i!==void 0&&(d.onprogress=function(_){let R=U();i({url:o,duration:R-g,sendingTime:g,currentTime:R,size:_.loaded,totalSize:_.total})}),d.onload=function(_){if(d.readyState===XMLHttpRequest.DONE)if(I(),d.status>=200&&d.status<300){let R=U(),T=d.response instanceof ArrayBuffer?d.response.byteLength:_.total,C=d.status,E=d.responseType,k=ee(d.responseURL)?d.responseURL:o,x;if(E===\"json\"?x=typeof d.response==\"object\"?d.response:Cu(d.responseText):x=d.response,v(x)){r(new ae(o,d.status,Te.PARSE_ERROR));return}t({status:C,url:k,responseType:E,sendingTime:g,receivedTime:R,requestDuration:R-g,size:T,responseData:x})}else r(new ae(o,d.status,Te.ERROR_HTTP_CODE))},m.hasLevel(\"DEBUG\")){let y=\"XHR: Sending GET \"+o;n.responseType!==void 0&&(y+=\" type=\"+n.responseType),f!==void 0&&(y+=\" to=\"+String(f/1e3)),l!==void 0&&(y+=\" cto=\"+String(l/1e3)),(s==null?void 0:s.Range)!==void 0&&(y+=\" Range=\"+(s==null?void 0:s.Range)),m.debug(y)}d.send();function I(){c!==void 0&&clearTimeout(c),p!==void 0&&clearTimeout(p),h!==null&&h()}})}function Cu(n){try{return JSON.parse(n)}catch(e){return null}}var pe=ti;var Et=Te,ze={NETWORK_ERROR:\"NETWORK_ERROR\",MEDIA_ERROR:\"MEDIA_ERROR\",ENCRYPTED_MEDIA_ERROR:\"ENCRYPTED_MEDIA_ERROR\",OTHER_ERROR:\"OTHER_ERROR\"};function Ze(n,e){return`${n}: ${e}`}var nn=class n extends Error{constructor(e,t,r){super(Ze(e,t)),Object.setPrototypeOf(this,n.prototype),this.name=\"EncryptedMediaError\",this.type=ze.ENCRYPTED_MEDIA_ERROR,this.code=e,this._originalMessage=t,this.fatal=!1,typeof(r==null?void 0:r.keyStatuses)==\"string\"&&(this.keyStatuses=r.keyStatuses)}serialize(){return{name:this.name,code:this.code,reason:this._originalMessage,keyStatuses:this.keyStatuses}}};var X=class n extends Error{constructor(e,t,r){super(Ze(e,t)),Object.setPrototypeOf(this,n.prototype),this.name=\"MediaError\",this.type=ze.MEDIA_ERROR,this._originalMessage=t,this.code=e,this.fatal=!1,(r==null?void 0:r.tracks)!==void 0&&(r==null?void 0:r.tracks.length)>0&&(this.tracksInfo=r.tracks)}serialize(){return{name:this.name,code:this.code,reason:this._originalMessage,tracks:this.tracksInfo}}};var Ye=class n extends Error{constructor(e,t){super(Ze(e,t.message)),Object.setPrototypeOf(this,n.prototype),this.name=\"NetworkError\",this.type=ze.NETWORK_ERROR,this.url=t.url,this.status=t.status,this.errorType=t.type,this._baseError=t,this.code=e,this.fatal=!1}isHttpError(e){return this.errorType===Et.ERROR_HTTP_CODE&&this.status===e}serialize(){return{name:this.name,code:this.code,baseError:this._baseError.serialize()}}};var Ie=class n extends Error{constructor(e,t){super(Ze(e,t)),Object.setPrototypeOf(this,n.prototype),this.name=\"OtherError\",this.type=ze.OTHER_ERROR,this.code=e,this.fatal=!1,this._originalMessage=t}serialize(){return{name:this.name,code:this.code,reason:this._originalMessage}}};function Ut(n){return(n instanceof nn||n instanceof X||n instanceof Ie||n instanceof Ye)&&Object.keys(ze).indexOf(n.type)>=0}function be(n,{defaultCode:e,defaultReason:t}){if(Ut(n))return n;let r=n instanceof Error?n.toString():t;return new Ie(e,r)}var Ce=class n extends Error{constructor(e,t,r){super(t),Object.setPrototypeOf(this,n.prototype),this.name=\"SourceBufferError\",this.errorName=e,this.isBufferFull=r}serialize(){return{errorName:this.name,message:this.message,isBufferFull:this.isBufferFull}}toString(){return`${this.errorName}: ${this.message}`}};var xu={dashParsers:{wasm:null,native:null,fastJs:null},codecSupportProber:null,createDebugElement:null,directfile:null,decrypt:null,htmlTextDisplayer:null,htmlTextTracksParsers:{},mainThreadMediaSourceInit:null,multithread:null,nativeTextDisplayer:null,nativeTextTracksParsers:{},transports:{}},ro=xu;var de=ro;function K(n,e,t){if(typeof Array.prototype.find==\"function\")return n.find(e,t);let r=n.length>>>0;for(let i=0;i<r;i++){let a=n[i];if(e.call(t,a,i,n))return a}}var Au={aa:\"aar\",ab:\"abk\",ae:\"ave\",af:\"afr\",ak:\"aka\",am:\"amh\",an:\"arg\",ar:\"ara\",as:\"asm\",av:\"ava\",ay:\"aym\",az:\"aze\",ba:\"bak\",be:\"bel\",bg:\"bul\",bi:\"bis\",bm:\"bam\",bn:\"ben\",bo:\"bod\",br:\"bre\",bs:\"bos\",ca:\"cat\",ce:\"che\",ch:\"cha\",co:\"cos\",cr:\"cre\",cs:\"ces\",cu:\"chu\",cv:\"chv\",cy:\"cym\",da:\"dan\",de:\"deu\",dv:\"div\",dz:\"dzo\",ee:\"ewe\",el:\"ell\",en:\"eng\",eo:\"epo\",es:\"spa\",et:\"est\",eu:\"eus\",fa:\"fas\",ff:\"ful\",fi:\"fin\",fj:\"fij\",fo:\"fao\",fr:\"fra\",fy:\"fry\",ga:\"gle\",gd:\"gla\",gl:\"glg\",gn:\"grn\",gu:\"guj\",gv:\"glv\",ha:\"hau\",he:\"heb\",hi:\"hin\",ho:\"hmo\",hr:\"hrv\",ht:\"hat\",hu:\"hun\",hy:\"hye\",hz:\"her\",ia:\"ina\",id:\"ind\",ie:\"ile\",ig:\"ibo\",ii:\"iii\",ik:\"ipk\",io:\"ido\",is:\"isl\",it:\"ita\",iu:\"iku\",ja:\"jpn\",jv:\"jav\",ka:\"kat\",kg:\"kon\",ki:\"kik\",kj:\"kua\",kk:\"kaz\",kl:\"kal\",km:\"khm\",kn:\"kan\",ko:\"kor\",kr:\"kau\",ks:\"kas\",ku:\"kur\",kv:\"kom\",kw:\"cor\",ky:\"kir\",la:\"lat\",lb:\"ltz\",lg:\"lug\",li:\"lim\",ln:\"lin\",lo:\"lao\",lt:\"lit\",lu:\"lub\",lv:\"lav\",mg:\"mlg\",mh:\"mah\",mi:\"mri\",mk:\"mkd\",ml:\"mal\",mn:\"mon\",mr:\"mar\",ms:\"msa\",mt:\"mlt\",my:\"mya\",na:\"nau\",nb:\"nob\",nd:\"nde\",ne:\"nep\",ng:\"ndo\",nl:\"nld\",nn:\"nno\",no:\"nor\",nr:\"nbl\",nv:\"nav\",ny:\"nya\",oc:\"oci\",oj:\"oji\",om:\"orm\",or:\"ori\",os:\"oss\",pa:\"pan\",pi:\"pli\",pl:\"pol\",ps:\"pus\",pt:\"por\",qu:\"que\",rm:\"roh\",rn:\"run\",ro:\"ron\",ru:\"rus\",rw:\"kin\",sa:\"san\",sc:\"srd\",sd:\"snd\",se:\"sme\",sg:\"sag\",si:\"sin\",sk:\"slk\",sl:\"slv\",sm:\"smo\",sn:\"sna\",so:\"som\",sq:\"sqi\",sr:\"srp\",ss:\"ssw\",st:\"sot\",su:\"sun\",sv:\"swe\",sw:\"swa\",ta:\"tam\",te:\"tel\",tg:\"tgk\",th:\"tha\",ti:\"tir\",tk:\"tuk\",tl:\"tgl\",tn:\"tsn\",to:\"ton\",tr:\"tur\",ts:\"tso\",tt:\"tat\",tw:\"twi\",ty:\"tah\",ug:\"uig\",uk:\"ukr\",ur:\"urd\",uz:\"uzb\",ve:\"ven\",vi:\"vie\",vo:\"vol\",wa:\"wln\",wo:\"wol\",xh:\"xho\",yi:\"yid\",yo:\"yor\",za:\"zha\",zh:\"zho\",zu:\"zul\"},io=Au;var ku={alb:\"sqi\",arm:\"hye\",baq:\"eus\",bur:\"mya\",chi:\"zho\",cze:\"ces\",dut:\"nld\",fre:\"fra\",geo:\"kat\",ger:\"deu\",gre:\"ell\",ice:\"isl\",mac:\"mkd\",mao:\"mri\",may:\"msa\",per:\"fas\",slo:\"slk\",rum:\"ron\",tib:\"bod\",wel:\"cym\"},ao=ku;function Mu(n){if(v(n)||n===\"\")return\"und\";let t=(\"\"+n).toLowerCase().split(\"-\")[0],r=Ou(t);return ee(r)?r:n}function Ou(n){let e;switch(n.length){case 2:e=io[n];break;case 3:e=ao[n];break}return e}var oo=Mu;var so=oo;function ur(n,e){if(n.length!==e.length)return!1;if(n===e)return!0;for(let t=n.length-1;t>=0;t--)if(n[t]!==e[t])return!1;return!0}function xe(){let n=\"\",e=-1;return function(){return e++,e>=Number.MAX_SAFE_INTEGER&&(n+=\"0\",e=0),n+String(e)}}var wu=xe(),ni=class{constructor(e,t){var r,i,a,o,s;if(this.id=e.id,this.uniqueId=wu(),this.bitrate=e.bitrate,this.codecs=[],e.isSpatialAudio!==void 0&&(this.isSpatialAudio=e.isSpatialAudio),e.height!==void 0&&(this.height=e.height),e.width!==void 0&&(this.width=e.width),e.mimeType!==void 0&&(this.mimeType=e.mimeType),e.contentProtections!==void 0&&(this.contentProtections=e.contentProtections),e.frameRate!==void 0&&(this.frameRate=e.frameRate),e.hdrInfo!==void 0&&(this.hdrInfo=e.hdrInfo),this.cdnMetadata=e.cdnMetadata,this.index=e.index,t===\"audio\"||t===\"video\")if(de.codecSupportProber!==null){if(e.supplementalCodecs!==void 0){let u=de.codecSupportProber.isSupported((r=this.mimeType)!=null?r:\"\",(i=e.supplementalCodecs)!=null?i:\"\");u!==!1&&(this.codecs=[e.supplementalCodecs],u===!0&&(this.isSupported=!0))}this.isSupported!==!0&&(this.codecs.length>0?this.codecs.push((a=e.codecs)!=null?a:\"\"):(this.codecs=e.codecs===void 0?[]:[e.codecs],this.isSupported=de.codecSupportProber.isSupported((o=this.mimeType)!=null?o:\"\",(s=e.codecs)!=null?s:\"\")))}else e.supplementalCodecs!==void 0&&this.codecs.push(e.supplementalCodecs),e.codecs!==void 0&&this.codecs.push(e.codecs);else e.codecs!==void 0&&this.codecs.push(e.codecs),this.isSupported=!0}refreshCodecSupport(e){var i;let t=(i=this.mimeType)!=null?i:\"\",r=this.codecs;r.length===0&&(r=[\"\"]);for(let a=0;a<r.length;a++)for(let o of e){let s=r[a];if(o.codec===s&&o.mimeType===t){if(o.result){this.isSupported=!0,this.codecs=[s];return}else if(a===r.length){this.isSupported=!1,this.codecs=[s];return}}}}getMimeTypeString(){var e,t,r;return`${(e=this.mimeType)!=null?e:\"\"};codecs=\"${(r=(t=this.codecs)==null?void 0:t[0])!=null?r:\"\"}\"`}getEncryptionData(e){var i,a;let t=this.getAllEncryptionData(),r=[];for(let o=0;o<t.length;o++){let s=!1,u=t[o];for(let f=0;f<u.values.length;f++)if(u.values[f].systemId.toLowerCase()===e.toLowerCase())if(s)r[r.length-1].values.push(u.values[f]);else{let l=(a=(i=this.contentProtections)==null?void 0:i.keyIds)==null?void 0:a.map(d=>d.keyId);r.push({type:u.type,keyIds:l,values:[u.values[f]]}),s=!0}}return r}getAllEncryptionData(){var t,r;if(this.contentProtections===void 0||this.contentProtections.initData.length===0)return[];let e=(r=(t=this.contentProtections)==null?void 0:t.keyIds)==null?void 0:r.map(i=>i.keyId);return this.contentProtections.initData.map(i=>({type:i.type,keyIds:e,values:i.values}))}addProtectionData(e,t,r){let i=!1;if(this.contentProtections===void 0)return this.contentProtections={keyIds:t!==void 0?[{keyId:t}]:[],initData:[{type:e,values:r}]},!0;if(t!==void 0){let o=this.contentProtections.keyIds;if(o===void 0)this.contentProtections.keyIds=[{keyId:t}];else{let s=!1;for(let u of o)ur(u.keyId,t)&&(s=!0);s||(m.warn(\"Manifest: found unanounced key id.\"),o.push({keyId:t}))}}let a=this.contentProtections.initData;for(let o=0;o<a.length;o++)if(a[o].type===e){let s=a[o].values;for(let u=0;u<r.length;u++){let f=r[u],l;for(l=0;l<s.length;l++)if(f.systemId===s[l].systemId){if(ur(f.data,s[l].data))break;m.warn(\"Manifest: different init data for the same system ID\")}l===s.length&&(s.push(f),i=!0)}return i}return this.contentProtections.initData.push({type:e,values:r}),!0}getMetadataSnapshot(){return{id:this.id,uniqueId:this.uniqueId,bitrate:this.bitrate,codecs:this.codecs,mimeType:this.mimeType,width:this.width,height:this.height,frameRate:this.frameRate,isSupported:this.isSupported,hdrInfo:this.hdrInfo,contentProtections:this.contentProtections,decipherable:this.decipherable}}},rn=ni;var ft=class n{constructor(e,t={}){let{trickModeTracks:r}=e,{representationFilter:i,isManuallyAdded:a}=t;this.id=e.id,this.type=e.type,e.isTrickModeTrack!==void 0&&(this.isTrickModeTrack=e.isTrickModeTrack),e.language!==void 0&&(this.language=e.language,this.normalizedLanguage=so(e.language)),e.closedCaption!==void 0&&(this.isClosedCaption=e.closedCaption),e.audioDescription!==void 0&&(this.isAudioDescription=e.audioDescription),e.isDub!==void 0&&(this.isDub=e.isDub),e.forcedSubtitles!==void 0&&(this.isForcedSubtitles=e.forcedSubtitles),e.isSignInterpreted!==void 0&&(this.isSignInterpreted=e.isSignInterpreted),e.label!==void 0&&(this.label=e.label),r!==void 0&&r.length>0&&(this.trickModeTracks=r.map(f=>new n(f)));let o=e.representations,s=[],u;for(let f=0;f<o.length;f++){let l=new rn(o[f],this.type),d=!0;if(!v(i)){let c={id:l.id,bitrate:l.bitrate,codecs:l.codecs,height:l.height,width:l.width,frameRate:l.frameRate,hdrInfo:l.hdrInfo};if(l.contentProtections!==void 0&&(c.contentProtections={},l.contentProtections.keyIds!==void 0)){let p=l.contentProtections.keyIds.map(({keyId:g})=>g);c.contentProtections.keyIds=p}d=i(c,{trackType:this.type,language:this.language,normalizedLanguage:this.normalizedLanguage,isClosedCaption:this.isClosedCaption,isDub:this.isDub,isAudioDescription:this.isAudioDescription,isSignInterpreted:this.isSignInterpreted})}d?(s.push(l),u===void 0&&(l.isSupported===!0?u=!0:l.isSupported===!1&&(u=!1))):m.debug(\"Filtering Representation due to representationFilter\",this.type,`Adaptation: ${this.id}`,`Representation: ${l.id}`,`(${l.bitrate})`)}s.sort((f,l)=>f.bitrate-l.bitrate),this.representations=s,this.isSupported=u,this.manuallyAdded=a===!0}refreshCodecSupport(e){for(let t of this.representations)t.isSupported===void 0&&(t.refreshCodecSupport(e),this.isSupported!==!0&&t.isSupported===!0?this.isSupported=!0:this.isSupported===void 0&&t.isSupported===!1&&(this.isSupported=!1))}getRepresentation(e){return K(this.representations,({id:t})=>e===t)}getMetadataSnapshot(){let e=[],t=this.representations;for(let r of t)e.push(r.getMetadataSnapshot());return{id:this.id,type:this.type,isSupported:this.isSupported,language:this.language,isForcedSubtitles:this.isForcedSubtitles,isClosedCaption:this.isClosedCaption,isAudioDescription:this.isAudioDescription,isSignInterpreted:this.isSignInterpreted,normalizedLanguage:this.normalizedLanguage,representations:e,label:this.label,isDub:this.isDub}}};function ce(n,e,t){if(typeof Array.prototype.includes==\"function\")return n.includes(e,t);let r=n.length>>>0;if(r===0)return!1;let i=t|0,a=i>=0?Math.min(i,r-1):Math.max(r+i,0),o=(s,u)=>s===u||typeof s==\"number\"&&typeof u==\"number\"&&isNaN(s)&&isNaN(u);for(;a<r;){if(o(n[a],e))return!0;a++}return!1}var uo=[];function Je(n){ce(uo,n)||(console.warn(n),uo.push(n))}function ri(n){return Object.keys(n).map(e=>n[e])}var dr=typeof Object.values==\"function\"?Object.values:ri;var Lt=[\"audio\",\"video\",\"text\"];function fo(n){var a,o;let e=n.timeBounds;if(e.timeshiftDepth===null)return(a=e.minimumSafePosition)!=null?a:0;let{maximumTimeData:t}=e,r;if(!e.maximumTimeData.isLinear)r=t.maximumSafePosition;else{let s=U()-t.time;r=t.maximumSafePosition+s/1e3}let i=r-e.timeshiftDepth;return Math.max((o=e.minimumSafePosition)!=null?o:0,i)}function co(n){let{maximumTimeData:e}=n.timeBounds;if(!n.isLive||e.livePosition===void 0)return;if(!e.isLinear)return e.livePosition;let t=U()-e.time;return e.livePosition+t/1e3}function mo(n){let{maximumTimeData:e}=n.timeBounds;if(!e.isLinear)return e.maximumSafePosition;let t=U()-e.time;return e.maximumSafePosition+t/1e3}function po(n,e){if(e===void 0)return ai(n).filter(r=>r.isSupported===!0);let t=n.adaptations[e];return t===void 0?[]:t.filter(r=>r.isSupported===!0)}function go(n,e){let t=null;for(let r=n.periods.length-1;r>=0;r--){let i=n.periods[r];if(ii(i,e,t))return i;t=i}}function ho(n,e){let t=e.end;if(t===void 0)return null;let r=K(n.periods,i=>i.end===void 0||t<i.end);return r===void 0?null:r}function ii(n,e,t){return e>=n.start&&(n.end===void 0||e<n.end)?!0:e===n.end&&(t===null||t.start>n.end)}function ai(n){let e=n.adaptations;return ri(e).reduce((t,r)=>v(r)?t:t.concat(r),[])}function Du(n,e){var r,i;let t={language:(r=n.language)!=null?r:\"\",normalized:(i=n.normalizedLanguage)!=null?i:\"\",audioDescription:n.isAudioDescription===!0,id:n.id,representations:(e?n.representations.filter(a=>a.isSupported===!0&&a.decipherable!==!1):n.representations).map(Uu),label:n.label};return n.isDub===!0&&(t.dub=!0),t}function Bu(n){var e,t;return{language:(e=n.language)!=null?e:\"\",normalized:(t=n.normalizedLanguage)!=null?t:\"\",closedCaption:n.isClosedCaption===!0,id:n.id,label:n.label,forced:n.isForcedSubtitles}}function Nu(n,e){let t=n.trickModeTracks!==void 0?n.trickModeTracks.map(i=>{let a=(e?i.representations.filter(s=>s.isSupported===!0&&s.decipherable!==!1):i.representations).map(lo),o={id:i.id,representations:a,isTrickModeTrack:!0};return i.isSignInterpreted===!0&&(o.signInterpreted=!0),o}):void 0,r={id:n.id,representations:(e?n.representations.filter(i=>i.isSupported===!0&&i.decipherable!==!1):n.representations).map(lo),label:n.label};return n.isSignInterpreted===!0&&(r.signInterpreted=!0),n.isTrickModeTrack===!0&&(r.isTrickModeTrack=!0),t!==void 0&&(r.trickModeTracks=t),r}function Uu(n){let{id:e,bitrate:t,codecs:r,isSpatialAudio:i,isSupported:a,decipherable:o}=n;return{id:e,bitrate:t,codec:r==null?void 0:r[0],isSpatialAudio:i,isCodecSupported:a,decipherable:o}}function lo(n){let{id:e,bitrate:t,frameRate:r,width:i,height:a,codecs:o,hdrInfo:s,isSupported:u,decipherable:f}=n;return{id:e,bitrate:t,frameRate:r,width:i,height:a,codec:o==null?void 0:o[0],hdrInfo:s,isCodecSupported:u,decipherable:f}}function ct(n){switch(n.type){case\"audio\":return{type:\"audio\",track:Du(n,!1)};case\"video\":return{type:\"video\",track:Nu(n,!1)};case\"text\":return{type:\"text\",track:Bu(n)}}}function Io(n){return new Function(`return (${n}(arguments[0], arguments[1]))`)}var mt=class{constructor(e,t,r){if(this.id=e.id,this.adaptations=Object.keys(e.adaptations).reduce((i,a)=>{let o=e.adaptations[a];if(v(o))return i;let s=o.map(u=>{let f=new ft(u,{representationFilter:r});return f.representations.length>0&&f.isSupported===!1&&t.push(f),f}).filter(u=>u.representations.length>0);if(s.every(u=>u.isSupported===!1)&&o.length>0&&(a===\"video\"||a===\"audio\"))throw new X(\"MANIFEST_INCOMPATIBLE_CODECS_ERROR\",\"No supported \"+a+\" adaptations\",{tracks:void 0});return s.length>0&&(i[a]=s),i},{}),!Array.isArray(this.adaptations.video)&&!Array.isArray(this.adaptations.audio))throw new X(\"MANIFEST_PARSE_ERROR\",\"No supported audio and video tracks.\");this.duration=e.duration,this.start=e.start,!v(this.duration)&&!v(this.start)&&(this.end=this.start+this.duration),this.streamEvents=e.streamEvents===void 0?[]:e.streamEvents}refreshCodecSupport(e,t){Object.keys(this.adaptations).forEach(r=>{let i=this.adaptations[r];if(i===void 0)return;let a=!1;for(let o of i){let s=o.isSupported;o.refreshCodecSupport(e),s!==!1&&o.isSupported===!1&&t.push(o),a===!1?a=o.isSupported:a===void 0&&o.isSupported===!0&&(a=!0)}if((r===\"video\"||r===\"audio\")&&a===!1)throw new X(\"MANIFEST_INCOMPATIBLE_CODECS_ERROR\",\"No supported \"+r+\" adaptations\",{tracks:void 0})},{})}getAdaptations(){return ai(this)}getAdaptationsForType(e){let t=this.adaptations[e];return t!=null?t:[]}getAdaptation(e){return K(this.getAdaptations(),({id:t})=>e===t)}getSupportedAdaptations(e){return po(this,e)}containsTime(e,t){return ii(this,e,t)}getMetadataSnapshot(){let e={},t=this.getAdaptations();for(let r of t){let i=e[r.type];i===void 0&&(i=[],e[r.type]=i),i.push(r.getMetadataSnapshot())}return{start:this.start,end:this.end,id:this.id,streamEvents:this.streamEvents,adaptations:e}}};function an(n,e,t){let r={updatedAdaptations:[],removedAdaptations:[],addedAdaptations:[]};n.start=e.start,n.end=e.end,n.duration=e.duration,n.streamEvents=e.streamEvents;let i=n.getAdaptations(),a=e.getAdaptations();for(let o=0;o<i.length;o++){let s=i[o],u=re(a,f=>f.id===s.id);if(u===-1){m.warn('Manifest: Adaptation \"'+i[o].id+'\" not found when merging.');let[f]=i.splice(o,1);o--,r.removedAdaptations.push({id:f.id,trackType:f.type})}else{let[f]=a.splice(u,1),l=[],d=[],c=[];r.updatedAdaptations.push({adaptation:s.id,trackType:s.type,updatedRepresentations:l,addedRepresentations:d,removedRepresentations:c});let p=s.representations,g=f.representations.slice();for(let h=0;h<p.length;h++){let I=p[h],y=re(g,_=>_.id===I.id);if(y===-1){m.warn(`Manifest: Representation \"${p[h].id}\" not found when merging.`);let[_]=p.splice(h,1);h--,c.push(_.id)}else{let[_]=g.splice(y,1);l.push(I.getMetadataSnapshot()),I.cdnMetadata=_.cdnMetadata,t===0?I.index._replace(_.index):I.index._update(_.index)}}g.length>0&&(m.warn(`Manifest: ${g.length} new Representations found when merging.`),s.representations.push(...g),d.push(...g.map(h=>h.getMetadataSnapshot())))}}if(a.length>0){m.warn(`Manifest: ${a.length} new Adaptations found when merging.`);for(let o of a){let s=n.adaptations[o.type];s===void 0?n.adaptations[o.type]=[o]:s.push(o),r.addedAdaptations.push(o.getMetadataSnapshot())}}return r}function bo(n,e){let t={updatedPeriods:[],addedPeriods:[],removedPeriods:[]},r=0;for(let a=0;a<e.length;a++){let o=e[a],s=r,u=n[s];for(;u!==void 0&&u.id!==o.id;)s++,u=n[s];if(u!==void 0){let f=an(u,o,0);t.updatedPeriods.push({period:{id:u.id,start:u.start,end:u.end,duration:u.duration,streamEvents:u.streamEvents},result:f});let l=e.slice(r,a),d=s-r,c=n.splice(r,d,...l);t.removedPeriods.push(...c.map(p=>({id:p.id,start:p.start,end:p.end}))),t.addedPeriods.push(...l.map(p=>p.getMetadataSnapshot())),r=a+1}}if(r>n.length)return m.error(\"Manifest: error when updating Periods\"),t;if(r<n.length){let a=n.splice(r,n.length-r);t.removedPeriods.push(...a.map(o=>({id:o.id,start:o.start,end:o.end})))}let i=e.slice(r,e.length);return i.length>0&&(n.push(...i),t.addedPeriods.push(...i.map(a=>a.getMetadataSnapshot()))),t}function So(n,e){let t={updatedPeriods:[],addedPeriods:[],removedPeriods:[]};if(n.length===0)return n.splice(0,0,...e),t.addedPeriods.push(...e.map(s=>s.getMetadataSnapshot())),t;if(e.length===0)return t;let r=n[n.length-1];if(r.start<e[0].start){if(r.end!==e[0].start)throw new X(\"MANIFEST_UPDATE_ERROR\",\"Cannot perform partial update: not enough data\");return n.push(...e),t.addedPeriods.push(...e.map(s=>s.getMetadataSnapshot())),t}let i=re(n,({id:s})=>s===e[0].id);if(i<0)throw new X(\"MANIFEST_UPDATE_ERROR\",\"Cannot perform partial update: incoherent data\");let a=an(n[i],e[0],1);t.updatedPeriods.push({period:H(n[i].getMetadataSnapshot(),{adaptations:void 0}),result:a});let o=i+1;for(let s=1;s<e.length;s++){let u=e[s],f=-1;for(let l=o;l<n.length;l++)if(u.id===n[l].id){f=l;break}if(f<0){let l=-1;for(let p=o;p<n.length;p++)if(u.start<n[p].start){l=p;break}let d=l-o,c=n.splice(o,d,u);t.addedPeriods.push(u.getMetadataSnapshot()),t.removedPeriods.push(...c.map(p=>({id:p.id,start:p.start,end:p.end})))}else{if(f>o){m.warn(\"Manifest: old Periods not found in new when updating, removing\");let d=n.splice(o,f-o);t.removedPeriods.push(...d.map(c=>({id:c.id,start:c.start,end:c.end}))),f=o}let l=an(n[f],u,0);t.updatedPeriods.push({period:H(n[f].getMetadataSnapshot(),{adaptations:void 0}),result:l})}o++}if(o<n.length){m.warn(\"Manifest: Ending Periods not found in new when updating, removing\");let s=n.splice(o,n.length-o);t.removedPeriods.push(...s.map(u=>({id:u.id,start:u.start,end:u.end})))}return t}var Lu=xe(),on=class extends fe{constructor(e,t,r){var s;super();let{representationFilter:i,manifestUpdateUrl:a}=t;this.manifestFormat=0,this.id=Lu(),this.expired=(s=e.expired)!=null?s:null,this.transport=e.transportType,this.clockOffset=e.clockOffset;let o=[];if(this.periods=e.periods.map(u=>new mt(u,o,i)).sort((u,f)=>u.start-f.start),o.length>0){let u=new X(\"MANIFEST_INCOMPATIBLE_CODECS_ERROR\",\"An Adaptation contains only incompatible codecs.\",{tracks:o.map(ct)});r.push(u)}this.adaptations=this.periods[0]===void 0?{}:this.periods[0].adaptations,this.timeBounds=e.timeBounds,this.isDynamic=e.isDynamic,this.isLive=e.isLive,this.isLastPeriodKnown=e.isLastPeriodKnown,this.uris=e.uris===void 0?[]:e.uris,this.updateUrl=a,this.lifetime=e.lifetime,this.clockOffset=e.clockOffset,this.suggestedPresentationDelay=e.suggestedPresentationDelay,this.availabilityStartTime=e.availabilityStartTime,this.publishTime=e.publishTime}refreshCodecSupport(e){let t=[];for(let r of this.periods)r.refreshCodecSupport(e,t);return t.length>0?new X(\"MANIFEST_INCOMPATIBLE_CODECS_ERROR\",\"An Adaptation contains only incompatible codecs.\",{tracks:t.map(ct)}):null}getPeriod(e){return K(this.periods,t=>e===t.id)}getPeriodForTime(e){return go(this,e)}getNextPeriod(e){return K(this.periods,t=>t.start>e)}getPeriodAfter(e){return ho(this,e)}getUrls(){return this.uris}replace(e){this._performUpdate(e,0)}update(e){this._performUpdate(e,1)}getMinimumSafePosition(){return fo(this)}getLivePosition(){return co(this)}getMaximumSafePosition(){return mo(this)}updateRepresentationsDeciperability(e){let t=Fu(this,e);t.length>0&&this.trigger(\"decipherabilityUpdate\",t)}getAdaptations(){Je(\"manifest.getAdaptations() is deprecated. Please use manifest.period[].getAdaptations() instead\");let e=this.periods[0];if(e===void 0)return[];let t=e.adaptations,r=[];for(let i in t)if(t.hasOwnProperty(i)){let a=t[i];r.push(...a)}return r}getAdaptationsForType(e){Je(\"manifest.getAdaptationsForType(type) is deprecated. Please use manifest.period[].getAdaptationsForType(type) instead\");let t=this.periods[0];if(t===void 0)return[];let r=t.adaptations[e];return r===void 0?[]:r}getAdaptation(e){return Je(\"manifest.getAdaptation(id) is deprecated. Please use manifest.period[].getAdaptation(id) instead\"),K(this.getAdaptations(),({id:t})=>e===t)}getMetadataSnapshot(){let e=[];for(let t of this.periods)e.push(t.getMetadataSnapshot());return{manifestFormat:1,id:this.id,periods:e,isDynamic:this.isDynamic,isLive:this.isLive,isLastPeriodKnown:this.isLastPeriodKnown,suggestedPresentationDelay:this.suggestedPresentationDelay,clockOffset:this.clockOffset,uris:this.uris,availabilityStartTime:this.availabilityStartTime,timeBounds:this.timeBounds}}_performUpdate(e,t){this.availabilityStartTime=e.availabilityStartTime,this.expired=e.expired,this.isDynamic=e.isDynamic,this.isLive=e.isLive,this.isLastPeriodKnown=e.isLastPeriodKnown,this.lifetime=e.lifetime,this.clockOffset=e.clockOffset,this.suggestedPresentationDelay=e.suggestedPresentationDelay,this.transport=e.transport,this.publishTime=e.publishTime;let r;if(t===0)this.timeBounds=e.timeBounds,this.uris=e.uris,r=bo(this.periods,e.periods);else{this.timeBounds.maximumTimeData=e.timeBounds.maximumTimeData,this.updateUrl=e.uris[0],r=So(this.periods,e.periods);let i=this.getMinimumSafePosition();for(;this.periods.length>0;){let a=this.periods[0];if(a.end===void 0||a.end>i)break;this.periods.shift()}}this.adaptations=this.periods[0]===void 0?{}:this.periods[0].adaptations,this.trigger(\"manifestUpdate\",r)}};function Fu(n,e){let t=[];for(let r of n.periods)for(let i of r.getAdaptations())for(let a of i.representations){let o={manifest:n,period:r,adaptation:i,representation:a},s=e(o);s!==a.decipherable&&(t.push(o),a.decipherable=s,m.debug(`Decipherability changed for \"${a.id}\"`,`(${a.bitrate})`,String(a.decipherable)))}return t}function et(n,e){return n.segment.id===e.segment.id&&n.representation.uniqueId===e.representation.uniqueId}function Rt(n){if(v(n))return\"\";let{period:e,adaptation:t,representation:r,segment:i}=n,a;return i.isInit?a=\"init\":i.complete?a=`${i.time}-${i.duration}`:a=`${i.time}`,`${t.type} P: ${e.id} A: ${t.id} R: ${r.id} S: ${a}`}var Ft=on;var pt=se,Pt=pt===void 0?void 0:v(pt.MediaSource)?v(pt.MozMediaSource)?v(pt.WebKitMediaSource)?pt.MSMediaSource:pt.WebKitMediaSource:pt.MozMediaSource:pt.MediaSource;var zu=200,lr=new Map;function oi(n){if(v(Pt))return lt&&m.error(\"Compat: Cannot request codec support in a worker without MSE.\"),!1;if(typeof Pt.isTypeSupported==\"function\"){let e=lr.get(n);if(e!==void 0)return e;{let t=Pt.isTypeSupported(n);return lr.size>=zu&&lr.clear(),lr.set(n,t),t}}return!0}var Wu=50,si=class{constructor(){this._cachedCodecSupport=new Map}isSupported(e,t){let r=`${e!=null?e:\"\"};codecs=\"${t!=null?t:\"\"}\"`,i=this._cachedCodecSupport.get(r);if(i!==void 0)return i;this._cachedCodecSupport.size>=Wu&&this._cachedCodecSupport.clear();let a=oi(r);return this._cachedCodecSupport.set(r,a),a}},Vu=new si,yo=Vu;var ui=class{constructor(){this._currentCacheSize=0,this._cachedCodecSupport=new Map}isSupported(e,t){var i;let r=(i=this._cachedCodecSupport.get(e))==null?void 0:i.get(t);if(r!==void 0)return r}updateCache(e,t,r){this._currentCacheSize>=50&&(this._cachedCodecSupport.clear(),this._currentCacheSize=0);let i=this._cachedCodecSupport.get(e);if(i!==void 0)i.set(t,r);else{let a=new Map;a.set(t,r),this._cachedCodecSupport.set(e,a)}}},_o=new ui;var fr=class n extends Error{constructor(e){super(e),Object.setPrototypeOf(this,n.prototype),this.name=\"AssertionError\"}};function Se(n,e){if(b.DEV===b.CURRENT_ENV&&!n)throw new fr(e===void 0?\"invalid assertion\":e)}function We(n){throw new fr(\"Unreachable path taken\")}var qu=\"<\";var To=\">\";var Hu=`\\r\n\t>/= `;function di(n,e={}){var c,p;let t=(c=e.pos)!=null?c:0,r=e.keepComments===!0,i=e.keepWhitespace===!0,a;if(e.attrValue!==void 0)for(e.attrName=(p=e.attrName)!=null?p:\"id\",a=[];(t=d())!==-1;)t=n.lastIndexOf(\"<\",t),t!==-1&&a.push(f()),n=n.substring(t),t=0;else a=o(\"\");return e.filter&&(a=Eo(a,e.filter)),a;function o(g){let h=[];for(;n[t];)if(n.charCodeAt(t)===60){if(n.charCodeAt(t+1)===47){let y=t+2;if(t=n.indexOf(To,t),n.substring(y,t).indexOf(g)===-1){let R=n.substring(0,t).split(`\n`);throw new Error(`Unexpected close tag\nLine: `+(R.length-1)+`\nColumn: `+(R[R.length-1].length+1)+`\nChar: `+n[t])}return t!==-1&&(t+=1),h}else if(n.charCodeAt(t+1)===33){if(n.charCodeAt(t+2)===45){let y=t;for(;t!==-1&&!(n.charCodeAt(t)===62&&n.charCodeAt(t-1)===45&&n.charCodeAt(t-2)===45);)t=n.indexOf(To,t+1);t===-1&&(t=n.length),r&&h.push(n.substring(y,t+1))}else if(n.charCodeAt(t+2)===91&&n.charCodeAt(t+8)===91&&n.substring(t+3,t+8).toLowerCase()===\"cdata\"){let y=n.indexOf(\"]]>\",t);y===-1?(h.push(n.substring(t+9)),t=n.length):(h.push(n.substring(t+9,y)),t=y+3);continue}else{let y=t+1;t+=2;let _=!1;for(;(n.charCodeAt(t)!==62||_)&&n[t];)n.charCodeAt(t)===91?_=!0:_&&n.charCodeAt(t)===93&&(_=!1),t++;h.push(n.substring(y,t))}t++;continue}let I=f();h.push(I),I.tagName[0]===\"?\"&&(h.push(...I.children),I.children=[])}else{let I=s();if(i)I.length>0&&h.push(I);else{let y=I.trim();y.length>0&&h.push(y)}t++}return h}function s(){let g=t;return t=n.indexOf(qu,t)-1,t===-2&&(t=n.length),n.slice(g,t+1)}function u(){let g=t;for(;Hu.indexOf(n[t])===-1&&n[t];)t++;return n.slice(g,t)}function f(){let g=t;t++;let h=u(),I={},y=[];for(;n.charCodeAt(t)!==62&&n[t];){let _=n.charCodeAt(t);if(_>64&&_<91||_>96&&_<123){let R=u(),T=n.charCodeAt(t);for(;T&&T!==39&&T!==34&&!(T>64&&T<91||T>96&&T<123)&&T!==62;)t++,T=n.charCodeAt(t);let C;T===39||T===34?C=l():(C=null,t--),I[R]=C===null?null:Ro(C)}t++}return n.charCodeAt(t-1)!==47?(t++,y=o(h)):t++,{tagName:h,attributes:I,children:y,posStart:g,posEnd:t}}function l(){let g=n[t],h=t+1;return t=n.indexOf(g,h),n.slice(h,t)}function d(){let g=new RegExp(\"\\\\s\"+e.attrName+`\\\\s*=['\"]`+e.attrValue+`['\"]`).exec(n);return g?g.index:-1}}function Eo(n,e,t=0,r=\"\"){let i=[];return n.forEach(function(a,o){if(typeof a==\"object\"&&(e(a,o,t,r)&&i.push(a),a.children.length>0)){let s=Eo(a.children,e,t+1,(r?r+\".\":\"\")+o+\".\"+a.tagName);i=i.concat(s)}}),i}function cr(n){if(Array.isArray(n)){let e=\"\";return n.forEach(function(t){e+=\" \"+cr(t),e=e.trim()}),e}else return typeof n==\"object\"?cr(n.children):\" \"+Ro(n)}function Ro(n){return n.indexOf(\"&\")<0?n:n.replace(/&lt;/g,\"<\").replace(/&gt;/g,\">\").replace(/&quot;/g,'\"').replace(/&apos;/g,\"'\").replace(/&#x([A-Fa-f0-9]+);/g,(e,t)=>String.fromCharCode(parseInt(t,16))).replace(/&amp;/g,\"&\")}function li(n,e,t){let{repeatCount:r}=n;if(r>=0)return r;let i;return v(e)?t!==void 0?i=t:i=Number.MAX_VALUE:i=e.start,Math.ceil((i-n.start)/n.duration)-1}function Be(n,e,t){let{start:r,duration:i}=n;if(i<=0)return r;let a=li(n,e,t);return r+(a+1)*i}function Pe(n,e){var t;return n*e.timescale+((t=e.indexTimeOffset)!=null?t:0)}function Qe(n,e){var t;return(n-((t=e.indexTimeOffset)!=null?t:0))/e.timescale}function Po(n,e,t){return[n*t,(n+e)*t]}function Gu(n,e){let t=0,r=n.length;for(;t<r;){let i=t+r>>>1;n[i].start<=e?t=i+1:r=i}return t-1}function vo(n,e,t){let{timeline:r}=n,i=Pe(e,n);if(i<0)return null;let a=Gu(r,i);if(a<0||a>=r.length-1)return null;let o=r[a];if(o.duration<=0)return null;let s=r[a+1];if(s===void 0)return null;let u=s.start,f=Be(o,s,t);return i>=f&&i<u?Qe(u,n):null}function tt(n,e){var i;let{initialization:t}=n,r={};return e!==void 0&&(r.isEMSGWhitelisted=e),{id:\"init\",isInit:!0,time:0,end:0,duration:0,timescale:1,range:v(t)?void 0:t.range,indexRange:n.indexRange,url:(i=t==null?void 0:t.url)!=null?i:null,complete:!0,privateInfos:r,timestampOffset:-(n.indexTimeOffset/n.timescale)}}function Ku(n,e){let t=n.toString();return t.length>=e?t:(new Array(e+1).join(\"0\")+t).slice(-e)}function fi(n){return(e,t,r)=>{let i=ee(r)?parseInt(r,10):1;return Ku(String(n),i)}}function Ne(n,e,t){return ju(n,e,t)}function ju(n,e,t){return n.indexOf(\"$\")===-1?n:n.replace(/\\$\\$/g,\"$\").replace(/\\$RepresentationID\\$/g,String(e)).replace(/\\$Bandwidth(\\%0(\\d+)d)?\\$/g,fi(t===void 0?0:t))}function mr(n,e){return function(r){return r.indexOf(\"$\")===-1?r:r.replace(/\\$\\$/g,\"$\").replace(/\\$Number(\\%0(\\d+)d)?\\$/g,(i,a,o)=>{if(e===void 0)throw new Error(\"Segment number not defined in a $Number$ scheme\");return fi(e)(i,a,o)}).replace(/\\$Time(\\%0(\\d+)d)?\\$/g,(i,a,o)=>{if(n===void 0)throw new Error(\"Segment time not defined in a $Time$ scheme\");return fi(n)(i,a,o)})}}function Yu(n,e,t){let r=t-n;return r>0?Math.floor(r/e):0}function sn(n,e,t,r,i,a){var _;let o=r.getEstimatedMaximumPosition((_=n.availabilityTimeOffset)!=null?_:0),s=Math.min(e+t,o!=null?o:1/0),u=Pe(e,n),f=Pe(s,n),{timeline:l,timescale:d,segmentUrlTemplate:c,startNumber:p,endNumber:g}=n,h=p!=null?p:1,I=[],y=l.length;for(let R=0;R<y;R++){let T=l[R],{duration:C,start:E,range:k}=T,x;o===void 0?x=i:x=Math.min(o*d,i!=null?i:1/0);let P=li(T,l[R+1],x),A=n.availabilityTimeComplete!==!1||R!==y-1&&P!==0,M=Yu(E,C,u),D=E+M*C;for(;D<f&&M<=P;){let w=h+M;if(g!==void 0&&w>g)break;let O=c===null?null:mr(D,w)(c),N=D-n.indexTimeOffset,W=C;N<0&&(W=C+N,N=0);let q={id:String(D),time:N/d,end:(N+W)/d,duration:W/d,isInit:!1,range:k,timescale:1,url:O,number:w,timestampOffset:-(n.indexTimeOffset/d),complete:A,privateInfos:{isEMSGWhitelisted:a}};I.push(q),M++,D=E+M*C}if(D>=f||(h+=P+1,g!==void 0&&h>g))return I}return I}function Qu(n,e){if(e.timescale!==n.timescale){let{timescale:t}=n;n.timeline.push({start:e.time/e.timescale*t,duration:e.duration/e.timescale*t,repeatCount:e.count===void 0?0:e.count,range:e.range})}else n.timeline.push({start:e.time,duration:e.duration,repeatCount:e.count===void 0?0:e.count,range:e.range});return!0}var vt=class{constructor(e,t){var g,h,I,y;let{periodStart:r,periodEnd:i,representationId:a,representationBitrate:o,isEMSGWhitelisted:s}=t,u=(g=e.timescale)!=null?g:1,l=((h=e.presentationTimeOffset)!=null?h:0)-r*u,d=((I=e.initialization)==null?void 0:I.media)===void 0?null:Ne(e.initialization.media,a,o),c=e.media===void 0?null:Ne(e.media,a,o),p;e.initialization!==void 0?p=e.initialization.range:e.indexRange!==void 0&&(p=[0,e.indexRange[0]-1]),this._index={indexRange:e.indexRange,indexTimeOffset:l,initialization:{url:d,range:p},segmentUrlTemplate:c,startNumber:e.startNumber,endNumber:e.endNumber,timeline:(y=e.timeline)!=null?y:[],timescale:u},this._manifestBoundsCalculator=t.manifestBoundsCalculator,this._scaledPeriodStart=Pe(r,this._index),this._scaledPeriodEnd=v(i)?void 0:Pe(i,this._index),this._isInitialized=this._index.timeline.length>0,this._isEMSGWhitelisted=s}getInitSegment(){return tt(this._index,this._isEMSGWhitelisted)}getSegments(e,t){return sn(this._index,e,t,this._manifestBoundsCalculator,this._scaledPeriodEnd,this._isEMSGWhitelisted)}shouldRefresh(){return!1}getFirstAvailablePosition(){let e=this._index;return e.timeline.length===0?null:Qe(Math.max(this._scaledPeriodStart,e.timeline[0].start),e)}getLastAvailablePosition(){var i;let{timeline:e}=this._index;if(e.length===0)return null;let t=e[e.length-1],r=Math.min(Be(t,null,this._scaledPeriodEnd),(i=this._scaledPeriodEnd)!=null?i:1/0);return Qe(r,this._index)}getEnd(){return this.getLastAvailablePosition()}awaitSegmentBetween(){return!1}isSegmentStillAvailable(){return!0}checkDiscontinuity(){return null}canBeOutOfSyncError(){return!1}isStillAwaitingFutureSegments(){return!1}isInitialized(){return this._isInitialized}initialize(e){if(!this._isInitialized){for(let t=0;t<e.length;t++)Qu(this._index,e[t]);this._isInitialized=!0}}addPredictedSegments(){m.warn(\"Cannot add predicted segments to a `BaseRepresentationIndex`\")}_replace(e){this._index=e._index,this._isInitialized=e._isInitialized,this._scaledPeriodEnd=e._scaledPeriodEnd,this._isEMSGWhitelisted=e._isEMSGWhitelisted}_update(){m.error(\"Base RepresentationIndex: Cannot update a SegmentList\")}};var Ct=class{constructor(e,t){var p,g,h;if(e.duration===void 0)throw new Error(\"Invalid SegmentList: no duration\");let{periodStart:r,periodEnd:i,representationId:a,representationBitrate:o,isEMSGWhitelisted:s}=t;this._isEMSGWhitelisted=s,this._periodStart=r,this._periodEnd=i;let u=(p=e.presentationTimeOffset)!=null?p:0,f=(g=e.timescale)!=null?g:1,l=u-r*f,d=((h=e.initialization)==null?void 0:h.media)===void 0?null:Ne(e.initialization.media,a,o),c=e.list.map(I=>({url:I.media===void 0?null:Ne(I.media,a,o),mediaRange:I.mediaRange}));this._index={list:c,timescale:f,duration:e.duration,indexTimeOffset:l,indexRange:e.indexRange,initialization:v(e.initialization)?void 0:{url:d,range:e.initialization.range}}}getInitSegment(){let e=tt(this._index);return e.privateInfos===void 0&&(e.privateInfos={}),e.privateInfos.isEMSGWhitelisted=this._isEMSGWhitelisted,e}getSegments(e,t){let r=this._index,{duration:i,list:a,timescale:o}=r,s=i/o,u=e-this._periodStart,[f,l]=Po(u,t,o),d=Math.min(a.length-1,Math.floor(l/i)),c=[],p=Math.floor(f/i);for(;p<=d;){let g=a[p].mediaRange,h=a[p].url,I=p*s+this._periodStart,y={id:String(p),time:I,isInit:!1,range:g,duration:s,timescale:1,end:I+s,url:h,timestampOffset:-(r.indexTimeOffset/o),complete:!0,privateInfos:{isEMSGWhitelisted:this._isEMSGWhitelisted}};c.push(y),p++}return c}shouldRefresh(e,t){return!1}getFirstAvailablePosition(){return this._periodStart}getLastAvailablePosition(){var i;let e=this._index,{duration:t,list:r}=e;return Math.min(r.length*t/e.timescale+this._periodStart,(i=this._periodEnd)!=null?i:1/0)}getEnd(){return this.getLastAvailablePosition()}awaitSegmentBetween(){return!1}isSegmentStillAvailable(){return!0}checkDiscontinuity(){return null}canBeOutOfSyncError(){return!1}isStillAwaitingFutureSegments(){return!1}isInitialized(){return!0}initialize(){m.error(\"A `ListRepresentationIndex` does not need to be initialized\")}addPredictedSegments(){m.warn(\"Cannot add predicted segments to a `ListRepresentationIndex`\")}_replace(e){this._index=e._index}_update(){m.error(\"A `ListRepresentationIndex` cannot be updated\")}};function zt(n){return L.getCurrent().DEFAULT_MAXIMUM_TIME_ROUNDING_ERROR*n}var xt=class{constructor(e,t){var y,_,R;let{availabilityTimeOffset:r,manifestBoundsCalculator:i,isDynamic:a,periodEnd:o,periodStart:s,representationId:u,representationBitrate:f,isEMSGWhitelisted:l}=t,d=(y=e.timescale)!=null?y:1;this._availabilityTimeOffset=r,this._manifestBoundsCalculator=i;let c=(_=e.presentationTimeOffset)!=null?_:0,p=s*d,g=c-p;if(e.duration===void 0)throw new Error(\"Invalid SegmentTemplate: no duration\");let h=((R=e.initialization)==null?void 0:R.media)===void 0?null:Ne(e.initialization.media,u,f),I=e.media===void 0?null:Ne(e.media,u,f);this._index={duration:e.duration,timescale:d,indexRange:e.indexRange,indexTimeOffset:g,initialization:v(e.initialization)?void 0:{url:h,range:e.initialization.range},url:I,presentationTimeOffset:c,startNumber:e.startNumber,endNumber:e.endNumber},this._isDynamic=a,this._periodStart=s,this._scaledRelativePeriodEnd=o===void 0?void 0:(o-s)*d,this._isEMSGWhitelisted=l}getInitSegment(){return tt(this._index,this._isEMSGWhitelisted)}getSegments(e,t){let r=this._index,{duration:i,startNumber:a,endNumber:o,timescale:s,url:u}=r,f=this._periodStart*s,l=this._scaledRelativePeriodEnd,d=e*s-f,c=(e+t)*s-f,p=this._getFirstSegmentStart(),g=this._getLastSegmentStart();if(v(p)||v(g))return[];let h=Math.max(p,d),I=Math.min(g,c);if(I+i<=h)return[];let y=[],_=a!=null?a:1,R=Math.floor(h/i);for(let T=R*i;T<=I;T+=i){let C=R+_;if(o!==void 0&&C>o)return y;let E=!v(l)&&T+i>l?l-T:i,k=T+f,x=T+this._index.presentationTimeOffset,P=u===null?null:mr(x,C)(u),A={id:String(C),number:C,time:k/s,end:(k+E)/s,duration:E/s,timescale:1,isInit:!1,scaledDuration:E/s,url:P,timestampOffset:-(r.indexTimeOffset/s),complete:!0,privateInfos:{isEMSGWhitelisted:this._isEMSGWhitelisted}};y.push(A),R++}return y}getFirstAvailablePosition(){let e=this._getFirstSegmentStart();return v(e)?e:e/this._index.timescale+this._periodStart}getLastAvailablePosition(){let e=this._getLastSegmentStart();if(v(e))return e;let t=this._estimateRelativeScaledEnd();return Math.min(e+this._index.duration,t!=null?t:1/0)/this._index.timescale+this._periodStart}getEnd(){if(!this._isDynamic)return this.getLastAvailablePosition();let e=this._estimateRelativeScaledEnd();if(e===void 0)return;let{timescale:t}=this._index;return(e+this._periodStart*t)/t}awaitSegmentBetween(e,t){if(Se(e<=t),!this._isDynamic)return!1;let{timescale:r}=this._index,i=zt(r),a=this._periodStart*r,o=e*r-a,s=t*r-a,u=this._getLastSegmentStart();if(v(u)){let d=this._estimateRelativeScaledEnd();return d===void 0?s+i>=0:s+i>=0&&o<d-i}let f=u+this._index.duration,l=this._estimateRelativeScaledEnd();return l===void 0?s>f-i:s>f-i&&o<l-i}shouldRefresh(){return!1}checkDiscontinuity(){return null}isSegmentStillAvailable(e){if(e.isInit)return!0;let t=this.getSegments(e.time,.1);return t.length===0?!1:t[0].time===e.time&&t[0].end===e.end&&t[0].number===e.number}canBeOutOfSyncError(){return!1}isStillAwaitingFutureSegments(){if(!this._isDynamic)return!1;let e=this._estimateRelativeScaledEnd();if(e===void 0)return!0;let{timescale:t}=this._index,r=this._getLastSegmentStart();if(v(r))return!0;let i=r+this._index.duration,a=zt(t);return i+a<e}isInitialized(){return!0}initialize(){m.error(\"A `TemplateRepresentationIndex` does not need to be initialized\")}addPredictedSegments(){m.warn(\"Cannot add predicted segments to a `TemplateRepresentationIndex`\")}_replace(e){this._index=e._index,this._isDynamic=e._isDynamic,this._periodStart=e._periodStart,this._scaledRelativePeriodEnd=e._scaledRelativePeriodEnd,this._manifestBoundsCalculator=e._manifestBoundsCalculator}_update(e){this._replace(e)}_getFirstSegmentStart(){var o;if(!this._isDynamic)return 0;if(this._scaledRelativePeriodEnd===0||this._scaledRelativePeriodEnd===void 0){let s=this._manifestBoundsCalculator.getEstimatedMaximumPosition((o=this._availabilityTimeOffset)!=null?o:0);if(s!==void 0&&s<this._periodStart)return null}let{duration:e,timescale:t}=this._index,r=this._manifestBoundsCalculator.getEstimatedMinimumSegmentTime();if(r===void 0)return;let i=r>this._periodStart?(r-this._periodStart)*t:0;return Math.floor(i/e)*e}_getLastSegmentStart(){var a,o;let{duration:e,timescale:t,endNumber:r,startNumber:i=1}=this._index;if(this._isDynamic){let s=this._manifestBoundsCalculator.getEstimatedLiveEdge();if(s!==void 0&&this._scaledRelativePeriodEnd!==void 0&&this._scaledRelativePeriodEnd<s-this._periodStart*this._index.timescale){let d=Math.ceil(this._scaledRelativePeriodEnd/e);return r!==void 0&&r-i+1<d&&(d=r-i+1),(d-1)*e}let u=this._manifestBoundsCalculator.getEstimatedMaximumPosition((a=this._availabilityTimeOffset)!=null?a:0);if(u===void 0)return;let f=(u-this._periodStart)*t;if(f<0)return null;let l=Math.floor(f/e);return r!==void 0&&r-i+1<l&&(l=r-i+1),l<=0?null:(l-1)*e}else{let s=(o=this._scaledRelativePeriodEnd)!=null?o:0,u=Math.ceil(s/e);r!==void 0&&r-i+1<u&&(u=r-i+1);let f=(u-1)*e,l=L.getCurrent().MINIMUM_SEGMENT_SIZE*t;return r!==void 0||s-f>l||u<2?f:(u-2)*e}}_estimateRelativeScaledEnd(){var e,t;if(this._index.endNumber!==void 0){let r=this._index.endNumber-((e=this._index.startNumber)!=null?e:1)+1;return Math.max(Math.min(r*this._index.duration,(t=this._scaledRelativePeriodEnd)!=null?t:1/0),0)}if(this._scaledRelativePeriodEnd!==void 0)return Math.max(this._scaledRelativePeriodEnd,0)}};function ci(n,e){let t=0;for(;n.length>0;){let r=n[0];if(r.start>=e||r.repeatCount===-1)return t;if(r.repeatCount===0)n.shift(),t+=1;else{let i=n[1];if(i!==void 0&&i.start<=e)n.shift(),t+=1;else{if(r.duration<=0)return t;let a=r.start+r.duration,o=1;for(;a<e&&o<=r.repeatCount;)a+=r.duration,o++;if(o>r.repeatCount)n.shift(),t=r.repeatCount+1;else{let s=r.repeatCount-o;return r.start=a,r.repeatCount=s,t+=o,t}}}}return t}function mi(n,e){if(n.length===0)return n.push(...e),!0;if(e.length===0)return!1;let t=n.length,r=e[0].start,i=n[t-1];if(Be(i,e[0])<r)throw new X(\"MANIFEST_UPDATE_ERROR\",\"Cannot perform partial update: not enough data\");for(let l=t-1;l>=0;l--){let d=n[l].start;if(d===r){let c=t-l;return n.splice(l,c,...e),!1}else if(d<r){let c=n[l];if(c.start+c.duration>r)return m.warn(\"RepresentationIndex: Manifest update removed all previous segments\"),n.splice(0,t,...e),!0;if(c.repeatCount===void 0||c.repeatCount<=0)return c.repeatCount<0&&(c.repeatCount=Math.floor((r-c.start)/c.duration)-1),n.splice(l+1,t-(l+1),...e),!1;if(c.start+c.duration*(c.repeatCount+1)<=r)return n.splice(l+1,t-(l+1),...e),!1;let g=(r-c.start)/c.duration-1;if(g%1===0&&c.duration===e[0].duration){let h=e[0].repeatCount<0?-1:e[0].repeatCount+g+1;return n.splice(l,t-l,...e),n[l].start=c.start,n[l].repeatCount=h,!1}return m.warn(\"RepresentationIndex: Manifest update removed previous segments\"),n[l].repeatCount=Math.floor(g),n.splice(l+1,t-(l+1),...e),!1}}let o=n[n.length-1],s=e[e.length-1];if(o.repeatCount!==void 0&&o.repeatCount<0)return o.start>s.start?(m.warn(\"RepresentationIndex: The new index is older than the previous one\"),!1):(m.warn('RepresentationIndex: The new index is \"bigger\" than the previous one'),n.splice(0,t,...e),!0);let u=o.start+o.duration*(o.repeatCount+1),f=s.start+s.duration*(s.repeatCount+1);return u>=f?(m.warn(\"RepresentationIndex: The new index is older than the previous one\"),!1):(m.warn('RepresentationIndex: The new index is \"bigger\" than the previous one'),n.splice(0,t,...e),!0)}function un(n,e,t){let r=n.start,i=n.duration,a=n.repeatCount;return r===void 0&&(e===null?r=0:v(e.duration)||(r=e.start+e.duration*(e.repeatCount+1))),(i===void 0||isNaN(i))&&t!==null&&t.start!==void 0&&!isNaN(t.start)&&r!==void 0&&!isNaN(r)&&(i=t.start-r),r!==void 0&&!isNaN(r)&&i!==void 0&&!isNaN(i)&&(a===void 0||!isNaN(a))?{start:r,duration:i,repeatCount:a===void 0?0:a}:(m.warn('DASH: A \"S\" Element could not have been parsed.'),null)}function dn(n){let e={};for(let t of Object.keys(n.attributes)){let r=n.attributes[t];if(!v(r))switch(t){case\"t\":let i=parseInt(r,10);isNaN(i)?m.warn(`DASH: invalid t (\"${r}\")`):e.start=i;break;case\"d\":let a=parseInt(r,10);isNaN(a)?m.warn(`DASH: invalid d (\"${r}\")`):e.duration=a;break;case\"r\":let o=parseInt(r,10);isNaN(o)?m.warn(`DASH: invalid r (\"${r}\")`):e.repeatCount=o;break}}return e}function ln(n){let e={};for(let t=0;t<n.attributes.length;t++){let r=n.attributes[t];switch(r.name){case\"t\":let i=parseInt(r.value,10);isNaN(i)?m.warn(`DASH: invalid t (\"${r.value}\")`):e.start=i;break;case\"d\":let a=parseInt(r.value,10);isNaN(a)?m.warn(`DASH: invalid d (\"${r.value}\")`):e.duration=a;break;case\"r\":let o=parseInt(r.value,10);isNaN(o)?m.warn(`DASH: invalid r (\"${r.value}\")`):e.repeatCount=o;break}}return e}function gt(n){let e=[];if(Array.isArray(n))for(let r=0;r<n.length;r++)e.push(dn(n[r]));else for(let r=0;r<n.length;r++)e.push(ln(n[r]));let t=[];for(let r=0;r<e.length;r++){let i=e[r],a=t[t.length-1]===void 0?null:t[t.length-1],o=e[r+1]===void 0?null:e[r+1],s=un(i,a,o);s!==null&&t.push(s)}return t}function pi(n,e){if(n.length===0||e.length===0)return null;let t=n[0].start,r=Array.isArray(e)?e[0].attributes.t:e[0].getAttribute(\"t\"),i=v(r)?null:parseInt(r,10);if(i===null||Number.isNaN(i))return null;if(t===i)return{prevSegmentsIdx:0,newElementsIdx:0,repeatNumberInPrevSegments:0,repeatNumberInNewElements:0};if(t<i){let a=n[0],o=0;for(;;){if(a.repeatCount>0){let s=i-a.start;if(s%a.duration===0&&s/a.duration<=a.repeatCount)return{repeatNumberInPrevSegments:s/a.duration,prevSegmentsIdx:o,newElementsIdx:0,repeatNumberInNewElements:0}}if(o++,o>=n.length)return null;if(a=n[o],a.start===i)return{prevSegmentsIdx:o,newElementsIdx:0,repeatNumberInPrevSegments:0,repeatNumberInNewElements:0};if(a.start>i)return null}}else{let a=0,o=Array.isArray(e)?e[0]:null,s=Array.isArray(e)?null:e[0],u=i;for(;;){let f=o!==null?o.attributes.d:s==null?void 0:s.getAttribute(\"d\"),l=v(f)?null:parseInt(f,10);if(l===null||Number.isNaN(l))return null;let d=o!==null?o.attributes.r:s==null?void 0:s.getAttribute(\"r\"),c=v(d)?null:parseInt(d,10);if(c!==null){if(Number.isNaN(c)||c<0)return null;if(c>0){let h=t-u;if(h%l===0&&h/l<=c)return{repeatNumberInPrevSegments:0,repeatNumberInNewElements:h/l,prevSegmentsIdx:0,newElementsIdx:a}}u+=l*(c+1)}else u+=l;if(a++,a>=e.length)return null;Array.isArray(e)?o=e[a]:s=e[a];let p=o!==null?o.attributes.t:s==null?void 0:s.getAttribute(\"t\"),g=v(p)?null:parseInt(p,10);if(g!==null){if(Number.isNaN(g))return null;u=g}if(u===t)return{newElementsIdx:a,prevSegmentsIdx:0,repeatNumberInPrevSegments:0,repeatNumberInNewElements:0};if(u>i)return null}}}function gi(n,e){var h;let t=pi(e,n);if(t===null)return m.warn('DASH: Cannot perform \"based\" update. Common segment not found.'),gt(n);let{prevSegmentsIdx:r,newElementsIdx:i,repeatNumberInPrevSegments:a,repeatNumberInNewElements:o}=t,u=e.length-r+i-1;if(u>=n.length)return m.info('DASH: Cannot perform \"based\" update. New timeline too short'),gt(n);let f=e.slice(r);if(a>0){let I=f[0];I.start+=I.duration*a,f[0].repeatCount-=a}if(o>0&&i!==0)return m.info('DASH: Cannot perform \"based\" update. The new timeline has a different form.'),gt(n);let l=f[f.length-1],d=Array.isArray(n)?dn(n[u]):ln(n[u]),c=((h=d.repeatCount)!=null?h:0)-o;if(d.duration!==l.duration||l.repeatCount>c)return m.info('DASH: Cannot perform \"based\" update. The new timeline has a different form at the beginning.'),gt(n);d.repeatCount!==void 0&&d.repeatCount>l.repeatCount&&(l.repeatCount=d.repeatCount);let p=[],g=[];if(Array.isArray(n))for(let I=u+1;I<n.length;I++)g.push(dn(n[I]));else for(let I=u+1;I<n.length;I++)g.push(ln(n[I]));for(let I=0;I<g.length;I++){let y=g[I],_=p[p.length-1]===void 0?l:p[p.length-1],R=g[I+1]===void 0?null:g[I+1],T=un(y,_,R);T!==null&&p.push(T)}return f.concat(p)}var fn=class n{constructor(e,t){var T,C,E,k,x;if(!n.isTimelineIndexArgument(e))throw new Error(\"The given index is not compatible with a TimelineRepresentationIndex.\");let{availabilityTimeComplete:r,availabilityTimeOffset:i,manifestBoundsCalculator:a,isDynamic:o,isLastPeriod:s,representationId:u,representationBitrate:f,periodStart:l,periodEnd:d,isEMSGWhitelisted:c}=t,p=(T=e.timescale)!=null?T:1,g=(C=e.presentationTimeOffset)!=null?C:0,h=l*p,I=g-h;this._manifestBoundsCalculator=a,this._isEMSGWhitelisted=c,this._isLastPeriod=s,this._lastUpdate=(E=t.receivedTime)!=null?E:U(),this._unsafelyBaseOnPreviousIndex=null,t.unsafelyBaseOnPreviousRepresentation!==null&&t.unsafelyBaseOnPreviousRepresentation.index instanceof n&&(t.unsafelyBaseOnPreviousRepresentation.index._unsafelyBaseOnPreviousIndex=null,this._unsafelyBaseOnPreviousIndex=t.unsafelyBaseOnPreviousRepresentation.index),this._isDynamic=o,this._parseTimeline=(k=e.timelineParser)!=null?k:null;let y=((x=e.initialization)==null?void 0:x.media)===void 0?null:Ne(e.initialization.media,u,f),_=e.media===void 0?null:Ne(e.media,u,f),R;i===void 0&&r===void 0?R=1/0:R=i!=null?i:0,this._index={availabilityTimeComplete:r!=null?r:!0,availabilityTimeOffset:R,indexRange:e.indexRange,indexTimeOffset:I,initialization:v(e.initialization)?void 0:{url:y,range:e.initialization.range},segmentUrlTemplate:_,startNumber:e.startNumber,endNumber:e.endNumber,timeline:e.timeline===void 0?null:hi(e.timeline,e.startNumber,e.endNumber),timescale:p},this._scaledPeriodStart=Pe(l,this._index),this._scaledPeriodEnd=d===void 0?void 0:Pe(d,this._index)}getInitSegment(){return tt(this._index,this._isEMSGWhitelisted)}getSegments(e,t){return this._refreshTimeline(),this._index.timeline===null&&(this._index.timeline=this._getTimeline()),sn(this._index,e,t,this._manifestBoundsCalculator,this._scaledPeriodEnd,this._isEMSGWhitelisted)}shouldRefresh(){return!1}getFirstAvailablePosition(){this._refreshTimeline(),this._index.timeline===null&&(this._index.timeline=this._getTimeline());let e=this._index.timeline;return e.length===0?null:Qe(Math.max(this._scaledPeriodStart,e[0].start),this._index)}getLastAvailablePosition(){var r;this._refreshTimeline(),this._index.timeline===null&&(this._index.timeline=this._getTimeline());let e=pr(this._index,this._manifestBoundsCalculator,this._scaledPeriodEnd);if(e===null)return null;let t=Math.min(e.end,(r=this._scaledPeriodEnd)!=null?r:1/0);return Qe(t,this._index)}getEnd(){var r;if(this._isDynamic&&!this._isLastPeriod)return;if(this._refreshTimeline(),this._index.timeline===null&&(this._index.timeline=this._getTimeline()),this._index.timeline.length<=0)return null;let e=this._index.timeline[this._index.timeline.length-1],t=Math.min(Be(e,null,this._scaledPeriodEnd),(r=this._scaledPeriodEnd)!=null?r:1/0);return Qe(t,this._index)}awaitSegmentBetween(e,t){var f,l;if(Se(e<=t),!this._isDynamic)return!1;this._refreshTimeline(),this._index.timeline===null&&(this._index.timeline=this._getTimeline());let{timescale:r,timeline:i}=this._index,a=zt(r),o=Pe(t,this._index),s=pr(this._index,this._manifestBoundsCalculator,this._scaledPeriodEnd);if(s!==null&&Math.min(s.end,(f=this._scaledPeriodEnd)!=null?f:1/0)+a>=Math.min(o,(l=this._scaledPeriodEnd)!=null?l:1/0))return!1;let u=Pe(e,this._index);if(i.length>0&&s!==null&&!s.isLastOfTimeline){let d=i[i.length-1],p=Be(d,null,this._scaledPeriodEnd)+a;if(u<p+a)return!0}return this._isLastPeriod?this._scaledPeriodEnd===void 0?o+a>this._scaledPeriodStart?void 0:!1:u-a<this._scaledPeriodEnd&&o+a>this._scaledPeriodStart:!1}isSegmentStillAvailable(e){return e.isInit?!0:(this._refreshTimeline(),this._index.timeline===null&&(this._index.timeline=this._getTimeline()),$u(e,this._index,this._manifestBoundsCalculator,this._scaledPeriodEnd))}checkDiscontinuity(e){this._refreshTimeline();let t=this._index.timeline;return t===null&&(t=this._getTimeline(),this._index.timeline=t),vo({timeline:t,timescale:this._index.timescale,indexTimeOffset:this._index.indexTimeOffset},e,this._scaledPeriodEnd)}canBeOutOfSyncError(e){return this._isDynamic?e instanceof Ye&&e.isHttpError(404):!1}_replace(e){this._parseTimeline=e._parseTimeline,this._index=e._index,this._isDynamic=e._isDynamic,this._scaledPeriodStart=e._scaledPeriodStart,this._scaledPeriodEnd=e._scaledPeriodEnd,this._lastUpdate=e._lastUpdate,this._manifestBoundsCalculator=e._manifestBoundsCalculator,this._isLastPeriod=e._isLastPeriod}_update(e){this._index.timeline===null&&(this._index.timeline=this._getTimeline()),e._index.timeline===null&&(e._index.timeline=e._getTimeline()),mi(this._index.timeline,e._index.timeline)&&(this._index.startNumber=e._index.startNumber),this._index.availabilityTimeOffset=e._index.availabilityTimeOffset,this._index.availabilityTimeComplete=e._index.availabilityTimeComplete,this._index.endNumber=e._index.endNumber,this._isDynamic=e._isDynamic,this._scaledPeriodStart=e._scaledPeriodStart,this._scaledPeriodEnd=e._scaledPeriodEnd,this._lastUpdate=e._lastUpdate,this._isLastPeriod=e._isLastPeriod}isStillAwaitingFutureSegments(){var o;if(!this._isDynamic)return!1;this._refreshTimeline(),this._index.timeline===null&&(this._index.timeline=this._getTimeline());let{timeline:e}=this._index;if(e.length===0){if(this._scaledPeriodEnd!==void 0){let s=this._manifestBoundsCalculator.getEstimatedLiveEdge();if(s!==void 0&&Pe(s,this._index)>this._scaledPeriodEnd)return!1}return this._isLastPeriod}let t=zt(this._index.timescale),r=pr(this._index,this._manifestBoundsCalculator,this._scaledPeriodEnd);if(r!==null&&!r.isLastOfTimeline){let s=Math.min(r.end,(o=this._scaledPeriodEnd)!=null?o:1/0);return!(this._scaledPeriodEnd!==void 0&&s+t>=this._scaledPeriodEnd)}if(!this._isLastPeriod)return!1;if(this._scaledPeriodEnd===void 0)return!0;let i=e[e.length-1];return Be(i,null,this._scaledPeriodEnd)+t<this._scaledPeriodEnd}isInitialized(){return!0}initialize(){m.error(\"A `TimelineRepresentationIndex` does not need to be initialized\")}addPredictedSegments(){m.warn(\"Cannot add predicted segments to a `TimelineRepresentationIndex`\")}static isTimelineIndexArgument(e){return typeof e.timelineParser==\"function\"||Array.isArray(e.timeline)}_refreshTimeline(){if(this._index.timeline===null&&(this._index.timeline=this._getTimeline()),!this._isDynamic)return;let e=this._manifestBoundsCalculator.getEstimatedMinimumSegmentTime();if(v(e))return;let t=Pe(e,this._index),r=ci(this._index.timeline,t);this._index.startNumber!==void 0?this._index.startNumber+=r:this._index.endNumber!==void 0&&(this._index.startNumber=r+1)}_getTimeline(){if(this._parseTimeline===null)return this._index.timeline!==null?this._index.timeline:(m.error(\"DASH: Timeline already lazily parsed.\"),[]);let e=this._parseTimeline();this._parseTimeline=null;let{MIN_DASH_S_ELEMENTS_TO_PARSE_UNSAFELY:t}=L.getCurrent();if(this._unsafelyBaseOnPreviousIndex===null||e.length<t)return hi(gt(e),this._index.startNumber,this._index.endNumber);let r;return this._unsafelyBaseOnPreviousIndex._index.timeline===null?(r=this._unsafelyBaseOnPreviousIndex._getTimeline(),this._unsafelyBaseOnPreviousIndex._index.timeline=r):r=this._unsafelyBaseOnPreviousIndex._index.timeline,this._unsafelyBaseOnPreviousIndex=null,hi(gi(e,r),this._index.startNumber,this._index.endNumber)}};function hi(n,e,t){if(t===void 0)return n;let r=e!=null?e:1;for(let i=0;i<n.length;i++){let a=n[i];if(r+=a.repeatCount+1,r>t){if(r===t+1)return n.slice(0,i+1);{let o=n.slice(0,i),s=J({},a),u=r-a.repeatCount-1;return s.repeatCount=Math.max(0,t-u),o.push(s),o}}}return n}function $u(n,e,t,r){let i=pr(e,t,r);if(i===null)return!1;for(let a=0;a<e.timeline.length;a++){if(i.timelineIdx<a)return!1;let o=e.timeline[a],s=(o.start-e.indexTimeOffset)/e.timescale;if(s>n.time)return!1;if(s===n.time)return o.range===void 0?n.range===void 0:!v(n.range)&&o.range[0]===n.range[0]&&o.range[1]===n.range[1];if(o.repeatCount>=0&&o.duration!==void 0){let f=(s-o.start)/o.duration-1;return f%1===0&&f<=i.newRepeatCount}}return!1}function pr(n,e,t){if(n.timeline.length<=0)return null;if(n.availabilityTimeOffset===1/0){let i=n.timeline.length-1,a=n.timeline[i];return{isLastOfTimeline:!0,timelineIdx:i,newRepeatCount:a.repeatCount,end:Be(a,null,t)}}let r=e.getEstimatedMaximumPosition(n.availabilityTimeOffset);if(r===void 0){let i=n.timeline.length-1,a=n.timeline[i];return{isLastOfTimeline:!0,timelineIdx:i,newRepeatCount:a.repeatCount,end:Be(a,null,t)}}for(let i=n.timeline.length-1;i>=n.timeline.length;i--){let a=n.timeline[i],o=a.start+a.duration;if(Qe(o,n)<=r){let s=Be(a,n.timeline[i+1],t);if(Qe(s,n)<=r)return{isLastOfTimeline:i===n.timeline.length-1,timelineIdx:i,newRepeatCount:a.repeatCount,end:o};{let f=Pe(r,n)-a.start,l=Math.floor(f/a.duration);return Se(l>=1),{isLastOfTimeline:!1,timelineIdx:i,newRepeatCount:l-1,end:a.start+l*a.duration}}}}return null}var gr=fn;function Ue(n,e,t){if(typeof String.prototype.startsWith==\"function\")return n.startsWith(e,t);let r=typeof t==\"number\"?Math.max(t,0):0;return n.substring(r,r+e.length)===e}var Xu=/^(?:[a-z]+:)?\\/\\//i,Zu=/^(?:([^:\\/?#]+):)?(?:\\/\\/([^\\/?#]*))?([^?#]*)(?:\\?([^#]*))?(?:#(.*))?$/;function Si(n){let e=n.lastIndexOf(\"/\");if(e<0)return n.length;if(Xu.test(n)){let r=n.indexOf(\"/\");if(r>=0&&e===r+1)return n.length}let t=n.indexOf(\"?\");return t>=0&&t<e?Si(n.substring(0,t)):e+1}function Ju(n,e){let t=Co(n),r=Co(e);if(r.scheme)return Ii(r);let i={scheme:t.scheme,authority:t.authority,path:\"\",query:r.query,fragment:r.fragment};return r.authority?(i.authority=r.authority,i.path=bi(r.path),Ii(i)):(r.path===\"\"?(i.path=t.path,r.query||(i.query=t.query)):Ue(r.path,\"/\")?i.path=bi(r.path):i.path=bi(td(t,r.path)),Ii(i))}var cn=new Map,ed=200;function Co(n){var r,i,a,o,s;if(cn.has(n))return cn.get(n);let e=n.match(Zu),t;return e===null?t={scheme:\"\",authority:\"\",path:\"\",query:\"\",fragment:\"\"}:t={scheme:(r=e[1])!=null?r:\"\",authority:(i=e[2])!=null?i:\"\",path:(a=e[3])!=null?a:\"\",query:(o=e[4])!=null?o:\"\",fragment:(s=e[5])!=null?s:\"\"},cn.size>=ed&&cn.clear(),cn.set(n,t),t}function Ii(n){let e=\"\";return n.scheme&&(e+=n.scheme+\":\"),n.authority&&(e+=\"//\"+n.authority),e+=n.path,n.query&&(e+=\"?\"+n.query),n.fragment&&(e+=\"#\"+n.fragment),e}function bi(n){let e=n.split(/(?=\\/)/),t=[];for(let r=0;r<e.length;r++){let i=e[r];if(!(i===\"..\"||i===\".\"||i===\"\")){if(i===\"/..\"){t.pop(),r===e.length-1&&t.push(\"/\");continue}if(i===\"/.\"){r===e.length-1&&t.push(\"/\");continue}t.push(i)}}return t.join(\"\")}function td(n,e){if(n.authority&&n.path===\"\")return\"/\"+e;let t=n.path;return t.substring(0,t.lastIndexOf(\"/\")+1)+e}function xo(...n){var r,i,a;let e=n.filter(o=>o!==\"\"),t=e.length;if(t===0)return\"\";if(t===1)return(r=e[0])!=null?r:\"\";{let o=(i=e[0])!=null?i:\"\",s=(a=e[1])!=null?a:\"\",u=Ju(o,s),f=e.slice(2);return xo(u,...f)}}var hr=xo;var mn=class{constructor(){this._refs=new Map,this._stored=[]}addReferences(e){for(let t of e)t.attributes.refId!==void 0&&this._refs.set(t.attributes.refId,t)}add(e,t){this._tryParsing(e,t,!1)||this._stored.push([e,t]),t.attributes.refId!==void 0&&(this._refs.set(t.attributes.refId,t),this._resolveStoredRefs(!1))}finalize(){this._resolveStoredRefs(!0)}_resolveStoredRefs(e){for(let t=this._stored.length-1;t>=0;t--){let[r,i]=this._stored[t];(this._tryParsing(r,i,e)||e)&&this._stored.splice(t,1)}return this._stored.length===0}_tryParsing(e,t,r){if(t.attributes.ref===void 0)return yi(e,t),!0;let i=this._getReferenced(t.attributes.ref);return i===void 0?(r&&(m.warn(\"DASH: forcing the parsing of a referencing ContentProtection\"),yi(e,t)),!1):(t.children.cencPssh.push(...i.children.cencPssh),t.attributes.keyId===void 0&&i.attributes.keyId!==void 0&&(t.attributes.keyId=i.attributes.keyId),t.attributes.schemeIdUri===void 0&&i.attributes.schemeIdUri!==void 0&&(t.attributes.schemeIdUri=i.attributes.schemeIdUri),t.attributes.value===void 0&&i.attributes.value!==void 0&&(t.attributes.value=i.attributes.value),yi(e,t),!0)}_getReferenced(e){return this._refs.get(e)}};function yi(n,e){let t;if(e.attributes.schemeIdUri!==void 0&&e.attributes.schemeIdUri.substring(0,9)===\"urn:uuid:\"&&(t=e.attributes.schemeIdUri.substring(9).replace(/-/g,\"\").toLowerCase()),e.attributes.keyId!==void 0&&e.attributes.keyId.length>0){let o={keyId:e.attributes.keyId,systemId:t};n.contentProtections===void 0?n.contentProtections={keyIds:[o],initData:[]}:n.contentProtections.keyIds===void 0?n.contentProtections.keyIds=[o]:n.contentProtections.keyIds.push(o)}if(t===void 0)return;let{cencPssh:r}=e.children,i=[];for(let o of r)i.push({systemId:t,data:o});if(i.length===0)return;if(n.contentProtections===void 0){n.contentProtections={keyIds:[],initData:[{type:\"cenc\",values:i}]};return}let a=K(n.contentProtections.initData,o=>o.type===\"cenc\");a===void 0?n.contentProtections.initData.push({type:\"cenc\",values:i}):a.values.push(...i)}function Ir(n){let e=Date.parse(n)-U();if(isNaN(e)){m.warn(\"DASH Parser: Invalid clock received: \",n);return}return e}function _i(n){let e=n.children.utcTimings.filter(t=>(t.schemeIdUri===\"urn:mpeg:dash:utc:http-iso:2014\"||t.schemeIdUri===\"urn:mpeg:dash:utc:http-xsdate:2014\")&&t.value!==void 0);return e.length>0?e[0].value:void 0}function br(n){let{representations:e}=n,t=null;for(let r=0;r<e.length;r++){let i=e[r].index.getLastAvailablePosition();if(i===void 0)return;i!==null&&(t=t===null?i:Math.min(t,i))}return t===null?null:t}function Ti(n){for(let e=n.length-1;e>=0;e--){let t=n[e].adaptations,r=t.audio===void 0?void 0:t.audio[0],i=t.video===void 0?void 0:t.video[0];if(r!==void 0||i!==void 0){let a=null,o=null;if(r!==void 0){let s=br(r);if(s===void 0)return{safe:void 0,unsafe:void 0};a=s}if(i!==void 0){let s=br(i);if(s===void 0)return{safe:void 0,unsafe:void 0};o=s}if(r!==void 0&&a===null||i!==void 0&&o===null)return m.info(\"Parser utils: found Period with no segment. \",\"Going to previous one to calculate last position\"),{safe:void 0,unsafe:void 0};if(o!==null)return a!==null?{safe:Math.min(a,o),unsafe:Math.max(a,o)}:{safe:o,unsafe:o};if(a!==null)return{safe:a,unsafe:a}}}return{safe:void 0,unsafe:void 0}}function Sr(n){let{representations:e}=n,t=null;for(let r=0;r<e.length;r++){let i=e[r].index.getFirstAvailablePosition();if(i===void 0)return;i!==null&&(t=t===null?i:Math.max(t,i))}return t===null?null:t}function Ei(n){for(let e=0;e<=n.length-1;e++){let t=n[e].adaptations,r=t.audio===void 0?void 0:t.audio[0],i=t.video===void 0?void 0:t.video[0];if(r!==void 0||i!==void 0){let a=null,o=null;if(r!==void 0){let s=Sr(r);if(s===void 0)return;a=s}if(i!==void 0){let s=Sr(i);if(s===void 0)return;o=s}if(r!==void 0&&a===null||i!==void 0&&o===null){m.info(\"Parser utils: found Period with no segment. \",\"Going to next one to calculate first position\");return}if(o!==null)return a!==null?Math.max(a,o):o;if(a!==null)return a}}}function Ri(n){if(n.length===0)throw new Error(\"DASH Parser: no period available for a dynamic content\");let e=Ei(n),t=Ti(n);return{minimumSafePosition:e,maximumSafePosition:t.safe,maximumUnsafePosition:t.unsafe}}var pn=class{constructor(e){this._isDynamic=e.isDynamic,this._timeShiftBufferDepth=!e.isDynamic||e.timeShiftBufferDepth===void 0?null:e.timeShiftBufferDepth,this._serverTimestampOffset=e.serverTimestampOffset,this._availabilityStartTime=e.availabilityStartTime}setLastPosition(e,t){this._lastPosition=e,this._positionTime=t}lastPositionIsKnown(){return this._isDynamic?this._positionTime!==void 0&&this._lastPosition!==void 0:this._lastPosition!==void 0}getEstimatedMinimumSegmentTime(){var r;if(!this._isDynamic||this._timeShiftBufferDepth===null)return 0;let e=(r=this.getEstimatedLiveEdge())!=null?r:this.getEstimatedMaximumPosition(0);return e===void 0?void 0:e-this._timeShiftBufferDepth}getEstimatedLiveEdge(){if(!(!this._isDynamic||this._serverTimestampOffset===void 0))return(U()+this._serverTimestampOffset)/1e3-this._availabilityStartTime}getEstimatedMaximumPosition(e){if(!this._isDynamic)return this._lastPosition;let t=this.getEstimatedLiveEdge();return t!==void 0&&e!==1/0?t+e:this._positionTime!==void 0&&this._lastPosition!==void 0?Math.max(this._lastPosition-this._positionTime+U()/1e3,0):this._lastPosition}};function Pi(n,e){return n.type!==\"dynamic\"?0:v(n.availabilityStartTime)?e!=null?e:0:n.availabilityStartTime}function vi(n,e){return typeof Array.prototype.flatMap==\"function\"?n.flatMap(e):n.reduce((t,r)=>{let i=e(r);return Array.isArray(i)?(t.push(...i),t):(t.push(i),t)},[])}var nd=typeof se==\"object\"&&typeof se.TextDecoder==\"function\",rd=typeof se==\"object\"&&typeof se.TextEncoder==\"function\";function gn(n){if(rd)try{return new TextEncoder().encode(n)}catch(i){let a=i instanceof Error?i:\"\";m.warn(\"Utils: could not use TextEncoder to encode string into UTF-8, fallbacking to another implementation\",a)}let e,t=encodeURIComponent(n);if(typeof unescape==\"function\")e=unescape(t);else{let i=/[0-9a-fA-F]/,a=t.length;e=\"\";for(let o=0;o<t.length;o++){let s=!1;if(t[o]===\"%\"){if(o<=a-6&&t[o+1]===\"u\"&&i.test(t[o+2])&&i.test(t[o+3])&&i.test(t[o+4])&&i.test(t[o+5])){let u=parseInt(t.substring(o+1,o+6),16);e+=String.fromCharCode(u),s=!0,o+=5}else if(o<=a-3&&i.test(t[o+1])&&i.test(t[o+2])){let u=parseInt(t.substring(o+1,o+3),16);e+=String.fromCharCode(u),s=!0,o+=2}}s||(e+=t[o])}}let r=new Uint8Array(e.length);for(let i=0;i<e.length;i++)r[i]=e.charCodeAt(i)&255;return r}function id(n){let t=\"\";for(let r=0;r<n.length;r+=16e3){let i=n.subarray(r,r+16e3);t+=String.fromCharCode.apply(null,i)}return t}function Ao(n,e){let t=n.toString(16);return t.length>=e?t:new Array(e-t.length+1).join(\"0\")+t}function Le(n){if(nd)try{return new TextDecoder().decode(n)}catch(i){let a=i instanceof Error?i:\"\";m.warn(\"Utils: could not use TextDecoder to parse UTF-8, fallbacking to another implementation\",a)}let e=n;e[0]===239&&e[1]===187&&e[2]===191&&(e=e.subarray(3));let t=id(e),r;if(typeof escape==\"function\")r=escape(t);else{let i=/[A-Za-z0-9*_\\+-\\.\\/]/;r=\"\";for(let a=0;a<t.length;a++)if(i.test(t[a]))r+=t[a];else{let o=t.charCodeAt(a);r+=o>=256?\"%u\"+Ao(o,4):\"%\"+Ao(o,2)}}return decodeURIComponent(r)}function hn(n){let e=n.length,t=new Uint8Array(e/2);for(let r=0,i=0;r<e;r+=2,i++)t[i]=parseInt(n.substring(r,r+2),16)&255;return t}function ko(n,e=\"\"){let t=\"\";for(let r=0;r<n.byteLength;r++)t+=(n[r]>>>4).toString(16),t+=(n[r]&15).toString(16),e.length>0&&r<n.byteLength-1&&(t+=e);return t}function Ci(n,e){let t=e;for(;t<n.length&&n[t]!==0;)t+=1;let r=n.subarray(e,t);return{end:t+1,string:Le(r)}}function xi(n){if(n.length===0)return[];let e=[n[0]];for(let t=1;t<n.length;t++){let r=n[t],i=e[e.length-1];for(;(i.duration===void 0||i.start+i.duration>r.start)&&(m.warn(\"DASH: Updating overlapping Periods.\",i==null?void 0:i.start,r.start),i.duration=r.start-i.start,i.end=r.start,!(i.duration>0));){if(e.pop(),e.length===0)break;i=e[e.length-1]}e.push(r)}return e}function Ai(n,e){let t=[];return n.forEach((r,i)=>{let a;if(!v(r.attributes.start))a=r.attributes.start;else if(i===0)a=!e.isDynamic||v(e.availabilityStartTime)?0:e.availabilityStartTime;else{let f=t[t.length-1];if(!v(f)&&!v(f.periodEnd))a=f.periodEnd;else throw new Error(\"Missing start time when parsing periods.\")}let o,s=n[i+1];v(r.attributes.duration)?i===n.length-1?o=e.duration:v(s.attributes.start)||(o=s.attributes.start-a):o=r.attributes.duration;let u=v(o)?void 0:a+o;t.push({periodStart:a,periodDuration:o,periodEnd:u})}),t}function ad(n,e){for(let t of e){let{adaptation:r,trickModeAttachedAdaptationIds:i}=t;for(let a of i)for(let o of Lt){let s=n[o];if(s!==void 0)for(let u of s)u.id===a&&(u.trickModeTracks===void 0&&(u.trickModeTracks=[]),u.trickModeTracks.push(r))}}}var Mo=ad;var od=[\"subtitle\",\"caption\"];function ki(n,e,t,r){function i(o,s){let u=o.split(\"/\")[0];if(ce(Lt,u))return u;if(o===\"application/ttml+xml\")return\"text\";if(o===\"application/mp4\")return s!==null&&K(s,f=>f.schemeIdUri===\"urn:mpeg:dash:role:2011\"&&ce(od,f.value))!==void 0?\"text\":void 0}function a(o){switch(o.substring(0,3)){case\"avc\":case\"hev\":case\"hvc\":case\"vp8\":case\"vp9\":case\"av1\":return\"video\";case\"vtt\":return\"text\"}switch(o.substring(0,4)){case\"mp4a\":return\"audio\";case\"wvtt\":case\"stpp\":return\"text\"}}if(e!==null){let o=i(e,r);if(o!==void 0)return o}if(t!==null){let o=a(t);if(o!==void 0)return o}for(let o=0;o<n.length;o++){let s=n[o],{mimeType:u,codecs:f}=s.attributes;if(u!==void 0){let l=i(u,r);if(l!==void 0)return l}if(f!==void 0){let l=a(f);if(l!==void 0)return l}}}var sd=/[, ]+/g;function Oo(n){return ee(n)?n.trim().replace(sd,\", \"):\"\"}function wo(n){let[e,t,r,i,a,o,s,u]=n.split(\".\");if(e!==\"vp08\"&&e!==\"vp09\"&&e!==\"vp10\")return;let f,l,d;if((i!==void 0&&i===\"10\"||i===\"12\")&&(f=parseInt(i,10)),s!==void 0&&(s===\"16\"?l=\"pq\":s===\"18\"&&(l=\"hlg\")),o!==void 0&&u!==void 0&&o===\"09\"&&u===\"09\"&&(d=\"rec2020\"),!(f===void 0||l===void 0))return{colorDepth:f,eotf:l,colorSpace:d}}function Mi(n,e){var g,h,I;let{availabilityTimeOffset:t,manifestBoundsCalculator:r,isDynamic:i,end:a,start:o,receivedTime:s,unsafelyBaseOnPreviousRepresentation:u,inbandEventStreams:f,isLastPeriod:l}=e,c={availabilityTimeComplete:void 0,availabilityTimeOffset:t,unsafelyBaseOnPreviousRepresentation:u,isEMSGWhitelisted:y=>f===void 0?!1:f.some(({schemeIdUri:_})=>_===y.schemeIdUri),isLastPeriod:l,manifestBoundsCalculator:r,isDynamic:i,periodEnd:a,periodStart:o,receivedTime:s,representationBitrate:n.attributes.bitrate,representationId:n.attributes.id},p;if(n.children.segmentBase!==void 0){let{segmentBase:y}=n.children;p=new vt(y,c)}else if(n.children.segmentList!==void 0){let{segmentList:y}=n.children;p=new Ct(y,c)}else if(n.children.segmentTemplate!==void 0||e.parentSegmentTemplates.length>0){let y=e.parentSegmentTemplates.slice(),_=n.children.segmentTemplate;_!==void 0&&y.push(_);let R=H({},...y);(R.availabilityTimeOffset!==void 0||e.availabilityTimeOffset!==void 0)&&(c.availabilityTimeOffset=((g=R.availabilityTimeOffset)!=null?g:0)+((h=e.availabilityTimeOffset)!=null?h:0)),(R.availabilityTimeComplete!==void 0||e.availabilityTimeComplete!==void 0)&&(c.availabilityTimeComplete=(I=R.availabilityTimeComplete)!=null?I:e.availabilityTimeComplete),p=gr.isTimelineIndexArgument(R)?new gr(R,c):new xt(R,c)}else{let y=e.adaptation.children;if(y.segmentBase!==void 0){let{segmentBase:_}=y;p=new vt(_,c)}else if(y.segmentList!==void 0){let{segmentList:_}=y;p=new Ct(_,c)}else p=new xt({duration:Number.MAX_VALUE,timescale:1,startNumber:0,media:\"\"},c)}return p}function nt(n,e){var i;if(e.length===0)return n;let t=e.map(a=>({url:a.value}));if(n.length===0)return t;let r=[];for(let a=0;a<n.length;a++){let o=n[a];for(let s=0;s<t.length;s++){let u=t[s],f=hr(o.url,u.url);r.push({url:f,serviceLocation:(i=u.serviceLocation)!=null?i:o.serviceLocation})}}return r}function ud(n,e){let t=[];if(n.children.inbandEventStreams!==void 0&&t.push(...n.children.inbandEventStreams),e.children.inbandEventStreams!==void 0&&t.push(...e.children.inbandEventStreams),t.length!==0)return t}function dd({adaptationProfiles:n,essentialProperties:e,supplementalProperties:t,manifestProfiles:r,codecs:i}){if(((n!=null?n:\"\")+(r!=null?r:\"\")).indexOf(\"http://dashif.org/guidelines/dash-if-uhd#hevc-hdr-pq10\")!==-1&&(i===\"hvc1.2.4.L153.B0\"||i===\"hev1.2.4.L153.B0\"))return{colorDepth:10,eotf:\"pq\",colorSpace:\"rec2020\"};let o=K([...e!=null?e:[],...t!=null?t:[]],s=>s.schemeIdUri===\"urn:mpeg:mpegB:cicp:TransferCharacteristics\");if(o!==void 0)switch(o.value){case\"15\":return;case\"16\":return{eotf:\"pq\"};case\"18\":return{eotf:\"hlg\"}}if(i!==void 0&&/^vp(08|09|10)/.exec(i))return wo(i)}function Oi(n,e,t){var i,a,o,s,u,f,l;let r=[];for(let d of n){let c=d.attributes.id!==void 0?d.attributes.id:String(d.attributes.bitrate)+(d.attributes.height!==void 0?`-${d.attributes.height}`:\"\")+(d.attributes.width!==void 0?`-${d.attributes.width}`:\"\")+(d.attributes.mimeType!==void 0?`-${d.attributes.mimeType}`:\"\")+(d.attributes.codecs!==void 0?`-${d.attributes.codecs}`:\"\");for(;r.some(P=>P.id===c);)c+=\"-dup\";let p=(a=(i=t.unsafelyBaseOnPreviousAdaptation)==null?void 0:i.getRepresentation(c))!=null?a:null,g=ud(d,e),h=(o=d.attributes.availabilityTimeComplete)!=null?o:t.availabilityTimeComplete,I;(d.attributes.availabilityTimeOffset!==void 0||t.availabilityTimeOffset!==void 0)&&(I=((s=d.attributes.availabilityTimeOffset)!=null?s:0)+((u=t.availabilityTimeOffset)!=null?u:0));let y=H({},t,{availabilityTimeOffset:I,availabilityTimeComplete:h,unsafelyBaseOnPreviousRepresentation:p,adaptation:e,inbandEventStreams:g}),_=Mi(d,y),R;d.attributes.bitrate===void 0?(m.warn(\"DASH: No usable bitrate found in the Representation.\"),R=0):R=d.attributes.bitrate;let T=nt(t.baseURLs,d.children.baseURLs),C=T.length===0?[{baseUrl:\"\",id:void 0}]:T.map(P=>({baseUrl:P.url,id:P.serviceLocation})),E={bitrate:R,cdnMetadata:C,index:_,id:c};d.children.supplementalProperties!==void 0&&K(d.children.supplementalProperties,P=>P.schemeIdUri===\"tag:dolby.com,2018:dash:EC3_ExtensionType:2018\"&&P.value===\"JOC\")&&(E.isSpatialAudio=!0);let k;d.attributes.codecs!==void 0?k=d.attributes.codecs:e.attributes.codecs!==void 0&&(k=e.attributes.codecs),k!==void 0&&(k=k===\"mp4a.40.02\"?\"mp4a.40.2\":k,E.codecs=k);let x;d.attributes.supplementalCodecs!==void 0?x=d.attributes.supplementalCodecs:e.attributes.supplementalCodecs!==void 0&&(x=e.attributes.supplementalCodecs),x!==void 0&&(E.supplementalCodecs=Oo(x)),d.attributes.frameRate!==void 0?E.frameRate=d.attributes.frameRate:e.attributes.frameRate!==void 0&&(E.frameRate=e.attributes.frameRate),d.attributes.height!==void 0?E.height=d.attributes.height:e.attributes.height!==void 0&&(E.height=e.attributes.height),d.attributes.mimeType!==void 0?E.mimeType=d.attributes.mimeType:e.attributes.mimeType!==void 0&&(E.mimeType=e.attributes.mimeType),d.attributes.width!==void 0?E.width=d.attributes.width:e.attributes.width!==void 0&&(E.width=e.attributes.width);{let P=[...(f=e.children.contentProtections)!=null?f:[],...(l=d.children.contentProtections)!=null?l:[]];for(let A of P)t.contentProtectionParser.add(E,A)}E.hdrInfo=dd({adaptationProfiles:e.attributes.profiles,supplementalProperties:e.children.supplementalProperties,essentialProperties:e.children.essentialProperties,manifestProfiles:t.manifestProfiles,codecs:k}),r.push(E)}return r}function ld(n){if(n===void 0)return!1;let e=n.schemeIdUri===\"urn:tva:metadata:cs:AudioPurposeCS:2007\"&&n.value===\"1\",t=n.schemeIdUri===\"urn:mpeg:dash:role:2011\"&&n.value===\"description\";return e||t}function fd(n,e){return!!(n!==void 0&&n.some(r=>r.schemeIdUri===\"urn:tva:metadata:cs:AudioPurposeCS:2007\"&&r.value===\"2\")||e!==void 0&&e.some(r=>r.schemeIdUri===\"urn:mpeg:dash:role:2011\"&&r.value===\"caption\"))}function cd(n){return n===void 0?!1:n.schemeIdUri===\"urn:mpeg:dash:role:2011\"&&n.value===\"sign\"}function md(n,e){if(ee(n.attributes.id))return n.attributes.id;let{isClosedCaption:t,isForcedSubtitle:r,isAudioDescription:i,isSignInterpreted:a,isTrickModeTrack:o,type:s}=e,u=s;return ee(n.attributes.language)&&(u+=`-${n.attributes.language}`),t===!0&&(u+=\"-cc\"),r===!0&&(u+=\"-cc\"),i===!0&&(u+=\"-ad\"),a===!0&&(u+=\"-si\"),o&&(u+=\"-trickMode\"),ee(n.attributes.contentType)&&(u+=`-${n.attributes.contentType}`),ee(n.attributes.codecs)&&(u+=`-${n.attributes.codecs}`),ee(n.attributes.mimeType)&&(u+=`-${n.attributes.mimeType}`),n.attributes.frameRate!==void 0&&(u+=`-${String(n.attributes.frameRate)}`),u}function pd(n){if(!v(n.children.supplementalProperties)){let{supplementalProperties:e}=n.children;for(let t of e)if(t.schemeIdUri===\"urn:mpeg:dash:adaptation-set-switching:2016\"&&!v(t.value))return t.value.split(\",\").map(r=>r.trim()).filter(r=>r)}return[]}function wi(n,e){var s,u,f,l,d,c,p;let t={video:[],audio:[],text:[]},r=[],i={},a=[];for(let g=0;g<n.length;g++){let h=n[g],I=h.children,{essentialProperties:y,roles:_,label:R}=I,T=Array.isArray(_)&&_.some(_e=>_e.value===\"main\")&&_.some(_e=>_e.schemeIdUri===\"urn:mpeg:dash:role:2011\"),C=h.children.representations,E=(s=h.attributes.availabilityTimeComplete)!=null?s:e.availabilityTimeComplete,k;(h.attributes.availabilityTimeOffset!==void 0||e.availabilityTimeOffset!==void 0)&&(k=((u=h.attributes.availabilityTimeOffset)!=null?u:0)+((f=e.availabilityTimeOffset)!=null?f:0));let x=h.attributes.mimeType,P=h.attributes.codecs,A=ki(C,ee(x)?x:null,ee(P)?P:null,v(I.roles)?null:I.roles);if(A===void 0)continue;let M=(l=h.attributes.selectionPriority)!=null?l:1,D=h.attributes.id,w=pd(h),O=[];e.segmentTemplate!==void 0&&O.push(e.segmentTemplate),h.children.segmentTemplate!==void 0&&O.push(h.children.segmentTemplate);let N={availabilityTimeComplete:E,availabilityTimeOffset:k,baseURLs:nt(e.baseURLs,I.baseURLs),contentProtectionParser:e.contentProtectionParser,manifestBoundsCalculator:e.manifestBoundsCalculator,end:e.end,isDynamic:e.isDynamic,isLastPeriod:e.isLastPeriod,manifestProfiles:e.manifestProfiles,parentSegmentTemplates:O,receivedTime:e.receivedTime,start:e.start,unsafelyBaseOnPreviousAdaptation:null},W=Array.isArray(y)?K(y,_e=>_e.schemeIdUri===\"http://dashif.org/guidelines/trickmode\"):void 0,q=(d=W==null?void 0:W.value)==null?void 0:d.split(\" \"),Q=q!==void 0,{accessibilities:G}=I,Y;_!==void 0&&_.some(_e=>_e.value===\"dub\")&&(Y=!0);let V;A!==\"text\"?V=!1:V=fd(G,_);let $;A===\"text\"&&_!==void 0&&_.some(_e=>_e.value===\"forced-subtitle\"||_e.value===\"forced_subtitle\")&&($=!0);let le;A!==\"audio\"?le=!1:G!==void 0&&(le=G.some(ld));let ye;A!==\"video\"?ye=!1:G!==void 0&&(ye=G.some(cd));let me=md(h,{isAudioDescription:le,isForcedSubtitle:$,isClosedCaption:V,isSignInterpreted:ye,isTrickModeTrack:Q,type:A});for(;ce(a,me);)me+=\"-dup\";let Ge=me;a.push(me),N.unsafelyBaseOnPreviousAdaptation=(p=(c=e.unsafelyBaseOnPreviousPeriod)==null?void 0:c.getAdaptation(me))!=null?p:null;let De=Oi(C,h,N),he={id:me,representations:De,type:A,isTrickModeTrack:Q};if(v(h.attributes.language)||(he.language=h.attributes.language),v(V)||(he.closedCaption=V),v(le)||(he.audioDescription=le),Y===!0&&(he.isDub=!0),$!==void 0&&(he.forcedSubtitles=$),ye===!0&&(he.isSignInterpreted=!0),R!==void 0&&(he.label=R),q!==void 0)r.push({adaptation:he,trickModeAttachedAdaptationIds:q});else{let _e=-1;for(let Xt of w){let Ke=i[Xt];if(Ke!==void 0&&Ke.newID!==Ge&&ce(Ke.adaptationSetSwitchingIDs,D)){_e=re(t[A],Nt=>Nt[0].id===Xt);let Me=t[A][_e];if(Me!==void 0&&Me[0].audioDescription===he.audioDescription&&Me[0].closedCaption===he.closedCaption&&Me[0].language===he.language){m.info('DASH Parser: merging \"switchable\" AdaptationSets',D,Xt),Me[0].representations.push(...he.representations),Me[1]={priority:Math.max(M,Me[1].priority),isMainAdaptation:T||Me[1].isMainAdaptation,indexInMpd:Math.min(g,Me[1].indexInMpd)};break}}}_e<0&&t[A].push([he,{priority:M,isMainAdaptation:T,indexInMpd:g}])}!v(D)&&v(i[D])&&(i[D]={newID:Ge,adaptationSetSwitchingIDs:w})}let o=Lt.reduce((g,h)=>{let I=t[h];return I.length>0&&(I.sort(Do),g[h]=I.map(([y])=>y)),g},{});return t.video.sort(Do),Mo(o,r),o}function Do(n,e){let t=e[1].priority-n[1].priority;return t!==0?t:n[1].isMainAdaptation!==e[1].isMainAdaptation?n[1].isMainAdaptation?-1:1:n[1].indexInMpd-e[1].indexInMpd}var gd=xe();function Di(n,e){var o,s,u,f,l;let t=[],r=Ai(n,e);if(r.length!==n.length)throw new Error(\"MPD parsing error: the time information are incoherent.\");let{isDynamic:i,manifestBoundsCalculator:a}=e;!i&&!v(e.duration)&&a.setLastPosition(e.duration);for(let d=n.length-1;d>=0;d--){let c=d===n.length-1,p=n[d],g=e.xlinkInfos.get(p),h=nt(e.baseURLs,p.children.baseURLs),{periodStart:I,periodDuration:y,periodEnd:_}=r[d],R;for(v(p.attributes.id)?(m.warn(\"DASH: No usable id found in the Period. Generating one.\"),R=\"gen-dash-period-\"+gd()):R=p.attributes.id;t.some(W=>W.id===R);)R+=\"-dup\";let T=g!==void 0?g.receivedTime:e.receivedTime,C=(s=(o=e.unsafelyBaseOnPreviousManifest)==null?void 0:o.getPeriod(R))!=null?s:null,E=p.attributes.availabilityTimeComplete,k=p.attributes.availabilityTimeOffset,{manifestProfiles:x,contentProtectionParser:P}=e,{segmentTemplate:A}=p.children;P.addReferences((u=p.children.contentProtections)!=null?u:[]);let M={availabilityTimeComplete:E,availabilityTimeOffset:k,baseURLs:h,contentProtectionParser:P,manifestBoundsCalculator:a,end:_,isDynamic:i,isLastPeriod:c,manifestProfiles:x,receivedTime:T,segmentTemplate:A,start:I,unsafelyBaseOnPreviousPeriod:C},D=wi(p.children.adaptations,M),w=((f=e.xmlNamespaces)!=null?f:[]).concat((l=p.attributes.namespaces)!=null?l:[]),O=Id(p.children.eventStreams,I,w),N={id:R,start:I,end:_,duration:y,adaptations:D,streamEvents:O};if(t.unshift(N),!a.lastPositionIsKnown()){let W=hd(D);if(!i)typeof W==\"number\"&&a.setLastPosition(W);else if(typeof W==\"number\"){let q=U()/1e3;a.setLastPosition(W,q)}else{let q=Bo(e,I);if(q!==void 0){let[Q,G]=q;a.setLastPosition(Q,G)}}}}if(e.isDynamic&&!a.lastPositionIsKnown()){let d=Bo(e,0);if(d!==void 0){let[c,p]=d;a.setLastPosition(c,p)}}return xi(t)}function Bo(n,e){if(v(n.clockOffset)){let t=Date.now()/1e3;if(t>=e){m.warn(\"DASH Parser: no clock synchronization mechanism found. Using the system clock instead.\");let r=t-n.availabilityStartTime,i=U()/1e3;return[r,i]}}else{let t=n.clockOffset/1e3-n.availabilityStartTime,r=U()/1e3,i=r+t;if(i>=e)return[i,r]}}function hd(n){let e=null,t=!0,r=dr(n).filter(a=>!v(a)),i=vi(r,a=>a);for(let a of i){let o=a.representations;for(let s of o){let u=s.index.getLastAvailablePosition();u!==null&&(t=!1,typeof u==\"number\"&&(e=v(e)?u:Math.max(e,u)))}}if(v(e)){if(t)return null}else return e}function Id(n,e,t){var i,a;let r=[];for(let o of n){let{schemeIdUri:s=\"\",timescale:u=1}=o.attributes,f=t.concat((i=o.attributes.namespaces)!=null?i:[]);for(let l of o.children.events)if(l.eventStreamData!==void 0){let d=((a=l.presentationTime)!=null?a:0)/u+e,c=l.duration===void 0?void 0:d+l.duration/u,p,g;if(!lt&&l.eventStreamData instanceof Element)p=l.eventStreamData;else try{g={namespaces:f,data:typeof l.eventStreamData==\"string\"?l.eventStreamData:Le(new Uint8Array(l.eventStreamData))}}catch(h){m.error(\"DASH: Error while parsing event-stream:\",h instanceof Error?h.message:\"Unknown error\")}r.push({start:d,end:c,id:l.id,data:{type:\"dash-event-stream\",value:{schemeIdUri:s,timescale:u,element:p,xmlData:g}}})}}return r}function Wt(n,e,t,r,i=new WeakMap){let{children:a,attributes:o}=n;if(v(e.externalClockOffset)){let u=o.type===\"dynamic\",f=K(a.utcTimings,c=>c.schemeIdUri===\"urn:mpeg:dash:utc:direct:2014\"&&!v(c.value)),l=!v(f)&&!v(f.value)?Ir(f.value):void 0,d=!v(l)&&!isNaN(l)?l:void 0;if(!v(d)&&r!==!0)e.externalClockOffset=d;else if(u&&r!==!0){let c=_i(n);if(!v(c)&&c.length>0)return{type:\"needs-clock\",value:{url:c,continue:function(g){return g.success?(e.externalClockOffset=Ir(g.data),Wt(n,e,t,!0)):(t.push(g.error),m.warn(\"DASH Parser: Error on fetching the clock ressource\",g.error),Wt(n,e,t,!0))}}}}}let s=[];for(let u=0;u<a.periods.length;u++){let{xlinkHref:f,xlinkActuate:l}=a.periods[u].attributes;!v(f)&&l===\"onLoad\"&&s.push({index:u,ressource:f})}return s.length===0?bd(n,e,t,i):{type:\"needs-xlinks\",value:{xlinksUrls:s.map(({ressource:u})=>u),continue:function(f){if(f.length!==s.length)throw new Error(\"DASH parser: wrong number of loaded ressources.\");for(let l=f.length-1;l>=0;l--){let d=s[l].index,{parsed:c,warnings:p,receivedTime:g,sendingTime:h,url:I}=f[l];p.length>0&&t.push(...p);for(let y of c)i.set(y,{receivedTime:g,sendingTime:h,url:I});a.periods.splice(d,1,...c)}return Wt(n,e,t,r,i)}}}}function bd(n,e,t,r){var w,O,N,W,q;let{children:i,attributes:a}=n,o=a.type===\"dynamic\",s=e.url!==void 0?[{url:e.url.substring(0,Si(e.url))}]:[],u=nt(s,i.baseURLs),f=Pi(a,e.referenceDateTime),l=a.timeShiftBufferDepth,{externalClockOffset:d,unsafelyBaseOnPreviousManifest:c}=e,{externalClockOffset:p}=e,g=new pn({availabilityStartTime:f,isDynamic:o,timeShiftBufferDepth:l,serverTimestampOffset:p}),h=new mn;h.addReferences((w=i.contentProtections)!=null?w:[]);let I={availabilityStartTime:f,baseURLs:u,clockOffset:d,contentProtectionParser:h,duration:a.duration,isDynamic:o,manifestBoundsCalculator:g,manifestProfiles:n.attributes.profiles,receivedTime:e.manifestReceivedTime,timeShiftBufferDepth:l,unsafelyBaseOnPreviousManifest:c,xlinkInfos:r,xmlNamespaces:n.attributes.namespaces},y=Di(i.periods,I);h.finalize();let _=a.duration,R,T,C=null,E;a.minimumUpdatePeriod!==void 0&&a.minimumUpdatePeriod>=0&&(R=a.minimumUpdatePeriod===0?L.getCurrent().DASH_FALLBACK_LIFETIME_WHEN_MINIMUM_UPDATE_PERIOD_EQUAL_0:a.minimumUpdatePeriod);let{minimumSafePosition:k,maximumSafePosition:x,maximumUnsafePosition:P}=Ri(y),A=U();if(o){let Q;x!==void 0?Q=x:p===void 0?(m.warn(\"DASH Parser: use system clock to define maximum position\"),Q=Date.now()/1e3-f):Q=(U()+p)/1e3-f;let G=g.getEstimatedLiveEdge();G===void 0&&(P!==void 0?G=P:G=Q),E={isLinear:!0,maximumSafePosition:Q,livePosition:G,time:A},T=k,C=l!=null?l:null,C!==null&&T!==void 0&&G-T>C&&(C=G-T)}else{T=k,T===void 0&&(T=(N=(O=y[0])==null?void 0:O.start)!=null?N:0);let Q=_!=null?_:1/0;if(y[y.length-1]!==void 0){let G=y[y.length-1],Y=(W=G.end)!=null?W:G.duration!==void 0?G.start+G.duration:void 0;Y!==void 0&&Y<Q&&(Q=Y)}x!==void 0&&x<Q&&(Q=x),E={isLinear:!1,maximumSafePosition:Q,livePosition:void 0,time:A}}let M=!o||n.attributes.minimumUpdatePeriod===void 0&&(((q=y[y.length-1])==null?void 0:q.end)!==void 0||n.attributes.duration!==void 0);return{type:\"done\",value:{parsed:{availabilityStartTime:f,clockOffset:e.externalClockOffset,isDynamic:o,isLive:o,isLastPeriodKnown:M,periods:y,publishTime:a.publishTime,suggestedPresentationDelay:a.suggestedPresentationDelay,transportType:\"dash\",timeBounds:{minimumSafePosition:T,timeshiftDepth:C,maximumTimeData:E},lifetime:R,uris:v(e.url)?i.locations:[e.url,...i.locations]},warnings:t}}}var yr=Wt;var No=[255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,62,255,255,255,63,52,53,54,55,56,57,58,59,60,61,255,255,255,0,255,255,255,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,255,255,255,255,255,255,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51];function _r(n){if(n>=No.length)throw new Error(\"Unable to parse base64 string.\");let e=No[n];if(e===255)throw new Error(\"Unable to parse base64 string.\");return e}function Tr(n){let e=n.length%4,t=n;e!==0&&(m.warn(\"base64ToBytes: base64 given miss padding\"),t+=e===3?\"=\":e===2?\"==\":\"===\");let r=t.indexOf(\"=\");if(r!==-1&&r<t.length-2)throw new Error(\"Unable to parse base64 string.\");let i=t.endsWith(\"==\")?2:t.endsWith(\"=\")?1:0,a=t.length,o=new Uint8Array(a/4*3),s;for(let u=0,f=0;u<a;u+=4,f+=3)s=_r(t.charCodeAt(u))<<18|_r(t.charCodeAt(u+1))<<12|_r(t.charCodeAt(u+2))<<6|_r(t.charCodeAt(u+3)),o[f]=s>>16,o[f+1]=s>>8&255,o[f+2]=s&255;return o.subarray(0,o.length-i)}var Sd=/^P(([\\d.]*)Y)?(([\\d.]*)M)?(([\\d.]*)D)?T?(([\\d.]*)H)?(([\\d.]*)M)?(([\\d.]*)S)?/,yd=/([0-9]+)-([0-9]+)/;function ve(n,e){return n===\"true\"?[!0,null]:n===\"false\"?[!1,null]:[!1,new Oe(`\\`${e}\\` property is not a boolean value but \"${n}\"`)]}function ne(n,e){let t=parseInt(n,10);return isNaN(t)?[null,new Oe(`\\`${e}\\` property is not an integer value but \"${n}\"`)]:[t,null]}function Ae(n,e){if(n===\"INF\")return[1/0,null];let t=parseFloat(n);return isNaN(t)?[null,new Oe(`\\`${e}\\` property is invalid: \"${n}\"`)]:[t,null]}function Bi(n,e){if(n===\"true\")return[!0,null];if(n===\"false\")return[!1,null];let t=parseInt(n,10);return isNaN(t)?[null,new Oe(`\\`${e}\\` property is not a boolean nor an integer but \"${n}\"`)]:[t,null]}function Er(n,e){let t=Date.parse(n);return isNaN(t)?[null,new Oe(`\\`${e}\\` is in an invalid date format: \"${n}\"`)]:[new Date(Date.parse(n)).getTime()/1e3,null]}function Ve(n,e){if(!ee(n))return[0,new Oe(`\\`${e}\\` property is empty`)];let t=Sd.exec(n);return t===null?[null,new Oe(`\\`${e}\\` property has an unrecognized format \"${n}\"`)]:[parseFloat(ee(t[2])?t[2]:\"0\")*365*24*60*60+parseFloat(ee(t[4])?t[4]:\"0\")*30*24*60*60+parseFloat(ee(t[6])?t[6]:\"0\")*24*60*60+parseFloat(ee(t[8])?t[8]:\"0\")*60*60+parseFloat(ee(t[10])?t[10]:\"0\")*60+parseFloat(ee(t[12])?t[12]:\"0\"),null]}function At(n,e){let t=yd.exec(n);return t===null?[null,new Oe(`\\`${e}\\` property has an unrecognized format \"${n}\"`)]:[[+t[1],+t[2]],null]}function Uo(n,e){try{return[Tr(n),null]}catch(t){return[null,new Oe(`\\`${e}\\` is not a valid base64 string: \"${n}\"`)]}}function Vt(n,e){let t=/^(\\d+)\\/(\\d+)$/.exec(n);return t!==null?[+t[1]/+t[2],null]:Ae(n,e)}function Ee(n){let e,t;for(let r of Object.keys(n.attributes)){let i=n.attributes[r];if(!v(i))switch(r){case\"schemeIdUri\":e=i;break;case\"value\":t=i;break}}return{schemeIdUri:e,value:t}}function ge(n,e){return function(t,{asKey:r,parser:i,dashName:a}){let[o,s]=i(t,a);s!==null&&(m.warn(s.message),e.push(s)),o!==null&&(n[r]=o)}}var Oe=class n extends Error{constructor(e){super(e),Object.setPrototypeOf(this,n.prototype),this.name=\"MPDError\"}};function ht(n){return cr(n)}function rt(n){let e=typeof n==\"string\"?n:ht(n.children),t=[];return e===null||e.length===0?[void 0,t]:[{value:e},t]}function _d(n){let e=[],t=[];for(let r=0;r<n.length;r++){let i=n[r];if(typeof i!=\"string\"&&i.tagName===\"cenc:pssh\"){let a=ht(i.children);if(a!==null&&a.length>0){let[o,s]=Uo(a,\"cenc:pssh\");s!==null&&(m.warn(s.message),e.push(s)),o!==null&&t.push(o)}}}return[{cencPssh:t},e]}function Td(n){let e={};for(let t of Object.keys(n.attributes)){let r=n.attributes[t];if(!v(r))switch(t){case\"schemeIdUri\":e.schemeIdUri=r;break;case\"value\":e.value=r;break;case\"cenc:default_KID\":e.keyId=hn(r.replace(/-/g,\"\"));break;case\"ref\":e.ref=r;break;case\"refId\":e.refId=r;break}}return e}function it(n){let[e,t]=_d(n.children),r=Td(n);return[{children:e,attributes:r},t]}function Ni(n){let e={};for(let t of Object.keys(n.attributes)){let r=n.attributes[t];if(!v(r))switch(t){case\"id\":e.id=r;break;case\"lang\":e.language=r;break;case\"contentType\":e.contentType=r;break;case\"par\":e.par=r;break}}return e}function Ui(n){let e={},t=[],r=ge(e,t);for(let i of Object.keys(n.attributes)){let a=n.attributes[i];if(!v(a))switch(i){case\"range\":r(a,{asKey:\"range\",parser:At,dashName:\"range\"});break;case\"sourceURL\":e.media=a;break}}return[e,t]}function at(n){let e={},t=[],r=ge(e,t),i=n.children;for(let a=0;a<i.length;a++){let o=i[a];if(typeof o!=\"string\"&&o.tagName===\"Initialization\"){let[s,u]=Ui(o);e.initialization=s,t=t.concat(u)}}for(let a of Object.keys(n.attributes)){let o=n.attributes[a];if(!v(o))switch(a){case\"timescale\":r(o,{asKey:\"timescale\",parser:ne,dashName:\"timescale\"});break;case\"presentationTimeOffset\":r(o,{asKey:\"presentationTimeOffset\",parser:Ae,dashName:\"presentationTimeOffset\"});break;case\"indexRange\":r(o,{asKey:\"indexRange\",parser:At,dashName:\"indexRange\"});break;case\"indexRangeExact\":r(o,{asKey:\"indexRangeExact\",parser:ve,dashName:\"indexRangeExact\"});break;case\"availabilityTimeOffset\":r(o,{asKey:\"availabilityTimeOffset\",parser:Ae,dashName:\"availabilityTimeOffset\"});break;case\"availabilityTimeComplete\":r(o,{asKey:\"availabilityTimeComplete\",parser:ve,dashName:\"availabilityTimeComplete\"});break;case\"duration\":r(o,{asKey:\"duration\",parser:ne,dashName:\"duration\"});break;case\"startNumber\":r(o,{asKey:\"startNumber\",parser:ne,dashName:\"startNumber\"});break;case\"endNumber\":r(o,{asKey:\"endNumber\",parser:ne,dashName:\"endNumber\"});break}}return[e,t]}function Li(n){let e={},t=[],r=ge(e,t);for(let i of Object.keys(n.attributes)){let a=n.attributes[i];if(!v(a))switch(i){case\"media\":e.media=a;break;case\"indexRange\":r(a,{asKey:\"indexRange\",parser:At,dashName:\"indexRange\"});break;case\"index\":e.index=a;break;case\"mediaRange\":r(a,{asKey:\"mediaRange\",parser:At,dashName:\"mediaRange\"});break}}return[e,t]}function In(n){let[e,t]=at(n),r=t,i=[],a=n.children;for(let s=0;s<a.length;s++){let u=a[s];if(typeof u!=\"string\"&&u.tagName===\"SegmentURL\"){let[f,l]=Li(u);i.push(f),r=r.concat(l)}}return[H(e,{list:i}),r]}function Fi(n){let e=n.children;return function(){for(let t=e.length-1;t>=0;t--){let r=e[t];(typeof r==\"string\"||r.tagName!==\"S\")&&e.splice(t,1)}return e}}function kt(n){let[e,t]=at(n),r=t,i;for(let s=0;s<n.children.length;s++){let u=n.children[s];typeof u!=\"string\"&&u.tagName===\"SegmentTimeline\"&&(i=Fi(u))}let a=H({},e,{duration:e.duration,timelineParser:i}),o=ge(a,r);for(let s of Object.keys(n.attributes)){let u=n.attributes[s];if(!v(u))switch(s){case\"initialization\":v(a.initialization)&&(a.initialization={media:u});break;case\"index\":a.index=u;break;case\"availabilityTimeOffset\":o(u,{asKey:\"availabilityTimeOffset\",parser:Ae,dashName:\"availabilityTimeOffset\"});break;case\"availabilityTimeComplete\":o(u,{asKey:\"availabilityTimeComplete\",parser:ve,dashName:\"availabilityTimeComplete\"});break;case\"media\":a.media=u;break;case\"bitstreamSwitching\":o(u,{asKey:\"bitstreamSwitching\",parser:ve,dashName:\"bitstreamSwitching\"});break}}return[a,r]}function Ed(n){let e={baseURLs:[]},t=[],r=[];for(let i=0;i<n.length;i++){let a=n[i];if(typeof a!=\"string\")switch(a.tagName){case\"BaseURL\":let[o,s]=rt(a);o!==void 0&&e.baseURLs.push(o),r=r.concat(s);break;case\"InbandEventStream\":e.inbandEventStreams===void 0&&(e.inbandEventStreams=[]),e.inbandEventStreams.push(Ee(a));break;case\"SegmentBase\":let[u,f]=at(a);e.segmentBase=u,f.length>0&&(r=r.concat(f));break;case\"SegmentList\":let[l,d]=In(a);r=r.concat(d),e.segmentList=l;break;case\"SegmentTemplate\":let[c,p]=kt(a);r=r.concat(p),e.segmentTemplate=c;break;case\"ContentProtection\":let[g,h]=it(a);h.length>0&&(r=r.concat(h)),g!==void 0&&t.push(g);break;case\"SupplementalProperty\":v(e.supplementalProperties)?e.supplementalProperties=[Ee(a)]:e.supplementalProperties.push(Ee(a));break}}return t.length>0&&(e.contentProtections=t),[e,r]}function Rd(n){let e={},t=[],r=ge(e,t);for(let i of Object.keys(n.attributes)){let a=n.attributes[i];if(!v(a))switch(i){case\"audioSamplingRate\":e.audioSamplingRate=a;break;case\"bandwidth\":r(a,{asKey:\"bitrate\",parser:ne,dashName:\"bandwidth\"});break;case\"codecs\":e.codecs=a;break;case\"codingDependency\":r(a,{asKey:\"codingDependency\",parser:ve,dashName:\"codingDependency\"});break;case\"frameRate\":r(a,{asKey:\"frameRate\",parser:Vt,dashName:\"frameRate\"});break;case\"height\":r(a,{asKey:\"height\",parser:ne,dashName:\"height\"});break;case\"id\":e.id=a;break;case\"maxPlayoutRate\":r(a,{asKey:\"maxPlayoutRate\",parser:Ae,dashName:\"maxPlayoutRate\"});break;case\"maximumSAPPeriod\":r(a,{asKey:\"maximumSAPPeriod\",parser:Ae,dashName:\"maximumSAPPeriod\"});break;case\"mimeType\":e.mimeType=a;break;case\"profiles\":e.profiles=a;break;case\"qualityRanking\":r(a,{asKey:\"qualityRanking\",parser:ne,dashName:\"qualityRanking\"});break;case\"scte214:supplementalCodecs\":e.supplementalCodecs=a;break;case\"segmentProfiles\":e.segmentProfiles=a;break;case\"width\":r(a,{asKey:\"width\",parser:ne,dashName:\"width\"});break;case\"availabilityTimeOffset\":r(a,{asKey:\"availabilityTimeOffset\",parser:Ae,dashName:\"availabilityTimeOffset\"});break;case\"availabilityTimeComplete\":r(a,{asKey:\"availabilityTimeComplete\",parser:ve,dashName:\"availabilityTimeComplete\"});break}}return e.bitrate===void 0&&t.push(new Oe(\"No bitrate found on a Representation\")),[e,t]}function Lo(n){let[e,t]=Ed(n.children),[r,i]=Rd(n),a=t.concat(i);return[{children:e,attributes:r},a]}function Pd(n){let e={baseURLs:[],representations:[]},t=[],r=[];for(let i=0;i<n.length;i++){let a=n[i];if(typeof a!=\"string\")switch(a.tagName){case\"Accessibility\":e.accessibilities===void 0?e.accessibilities=[Ee(a)]:e.accessibilities.push(Ee(a));break;case\"BaseURL\":let[o,s]=rt(a);o!==void 0&&e.baseURLs.push(o),s.length>0&&(r=r.concat(s));break;case\"ContentComponent\":e.contentComponent=Ni(a);break;case\"EssentialProperty\":v(e.essentialProperties)?e.essentialProperties=[Ee(a)]:e.essentialProperties.push(Ee(a));break;case\"InbandEventStream\":e.inbandEventStreams===void 0&&(e.inbandEventStreams=[]),e.inbandEventStreams.push(Ee(a));break;case\"Label\":let u=ht(a.children);u!=null&&(e.label=u);break;case\"Representation\":let[f,l]=Lo(a);e.representations.push(f),l.length>0&&(r=r.concat(l));break;case\"Role\":v(e.roles)?e.roles=[Ee(a)]:e.roles.push(Ee(a));break;case\"SupplementalProperty\":v(e.supplementalProperties)?e.supplementalProperties=[Ee(a)]:e.supplementalProperties.push(Ee(a));break;case\"SegmentBase\":let[d,c]=at(a);e.segmentBase=d,c.length>0&&(r=r.concat(c));break;case\"SegmentList\":let[p,g]=In(a);e.segmentList=p,g.length>0&&(r=r.concat(g));break;case\"SegmentTemplate\":let[h,I]=kt(a);e.segmentTemplate=h,I.length>0&&(r=r.concat(I));break;case\"ContentProtection\":let[y,_]=it(a);_.length>0&&(r=r.concat(_)),y!==void 0&&t.push(y);break}}return t.length>0&&(e.contentProtections=t),[e,r]}function vd(n){let e={},t=[],r=ge(e,t);for(let i of Object.keys(n.attributes)){let a=n.attributes[i];if(!v(a))switch(i){case\"id\":e.id=a;break;case\"group\":r(a,{asKey:\"group\",parser:ne,dashName:\"group\"});break;case\"lang\":e.language=a;break;case\"contentType\":e.contentType=a;break;case\"par\":e.par=a;break;case\"minBandwidth\":r(a,{asKey:\"minBitrate\",parser:ne,dashName:\"minBandwidth\"});break;case\"maxBandwidth\":r(a,{asKey:\"maxBitrate\",parser:ne,dashName:\"maxBandwidth\"});break;case\"minWidth\":r(a,{asKey:\"minWidth\",parser:ne,dashName:\"minWidth\"});break;case\"maxWidth\":r(a,{asKey:\"maxWidth\",parser:ne,dashName:\"maxWidth\"});break;case\"minHeight\":r(a,{asKey:\"minHeight\",parser:ne,dashName:\"minHeight\"});break;case\"maxHeight\":r(a,{asKey:\"maxHeight\",parser:ne,dashName:\"maxHeight\"});break;case\"minFrameRate\":r(a,{asKey:\"minFrameRate\",parser:Vt,dashName:\"minFrameRate\"});break;case\"maxFrameRate\":r(a,{asKey:\"maxFrameRate\",parser:Vt,dashName:\"maxFrameRate\"});break;case\"selectionPriority\":r(a,{asKey:\"selectionPriority\",parser:ne,dashName:\"selectionPriority\"});break;case\"segmentAlignment\":r(a,{asKey:\"segmentAlignment\",parser:Bi,dashName:\"segmentAlignment\"});break;case\"subsegmentAlignment\":r(a,{asKey:\"subsegmentAlignment\",parser:Bi,dashName:\"subsegmentAlignment\"});break;case\"bitstreamSwitching\":r(a,{asKey:\"bitstreamSwitching\",parser:ve,dashName:\"bitstreamSwitching\"});break;case\"audioSamplingRate\":e.audioSamplingRate=a;break;case\"codecs\":e.codecs=a;break;case\"scte214:supplementalCodecs\":e.supplementalCodecs=a;break;case\"codingDependency\":r(a,{asKey:\"codingDependency\",parser:ve,dashName:\"codingDependency\"});break;case\"frameRate\":r(a,{asKey:\"frameRate\",parser:Vt,dashName:\"frameRate\"});break;case\"height\":r(a,{asKey:\"height\",parser:ne,dashName:\"height\"});break;case\"maxPlayoutRate\":r(a,{asKey:\"maxPlayoutRate\",parser:Ae,dashName:\"maxPlayoutRate\"});break;case\"maximumSAPPeriod\":r(a,{asKey:\"maximumSAPPeriod\",parser:Ae,dashName:\"maximumSAPPeriod\"});break;case\"mimeType\":e.mimeType=a;break;case\"profiles\":e.profiles=a;break;case\"segmentProfiles\":e.segmentProfiles=a;break;case\"width\":r(a,{asKey:\"width\",parser:ne,dashName:\"width\"});break;case\"availabilityTimeOffset\":r(a,{asKey:\"availabilityTimeOffset\",parser:Ae,dashName:\"availabilityTimeOffset\"});break;case\"availabilityTimeComplete\":r(a,{asKey:\"availabilityTimeComplete\",parser:ve,dashName:\"availabilityTimeComplete\"});break}}return[e,t]}function Fo(n){let e=n.children,[t,r]=Pd(e),[i,a]=vd(n),o=r.concat(a);return[{children:t,attributes:i},o]}function Cd(n){let e={},t=[],r=ge(e,t);for(let i of Object.keys(n.attributes)){let a=n.attributes[i];if(!v(a))switch(i){case\"schemeIdUri\":e.schemeIdUri=a;break;case\"value\":e.value=a;break;case\"timescale\":r(a,{asKey:\"timescale\",parser:ne,dashName:\"timescale\"});break;default:Ue(i,\"xmlns:\")&&(e.namespaces===void 0&&(e.namespaces=[]),e.namespaces.push({key:i.substring(6),value:a}));break}}return[e,t]}function zo(n,e){let[t,r]=Cd(n),i=[];for(let a of n.children)if(typeof a!=\"string\"&&a.tagName===\"Event\"){let o={};if(v(a.attributes.id)||(o.id=a.attributes.id),!v(a.attributes.presentationTime)){let[s,u]=ne(a.attributes.presentationTime,\"presentationTime\");u!==null&&r.push(u),s!==null&&(o.presentationTime=s)}if(!v(a.attributes.duration)){let[s,u]=ne(a.attributes.duration,\"duration\");u!==null&&r.push(u),s!==null&&(o.duration=s)}if(a.posStart<a.posEnd){let s=e.substring(a.posStart,a.posEnd);o.eventStreamData=s}i.push(o)}return[{children:{events:i},attributes:t},r]}function xd(n,e){let t=[],r=[],i,a=[],o=[],s=[];for(let u=0;u<n.length;u++){let f=n[u];if(typeof f!=\"string\")switch(f.tagName){case\"BaseURL\":let[l,d]=rt(f);l!==void 0&&t.push(l),o=o.concat(d);break;case\"AdaptationSet\":let[c,p]=Fo(f);r.push(c),o=o.concat(p);break;case\"EventStream\":let[g,h]=zo(f,e);s.push(g),o=o.concat(h);break;case\"SegmentTemplate\":let[I,y]=kt(f);i=I,y.length>0&&(o=o.concat(y));break;case\"ContentProtection\":let[_,R]=it(f);R.length>0&&(o=o.concat(R)),_!==void 0&&a.push(_);break}}return[{baseURLs:t,adaptations:r,eventStreams:s,segmentTemplate:i,contentProtections:a},o]}function Ad(n){let e={},t=[],r=ge(e,t);for(let i of Object.keys(n.attributes)){let a=n.attributes[i];if(!v(a))switch(i){case\"id\":e.id=a;break;case\"start\":r(a,{asKey:\"start\",parser:Ve,dashName:\"start\"});break;case\"duration\":r(a,{asKey:\"duration\",parser:Ve,dashName:\"duration\"});break;case\"bitstreamSwitching\":r(a,{asKey:\"bitstreamSwitching\",parser:ve,dashName:\"bitstreamSwitching\"});break;case\"xlink:href\":e.xlinkHref=a;break;case\"xlink:actuate\":e.xlinkActuate=a;break;default:Ue(i,\"xmlns:\")&&(e.namespaces===void 0&&(e.namespaces=[]),e.namespaces.push({key:i.substring(6),value:a}));break}}return[e,t]}function Rr(n,e){let[t,r]=xd(n.children,e),[i,a]=Ad(n),o=r.concat(a);return[{children:t,attributes:i},o]}function kd(n,e){let t=[],r=[],i=[],a=[],o=[],s=[];for(let u=0;u<n.length;u++){let f=n[u];if(typeof f!=\"string\")switch(f.tagName){case\"BaseURL\":let[l,d]=rt(f);l!==void 0&&t.push(l),s=s.concat(d);break;case\"Location\":r.push(ht(f.children));break;case\"Period\":let[c,p]=Rr(f,e);i.push(c),s=s.concat(p);break;case\"UTCTiming\":let g=Ee(f);a.push(g);break;case\"ContentProtection\":let[h,I]=it(f);I.length>0&&(s=s.concat(I)),h!==void 0&&o.push(h);break}}return[{baseURLs:t,locations:r,periods:i,utcTimings:a,contentProtections:o},s]}function Md(n){let e={},t=[],r=ge(e,t);for(let i of Object.keys(n.attributes)){let a=n.attributes[i];if(!v(a))switch(i){case\"id\":e.id=a;break;case\"profiles\":e.profiles=a;break;case\"type\":e.type=a;break;case\"availabilityStartTime\":r(a,{asKey:\"availabilityStartTime\",parser:Er,dashName:\"availabilityStartTime\"});break;case\"availabilityEndTime\":r(a,{asKey:\"availabilityEndTime\",parser:Er,dashName:\"availabilityEndTime\"});break;case\"publishTime\":r(a,{asKey:\"publishTime\",parser:Er,dashName:\"publishTime\"});break;case\"mediaPresentationDuration\":r(a,{asKey:\"duration\",parser:Ve,dashName:\"mediaPresentationDuration\"});break;case\"minimumUpdatePeriod\":r(a,{asKey:\"minimumUpdatePeriod\",parser:Ve,dashName:\"minimumUpdatePeriod\"});break;case\"minBufferTime\":r(a,{asKey:\"minBufferTime\",parser:Ve,dashName:\"minBufferTime\"});break;case\"timeShiftBufferDepth\":r(a,{asKey:\"timeShiftBufferDepth\",parser:Ve,dashName:\"timeShiftBufferDepth\"});break;case\"suggestedPresentationDelay\":r(a,{asKey:\"suggestedPresentationDelay\",parser:Ve,dashName:\"suggestedPresentationDelay\"});break;case\"maxSegmentDuration\":r(a,{asKey:\"maxSegmentDuration\",parser:Ve,dashName:\"maxSegmentDuration\"});break;case\"maxSubsegmentDuration\":r(a,{asKey:\"maxSubsegmentDuration\",parser:Ve,dashName:\"maxSubsegmentDuration\"});break;default:Ue(i,\"xmlns:\")&&(e.namespaces===void 0&&(e.namespaces=[]),e.namespaces.push({key:i.substring(6),value:a}));break}}return[e,t]}function Wo(n,e){let[t,r]=kd(n.children,e),[i,a]=Md(n),o=r.concat(a);return[{children:t,attributes:i},o]}function zi(n,e){let t=di(n),r=t[t.length-1];if(r===void 0||typeof r==\"string\"||r.tagName!==\"MPD\")throw new Error(\"DASH Parser: document root should be MPD\");let[i,a]=Wo(r,n),o=yr(i,e,a);return s(o);function s(u){if(u.type===\"done\")return u;if(u.type===\"needs-clock\")return{type:\"needs-resources\",value:{urls:[u.value.url],format:\"string\",continue(f){if(f.length!==1)throw new Error(\"DASH parser: wrong number of loaded ressources.\");let l=u.value.continue(f[0].responseData);return s(l)}}};if(u.type===\"needs-xlinks\")return{type:\"needs-resources\",value:{urls:u.value.xlinksUrls,format:\"string\",continue(f){let l=[];for(let c=0;c<f.length;c++){let{responseData:p,receivedTime:g,sendingTime:h,url:I}=f[c];if(!p.success)throw p.error;let y=\"<root>\"+p.data+\"</root>\",_=di(y),R=_[_.length-1];if(R===void 0||typeof R==\"string\")throw new Error(\"DASH parser: Invalid external ressources\");let T=R.children,C=[],E=[];for(let k=0;k<T.length;k++){let x=T[k];if(typeof x==\"string\"||x.tagName!==\"Period\")continue;let[P,A]=Rr(x,y);E.push(...A),C.push(P)}l.push({url:I,receivedTime:g,sendingTime:h,parsed:C,warnings:E})}let d=u.value.continue(l);return s(d)}}};We(u)}}var Vo=zi;var Od=typeof WebAssembly==\"object\"&&typeof WebAssembly.instantiate==\"function\",qo=Od;function F(n,e,t,r){let i=new Uint8Array(e,t,r);return n.decode(i)}function Wi(n){return n===1/0?!0:n===-1/0?!1:n}function It(n,e){let t=new TextDecoder;return function(i,a,o){i===64&&(n.value=F(t,e.buffer,a,o))}}function bt(n,e){let t=n.attributes,r=n.children,i=new TextDecoder;return function(o,s,u){switch(o){case 16:t.schemeIdUri=F(i,e.buffer,s,u);break;case 13:t.value=F(i,e.buffer,s,u);break;case 14:let f=F(i,e.buffer,s,u);t.keyId=hn(f.replace(/-/g,\"\"));break;case 15:try{let l=F(i,e.buffer,s,u);r.cencPssh.push(Tr(l))}catch(l){}break;case 78:t.ref=F(i,e.buffer,s,u);break;case 79:t.refId=F(i,e.buffer,s,u);break}}}function Ho(n,e){let t=new TextDecoder;return function(i,a,o){switch(i){case 0:n.id=F(t,e.buffer,a,o);break;case 60:n.language=F(t,e.buffer,a,o);break;case 61:n.contentType=F(t,e.buffer,a,o);break;case 62:n.par=F(t,e.buffer,a,o);break}}}function qe(n,e){let t=new TextDecoder;return function(i,a,o){switch(i){case 16:n.schemeIdUri=F(t,e.buffer,a,o);break;case 17:n.value=F(t,e.buffer,a,o);break}}}function qt(n,e){let t=new TextDecoder;return function(i,a,o){switch(i){case 29:{let s=new DataView(e.buffer);n.initialization===void 0&&(n.initialization={}),n.initialization.range=[s.getFloat64(a,!0),s.getFloat64(a+8,!0)];break}case 67:n.initialization===void 0&&(n.initialization={}),n.initialization.media=F(t,e.buffer,a,o);break;case 43:{let s=new DataView(e.buffer);n.availabilityTimeOffset=s.getFloat64(a,!0);break}case 22:{n.availabilityTimeComplete=new DataView(e.buffer).getUint8(0)===0;break}case 24:{let s=new DataView(e.buffer);n.presentationTimeOffset=s.getFloat64(a,!0);break}case 27:{let s=new DataView(e.buffer);n.timescale=s.getFloat64(a,!0);break}case 31:{let s=new DataView(e.buffer);n.indexRange=[s.getFloat64(a,!0),s.getFloat64(a+8,!0)];break}case 23:{n.indexRangeExact=new DataView(e.buffer).getUint8(0)===0;break}case 1:{let s=new DataView(e.buffer);n.duration=s.getFloat64(a,!0);break}case 20:{let s=new DataView(e.buffer);n.startNumber=s.getFloat64(a,!0);break}case 76:{let s=new DataView(e.buffer);n.endNumber=s.getFloat64(a,!0);break}}}}function Go(n,e){let t=new TextDecoder;return function(i,a,o){switch(i){case 28:n.index=F(t,e.buffer,a,o);break;case 31:{let s=new DataView(e.buffer);n.indexRange=[s.getFloat64(a,!0),s.getFloat64(a+8,!0)];break}case 30:n.media=F(t,e.buffer,a,o);break;case 18:{let s=new DataView(e.buffer);n.mediaRange=[s.getFloat64(a,!0),s.getFloat64(a+8,!0)];break}}}}function Pr(n,e,t){return function(i){switch(i){case 20:{let a={};n.list===void 0&&(n.list=[]),n.list.push(a);let o=Go(a,e);t.pushParsers(i,B,o);break}default:t.pushParsers(i,B,B);break}}}function Ht(n,e){let t=new TextDecoder;return function(i,a,o){switch(i){case 19:{let s=new DataView(e.buffer);n.timeline=[];let u=a;for(let f=0;f<o/24;f++)n.timeline.push({start:s.getFloat64(u,!0),duration:s.getFloat64(u+8,!0),repeatCount:s.getFloat64(u+16,!0)}),u+=24;break}case 67:n.initialization={media:F(t,e.buffer,a,o)};break;case 28:n.index=F(t,e.buffer,a,o);break;case 43:{let s=new DataView(e.buffer);n.availabilityTimeOffset=s.getFloat64(a,!0);break}case 22:{n.availabilityTimeComplete=new DataView(e.buffer).getUint8(0)===0;break}case 24:{let s=new DataView(e.buffer);n.presentationTimeOffset=s.getFloat64(a,!0);break}case 27:{let s=new DataView(e.buffer);n.timescale=s.getFloat64(a,!0);break}case 31:{let s=new DataView(e.buffer);n.indexRange=[s.getFloat64(a,!0),s.getFloat64(a+8,!0)];break}case 23:{n.indexRangeExact=new DataView(e.buffer).getUint8(0)===0;break}case 30:n.media=F(t,e.buffer,a,o);break;case 32:{n.bitstreamSwitching=new DataView(e.buffer).getUint8(0)===0;break}case 1:{let s=new DataView(e.buffer);n.duration=s.getFloat64(a,!0);break}case 20:{let s=new DataView(e.buffer);n.startNumber=s.getFloat64(a,!0);break}case 76:{let s=new DataView(e.buffer);n.endNumber=s.getFloat64(a,!0);break}}}}function Ko(n,e,t){return function(i){switch(i){case 15:{let a={value:\"\",attributes:{}};n.baseURLs.push(a),t.pushParsers(i,B,It(a,e));break}case 10:{let a={children:{cencPssh:[]},attributes:{}};n.contentProtections===void 0&&(n.contentProtections=[]),n.contentProtections.push(a);let o=bt(a,e);t.pushParsers(i,B,o);break}case 19:{let a={};n.inbandEventStreams===void 0&&(n.inbandEventStreams=[]),n.inbandEventStreams.push(a),t.pushParsers(i,B,qe(a,e));break}case 13:{let a={};n.supplementalProperties===void 0&&(n.supplementalProperties=[]),n.supplementalProperties.push(a);let o=qe(a,e);t.pushParsers(i,B,o);break}case 17:{let a={};n.segmentBase=a;let o=qt(a,e);t.pushParsers(i,B,o);break}case 18:{let a={list:[]};n.segmentList=a;let o=Pr(a,e,t),s=qt(a,e);t.pushParsers(i,o,s);break}case 16:{let a={};n.segmentTemplate=a,t.pushParsers(i,B,Ht(a,e));break}default:t.pushParsers(i,B,B);break}}}function jo(n,e){let t=new TextDecoder;return function(i,a,o){let s=new DataView(e.buffer);switch(i){case 0:n.id=F(t,e.buffer,a,o);break;case 3:n.audioSamplingRate=F(t,e.buffer,a,o);break;case 63:n.bitrate=s.getFloat64(a,!0);break;case 4:n.codecs=F(t,e.buffer,a,o);break;case 77:n.supplementalCodecs=F(t,e.buffer,a,o);break;case 5:n.codingDependency=new DataView(e.buffer).getUint8(0)===0;break;case 6:n.frameRate=s.getFloat64(a,!0);break;case 7:n.height=s.getFloat64(a,!0);break;case 8:n.width=s.getFloat64(a,!0);break;case 9:n.maxPlayoutRate=s.getFloat64(a,!0);break;case 10:n.maximumSAPPeriod=s.getFloat64(a,!0);break;case 11:n.mimeType=F(t,e.buffer,a,o);break;case 2:n.profiles=F(t,e.buffer,a,o);break;case 65:n.qualityRanking=s.getFloat64(a,!0);break;case 12:n.segmentProfiles=F(t,e.buffer,a,o);break;case 43:n.availabilityTimeOffset=s.getFloat64(a,!0);break;case 22:n.availabilityTimeComplete=s.getUint8(0)===0;break}}}function Yo(n,e,t){return function(i){switch(i){case 8:{let a={};n.accessibilities===void 0&&(n.accessibilities=[]),n.accessibilities.push(a);let o=qe(a,e);t.pushParsers(i,B,o);break}case 15:{let a={value:\"\",attributes:{}};n.baseURLs.push(a);let o=It(a,e);t.pushParsers(i,B,o);break}case 9:{let a={};n.contentComponent=a,t.pushParsers(i,B,Ho(a,e));break}case 10:{let a={children:{cencPssh:[]},attributes:{}};n.contentProtections===void 0&&(n.contentProtections=[]),n.contentProtections.push(a);let o=bt(a,e);t.pushParsers(i,B,o);break}case 11:{let a={};n.essentialProperties===void 0&&(n.essentialProperties=[]),n.essentialProperties.push(a);let o=B,s=qe(a,e);t.pushParsers(i,o,s);break}case 19:{let a={};n.inbandEventStreams===void 0&&(n.inbandEventStreams=[]),n.inbandEventStreams.push(a);let o=B,s=qe(a,e);t.pushParsers(i,o,s);break}case 7:{let a={children:{baseURLs:[]},attributes:{}};n.representations.push(a);let o=Ko(a.children,e,t),s=jo(a.attributes,e);t.pushParsers(i,o,s);break}case 12:{let a={};n.roles===void 0&&(n.roles=[]),n.roles.push(a);let o=qe(a,e);t.pushParsers(i,B,o);break}case 13:{let a={};n.supplementalProperties===void 0&&(n.supplementalProperties=[]),n.supplementalProperties.push(a);let o=qe(a,e);t.pushParsers(i,B,o);break}case 17:{let a={};n.segmentBase=a;let o=qt(a,e);t.pushParsers(i,B,o);break}case 18:{let a={list:[]};n.segmentList=a;let o=Pr(a,e,t),s=qt(a,e);t.pushParsers(i,o,s);break}case 16:{let a={};n.segmentTemplate=a,t.pushParsers(i,B,Ht(a,e));break}default:t.pushParsers(i,B,B);break}}}function Qo(n,e){let t=new TextDecoder;return function(i,a,o){let s=new DataView(e.buffer);switch(i){case 0:n.id=F(t,e.buffer,a,o);break;case 48:n.group=s.getFloat64(a,!0);break;case 60:n.language=F(t,e.buffer,a,o);break;case 61:n.contentType=F(t,e.buffer,a,o);break;case 62:n.par=F(t,e.buffer,a,o);break;case 53:n.minBitrate=s.getFloat64(a,!0);break;case 49:n.maxBitrate=s.getFloat64(a,!0);break;case 56:n.minWidth=s.getFloat64(a,!0);break;case 52:n.maxWidth=s.getFloat64(a,!0);break;case 55:n.minHeight=s.getFloat64(a,!0);break;case 51:n.maxHeight=s.getFloat64(a,!0);break;case 54:n.minFrameRate=s.getFloat64(a,!0);break;case 50:n.maxFrameRate=s.getFloat64(a,!0);break;case 57:n.selectionPriority=s.getFloat64(a,!0);break;case 58:n.segmentAlignment=Wi(s.getFloat64(a,!0));break;case 59:n.subsegmentAlignment=Wi(s.getFloat64(a,!0));break;case 32:n.bitstreamSwitching=s.getFloat64(a,!0)!==0;break;case 3:n.audioSamplingRate=F(t,e.buffer,a,o);break;case 4:n.codecs=F(t,e.buffer,a,o);break;case 77:n.supplementalCodecs=F(t,e.buffer,a,o);break;case 2:n.profiles=F(t,e.buffer,a,o);break;case 12:n.segmentProfiles=F(t,e.buffer,a,o);break;case 11:n.mimeType=F(t,e.buffer,a,o);break;case 5:n.codingDependency=s.getFloat64(a,!0)!==0;break;case 6:n.frameRate=s.getFloat64(a,!0);break;case 7:n.height=s.getFloat64(a,!0);break;case 8:n.width=s.getFloat64(a,!0);break;case 9:n.maxPlayoutRate=s.getFloat64(a,!0);break;case 10:n.maximumSAPPeriod=s.getFloat64(a,!0);break;case 43:n.availabilityTimeOffset=s.getFloat64(a,!0);break;case 22:n.availabilityTimeComplete=s.getUint8(0)===0;break;case 71:let u=F(t,e.buffer,a,o);n.label=u;break}}}function $o(n,e,t,r){return function(a){switch(a){case 6:{let o={};n.events.push(o);let s=wd(o,e,r);t.pushParsers(a,B,s);break}default:t.pushParsers(a,B,B);break}}}function Xo(n,e){let t=new TextDecoder;return function(i,a,o){let s=new DataView(e.buffer);switch(i){case 16:n.schemeIdUri=F(t,e.buffer,a,o);break;case 17:n.value=F(t,e.buffer,a,o);break;case 27:n.timescale=s.getFloat64(a,!0);break;case 70:let u={key:\"\",value:\"\"},f=a,l=s.getUint32(f);f+=4,u.key=F(t,e.buffer,f,l),f+=l;let d=s.getUint32(f);f+=4,u.value=F(t,e.buffer,f,d),n.namespaces===void 0?n.namespaces=[u]:n.namespaces.push(u);break}}}function wd(n,e,t){let r=new TextDecoder;return function(a,o,s){let u=new DataView(e.buffer);switch(a){case 25:n.presentationTime=u.getFloat64(o,!0);break;case 1:n.duration=u.getFloat64(o,!0);break;case 0:n.id=F(r,e.buffer,o,s);break;case 69:let f=u.getFloat64(o,!0),l=u.getFloat64(o+8,!0);n.eventStreamData=t.slice(f,l);break}}}function vr(n,e,t,r){return function(a){switch(a){case 4:{let o={children:{baseURLs:[],representations:[]},attributes:{}};n.adaptations.push(o);let s=Yo(o.children,e,t),u=Qo(o.attributes,e);t.pushParsers(a,s,u);break}case 15:{let o={value:\"\",attributes:{}};n.baseURLs.push(o);let s=B,u=It(o,e);t.pushParsers(a,s,u);break}case 5:{let o={children:{events:[]},attributes:{}};n.eventStreams.push(o);let s=$o(o.children,e,t,r),u=Xo(o.attributes,e);t.pushParsers(a,s,u);break}case 16:{let o={};n.segmentTemplate=o,t.pushParsers(a,B,Ht(o,e));break}case 10:{let o={children:{cencPssh:[]},attributes:{}};n.contentProtections===void 0&&(n.contentProtections=[]),n.contentProtections.push(o);let s=bt(o,e);t.pushParsers(a,B,s);break}default:t.pushParsers(a,B,B);break}}}function Cr(n,e){let t=new TextDecoder;return function(i,a,o){switch(i){case 0:n.id=F(t,e.buffer,a,o);break;case 45:n.start=new DataView(e.buffer).getFloat64(a,!0);break;case 1:n.duration=new DataView(e.buffer).getFloat64(a,!0);break;case 32:n.bitstreamSwitching=new DataView(e.buffer).getUint8(0)===0;break;case 46:n.xlinkHref=F(t,e.buffer,a,o);break;case 47:n.xlinkActuate=F(t,e.buffer,a,o);break;case 43:n.availabilityTimeOffset=new DataView(e.buffer).getFloat64(a,!0);break;case 22:n.availabilityTimeComplete=new DataView(e.buffer).getUint8(0)===0;break;case 70:let s={key:\"\",value:\"\"},u=new DataView(e.buffer),f=a,l=u.getUint32(f);f+=4,s.key=F(t,e.buffer,f,l),f+=l;let d=u.getUint32(f);f+=4,s.value=F(t,e.buffer,f,d),n.namespaces===void 0?n.namespaces=[s]:n.namespaces.push(s);break}}}function Zo(n,e,t,r){return function(a){switch(a){case 15:{let o={value:\"\",attributes:{}};n.baseURLs.push(o);let s=B,u=It(o,e);t.pushParsers(a,s,u);break}case 2:{let o={children:{adaptations:[],baseURLs:[],eventStreams:[]},attributes:{}};n.periods.push(o);let s=vr(o.children,e,t,r),u=Cr(o.attributes,e);t.pushParsers(a,s,u);break}case 3:{let o={};n.utcTimings.push(o);let s=B,u=qe(o,e);t.pushParsers(a,s,u);break}case 10:{let o={children:{cencPssh:[]},attributes:{}};n.contentProtections===void 0&&(n.contentProtections=[]),n.contentProtections.push(o);let s=bt(o,e);t.pushParsers(a,B,s);break}default:t.pushParsers(a,B,B);break}}}function Jo(n,e,t){let r,i=new TextDecoder;return function(o,s,u){switch(o){case 0:e.id=F(i,t.buffer,s,u);break;case 2:e.profiles=F(i,t.buffer,s,u);break;case 33:e.type=F(i,t.buffer,s,u);break;case 34:let f=F(i,t.buffer,s,u);e.availabilityStartTime=new Date(f).getTime()/1e3;break;case 35:let l=F(i,t.buffer,s,u);e.availabilityEndTime=new Date(l).getTime()/1e3;break;case 36:let d=F(i,t.buffer,s,u);e.publishTime=new Date(d).getTime()/1e3;break;case 68:r=new DataView(t.buffer),e.duration=r.getFloat64(s,!0);break;case 37:r=new DataView(t.buffer),e.minimumUpdatePeriod=r.getFloat64(s,!0);break;case 38:r=new DataView(t.buffer),e.minBufferTime=r.getFloat64(s,!0);break;case 39:r=new DataView(t.buffer),e.timeShiftBufferDepth=r.getFloat64(s,!0);break;case 40:r=new DataView(t.buffer),e.suggestedPresentationDelay=r.getFloat64(s,!0);break;case 41:r=new DataView(t.buffer),e.maxSegmentDuration=r.getFloat64(s,!0);break;case 42:r=new DataView(t.buffer),e.maxSubsegmentDuration=r.getFloat64(s,!0);break;case 66:let c=F(i,t.buffer,s,u);n.locations.push(c);break;case 70:let p={key:\"\",value:\"\"};r=new DataView(t.buffer);let g=s,h=r.getUint32(g);g+=4,p.key=F(i,t.buffer,g,h),g+=h;let I=r.getUint32(g);g+=4,p.value=F(i,t.buffer,g,I),e.namespaces===void 0?e.namespaces=[p]:e.namespaces.push(p);break}}}function Vi(n,e,t,r){return function(a){switch(a){case 1:n.mpd={children:{baseURLs:[],locations:[],periods:[],utcTimings:[]},attributes:{}};let o=Zo(n.mpd.children,e,t,r),s=Jo(n.mpd.children,n.mpd.attributes,e);t.pushParsers(a,o,s);break;default:t.pushParsers(a,B,B);break}}}function es(n,e,t,r){return function(a){switch(a){case 2:{let o={children:{adaptations:[],baseURLs:[],eventStreams:[]},attributes:{}};n.periods.push(o);let s=vr(o.children,e,t,r),u=Cr(o.attributes,e);t.pushParsers(a,s,u);break}default:t.pushParsers(a,B,B);break}}}var bn=class{constructor(){this._currentNodeId=null,this.childrenParser=B,this.attributeParser=B,this._stack=[{nodeId:null,children:B,attribute:B}]}pushParsers(e,t,r){this._currentNodeId=e,this.childrenParser=t,this.attributeParser=r,this._stack.push({nodeId:e,attribute:r,children:t})}popIfCurrent(e){if(this._currentNodeId!==e)return;this._stack.pop();let{nodeId:t,children:r,attribute:i}=this._stack[this._stack.length-1];this._currentNodeId=t,this.attributeParser=i,this.childrenParser=r}reset(){this.childrenParser=B,this.attributeParser=B,this._stack=[{nodeId:null,children:B,attribute:B}]}};var Dd=15e3,Sn=class{constructor(){this._parsersStack=new bn,this._instance=null,this._mpdData=null,this._linearMemory=null,this.status=\"uninitialized\",this._initProm=null,this._warnings=[],this._isParsing=!1}waitForInitialization(){var e;return(e=this._initProm)!=null?e:Promise.reject(\"No initialization performed yet.\")}async initialize(e){if(this.status!==\"uninitialized\")return Promise.reject(new Error(\"DashWasmParser already initialized.\"));if(!this.isCompatible())return this.status=\"failure\",Promise.reject(new Error(\"Target not compatible with WebAssembly.\"));this.status=\"initializing\";let t=this._parsersStack,r=new TextDecoder,i=this,a={env:{memoryBase:0,tableBase:0,memory:new WebAssembly.Memory({initial:10}),table:new WebAssembly.Table({initial:1,element:\"anyfunc\"}),onTagOpen:f,onCustomEvent:c,onAttribute:d,readNext:p,onTagClose:l}},o=null,s;typeof e.wasmUrl==\"string\"?s=fetch(e.wasmUrl):(o=URL.createObjectURL(new Blob([e.wasmUrl],{type:\"application/wasm\"})),s=fetch(o));let u=typeof WebAssembly.instantiateStreaming==\"function\"?WebAssembly.instantiateStreaming(s,a):Promise.reject(\"`WebAssembly.instantiateStreaming` API not available\");return this._initProm=u.catch(async g=>{o!==null&&(URL.revokeObjectURL(o),o=null),m.warn(\"Unable to call `instantiateStreaming` on WASM\",g instanceof Error?g:\"\");let h=await s;if(h.status<200||h.status>=300)throw new Error(\"WebAssembly request failed. status: \"+String(h.status));let I=await h.arrayBuffer();return WebAssembly.instantiate(I,a)}).then(g=>{o!==null&&(URL.revokeObjectURL(o),o=null),this._instance=g,this._linearMemory=this._instance.instance.exports.memory,this.status=\"initialized\"}).catch(g=>{let h=g instanceof Error?g.toString():\"Unknown error\";throw m.warn(\"DW: Could not create DASH-WASM parser:\",h),this.status=\"failure\",g}),this._initProm;function f(g){return t.childrenParser(g)}function l(g){return t.popIfCurrent(g)}function d(g,h,I){return t.attributeParser(g,h,I)}function c(g,h,I){let y=i._linearMemory,_=new Uint8Array(y.buffer,h,I);if(g===1){let R=r.decode(_);m.warn(\"WASM Error Event:\",R),i._warnings.push(new Error(R))}else if(g===0){let R=r.decode(_);m.warn(\"WASM Log Event:\",R)}}function p(g,h){if(i._mpdData===null)throw new Error(\"DashWasmParser Error: No MPD to read.\");let I=i._linearMemory,{mpd:y,cursor:_}=i._mpdData,R=Math.min(h,Dd,y.byteLength-_);return new Uint8Array(I.buffer,g,R).set(new Uint8Array(y,_,R)),i._mpdData.cursor+=R,R}}runWasmParser(e,t){let[r,i]=this._parseMpd(e);if(r===null)throw new Error(\"DASH Parser: Unknown error while parsing the MPD\");let a=yr(r,t,i);return this._processParserReturnValue(a)}isCompatible(){return qo&&typeof se.TextDecoder==\"function\"}_parseMpd(e){var s;if(this._instance===null)throw new Error(\"DashWasmParser not initialized\");if(this._isParsing)throw new Error(\"Parsing operation already pending.\");this._isParsing=!0,this._mpdData={mpd:e,cursor:0};let t={},r=this._linearMemory,i=Vi(t,r,this._parsersStack,e);this._parsersStack.pushParsers(null,i,B),this._warnings=[];try{this._instance.instance.exports.parse()}catch(u){throw this._parsersStack.reset(),this._warnings=[],this._isParsing=!1,u}let a=(s=t.mpd)!=null?s:null,o=this._warnings;return this._parsersStack.reset(),this._warnings=[],this._isParsing=!1,[a,o]}_parseXlink(e){if(this._instance===null)throw new Error(\"DashWasmParser not initialized\");if(this._isParsing)throw new Error(\"Parsing operation already pending.\");this._isParsing=!0,this._mpdData={mpd:e,cursor:0};let t={periods:[]},r=this._linearMemory,i=es(t,r,this._parsersStack,e);this._parsersStack.pushParsers(null,i,B),this._warnings=[];try{this._instance.instance.exports.parse()}catch(s){throw this._parsersStack.reset(),this._warnings=[],this._isParsing=!1,s}let{periods:a}=t,o=this._warnings;return this._parsersStack.reset(),this._warnings=[],this._isParsing=!1,[a,o]}_processParserReturnValue(e){if(e.type===\"done\")return e;if(e.type===\"needs-clock\"){let t=r=>{if(r.length!==1)throw new Error(\"DASH parser: wrong number of loaded ressources.\");let i=e.value.continue(r[0].responseData);return this._processParserReturnValue(i)};return{type:\"needs-resources\",value:{urls:[e.value.url],format:\"string\",continue:t}}}else if(e.type===\"needs-xlinks\"){let t=r=>{let i=[];for(let o=0;o<r.length;o++){let{responseData:s,receivedTime:u,sendingTime:f,url:l}=r[o];if(!s.success)throw s.error;let[d,c]=this._parseXlink(s.data);i.push({url:l,receivedTime:u,sendingTime:f,parsed:d,warnings:c})}let a=e.value.continue(i);return this._processParserReturnValue(a)};return{type:\"needs-resources\",value:{urls:e.value.xlinksUrls,format:\"arraybuffer\",continue:t}}}else We(e)}};var ts=Sn;var Mt=class{constructor(e,t){this._last=e,this._wanted=t}serialize(){return[this._last,this._wanted]}getPolled(){return this._last}getWanted(){var e;return(e=this._wanted)!=null?e:this._last}forceWantedPosition(e){this._wanted=e}isAwaitingFuturePosition(){return this._wanted!==null}};function xr(n,e,t){let r=e(n.getReference(),t);return{getCurrentTime(){return n.getCurrentTime()},getReadyState(){return n.getReadyState()},getPlaybackRate(){return n.getPlaybackRate()},getIsPaused(){return n.getIsPaused()},getReference(){return r},listen(i,a){var o;t.isCancelled()||((o=a==null?void 0:a.clearSignal)==null?void 0:o.isCancelled())===!0||r.onUpdate(i,{clearSignal:a==null?void 0:a.clearSignal,emitCurrentValue:a==null?void 0:a.includeLastObservation})},deriveReadOnlyObserver(i){return xr(this,i,t)}}}var yn=class{constructor(e,t,r,i){this._src=e,this._contentId=t,this._messageSender=r,this._cancelSignal=i}getCurrentTime(){}getReadyState(){}getIsPaused(){}getReference(){return this._src}setPlaybackRate(e){this._messageSender({type:\"update-playback-rate\",contentId:this._contentId,value:e})}getPlaybackRate(){}listen(e,t){var r;this._cancelSignal.isCancelled()||((r=t==null?void 0:t.clearSignal)==null?void 0:r.isCancelled())===!0||this._src.onUpdate(e,{clearSignal:t==null?void 0:t.clearSignal,emitCurrentValue:t==null?void 0:t.includeLastObservation})}deriveReadOnlyObserver(e){return xr(this,e,this._cancelSignal)}};function ot(n,e){if(e.length===0)return n;let t,r=\"\",i=n.indexOf(\"#\"),a=n;i>=0&&(r=n.substring(i),a=n.substring(0,i));let o=a.indexOf(\"?\");o===-1?t=\"?\":o+1===a.length?t=\"\":t=\"&\";let s=a+t;for(let u=0;u<e.length;u++){let f=e[u];f[1]===null?s+=f[0]:s+=`${f[0]}=${f[1]}`,u<e.length-1&&(s+=\"&\")}return r.length>0&&(s+=r),s}function qi(n,e){return(t,r,i)=>new Promise((a,o)=>{let s=Date.now()-U(),u=!1,c={reject:h=>{var R,T;if(u||i.isCancelled())return;u=!0,i.deregister(g);let I=h,y=(R=I==null?void 0:I.message)!=null?R:\"Unknown error when fetching the Manifest through a custom manifestLoader.\",_=new je(y,(T=I==null?void 0:I.canRetry)!=null?T:!1,I==null?void 0:I.xhr);o(_)},resolve:h=>{if(u||i.isCancelled())return;u=!0,i.deregister(g);let I=h.receivingTime!==void 0?h.receivingTime-s:void 0,y=h.sendingTime!==void 0?h.sendingTime-s:void 0;a({responseData:h.data,size:h.size,requestDuration:h.duration,url:h.url,receivedTime:I,sendingTime:y})},fallback:()=>{u||i.isCancelled()||(u=!0,i.deregister(g),e(t,r,i).then(a,o))}},p=n({url:t,timeout:r.timeout,cmcdPayload:r.cmcdPayload},c);i.register(g);function g(h){u||(u=!0,typeof p==\"function\"&&p(),o(h))}})}function Bd(n){return function(t,r,i){var s,u;if(t===void 0)throw new Error(\"Cannot perform HTTP(s) request. URL not known\");let a=((s=r.cmcdPayload)==null?void 0:s.type)===\"query\"?ot(t,r.cmcdPayload.value):t,o=((u=r.cmcdPayload)==null?void 0:u.type)===\"headers\"?r.cmcdPayload.value:void 0;switch(n){case\"arraybuffer\":return pe({url:a,headers:o,responseType:\"arraybuffer\",timeout:r.timeout,connectionTimeout:r.connectionTimeout,cancelSignal:i});case\"text\":return pe({url:a,headers:o,responseType:\"text\",timeout:r.timeout,connectionTimeout:r.connectionTimeout,cancelSignal:i});case\"document\":return pe({url:a,headers:o,responseType:\"document\",timeout:r.timeout,connectionTimeout:r.connectionTimeout,cancelSignal:i});default:We(n)}}}function Hi({customManifestLoader:n},e,t){let r=Bd(e),i=typeof n!=\"function\"?r:qi(n,r);return t!==null?t(i):i}var z=class{constructor(){let[e,t]=Nd();this._isUsed=!1,this._trigger=e,this.signal=new Gi(t)}isUsed(){return this._isUsed}linkToSignal(e){let t=e.register(()=>{this.cancel()});return this.signal.register(t),t}cancel(e){if(this._isUsed)return;this._isUsed=!0;let t=e!=null?e:new oe;this._trigger(t)}static isCancellationError(e){return e instanceof oe}},Gi=class{constructor(e){this._isCancelled=!1,this.cancellationError=null,this._listeners=[],e(t=>{for(this.cancellationError=t,this._isCancelled=!0;this._listeners.length>0;)try{let r=this._listeners.pop();r==null||r(t)}catch(r){m.error(\"Error while calling clean up listener\",r instanceof Error?r.toString():\"Unknown error\")}})}isCancelled(){return this._isCancelled}register(e){return this._isCancelled?(Se(this.cancellationError!==null),e(this.cancellationError),B):(this._listeners.push(e),()=>this.deregister(e))}deregister(e){for(let t=this._listeners.length-1;t>=0;t--)this._listeners[t]===e&&this._listeners.splice(t,1)}},oe=class n extends Error{constructor(){let e=\"This task was cancelled.\";super(e),Object.setPrototypeOf(this,n.prototype),this.name=\"CancellationError\"}};function Nd(){let n=B;return[function(t){n(t)},function(t){n=t}]}function Ot(...n){let e=n.length,t=-1,r=0,i;for(;++t<e;)i=n[t],r+=typeof i==\"number\"?i:i.length;let a=new Uint8Array(r),o=0;for(t=-1;++t<e;)i=n[t],typeof i==\"number\"?o+=i:i.length>0&&(a.set(i,o),o+=i.length);return a}function Ki(n,e){return(n[e+0]<<8)+(n[e+1]<<0)}function ji(n,e){return n[e+0]*65536+n[e+1]*256+n[e+2]}function te(n,e){return n[e+0]*16777216+n[e+1]*65536+n[e+2]*256+n[e+3]}function St(n,e){return(n[e+0]*16777216+n[e+1]*65536+n[e+2]*256+n[e+3])*4294967296+n[e+4]*16777216+n[e+5]*65536+n[e+6]*256+n[e+7]}function ns(n){return new Uint8Array([n>>>8&255,n&255])}function yt(n){return new Uint8Array([n>>>24&255,n>>>16&255,n>>>8&255,n&255])}function Ar(n){let e=n%4294967296,t=(n-e)/4294967296;return new Uint8Array([t>>>24&255,t>>>16&255,t>>>8&255,t&255,e>>>24&255,e>>>16&255,e>>>8&255,e&255])}function $e(n,e){let t=n.length,r=0;for(;r+8<=t;){let i=te(n,r);if(i===0)i=t-r;else if(i===1){if(r+16>t)return-1;i=St(n,r+8)}if(isNaN(i)||i<=0)return-1;if(te(n,r+4)===e)return r+i<=t?r:-1;r+=i}return-1}function kr(n){let e=0,t=[],r=null;for(;e<=n.length;){if(e===n.length){r=null;break}r=n.subarray(e,1/0);let i=$e(r,1836019558);if(i<0)break;let a=te(n,i+e),o=e+i+a;if(o>n.length)break;let s=$e(r,1835295092);if(s<0)break;let u=te(n,s+e),f=e+s+u;if(f>n.length)break;let l=Math.max(o,f),d=n.subarray(e,l);t.push(d),e=l}return t.length===0?[null,r]:[t,r]}function Ud(n,e,t){return new Uint8Array(Array.prototype.slice.call(n,e,t))}function Ld(n,e,t){return n.slice(e,t)}var Yi=typeof Uint8Array.prototype.slice==\"function\"?Ld:Ud;function Qi(n,e){let t=n;for(let r of e){let i=ue(t,r);if(i===null)return null;t=i}return t}function ue(n,e){let t=ke(n,e);return t!==null?n.subarray(t[1],t[2]):null}function rs(n,e){let t=[],r=n;for(;;){let i=ke(r,e);if(i===null)return t;Se(i[2]!==0&&r.length!==0),t.push(r.subarray(i[1],i[2])),r=r.subarray(i[2])}}function ke(n,e){let t=n.length,r=0,i,a=0,o;for(;r+8<=t;){if(o=r,a=te(n,o),o+=4,i=te(n,o),o+=4,a===0)a=t-r;else if(a===1){if(o+8>t)return null;a=St(n,o),o+=8}if(a<0)throw new Error(\"ISOBMFF: Size out of range\");if(i===e)return e===1970628964&&(o+=16),[r,o,r+a];r+=a}return null}function Mr(n){let e=0,t=ue(n,1836019574);if(t===null)return[];let r=[];for(;e<t.length;){let i;try{i=ke(t,1886614376)}catch(s){let u=s instanceof Error?s:\"\";return m.warn(\"Error while removing PSSH from ISOBMFF\",u),r}if(i===null)return r;let a=Yi(t,i[0],i[2]),o=is(a,i[1]-i[0]);o!==void 0&&r.push({systemId:o,data:a}),t[i[1]-4]=102,t[i[1]-3]=114,t[i[1]-2]=101,t[i[1]-1]=101,e=i[2]}return r}function is(n,e){if(n[e]>1){m.warn(\"ISOBMFF: un-handled PSSH version\");return}let t=e+4;if(t+16>n.length)return;let r=Yi(n,t,t+16);return ko(r)}var $i=Math.pow(2,32)-1;function Xi(n){let e=ue(n,1836019558);return e===null?null:ue(e,1953653094)}function as(n){return rs(n,1836019558).reduce((t,r)=>{let i=ue(r,1953653094);return i!==null&&t.push(i),t},[])}function Zi(n){return ue(n,1835295092)}function Ji(n){let e=ue(n,1836019574);if(e===null)return null;let t=ue(e,1953653099);return t===null?null:ue(t,1835297121)}function os(n,e=0){return ue(n.subarray(e),1701671783)}var ss=1635148593,us=1635148595,ds=1633889587,ls=1700998451,fs=1836069985,cs=new Uint8Array([0,0,0,80,115,105,110,102,0,0,0,12,102,114,109,97,0,0,0,0,0,0,0,20,115,99,104,109,0,0,0,0,99,101,110,99,0,1,0,0,0,0,0,40,115,99,104,105,0,0,0,32,116,101,110,99,0,0,0,0,0,0,1,8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]);function ms(n){var l;let e=n instanceof Uint8Array?n:n instanceof ArrayBuffer?new Uint8Array(n):new Uint8Array(n.buffer),t=[];{let d=[1836019574,1953653099,1835297121,1835626086,1937007212,1937011556],c=e,p=0;for(let g of d){let h=ke(c,g);if(h===null)return e;c=c.subarray(h[1],h[2]),t.push(h.map(I=>I+p)),p+=h[1]}}let r=t[t.length-1],i=r[1]+8,a=e.subarray(i,r[2]),o=ue(a,1701733238),s=ue(a,1701733217);if(o!==null||s!==null)return e;let u=[{type:\"video\",name:ss,relativeOffsets:ke(a,ss)},{type:\"video\",name:us,relativeOffsets:ke(a,us)},{type:\"audio\",name:ds,relativeOffsets:ke(a,ds)},{type:\"audio\",name:ls,relativeOffsets:ke(a,ls)},{type:\"audio\",name:fs,relativeOffsets:ke(a,fs)}].filter(d=>d.relativeOffsets!==null);u.sort((d,c)=>c.relativeOffsets[0]-d.relativeOffsets[0]);let f=e;for(let d of u){let c=d.relativeOffsets[2]-d.relativeOffsets[0],p=new Uint8Array(c+cs.length),g=a.subarray(d.relativeOffsets[0],d.relativeOffsets[2]);p.set(g,0);let h=d.relativeOffsets[1]-d.relativeOffsets[0]-4;d.type===\"audio\"?p.set(yt(1701733217),h):p.set(yt(1701733238),h),p.set(cs,c);let I=ke(p,1936289382);if(I===null)return m.warn(\"ISOBMFF: sinf not found, this should not be possible.\"),e;let y=p.subarray(I[1],I[2]),_=(l=ke(y,1718775137))==null?void 0:l.map(E=>E+I[1]);if(_===void 0)return m.warn(\"ISOBMFF: frma not found in sinf, this should not be possible.\"),e;p.set(yt(d.name),_[1]),p=ea(p);let R=f;f=new Uint8Array(R.length+p.byteLength);let T=i+d.relativeOffsets[2];f.set(R.subarray(0,T),0),f.set(R.subarray(T),T+p.length),f.set(p,T);for(let E of t){let k=f.subarray(E[0],E[2]+p.length);ea(k)}let C=Ki(f,r[1]+6);C+=1,f.set(ns(C),r[1]+6)}return f}function _n(n,e){let t=ke(n,1936286840);if(t===null)return null;let r=e,i=t[2]-t[0],a=t[1],o=n[a];a+=8;let s=te(n,a);a+=4;let u;if(o===0)u=te(n,a),a+=4,r+=te(n,a)+i,a+=4;else if(o===1)u=St(n,a),a+=8,r+=St(n,a)+i,a+=8;else return null;let f=[];a+=2;let l=Ki(n,a);for(a+=2;--l>=0;){let d=te(n,a);a+=4;let c=(d&2147483648)>>>31,p=d&2147483647;if(c===1)throw new Error(\"sidx with reference_type `1` not yet implemented\");let g=te(n,a);a+=4,a+=4,f.push({time:u,duration:g,timescale:s,range:[r,r+p-1]}),u+=g,r+=p}return f}function ta(n){let e=Xi(n);if(e===null)return;let t=ue(e,1952867444);if(t===null)return;let r=t[0];if(r===1)return St(t,4);if(r===0)return te(t,4)}function Fd(n){let e=ue(n,1952868452);if(e===null)return;let t=1,r=ji(e,t);t+=3;let i=(r&1)>0,a=(r&2)>0;return(r&8)>0?(t+=4,i&&(t+=8),a&&(t+=4),te(e,t)):void 0}function na(n){let e=as(n);if(e.length===0)return;let t=0;for(let r of e){let i=ue(r,1953658222);if(i===null)return;let a=0,o=i[a];if(a+=1,o>1)return;let s=ji(i,a);a+=3;let u=(s&256)>0,f=0;if(!u&&(f=Fd(r),f===void 0))return;let l=(s&1)>0,d=(s&4)>0,c=(s&512)>0,p=(s&1024)>0,g=(s&2048)>0,h=te(i,a);a+=4,l&&(a+=4),d&&(a+=4);let I=h,y=0;for(;I-- >0;)u?(y+=te(i,a),a+=4):y+=f,c&&(a+=4),p&&(a+=4),g&&(a+=4);t+=y}return t}function Tn(n){let e=Ji(n);if(e===null)return;let t=ue(e,1835296868);if(t===null)return;let r=0,i=t[r];if(r+=4,i===1)return te(t,r+16);if(i===0)return te(t,r+8)}function ea(n){let e=n.length;if(e<4)throw new Error(\"Cannot update box length: box too short\");let t=te(n,0);if(t===0)if(e>$i){let r=new Uint8Array(e+8);return r.set(yt(1),0),r.set(n.subarray(4,8),4),r.set(Ar(e+8),8),r.set(n.subarray(8,e),16),r}else return n.set(yt(e),0),n;else if(t===1){if(e<16)throw new Error(\"Cannot update box length: box too short\");return n.set(Ar(e),8),n}else{if(e<=$i)return n.set(yt(e),0),n;{let r=new Uint8Array(e+8);return r.set(yt(1),0),r.set(n.subarray(4,8),4),r.set(Ar(e+8),8),r.set(n.subarray(8,e),16),r}}}function ps(n){let e=[],t=0;for(;t<n.length;){let r=os(n,t);if(r===null)break;let i=r.length;t+=i;let a=r[0];if(a!==0)m.warn(\"ISOBMFF: EMSG version \"+a.toString()+\" not supported.\");else{let o=4,{end:s,string:u}=Ci(r,o);o=s;let{end:f,string:l}=Ci(r,o);o=f;let d=te(r,o);o+=4;let c=te(r,o);o+=4;let p=te(r,o);o+=4;let g=te(r,o);o+=4;let h=r.subarray(o,i),I={schemeIdUri:u,value:l,timescale:d,presentationTimeDelta:c,eventDuration:p,id:g,messageData:h};e.push(I)}}if(e.length!==0)return e}function gs(n){let e=Qi(n,[1836019574,1953653099,1835297121,1835626086,1937007212,1937011556]);if(e===null)return null;let t=e.subarray(8),r=ue(t,1701733238),i=0;if(r===null?(i=28,r=ue(t,1701733217)):i=78,r===null)return null;let a=Qi(r.subarray(i),[1936289382,1935894633,1952804451]);if(a===null||a.byteLength<24)return null;let o=a.subarray(8,24);return o.every(s=>s===0)?null:o}function ra(n,e){if(e){if($e(n,1718909296)<0)throw new Ie(\"INTEGRITY_ERROR\",\"Incomplete `ftyp` box\");if($e(n,1836019574)<0)throw new Ie(\"INTEGRITY_ERROR\",\"Incomplete `moov` box\")}else{if($e(n,1836019558)<0)throw new Ie(\"INTEGRITY_ERROR\",\"Incomplete `moof` box\");if($e(n,1835295092)<0)throw new Ie(\"INTEGRITY_ERROR\",\"Incomplete `mdat` box\")}}function He(n,e){if(n===\"audio\"||n===\"video\")return e===\"video/mp4\"||e===\"audio/mp4\"?\"mp4\":e===\"video/webm\"||e===\"audio/webm\"?\"webm\":void 0;if(n===\"text\")return e===\"application/mp4\"?\"mp4\":void 0}function Or(n){return(e,t,r,i,a)=>{return new Promise((s,u)=>{let f=new z,l=f.linkToSignal(i);f.signal.register(u),n(e,t,r,f.signal,ie(J({},a),{onNewChunk(c){try{o(c),a.onNewChunk(c)}catch(p){d(),f.cancel(),u(p)}}})).then(c=>{if(d(),!f.isUsed()){if(c.resultType===\"segment-loaded\")try{o(c.resultData.responseData)}catch(p){u(p);return}s(c)}},c=>{d(),u(c)});function d(){f.signal.deregister(u),l()}});function o(s){!(s instanceof ArrayBuffer)&&!(s instanceof Uint8Array)||He(t.type,t.mimeType)!==\"mp4\"||ra(new Uint8Array(s),t.segment.isInit)}}}function hs(n){return async(e,t,r)=>{let i=await n(e,t,r);return a(i.responseData),i;function a(o){if(typeof o==\"string\"){let s=o.length-1,u=[\"</\",\"MPD\",\">\"];for(let f=u.length-1;f>=0;f--){let l=u[f];for(;zd(o[s]);)s--;for(let d=l.length-1;d>=0;d--){if(o[s]!==l[d])throw new Error(\"INTEGRITY_ERROR MPD does not end with </MPD>\");s--}}}else if(o instanceof ArrayBuffer){let s=o.byteLength-1,u=new DataView(o),f=[[60,47],[77,80,68],[62]];for(let l=f.length-1;l>=0;l--){let d=f[l];for(;Wd(u.getUint8(s));)s--;for(let c=d.length-1;c>=0;c--){if(u.getUint8(s)!==d[c])throw new Error(\"INTEGRITY_ERROR MPD does not end with </MPD>\");s--}}}else if(!v(se.Document)&&o instanceof se.Document&&o.documentElement.nodeName!==\"MPD\")throw new Ie(\"INTEGRITY_ERROR\",\"MPD does not end with </MPD>\")}}}function zd(n){return n===\" \"||n===\"\t\"||n===\"\\r\"||n===`\n`}function Wd(n){return n===32||n===9||n===13||n===10}function ia(n){let{referenceDateTime:e}=n,t=n.serverSyncInfos!==void 0?n.serverSyncInfos.serverTimestamp-n.serverSyncInfos.clientTime:void 0;return function(i,a,o,s,u){var _;let{responseData:f}=i,l=a.externalClockOffset,d=(_=i.url)!=null?_:a.originalUrl,c=t!=null?t:l,g={unsafelyBaseOnPreviousManifest:a.unsafeMode?a.previousManifest:null,url:d,referenceDateTime:e,externalClockOffset:c},h=de.dashParsers;if(h.wasm===null||h.wasm.status===\"uninitialized\"||h.wasm.status===\"failure\")return m.debug(\"DASH: WASM MPD Parser not initialized. Running JS one.\"),I();{let R=Kd(f);if(!jd(R))return m.info(\"DASH: MPD doesn't seem to be UTF-8-encoded. Running JS parser instead of the WASM one.\"),I();if(h.wasm.status===\"initialized\"){m.debug(\"DASH: Running WASM MPD Parser.\");let T=h.wasm.runWasmParser(R,g);return y(T)}else return m.debug(\"DASH: Awaiting WASM initialization before parsing the MPD.\"),h.wasm.waitForInitialization().catch(()=>{}).then(()=>{if(h.wasm===null||h.wasm.status!==\"initialized\")return m.warn(\"DASH: WASM MPD parser initialization failed. Running JS parser instead\"),I();m.debug(\"DASH: Running WASM MPD Parser.\");let C=h.wasm.runWasmParser(R,g);return y(C)})}function I(){if(h.fastJs!==null){let R=Hd(f),T=h.fastJs(R,g);return y(T)}else if(h.native!==null){let R=Gd(f),T=h.native(R,g);return y(T)}else throw new Error(\"No MPD parser is imported\")}function y(R){if(R.type===\"done\"){if(R.value.warnings.length>0&&o(R.value.warnings),s.isCancelled())return Promise.reject(s.cancellationError);let E=[];return{manifest:new Ft(R.value.parsed,n,E),url:d,warnings:E}}let{value:T}=R,C=T.urls.map(E=>u(()=>{let k=L.getCurrent().DEFAULT_REQUEST_TIMEOUT,x=L.getCurrent().DEFAULT_CONNECTION_TIMEOUT;return T.format===\"string\"?pe({url:E,responseType:\"text\",timeout:k,connectionTimeout:x,cancelSignal:s}):pe({url:E,responseType:\"arraybuffer\",timeout:k,connectionTimeout:x,cancelSignal:s})}).then(k=>{if(T.format===\"string\"){if(typeof k.responseData!=\"string\")throw new Error(\"External DASH resources should have been a string\");return H(k,{responseData:{success:!0,data:k.responseData}})}else{if(!(k.responseData instanceof ArrayBuffer))throw new Error(\"External DASH resources should have been ArrayBuffers\");return H(k,{responseData:{success:!0,data:k.responseData}})}},k=>{let x=be(k,{defaultCode:\"PIPELINE_PARSE_ERROR\",defaultReason:\"An unknown error occured when parsing ressources.\"});return H({},{size:void 0,requestDuration:void 0,responseData:{success:!1,error:x}})}));return Promise.all(C).then(E=>T.format===\"string\"?(Vd(E),y(T.continue(E))):(qd(E),y(T.continue(E))))}}}function Vd(n){b.CURRENT_ENV!==b.PRODUCTION&&n.forEach(e=>{let{responseData:t}=e;if(!(t.success&&typeof t.data==\"string\")&&t.success)throw new Error(\"Invalid data given to the LoadedRessource\")})}function qd(n){b.CURRENT_ENV!==b.PRODUCTION&&n.forEach(e=>{let{responseData:t}=e;if(!(t.success&&t.data instanceof ArrayBuffer)&&t.success)throw new Error(\"Invalid data given to the LoadedRessource\")})}function Hd(n){if(n instanceof ArrayBuffer)return Le(new Uint8Array(n));if(typeof n==\"string\")return n;if(n instanceof Document)return n.documentElement.outerHTML;throw new Error(\"DASH Manifest Parser: Unrecognized Manifest format\")}function Gd(n){if(n instanceof ArrayBuffer)return new DOMParser().parseFromString(Le(new Uint8Array(n)),\"text/xml\");if(typeof n==\"string\")return new DOMParser().parseFromString(n,\"text/xml\");if(n instanceof Document)return n;throw new Error(\"DASH Manifest Parser: Unrecognized Manifest format\")}function Kd(n){if(n instanceof ArrayBuffer)return n;if(typeof n==\"string\")return gn(n).buffer;if(n instanceof Document)return gn(n.documentElement.innerHTML).buffer;throw new Error(\"DASH Manifest Parser: Unrecognized Manifest format\")}function jd(n){let e=new DataView(n);return e.getUint16(0)===61371&&e.getUint8(2)===191?!0:!(e.getUint16(0)===65279||e.getUint16(0)===65534)}function Xe([n,e]){return e===1/0?`bytes=${n}-`:`bytes=${n}-${e}`}function En(n,e){return n===null?null:e.url===null?n.baseUrl:hr(n.baseUrl,e.url)}function Rn(n,e,t,r,i){var f,l;let a=n;((f=t.cmcdPayload)==null?void 0:f.type)===\"query\"&&(a=ot(a,t.cmcdPayload.value));let o=((l=t.cmcdPayload)==null?void 0:l.type)===\"headers\"?t.cmcdPayload.value:void 0;if(e.range===void 0)return pe({url:a,responseType:\"arraybuffer\",headers:o,timeout:t.timeout,connectionTimeout:t.connectionTimeout,cancelSignal:r,onProgress:i.onProgress}).then(d=>({resultType:\"segment-loaded\",resultData:d}));if(e.indexRange===void 0)return pe({url:a,headers:ie(J({},o),{Range:Xe(e.range)}),responseType:\"arraybuffer\",timeout:t.timeout,connectionTimeout:t.connectionTimeout,cancelSignal:r,onProgress:i.onProgress}).then(d=>({resultType:\"segment-loaded\",resultData:d}));if(e.range[1]+1===e.indexRange[0])return pe({url:a,headers:ie(J({},o),{Range:Xe([e.range[0],e.indexRange[1]])}),responseType:\"arraybuffer\",timeout:t.timeout,connectionTimeout:t.connectionTimeout,cancelSignal:r,onProgress:i.onProgress}).then(d=>({resultType:\"segment-loaded\",resultData:d}));let s=pe({url:a,headers:ie(J({},o),{Range:Xe(e.range)}),responseType:\"arraybuffer\",timeout:t.timeout,connectionTimeout:t.connectionTimeout,cancelSignal:r,onProgress:i.onProgress}),u=pe({url:a,headers:ie(J({},o),{Range:Xe(e.indexRange)}),responseType:\"arraybuffer\",timeout:t.timeout,connectionTimeout:t.connectionTimeout,cancelSignal:r,onProgress:i.onProgress});return Promise.all([s,u]).then(([d,c])=>{let p=Ot(new Uint8Array(d.responseData),new Uint8Array(c.responseData)),g=Math.min(d.sendingTime,c.sendingTime),h=Math.max(d.receivedTime,c.receivedTime);return{resultType:\"segment-loaded\",resultData:{url:a,responseData:p,size:d.size+c.size,requestDuration:h-g,sendingTime:g,receivedTime:h}}})}async function Pn(n,e,t,r){let i=null;function a(s){let u=new Uint8Array(s.chunk),f=i!==null?Ot(i,u):u,l=kr(f),d=l[0];i=l[1],!(d!==null&&(d.forEach(c=>{t.onNewChunk(c)}),r.isCancelled()))&&(t.onProgress({duration:s.duration,size:s.size,totalSize:s.totalSize}),r.isCancelled())}return{resultType:\"chunk-complete\",resultData:await sr({url:n,headers:e.headers,onData:a,timeout:e.timeout,connectionTimeout:e.connectionTimeout,cancelSignal:r})}}async function Is(n,e,t,r,i,a){var c,p;if(e.segment.isInit)return Rn(n,e.segment,r,a,i);let o=((c=r.cmcdPayload)==null?void 0:c.type)===\"query\"?ot(n,r.cmcdPayload.value):n,s=((p=r.cmcdPayload)==null?void 0:p.type)===\"headers\"?r.cmcdPayload.value:void 0,{segment:u}=e,f;u.range!==void 0?f=ie(J({},s),{Range:Xe(u.range)}):s!==void 0&&(f=s);let l=He(e.type,e.mimeType);if(t&&(l===\"mp4\"||l===void 0)){if(tn())return Pn(o,{headers:f,timeout:r.timeout,connectionTimeout:r.connectionTimeout},i,a);Je(\"DASH: Your browser does not have the fetch API. You will have a higher chance of rebuffering when playing close to the live edge\")}return{resultType:\"segment-loaded\",resultData:await pe({url:o,responseType:\"arraybuffer\",headers:f,timeout:r.timeout,connectionTimeout:r.connectionTimeout,cancelSignal:a,onProgress:i.onProgress})}}function aa({lowLatencyMode:n,segmentLoader:e,checkMediaSegmentIntegrity:t}){return t!==!0?r:Or(r);function r(i,a,o,s,u){let f=En(i,a.segment);return f===null?Promise.resolve({resultType:\"segment-created\",resultData:null}):n||e===void 0?Is(f,a,n,o,u,s):new Promise((l,d)=>{let c=!1,y={reject:E=>{var A,M;if(c||s.isCancelled())return;c=!0,s.deregister(C);let k=E,x=(A=k==null?void 0:k.message)!=null?A:\"Unknown error when fetching a DASH segment through a custom segmentLoader.\",P=new je(x,(M=k==null?void 0:k.canRetry)!=null?M:!1,k==null?void 0:k.xhr);d(P)},resolve:E=>{c||s.isCancelled()||(c=!0,s.deregister(C),l({resultType:\"segment-loaded\",resultData:{responseData:E.data,size:E.size,requestDuration:E.duration}}))},progress:E=>{c||s.isCancelled()||u.onProgress({duration:E.duration,size:E.size,totalSize:E.totalSize})},fallback:()=>{c||s.isCancelled()||(c=!0,s.deregister(C),Is(f,a,n,o,u,s).then(l,d))}},_;a.segment.range!==void 0&&(_=[a.segment.range],a.segment.indexRange!==void 0&&_.push(a.segment.indexRange));let R={isInit:a.segment.isInit,timeout:o.timeout,byteRanges:_,trackType:a.type,url:f,cmcdPayload:o.cmcdPayload},T=e(R,y);s.register(C);function C(E){c||(c=!0,typeof T==\"function\"&&T(),d(E))}})}}var sa=408125543,bs=357149030,Yd=2807729,Qd=17545,$d=475249515,Xd=187,Zd=179,Jd=183,el=241;function _t(n,e,t,[r,i]){let a=r;for(;a<i;){let o=nl(t,a);if(o===null)return null;let{value:s,length:u}=o,f=a+u,l=rl(t,f);if(l===null)return null;let{length:d,value:c}=l,p=f+d,g=p+c;if(s===n)return[p,g];if(e.length>0){for(let h=0;h<e.length;h++)if(s===e[h]){let I=e.slice(h+1,e.length);return _t(n,I,t,[p,g])}}a=g}return null}function wr(n,e){let t=_t(Yd,[sa,bs],n,[e,n.length]);if(t===null)return null;let r=t[1]-t[0];return 1e9/oa(n,t[0],r)}function tl(n,e){let t=_t(Qd,[sa,bs],n,[e,n.length]);if(t===null)return null;let r=t[1]-t[0];return r===4?il(n,t[0]):r===8?al(n,t[0]):null}function ua(n,e){let t=_t(sa,[],n,[e,n.length]);if(t===null)return null;let[r,i]=t,a=wr(n,r);if(a===null)return null;let o=tl(n,r);if(o===null)return null;let s=_t($d,[],n,[r,i]);if(s===null)return null;let u=[],f=s[0];for(;f<s[1];){let d=_t(Xd,[],n,[f,s[1]]);if(d===null)break;let c=_t(Zd,[],n,[d[0],d[1]]);if(c===null)return null;let p=oa(n,c[0],c[1]-c[0]),g=_t(el,[Jd],n,[d[0],d[1]]);if(g===null)return null;let h=oa(n,g[0],g[1]-g[0])+r;u.push({time:p,rangeStart:h}),f=d[1]}let l=[];for(let d=0;d<u.length;d++){let c=u[d];d===u.length-1?l.push({time:c.time,timescale:a,duration:d===0?o:o-c.time,range:[c.rangeStart,1/0]}):l.push({time:c.time,timescale:a,duration:u[d+1].time-c.time,range:[c.rangeStart,u[d+1].rangeStart-1]})}return l}function Ss(n,e){for(let t=1;t<=8;t++)if(n[e]>=Math.pow(2,8-t))return t}function nl(n,e){let t=Ss(n,e);if(t===void 0)return m.warn(\"webm: unrepresentable length\"),null;if(e+t>n.length)return m.warn(\"webm: impossible length\"),null;let r=0;for(let i=0;i<t;i++)r=n[e+i]*Math.pow(2,(t-i-1)*8)+r;return{length:t,value:r}}function rl(n,e){let t=Ss(n,e);if(t===void 0)return m.warn(\"webm: unrepresentable length\"),null;if(e+t>n.length)return m.warn(\"webm: impossible length\"),null;let r=(n[e]&(1<<8-t)-1)*Math.pow(2,(t-1)*8);for(let i=1;i<t;i++)r=n[e+i]*Math.pow(2,(t-i-1)*8)+r;return{length:t,value:r}}function il(n,e){return new DataView(n.buffer).getFloat32(e)}function al(n,e){return new DataView(n.buffer).getFloat64(e)}function oa(n,e,t){let r=0;for(let i=0;i<t;i++)r=n[e+i]*Math.pow(2,(t-i-1)*8)+r;return r}function vn(n,e,t,r){let i=ta(n);if(i===void 0||r===void 0)return null;let a=t.timestampOffset!==void 0?i+t.timestampOffset*r:i,o=na(n);if(a<0&&(o!==void 0&&(o+=a),a=0),e||!t.complete)return o===void 0&&m.warn(\"DASH: Chunked segments should indicate a duration through their trun boxes\"),{time:a/r,duration:o!==void 0?o/r:void 0};let s,u=t.duration*r,f=Math.min(r*.9,u/4);return o!==void 0&&Math.abs(o-u)<=f&&(s=o),{time:a/r,duration:s!==void 0?s/r:s}}function ol(n,e){if(n.length<=0)return!1;let t=n.length;for(let r=0;r<t;r++){let i=n[r],a=e,{messageData:o}=i,s=Le(o),u=Date.parse(s);if(a===void 0||u===void 0||isNaN(u)||u>=a)return!0}return!1}function da(n,e){if(n.length===0)return;let{manifestRefreshEventsFromEMSGs:t,EMSGs:r}=n.reduce((o,s)=>(s.schemeIdUri===\"urn:mpeg:dash:event:2012\"&&s.value===\"1\"?(o.manifestRefreshEventsFromEMSGs===void 0&&(o.manifestRefreshEventsFromEMSGs=[]),o.manifestRefreshEventsFromEMSGs.push(s)):(o.EMSGs===void 0&&(o.EMSGs=[]),o.EMSGs.push(s)),o),{manifestRefreshEventsFromEMSGs:void 0,EMSGs:void 0}),i=r==null?void 0:r.map(o=>({type:\"emsg\",value:o})),a=e===void 0||t===void 0?!1:ol(t,e);return{inbandEvents:i,needsManifestRefresh:a}}function la({__priv_patchLastSegmentInSidx:n}){return function(t,r,i){var R,T;let{segment:a,periodStart:o,periodEnd:s}=r,{data:u,isChunked:f}=t,l=[o,s];if(u===null)return a.isInit?{segmentType:\"init\",initializationData:null,initializationDataSize:0,protectionData:[],initTimescale:void 0}:{segmentType:\"media\",chunkData:null,chunkSize:0,chunkInfos:null,chunkOffset:0,protectionData:[],appendWindow:l};let d=u instanceof Uint8Array?u:new Uint8Array(u),c=He(r.type,r.mimeType),p=c===\"mp4\"||c===void 0,g=[];if(p){let C=Mr(d),E;a.isInit&&(E=(R=gs(d))!=null?R:void 0),(C.length>0||E!==void 0)&&g.push({initDataType:\"cenc\",keyId:E,initData:C})}if(!a.isInit){let C=p?vn(d,f,a,i):null,E=(T=a.timestampOffset)!=null?T:0;if(p){let k=ps(d);if(k!==void 0){let x=k.filter(A=>a.privateInfos===void 0||a.privateInfos.isEMSGWhitelisted===void 0?!1:a.privateInfos.isEMSGWhitelisted(A)),P=da(x,r.manifestPublishTime);if(P!==void 0){let{needsManifestRefresh:A,inbandEvents:M}=P;return{segmentType:\"media\",chunkData:d,chunkSize:d.length,chunkInfos:C,chunkOffset:E,appendWindow:l,inbandEvents:M,protectionData:g,needsManifestRefresh:A}}}}return{segmentType:\"media\",chunkData:d,chunkSize:d.length,chunkInfos:C,chunkOffset:E,protectionData:g,appendWindow:l}}let{indexRange:h}=a,I;if(c===\"webm\")I=ua(d,0);else if(p&&(I=_n(d,Array.isArray(h)?h[0]:0),n===!0&&I!==null&&I.length>0)){let C=I[I.length-1];Array.isArray(C.range)&&(C.range[1]=1/0)}let y;p?y=Tn(d):c===\"webm\"&&(y=wr(d,0));let _=v(y)?void 0:y;return a.isInit&&(m.warn(\"DASH: !!!!!!!!!!!! FAKE ENCRYPTION\"),d=ms(d)),{segmentType:\"init\",initializationData:d,initializationDataSize:d.length,protectionData:g,initTimescale:_,segmentList:I!=null?I:void 0}}}function fa({lowLatencyMode:n,checkMediaSegmentIntegrity:e}){return e!==!0?t:Or(t);async function t(r,i,a,o,s){var I,y;let{segment:u}=i,f=En(r,u);if(f===null)return Promise.resolve({resultType:\"segment-created\",resultData:null});if(u.isInit)return Rn(f,u,a,o,s);let l=((I=a.cmcdPayload)==null?void 0:I.type)===\"query\"?ot(f,a.cmcdPayload.value):f,d=((y=a.cmcdPayload)==null?void 0:y.type)===\"headers\"?a.cmcdPayload.value:void 0,c;u.range!==void 0?c=ie(J({},d),{Range:Xe(u.range)}):d!==void 0&&(c=d);let p=He(i.type,i.mimeType),g=p===\"mp4\"||p===void 0;if(n&&g){if(tn())return Pn(l,{headers:c,timeout:a.timeout,connectionTimeout:a.connectionTimeout},s,o);Je(\"DASH: Your browser does not have the fetch API. You will have a higher chance of rebuffering when playing close to the live edge\")}let h;return g?h=await pe({url:l,responseType:\"arraybuffer\",headers:c,timeout:a.timeout,connectionTimeout:a.connectionTimeout,onProgress:s.onProgress,cancelSignal:o}):h=await pe({url:l,responseType:\"text\",headers:c,timeout:a.timeout,connectionTimeout:a.connectionTimeout,onProgress:s.onProgress,cancelSignal:o}),{resultType:\"segment-loaded\",resultData:h}}}function sl(n){let e=Zi(n);return e===null?\"\":Le(e)}function ul(n){if(n===void 0)throw new Error(\"Cannot parse subtitles: unknown format\");switch(n.toLowerCase()){case\"stpp\":case\"stpp.ttml.im1t\":return\"ttml\";case\"wvtt\":return\"vtt\"}throw new Error(`The codec used for the subtitles \"${n}\" is not managed yet.`)}function dl(n,e){switch(e){case\"application/ttml+xml\":return\"ttml\";case\"application/x-sami\":case\"application/smil\":return\"sami\";case\"text/vtt\":return\"vtt\"}if(n!==void 0&&n.toLowerCase()===\"srt\")return\"srt\";throw new Error(`could not find a text-track parser for the type ${e!=null?e:\"\"}`)}function ys({segment:n,language:e,codecs:t},r,i,a){if(n.isInit)return null;let o,s;i===null?a?(o=n.time,s=n.end):m.warn(\"Transport: Unavailable time data for current text track.\"):(o=i.time,i.duration!==void 0?s=o+i.duration:!a&&n.complete&&(s=o+n.duration));let u=ul(t);return{data:sl(r),type:u,language:e,start:o,end:s}}function _s(n,e,t){let{segment:r}=n;if(r.isInit)return null;let i,a;t?m.warn(\"Transport: Unavailable time data for current text track.\"):(i=r.time,r.complete&&(a=r.time+r.duration));let o=dl(n.codecs,n.mimeType);return{data:e,type:o,language:n.language,start:i,end:a}}function ll(n,e,t,r,i){var c;let{segment:a}=t,{isInit:o,indexRange:s}=a,u;if(typeof n==\"string\"?u=gn(n):n instanceof Uint8Array?u=n:u=new Uint8Array(n),o){let p=_n(u,Array.isArray(s)?s[0]:0);if(i===!0&&p!==null&&p.length>0){let h=p[p.length-1];Array.isArray(h.range)&&(h.range[1]=1/0)}let g=Tn(u);return{segmentType:\"init\",initializationData:null,initializationDataSize:0,protectionData:[],initTimescale:g,segmentList:p!=null?p:void 0}}let f=vn(u,e,a,r),l=ys(t,u,f,e),d=(c=a.timestampOffset)!=null?c:0;return{segmentType:\"media\",chunkData:l,chunkSize:u.length,chunkInfos:f,chunkOffset:d,protectionData:[],appendWindow:[t.periodStart,t.periodEnd]}}function fl(n,e,t){let{periodStart:r,periodEnd:i,segment:a}=t,{timestampOffset:o=0}=a;if(a.isInit)return{segmentType:\"init\",initializationData:null,initializationDataSize:0,protectionData:[],initTimescale:void 0};let s,u;if(typeof n!=\"string\"){let l=n instanceof Uint8Array?n:new Uint8Array(n);s=Le(l),u=l.length}else s=n;return{segmentType:\"media\",chunkData:_s(t,s,e),chunkSize:u,chunkInfos:null,chunkOffset:o,protectionData:[],appendWindow:[r,i]}}function ca({__priv_patchLastSegmentInSidx:n}){return function(t,r,i){var d;let{periodStart:a,periodEnd:o,segment:s}=r,{data:u,isChunked:f}=t;if(u===null)return s.isInit?{segmentType:\"init\",initializationData:null,initializationDataSize:0,protectionData:[],initTimescale:void 0}:{segmentType:\"media\",chunkData:null,chunkSize:0,chunkInfos:null,chunkOffset:(d=s.timestampOffset)!=null?d:0,protectionData:[],appendWindow:[a,o]};let l=He(r.type,r.mimeType);if(l===\"webm\")throw new Error(\"Text tracks with a WEBM container are not yet handled.\");return l===\"mp4\"?ll(u,f,r,i,n):fl(u,f,r)}}function Ts(n){let e=Hi({customManifestLoader:n.manifestLoader},cl()?\"text\":\"arraybuffer\",n.checkManifestIntegrity===!0?hs:null),t=ia(n),r=aa(n),i=la(n),a=fa(n),o=ca(n);return{transportName:\"dash\",manifest:{loadManifest:e,parseManifest:t},audio:{loadSegment:r,parseSegment:i},video:{loadSegment:r,parseSegment:i},text:{loadSegment:a,parseSegment:o}}}function cl(){return de.dashParsers.wasm!==null&&(de.dashParsers.wasm.status===\"initialized\"||de.dashParsers.wasm.status===\"initializing\")}var Es=Ts;var wt=typeof queueMicrotask==\"function\"?queueMicrotask:function(e){Promise.resolve().then(e,()=>e())};var Dt=class{constructor(e){this._array=[],this._sortingFn=e}add(...e){e.sort(this._sortingFn);let t=0;for(let r=0;r<e.length;r++){let i=e[r],a=!1;for(;!a&&t<this._array.length;)this._sortingFn(i,this._array[t])<0?(this._array.splice(t,0,i),a=!0):t++;a||this._array.push(i)}}length(){return this._array.length}get(e){if(e<0||e>=this._array.length)throw new Error(\"Invalid index.\");return this._array[e]}toArray(){return this._array.slice()}findFirst(e){return K(this._array,e)}has(e){return ce(this._array,e)}removeElement(e){let t=this._array.indexOf(e);if(t>=0)return this._array.splice(t,1),t}head(){return this._array[0]}last(){return this._array[this._array.length-1]}shift(){return this._array.shift()}pop(){return this._array.pop()}};var Cn=class{constructor(e){this._weakMap=new WeakMap,this._fn=e}get(e){let t=this._weakMap.get(e);if(t===void 0){let r=this._fn(e);return this._weakMap.set(e,r),r}else return t}destroy(e){this._weakMap.delete(e)}};var ml=.016666666666666666;function Rs(n,e){return Math.abs(n-e)<ml}function vs(n,e){let t=Math.min(n.start,e.start),r=Math.max(n.end,e.end);return{start:t,end:r}}function pl(n){for(let e=0;e<n.length;e++){let t=n[e];t.start===t.end&&n.splice(e--,1)}return n}function gl(n){for(let e=1;e<n.length;e++){let t=n[e-1],r=n[e];if(xs(t,r)){let i=vs(t,r);n.splice(--e,2,i)}}return n}function ma(n,e){return n.end<=e.start}function Ps({start:n,end:e},t){return n<=t&&t<e}function Cs(n,e){return Ps(n,e.start)||n.start<e.end&&e.end<n.end||Ps(e,n.start)}function xs(n,e){return Rs(e.start,n.end)||Rs(e.end,n.start)}function pa(n){let e=[];for(let t=0;t<n.length;t++)e.push({start:n.start(t),end:n.end(t)});return e}function hl(n,e){for(let t=n.length-1;t>=0;t--){let r=n[t].start;if(e>=r){let i=n[t].end;if(e<i)return n[t]}}return null}function As(n,e){let t=null,r=[];for(let i=0;i<n.length;i++){let a=n[i].start,o=n[i].end;e<a||e>=o?r.push({start:a,end:o}):t={start:a,end:o}}return{outerRanges:r,innerRange:t}}function Dr(n,e){let t=hl(n,e);return t!==null?t.end-e:1/0}function Gt(n,e){if(e.start===e.end)return n;let t=e,r=0;for(;r<n.length;r++){let i=n[r],a=Cs(t,i),o=xs(t,i);if(a||o)t=vs(t,i),n.splice(r--,1);else if(r===0){if(ma(t,n[0]))break}else if(ma(n[r-1],t)&&ma(t,i))break}return n.splice(r,0,t),gl(pl(n))}function Il(n,e){let t=[];for(let r=0;r<e.length;r++)Cs(n,e[r])&&t.push(e[r]);return t}function Br(n,e){let t=[];for(let r=0;r<n.length;r++){let i=n[r],a=[],o=Il(i,e);if(o.length>0)for(let s=0;s<o.length;s++){let u=o[s];a.push({start:Math.max(i.start,u.start),end:Math.min(i.end,u.end)})}if(a.length===0)t.push(i);else{let s=i.start;for(let u=0;u<a.length;u++)a[u].start>s&&t.push({start:s,end:a[u].start}),s=a[u].end;s<i.end&&t.push({start:s,end:i.end})}}return t}function Nr({segmentSink:n,playbackObserver:e,maxBufferBehind:t,maxBufferAhead:r},i){let a,o=[];e.listen(u=>{a=u.position.getWanted(),o=u.buffered[n.bufferType],s()},{includeLastObservation:!0,clearSignal:i});function s(){o!==null&&bl(n,a,o,t.getValue(),r.getValue(),i).catch(u=>{let f=u instanceof Error?u.message:\"Unknown error\";m.error(\"Could not run BufferGarbageCollector:\",f)})}t.onUpdate(s,{clearSignal:i}),r.onUpdate(s,{clearSignal:i}),s()}async function bl(n,e,t,r,i,a){if(!isFinite(r)&&!isFinite(i))return Promise.resolve();let o=[],{innerRange:s,outerRanges:u}=As(t,e),f=()=>{if(isFinite(r)){for(let d of u)e-r>=d.end?o.push(d):e>=d.end&&e-r>d.start&&e-r<d.end&&o.push({start:d.start,end:e-r});v(s)||e-r>s.start&&o.push({start:s.start,end:e-r})}},l=()=>{if(isFinite(i)){for(let d of u)e+i<=d.start?o.push(d):e<=d.start&&e+i<d.end&&e+i>d.start&&o.push({start:e+i,end:d.end});v(s)||e+i<s.end&&o.push({start:e+i,end:s.end})}};f(),l();for(let d of o)if(d.start<d.end){if(m.debug(\"GC: cleaning range from SegmentSink\",d.start,d.end),a.cancellationError!==null)throw a.cancellationError;await n.removeBuffer(d.start,d.end)}}var xn=class{constructor(e,t){this._history=[],this._lifetime=e,this._maxHistoryLength=t}addBufferedSegment(e,t){let r=U();this._history.push({date:r,buffered:t,context:e}),this._cleanHistory(r)}getHistoryFor(e){return this._history.filter(t=>et(t.context,e))}_cleanHistory(e){let t=e-this._lifetime,r=0;for(let i of this._history)if(i.date<t)r++;else break;if(r>0&&(this._history=this._history.splice(r)),this._history.length>this._maxHistoryLength){let i=this._history.length-this._maxHistoryLength;this._history=this._history.splice(i)}}};var An=class{constructor(){let{BUFFERED_HISTORY_RETENTION_TIME:e,BUFFERED_HISTORY_MAXIMUM_ENTRIES:t}=L.getCurrent();this._inventory=[],this._bufferedHistory=new xn(e,t)}reset(){this._inventory.length=0}synchronizeBuffered(e){var u,f,l,d,c,p,g;let t=this._inventory,r=0,i=t[0],{MINIMUM_SEGMENT_SIZE:a}=L.getCurrent(),o=i==null?void 0:i.infos.adaptation.type;if(m.hasLevel(\"DEBUG\")){let h=e.map(I=>`${I.start}-${I.end}`).join(\",\");m.debug(`SI: synchronizing ${o!=null?o:\"unknown\"} buffered ranges:`,h)}let s=e.length;for(let h=0;h<s;h++){if(i===void 0)return;let I=e[h].start,y=e[h].end;if(y-I<a){m.warn(\"SI: skipped range when synchronizing because it was too small\",o,I,y);continue}let _=r;for(;i!==void 0&&((u=i.bufferedEnd)!=null?u:i.end)-I<a;)i=t[++r];let R=null,T=r-_;if(T>0){let E=t[_+T-1];R={end:(f=E.bufferedEnd)!=null?f:E.end,precizeEnd:E.precizeEnd},m.debug(`SI: ${T} segments GCed.`,o);let k=t.splice(_,T);for(let x of k)x.bufferedStart===void 0&&x.bufferedEnd===void 0&&x.status!==2&&this._bufferedHistory.addBufferedSegment(x.infos,null);r=_}if(i===void 0)return;if(y-((l=i.bufferedStart)!=null?l:i.start)>=a){if(Sl(i,I,R,o),r===t.length-1){Ms(i,y,o);return}i=t[++r];let E=(d=i.bufferedStart)!=null?d:i.start,k=(c=i.bufferedEnd)!=null?c:i.end,x=h<s-1?e[h+1].start:void 0;for(;i!==void 0&&!(y<E||y-E<a&&k-y>=a||x!==void 0&&y-E<k-x);){let P=t[r-1];P.bufferedEnd===void 0&&(i.precizeStart?P.bufferedEnd=i.start:P.infos.segment.complete?P.bufferedEnd=P.end:P.bufferedEnd=i.start,m.debug(\"SI: calculating buffered end of contiguous segment\",o,P.bufferedEnd,P.end)),i.bufferedStart=P.bufferedEnd,i=t[++r],i!==void 0&&(E=(p=i.bufferedStart)!=null?p:i.start,k=(g=i.bufferedEnd)!=null?g:i.end)}}let C=t[r-1];C!==void 0&&Ms(C,y,o)}if(!v(i)){let{SEGMENT_SYNCHRONIZATION_DELAY:h}=L.getCurrent(),I=U();for(let y=r;y<t.length;y++){let _=t[y];I-_.insertionTs>=h&&(m.debug(\"SI: A segment at the end has been completely GCed\",o,`${_.start}-${_.end}`),_.bufferedStart===void 0&&_.bufferedEnd===void 0&&_.status!==2&&this._bufferedHistory.addBufferedSegment(_.infos,null),t.splice(y,1),y--)}}o!==void 0&&m.hasLevel(\"DEBUG\")&&m.debug(`SI: current ${o} inventory timeline:\n`+yl(this._inventory))}insertChunk({period:e,adaptation:t,representation:r,segment:i,chunkSize:a,start:o,end:s},u,f){if(i.isInit)return;let l=t.type;if(o>=s){m.warn(\"SI: Invalid chunked inserted: starts before it ends\",l,o,s);return}let d=this._inventory,c={status:u?0:2,insertionTs:f,chunkSize:a,splitted:!1,start:o,end:s,precizeStart:!1,precizeEnd:!1,bufferedStart:void 0,bufferedEnd:void 0,infos:{segment:i,period:e,adaptation:t,representation:r}};for(let g=d.length-1;g>=0;g--){let h=d[g];if(h.start<=o)if(h.end<=o){for(m.debug(\"SI: Pushing segment strictly after previous one.\",l,o,h.end),this._inventory.splice(g+1,0,c),g+=2;g<d.length&&d[g].start<c.end;){if(d[g].end>c.end){m.debug(\"SI: Segment pushed updates the start of the next one\",l,c.end,d[g].start),d[g].start=c.end,d[g].bufferedStart=void 0,d[g].precizeStart=d[g].precizeStart&&c.precizeEnd;return}m.debug(\"SI: Segment pushed removes the next one\",l,o,s,d[g].start,d[g].end),d.splice(g,1)}return}else if(h.start===o)if(h.end<=s){for(m.debug(\"SI: Segment pushed replace another one\",l,o,s,h.end),this._inventory.splice(g,1,c),g+=1;g<d.length&&d[g].start<c.end;){if(d[g].end>c.end){m.debug(\"SI: Segment pushed updates the start of the next one\",l,c.end,d[g].start),d[g].start=c.end,d[g].bufferedStart=void 0,d[g].precizeStart=d[g].precizeStart&&c.precizeEnd;return}m.debug(\"SI: Segment pushed removes the next one\",l,o,s,d[g].start,d[g].end),d.splice(g,1)}return}else{m.debug(\"SI: Segment pushed ends before another with the same start\",l,o,s,h.end),d.splice(g,0,c),h.start=c.end,h.bufferedStart=void 0,h.precizeStart=h.precizeStart&&c.precizeEnd;return}else if(h.end<=c.end){for(m.debug(\"SI: Segment pushed updates end of previous one\",l,o,s,h.start,h.end),this._inventory.splice(g+1,0,c),h.end=c.start,h.bufferedEnd=void 0,h.precizeEnd=h.precizeEnd&&c.precizeStart,g+=2;g<d.length&&d[g].start<c.end;){if(d[g].end>c.end){m.debug(\"SI: Segment pushed updates the start of the next one\",l,c.end,d[g].start),d[g].start=c.end,d[g].bufferedStart=void 0,d[g].precizeStart=d[g].precizeStart&&c.precizeEnd;return}m.debug(\"SI: Segment pushed removes the next one\",l,o,s,d[g].start,d[g].end),d.splice(g,1)}return}else{m.warn(\"SI: Segment pushed is contained in a previous one\",l,o,s,h.start,h.end);let I={status:h.status,insertionTs:h.insertionTs,chunkSize:h.chunkSize,splitted:!0,start:c.end,end:h.end,precizeStart:h.precizeStart&&h.precizeEnd&&c.precizeEnd,precizeEnd:h.precizeEnd,bufferedStart:void 0,bufferedEnd:h.end,infos:h.infos};h.end=c.start,h.splitted=!0,h.bufferedEnd=void 0,h.precizeEnd=h.precizeEnd&&c.precizeStart,d.splice(g+1,0,c),d.splice(g+2,0,I);return}}let p=this._inventory[0];if(p===void 0){m.debug(\"SI: first segment pushed\",l,o,s),this._inventory.push(c);return}if(p.start>=s)m.debug(\"SI: Segment pushed comes before all previous ones\",l,o,s,p.start),this._inventory.splice(0,0,c);else if(p.end<=s){for(m.debug(\"SI: Segment pushed starts before and completely recovers the previous first one\",l,o,s,p.start,p.end),this._inventory.splice(0,1,c);d.length>1&&d[1].start<c.end;){if(d[1].end>c.end){m.debug(\"SI: Segment pushed updates the start of the next one\",l,c.end,d[1].start),d[1].start=c.end,d[1].bufferedStart=void 0,d[1].precizeStart=c.precizeEnd;return}m.debug(\"SI: Segment pushed removes the next one\",l,o,s,d[1].start,d[1].end),d.splice(1,1)}return}else{m.debug(\"SI: Segment pushed start of the next one\",l,o,s,p.start,p.end),p.start=s,p.bufferedStart=void 0,p.precizeStart=c.precizeEnd,this._inventory.splice(0,0,c);return}}completeSegment(e){if(e.segment.isInit)return;let t=this._inventory,r=[];for(let i=0;i<t.length;i++)if(et(t[i].infos,e)){let a=!1;r.length>0&&(a=!0,r.length===1&&(m.warn(\"SI: Completed Segment is splitted.\",e.segment.id,e.segment.time,e.segment.end),r[0].splitted=!0));let o=i,s=t[i].chunkSize;for(i+=1;i<t.length&&et(t[i].infos,e);){let c=t[i].chunkSize;s!==void 0&&c!==void 0&&(s+=c),i++}let u=i-1,f=u-o,l=t[u].end,d=t[u].bufferedEnd;f>0&&(this._inventory.splice(o+1,f),i-=f),this._inventory[o].status===0&&(this._inventory[o].status=1),this._inventory[o].chunkSize=s,this._inventory[o].end=l,this._inventory[o].bufferedEnd=d,this._inventory[o].splitted=a,r.push(this._inventory[o])}if(r.length===0)m.warn(\"SI: Completed Segment not found\",e.segment.id,e.segment.time);else for(let i of r)i.bufferedStart!==void 0&&i.bufferedEnd!==void 0?i.status!==2&&this._bufferedHistory.addBufferedSegment(i.infos,{start:i.bufferedStart,end:i.bufferedEnd}):m.debug(\"SI: buffered range not known after sync. Skipping history.\",i.start,i.end)}getInventory(){return this._inventory}getHistoryFor(e){return this._bufferedHistory.getHistoryFor(e)}};function ga(n){if(n.bufferedStart===void 0||n.status!==1)return!1;let{start:e,end:t}=n,r=t-e,{MAX_MANIFEST_BUFFERED_START_END_DIFFERENCE:i,MAX_MANIFEST_BUFFERED_DURATION_DIFFERENCE:a}=L.getCurrent();return Math.abs(e-n.bufferedStart)<=i&&(n.bufferedEnd===void 0||n.bufferedEnd>n.bufferedStart&&Math.abs(n.bufferedEnd-n.bufferedStart-r)<=Math.min(a,r/3))}function ks(n){if(n.bufferedEnd===void 0||!n.infos.segment.complete||n.status!==1)return!1;let{start:e,end:t}=n,r=t-e,{MAX_MANIFEST_BUFFERED_START_END_DIFFERENCE:i,MAX_MANIFEST_BUFFERED_DURATION_DIFFERENCE:a}=L.getCurrent();return Math.abs(t-n.bufferedEnd)<=i&&n.bufferedStart!==void 0&&n.bufferedEnd>n.bufferedStart&&Math.abs(n.bufferedEnd-n.bufferedStart-r)<=Math.min(a,r/3)}function Sl(n,e,t,r){let{MAX_MANIFEST_BUFFERED_START_END_DIFFERENCE:i,MISSING_DATA_TRIGGER_SYNC_DELAY:a,SEGMENT_SYNCHRONIZATION_DELAY:o}=L.getCurrent();if(n.bufferedStart!==void 0)n.bufferedStart<e&&(m.debug(\"SI: Segment partially GCed at the start\",r,n.bufferedStart,e),n.bufferedStart=e),!n.precizeStart&&ga(n)&&(n.start=n.bufferedStart,n.precizeStart=!0);else if(n.precizeStart)m.debug(\"SI: buffered start is precize start\",r,n.start),n.bufferedStart=n.start;else if(t!==null&&t.end>e&&(t.precizeEnd||n.start-t.end<=i))m.debug(\"SI: buffered start is end of previous segment\",r,e,n.start,t.end),n.bufferedStart=t.end,ga(n)&&(n.start=t.end,n.precizeStart=!0);else if(n.start-e<=i){let s=U();if(n.start-e>=a&&s-n.insertionTs<o){m.debug(\"SI: Ignored bufferedStart synchronization\",r,e,n.start,s-n.insertionTs);return}m.debug(\"SI: found true buffered start\",r,e,n.start),n.bufferedStart=e,ga(n)&&(n.start=e,n.precizeStart=!0)}else if(e<n.start)m.debug(\"SI: range start too far from expected start\",r,e,n.start),n.bufferedStart=n.start;else{let s=U();if(n.start-e>=a&&s-n.insertionTs<o){m.debug(\"SI: Ignored bufferedStart synchronization\",r,e,n.start,s-n.insertionTs);return}m.debug(\"SI: Segment appears immediately garbage collected at the start\",r,e,n.start),n.bufferedStart=e}}function Ms(n,e,t){let{MAX_MANIFEST_BUFFERED_START_END_DIFFERENCE:r,MISSING_DATA_TRIGGER_SYNC_DELAY:i,SEGMENT_SYNCHRONIZATION_DELAY:a}=L.getCurrent();if(n.bufferedEnd!==void 0)n.bufferedEnd>e&&(m.debug(\"SI: Segment partially GCed at the end\",t,n.bufferedEnd,e),n.bufferedEnd=e),!n.precizeEnd&&e-n.end<=r&&ks(n)&&(n.precizeEnd=!0,n.end=e);else if(n.precizeEnd)m.debug(\"SI: buffered end is precize end\",t,n.end),n.bufferedEnd=n.end;else if(e-n.end<=r||!n.infos.segment.complete){let o=U();if(e-n.end>=i&&o-n.insertionTs<a){m.debug(\"SI: Ignored bufferedEnd synchronization\",t,e,n.end,o-n.insertionTs);return}m.debug(\"SI: found true buffered end\",t,e,n.end),n.bufferedEnd=e,ks(n)&&(n.end=e,n.precizeEnd=!0)}else if(e>n.end)m.debug(\"SI: range end too far from expected end\",t,e,n.end),n.bufferedEnd=n.end;else{let o=U();if(e-n.end>=i&&o-n.insertionTs<a){m.debug(\"SI: Ignored bufferedEnd synchronization\",t,e,n.end,o-n.insertionTs);return}m.debug(\"SI: Segment appears immediately garbage collected at the end\",t,n.bufferedEnd,e),n.bufferedEnd=e}}function yl(n){let e=.016666666666666666,t={},r=[],i=null,a=null;function o(u){let f=String.fromCharCode(r.length+65);return r.push({letter:f,periodId:u.period.id,representationId:u.representation.id,bitrate:u.representation.bitrate}),f}let s=\"\";for(let u=0;u<n.length;u++){let f=n[u];if(f.bufferedStart!==void 0&&f.bufferedEnd!==void 0){let l=f.infos.period.id,d=f.infos.representation.id,c=t[l],p;c===void 0?(p=o(f.infos),t[l]={[d]:p}):c[d]===void 0?(p=o(f.infos),c[d]=p):p=c[d],i===null?s+=`${f.bufferedStart.toFixed(2)}|${p}|`:a===p?i.bufferedEnd+e<f.bufferedStart&&(s+=`${i.bufferedEnd.toFixed(2)} ~ ${f.bufferedStart.toFixed(2)}|${p}|`):s+=`${i.bufferedEnd.toFixed(2)} ~ ${f.bufferedStart.toFixed(2)}|${p}|`,i=f,a=p}}return i!==null&&(s+=String(i.end.toFixed(2))),r.forEach(u=>{var f;s+=`\n[${u.letter}] P: ${u.periodId} || R: ${u.representationId}(${(f=u.bitrate)!=null?f:\"unknown bitrate\"})`}),s}function Kt(n,e){for(let t=0;t<n.length;t++)if(n[t].infos.period.start>=e.start)return t>0?n[t-1]:null;return n.length>0?n[n.length-1]:null}function jt(n,e){for(let t of n)if(t.infos.period.start>e.start)return t;return null}var Os=An;var Yt=class{constructor(){this._segmentInventory=new Os}synchronizeInventory(e){this._segmentInventory.synchronizeBuffered(e)}getLastKnownInventory(){return this._segmentInventory.getInventory()}getSegmentHistory(e){return this._segmentInventory.getHistoryFor(e)}};var kn=class extends Yt{constructor(e,t,r){super(),m.info(\"AVSB: calling `mediaSource.addSourceBuffer`\",t);let i=r.addSourceBuffer(e,t);this.bufferType=e,this._sourceBuffer=i,this._lastInitSegmentUniqueId=null,this.codec=t,this._initSegmentsMap=new Map,this._pendingOperations=[]}declareInitSegment(e,t){ws(t),this._initSegmentsMap.set(e,t)}freeInitSegment(e){this._initSegmentsMap.delete(e)}async pushChunk(e){ws(e.data.chunk),m.debug(\"AVSB: receiving order to push data to the SourceBuffer\",this.bufferType,Rt(e.inventoryInfos));let t=this._getActualDataToPush(e.data);t.length===0&&t.push(new Uint8Array);let r=Promise.all(t.map(o=>{let{codec:s,timestampOffset:u,appendWindow:f}=e.data;return m.debug(\"AVSB: pushing segment\",this.bufferType,Rt(e.inventoryInfos)),this._sourceBuffer.appendBuffer(o,{codec:s,timestampOffset:u,appendWindow:f})}));this._addToOperationQueue(r,{type:0,value:e});let i;try{i=await r}catch(o){throw this._segmentInventory.insertChunk(e.inventoryInfos,!1,U()),o}e.inventoryInfos!==null&&this._segmentInventory.insertChunk(e.inventoryInfos,!0,U());let a=i[i.length-1];return this._segmentInventory.synchronizeBuffered(a),a}async removeBuffer(e,t){m.debug(\"AVSB: receiving order to remove data from the SourceBuffer\",this.bufferType,e,t);let r=this._sourceBuffer.remove(e,t);this._addToOperationQueue(r,{type:1,value:{start:e,end:t}});let i=await r;return this._segmentInventory.synchronizeBuffered(i),i}async signalSegmentComplete(e){if(this._pendingOperations.length>0){let{promise:t}=this._pendingOperations[this._pendingOperations.length-1];this._addToOperationQueue(t,{type:2,value:e});try{await t}catch(r){}}this._segmentInventory.completeSegment(e)}getPendingOperations(){return this._pendingOperations.map(e=>e.operation)}dispose(){try{m.debug(\"AVSB: Calling `dispose` on the SourceBufferInterface\"),this._sourceBuffer.dispose()}catch(e){m.debug(`AVSB: Failed to dispose a ${this.bufferType} SourceBufferInterface:`,e instanceof Error?e:\"\")}}_getActualDataToPush(e){let t=[];if(e.initSegmentUniqueId!==null&&!this._isLastInitSegment(e.initSegmentUniqueId)){let r=this._initSegmentsMap.get(e.initSegmentUniqueId);if(r===void 0)throw new Error(\"Invalid initialization segment uniqueId\");let i=new ArrayBuffer(r.byteLength),a=new Uint8Array(i);a.set(r instanceof ArrayBuffer?new Uint8Array(r):new Uint8Array(r.buffer)),r=a,t.push(r),this._lastInitSegmentUniqueId=e.initSegmentUniqueId}return e.chunk!==null&&t.push(e.chunk),t}_isLastInitSegment(e){return this._lastInitSegmentUniqueId===null?!1:this._lastInitSegmentUniqueId===e}_addToOperationQueue(e,t){let r={operation:t,promise:e};this._pendingOperations.push(r);let i=()=>{let a=this._pendingOperations.indexOf(r);a>=0&&this._pendingOperations.splice(a,1)};e.then(i,i)}};function ws(n){if(b.CURRENT_ENV!==b.PRODUCTION&&(typeof n!=\"object\"||n!==null&&!(n instanceof ArrayBuffer)&&!(n.buffer instanceof ArrayBuffer)))throw new Error(\"Invalid data given to the AudioVideoSegmentSink\")}var Lr=kn;function Bt(n,e){let t;return new Promise((r,i)=>{if(n.cancellationError!==null)return i(n.cancellationError);let a=!1;t=e(function(u){n.deregister(o),a=!0,r(u)},function(u){n.deregister(o),a=!0,i(u)}),a||n.register(o);function o(s){t!==void 0&&t(),i(s)}})}var Mn=class extends Yt{constructor(e){m.debug(\"HTSB: Creating TextSegmentSink\"),super(),this.bufferType=\"text\",this._sender=e,this._pendingOperations=[],this._sender.reset()}declareInitSegment(e){m.warn(\"HTSB: Declaring initialization segment for  Text SegmentSink\",e)}freeInitSegment(e){m.warn(\"HTSB: Freeing initialization segment for  Text SegmentSink\",e)}async pushChunk(e){let{data:t}=e;Tl(t.chunk);let r=this._sender.pushTextData(ie(J({},t),{chunk:t.chunk}));this._addToOperationQueue(r,{type:0,value:e});let i=await r;return e.inventoryInfos!==null&&this._segmentInventory.insertChunk(e.inventoryInfos,!0,U()),this._segmentInventory.synchronizeBuffered(i),i}async removeBuffer(e,t){let r=this._sender.remove(e,t);this._addToOperationQueue(r,{type:1,value:{start:e,end:t}});let i=await r;return this._segmentInventory.synchronizeBuffered(i),i}async signalSegmentComplete(e){if(this._pendingOperations.length>0){let{promise:t}=this._pendingOperations[this._pendingOperations.length-1];this._addToOperationQueue(t,{type:2,value:e});try{await t}catch(r){}}this._segmentInventory.completeSegment(e)}getPendingOperations(){return this._pendingOperations.map(e=>e.operation)}dispose(){m.debug(\"HTSB: Disposing TextSegmentSink\"),this._sender.reset()}_addToOperationQueue(e,t){let r={operation:t,promise:e};this._pendingOperations.push(r);let i=()=>{let a=this._pendingOperations.indexOf(r);a>=0&&this._pendingOperations.splice(a,1)};e.then(i,i)}};function Tl(n){if(b.CURRENT_ENV!==b.PRODUCTION&&(typeof n!=\"object\"||n===null||typeof n.data!=\"string\"||typeof n.type!=\"string\"||n.language!==void 0&&typeof n.language!=\"string\"||n.start!==void 0&&typeof n.start!=\"number\"||n.end!==void 0&&typeof n.end!=\"number\"))throw new Error(\"Invalid format given to a TextSegmentSink\")}b.CURRENT_ENV===b.DEV&&(El=function(e){function t(r){}});var El;var Ds=Mn;var Rl=[\"audio\",\"video\",\"text\"],On=class n{static isNative(e){return Bs(e)}constructor(e,t,r){this._mediaSource=e,this._textInterface=r,this._hasVideo=t,this._initializedSegmentSinks={},this._onNativeBufferAddedOrDisabled=[]}getBufferTypes(){let e=this.getNativeBufferTypes();return this._textInterface!==null&&e.push(\"text\"),e}getNativeBufferTypes(){return this._hasVideo?[\"video\",\"audio\"]:[\"audio\"]}getStatus(e){let t=this._initializedSegmentSinks[e];return t===void 0?{type:\"uninitialized\"}:t===null?{type:\"disabled\"}:{type:\"initialized\",value:t}}waitForUsableBuffers(e){return this._areNativeBuffersUsable()?Promise.resolve():Bt(e,t=>{let r,i=()=>{let a=this._onNativeBufferAddedOrDisabled.indexOf(r);a>=0&&this._onNativeBufferAddedOrDisabled.splice(a,1)};return r=()=>{this._areNativeBuffersUsable()&&(i(),t())},this._onNativeBufferAddedOrDisabled.push(r),i})}disableSegmentSink(e){let t=this._initializedSegmentSinks[e];if(t===null){m.warn(`SBS: The ${e} SegmentSink was already disabled.`);return}if(t!==void 0)throw new Error(\"Cannot disable an active SegmentSink.\");this._initializedSegmentSinks[e]=null,n.isNative(e)&&this._onNativeBufferAddedOrDisabled.forEach(r=>r())}createSegmentSink(e,t){let r=this._initializedSegmentSinks[e];if(Bs(e)){if(!v(r))return r instanceof Lr&&r.codec!==t?m.warn(\"SB: Reusing native SegmentSink with codec\",r.codec,\"for codec\",t):m.info(\"SB: Reusing native SegmentSink with codec\",t),r;m.info(\"SB: Adding native SegmentSink with codec\",t);let a=e===\"audio\"?\"audio\":\"video\",o=new Lr(a,t,this._mediaSource);return this._initializedSegmentSinks[e]=o,this._onNativeBufferAddedOrDisabled.forEach(s=>s()),o}if(!v(r))return m.info(\"SB: Reusing a previous custom SegmentSink for the type\",e),r;let i;if(e===\"text\"){if(m.info(\"SB: Creating a new text SegmentSink\"),this._textInterface===null)throw new Error(\"HTML Text track feature not activated\");return i=new Ds(this._textInterface),this._initializedSegmentSinks.text=i,i}throw m.error(\"SB: Unknown buffer type:\",e),new X(\"BUFFER_TYPE_UNKNOWN\",\"The player wants to create a SegmentSink of an unknown type.\")}disposeSegmentSink(e){let t=this._initializedSegmentSinks[e];if(v(t)){m.warn(\"SB: Trying to dispose a SegmentSink that does not exist\");return}m.info(\"SB: Aborting SegmentSink\",e),t.dispose(),delete this._initializedSegmentSinks[e]}disposeAll(){Rl.forEach(e=>{this.getStatus(e).type===\"initialized\"&&this.disposeSegmentSink(e)})}_areNativeBuffersUsable(){let e=this.getNativeBufferTypes();return!(e.some(i=>this._initializedSegmentSinks[i]===void 0)||e.every(i=>this._initializedSegmentSinks[i]===null))}createSegmentSinkMetricsForType(e){var t,r;return{bufferType:e,codec:(t=this._initializedSegmentSinks[e])==null?void 0:t.codec,segmentInventory:(r=this._initializedSegmentSinks[e])==null?void 0:r.getLastKnownInventory().map(i=>ie(J({},i),{infos:Pl(i.infos)}))}}getSegmentSinksMetrics(){return{segmentSinks:{audio:this.createSegmentSinkMetricsForType(\"audio\"),video:this.createSegmentSinkMetricsForType(\"video\"),text:this.createSegmentSinkMetricsForType(\"text\")}}}};function Bs(n){return n===\"audio\"||n===\"video\"}function Pl(n){return{adaptation:n.adaptation.getMetadataSnapshot(),period:n.period.getMetadataSnapshot(),representation:n.representation.getMetadataSnapshot()}}var Tt=On;function wn(n,e){return Bt(e,t=>{let r=setTimeout(()=>t(),n);return()=>clearTimeout(r)})}var Dn=class extends fe{constructor(e,t,r,i){super(),this._content=e,this._currentCanceller=null,this._downloadQueue=t,this._initSegmentRequest=null,this._mediaSegmentRequest=null,this._segmentFetcher=r,this._initSegmentInfoRef=new j(void 0),this._mediaSegmentAwaitingInitMetadata=null,i||this._initSegmentInfoRef.setValue(null)}getRequestedInitSegment(){return this._initSegmentRequest===null?null:this._initSegmentRequest.segment}getRequestedMediaSegment(){return this._mediaSegmentRequest===null?null:this._mediaSegmentRequest.segment}start(){this._currentCanceller===null&&(this._currentCanceller=new z,this._downloadQueue.onUpdate(e=>{let{segmentQueue:t}=e;if(t.length>0&&t[0].segment.id===this._mediaSegmentAwaitingInitMetadata)return;let r=this._mediaSegmentRequest;if(t.length===0){if(r===null)return;m.debug(\"Stream: no more media segment to request. Cancelling queue.\",this._content.adaptation.type),this._restartMediaSegmentDownloadingQueue();return}else if(r===null){m.debug(\"Stream: Media segments now need to be requested. Starting queue.\",this._content.adaptation.type,t.length),this._restartMediaSegmentDownloadingQueue();return}else{let i=t[0];if(r.segment.id!==i.segment.id){m.debug(\"Stream: Next media segment changed, cancelling previous\",this._content.adaptation.type),this._restartMediaSegmentDownloadingQueue();return}r.priority!==i.priority&&(m.debug(\"Stream: Priority of next media segment changed, updating\",this._content.adaptation.type,r.priority,i.priority),this._segmentFetcher.updatePriority(r.request,i.priority));return}},{emitCurrentValue:!0,clearSignal:this._currentCanceller.signal}),this._downloadQueue.onUpdate(e=>{var r;let t=this._initSegmentRequest;if(e.initSegment!==null&&t!==null){e.initSegment.priority!==t.priority&&this._segmentFetcher.updatePriority(t.request,e.initSegment.priority);return}else if(((r=e.initSegment)==null?void 0:r.segment.id)===(t==null?void 0:t.segment.id))return;e.initSegment===null&&m.debug(\"Stream: no more init segment to request. Cancelling queue.\",this._content.adaptation.type),this._restartInitSegmentDownloadingQueue(e.initSegment)},{emitCurrentValue:!0,clearSignal:this._currentCanceller.signal}))}stop(){var e;(e=this._currentCanceller)==null||e.cancel(),this._currentCanceller=null}_restartMediaSegmentDownloadingQueue(){this._mediaSegmentRequest!==null&&this._mediaSegmentRequest.canceller.cancel();let{segmentQueue:e}=this._downloadQueue.getValue(),t=e[0],r=i=>{if(this._currentCanceller!==null&&this._currentCanceller.isUsed()){this._mediaSegmentRequest=null;return}if(i===void 0){this._mediaSegmentRequest=null,this.trigger(\"emptyQueue\",null);return}let a=new z,o=this._currentCanceller===null?B:a.linkToSignal(this._currentCanceller.signal),{segment:s,priority:u}=i,f=H({segment:s},this._content),l=!1,d=!1;a.signal.register(()=>{this._mediaSegmentRequest=null,!l&&(this._mediaSegmentAwaitingInitMetadata===s.id&&(this._mediaSegmentAwaitingInitMetadata=null),l=!0,d=!1)});let c=h=>{Se(h.segmentType===\"media\",\"Should have loaded a media segment.\"),this.trigger(\"parsedMediaSegment\",H({},h,{segment:s}))},p=()=>{let h=this._downloadQueue.getValue().segmentQueue;if(h.length===0){l=!0,this.trigger(\"emptyQueue\",null);return}else h[0].segment.id===s.id&&h.shift();l=!0,r(h[0])},g=this._segmentFetcher.createRequest(f,u,{onRetry:h=>{this.trigger(\"requestRetry\",{segment:s,error:h})},beforeInterrupted(){m.info(\"Stream: segment request interrupted temporarly.\",s.id,s.time)},onChunk:h=>{let I=this._initSegmentInfoRef.getValue();I!==void 0?c(h(I!=null?I:void 0)):(d=!0,this._initSegmentInfoRef.waitUntilDefined(y=>{c(h(y!=null?y:void 0))},{clearSignal:a.signal}))},onAllChunksReceived:()=>{d?(this._mediaSegmentAwaitingInitMetadata=s.id,this._initSegmentInfoRef.waitUntilDefined(()=>{this._mediaSegmentAwaitingInitMetadata=null,d=!1,this.trigger(\"fullyLoadedSegment\",s)},{clearSignal:a.signal})):this.trigger(\"fullyLoadedSegment\",s)},beforeEnded:()=>{o(),this._mediaSegmentRequest=null,d?this._initSegmentInfoRef.waitUntilDefined(p,{clearSignal:a.signal}):p()}},a.signal);g.catch(h=>{o(),l||(l=!0,this.stop(),this.trigger(\"error\",h))}),this._mediaSegmentRequest={segment:s,priority:u,request:g,canceller:a}};r(t)}_restartInitSegmentDownloadingQueue(e){if(this._currentCanceller!==null&&this._currentCanceller.isUsed()||(this._initSegmentRequest!==null&&this._initSegmentRequest.canceller.cancel(),e===null))return;let t=new z,r=this._currentCanceller===null?B:t.linkToSignal(this._currentCanceller.signal),{segment:i,priority:a}=e,o=H({segment:i},this._content),s=!1,u=this._segmentFetcher.createRequest(o,a,{onRetry:f=>{this.trigger(\"requestRetry\",{segment:i,error:f})},beforeInterrupted:()=>{m.info(\"Stream: init segment request interrupted temporarly.\",i.id)},beforeEnded:()=>{r(),this._initSegmentRequest=null,s=!0},onChunk:f=>{var d;let l=f(void 0);Se(l.segmentType===\"init\",\"Should have loaded an init segment.\"),this.trigger(\"parsedInitSegment\",H({},l,{segment:i})),l.segmentType===\"init\"&&this._initSegmentInfoRef.setValue((d=l.initTimescale)!=null?d:null)},onAllChunksReceived:()=>{this.trigger(\"fullyLoadedSegment\",i)}},t.signal);u.catch(f=>{r(),s||(s=!0,this.stop(),this.trigger(\"error\",f))}),t.signal.register(()=>{this._initSegmentRequest=null,!s&&(s=!0)}),this._initSegmentRequest={segment:i,priority:a,request:u,canceller:t}}};function ha(n,e,t,r,i){let{period:a,adaptation:o,representation:s}=n,u=vl(i,e);if(u===null){if(t===null){if(r&&a.end!==void 0&&e.end>=a.end)return{start:void 0,end:null};let d=s.index.checkDiscontinuity(e.start);if(d!==null)return{start:void 0,end:d}}return null}let f=i[u];if(f.bufferedStart!==void 0&&f.bufferedStart>e.start&&(t===null||f.infos.segment.end<=t)){let d=f.bufferedStart;return!r&&s.index.awaitSegmentBetween(e.start,d)!==!1?null:(m.debug(\"RS: current discontinuity encountered\",o.type,f.bufferedStart),{start:void 0,end:d})}let l=Cl(i,e,u+1);if(l!==null){let d=i[l-1],c=i[l];if(t===null||c.infos.segment.end<=t){if(!r&&s.index.awaitSegmentBetween(d.infos.segment.end,c.infos.segment.time)!==!1)return null;let p=d.bufferedEnd,g=c.bufferedStart;return m.debug(\"RS: future discontinuity encountered\",o.type,p,g),{start:p,end:g}}}if(t===null){if(r&&a.end!==void 0){if(e.end<a.end)return null;let d=xl(i,a.end);if(d!==null){let c=i[d];if(c.bufferedEnd!==void 0&&c.bufferedEnd<a.end)return m.debug(\"RS: discontinuity encountered at the end of the current period\",o.type,c.bufferedEnd,a.end),{start:c.bufferedEnd,end:null}}}if(a.end!==void 0&&e.end>=a.end)return null;for(let d=i.length-1;d>=0;d--){let c=i[d];if(c.bufferedStart===void 0)break;if(c.bufferedStart<e.end){if(c.bufferedEnd!==void 0&&c.bufferedEnd<e.end){let p=s.index.checkDiscontinuity(e.end);if(p!==null)return{start:c.bufferedEnd,end:p}}return null}}}return null}function vl(n,e){for(let t=0;t<n.length;t++){let r=n[t];if(r.bufferedStart===void 0||r.bufferedEnd===void 0||r.bufferedStart>=e.end)return null;if(r.bufferedEnd>e.start)return t}return null}function Cl(n,e,t){if(t<=0)return m.error(\"RS: Asked to check a discontinuity before the first chunk.\"),null;for(let r=t;r<n.length;r++){let i=n[r],a=n[r-1];if(i.bufferedStart===void 0||a.bufferedEnd===void 0||i.bufferedStart>=e.end)return null;if(i.bufferedStart-a.bufferedEnd>0)return r}return null}function xl(n,e){for(let t=n.length-1;t>=0;t--){let r=n[t];if(r.bufferedStart===void 0)return null;if(r.bufferedStart<e)return t}return null}function Ia({bufferedSegments:n,content:e,currentPlaybackTime:t,fastSwitchThreshold:r,getBufferedHistory:i,neededRange:a,segmentsBeingPushed:o,maxBufferSize:s}){let{adaptation:u,representation:f}=e,l=Al(n,o,s),d=f.index.getSegments(a.start,a.end-a.start),c=n.filter(C=>!Ns(C.infos,e,t,r)),p=Nl(c,a,i),{MINIMUM_SEGMENT_SIZE:g,MIN_BUFFER_AHEAD:h}=L.getCurrent(),I=!1,y=Math.min(1/60,g),_=!1,R=[];return{segmentsToLoad:d.filter(C=>{let E=H({segment:C},e);if(o.length>0&&o.some(w=>et(E,w)))return!1;let{duration:k,time:x,end:P}=C;if(C.isInit)return!0;if(I)return R.push(C),!1;if(C.complete&&k<g||o.length>0&&o.some(w=>{if(w.period.id!==e.period.id||w.adaptation.id!==e.adaptation.id)return!1;let{segment:O}=w;if(O.time-y>x)return!1;if(O.complete){if(O.end+y<P)return!1}else if(Math.abs(x-O.time)>x)return!1;return!Ns(w,E,t,r)}))return!1;for(let D=0;D<p.length;D++){let w=p[D],O=w.infos.period.id===e.period.id;if(w.status===1&&O){let N=w.infos.segment;if(x-N.time>-y){if(N.complete){if(N.end-P>-y)return!1}else if(Math.abs(x-N.time)<y)return!1}}}let A=k*e.representation.bitrate;if(l-A<0&&(_=!0,x>a.start+h))return I=!0,R.push(C),!1;let M=i(E);if(M.length>1){let D=M[M.length-1],w=M[M.length-2];if(D.buffered===null&&w.buffered===null)return m.warn(\"Stream: Segment GCed multiple times in a row, ignoring it.\",\"If this happens a lot and lead to unpleasant experience, please  check your device's available memory. If it's low when this message is emitted, you might want to update the RxPlayer's settings (`maxBufferAhead`, `maxVideoBufferSize` etc.) so less memory is used by regular media data buffering.\"+u.type,f.id,C.time),!1}for(let D=0;D<p.length;D++){let w=p[D];if(w.end+y>x){let O=w.start>x+y||kl(p,D).end<P-y;return O&&(l-=A),O}}return l-=A,!0}),segmentsOnHold:R,isBufferFull:_}}function Al(n,e,t){let r=t*8e3;return r-=e.reduce((i,a)=>{let{bitrate:o}=a.representation,{duration:s}=a.segment;return i+o*s},0),n.reduce((i,a)=>a.chunkSize!==void 0?i-a.chunkSize*8:i,r)}function kl(n,e){let t=e+1,{MINIMUM_SEGMENT_SIZE:r}=L.getCurrent(),i=Math.min(1/60,r);for(;t<n.length-1&&n[t-1].end+i>n[t].start;)t++;return t--,n[t]}function Ns(n,e,t,r){let{CONTENT_REPLACEMENT_PADDING:i}=L.getCurrent();if(n.period.id!==e.period.id)return!1;let{segment:a}=n;return a.time<t+i?!1:n.adaptation.id!==e.adaptation.id?!0:Ml(n.representation,e.representation,r)}function Ml(n,e,t){let r=n.bitrate,{BITRATE_REBUFFERING_RATIO:i}=L.getCurrent();if(t===void 0){let a=r*i;return e.bitrate>a}return r<t&&e.bitrate>r}function Ol(n,e,t){let{MAX_TIME_MISSING_FROM_COMPLETE_SEGMENT:r}=L.getCurrent();return n.bufferedStart===void 0||e!==null&&e.bufferedEnd!==void 0&&n.bufferedStart-e.bufferedEnd<.1?!1:t<n.bufferedStart&&n.bufferedStart-n.start>r?(m.info(\"Stream: The start of the wanted segment has been garbage collected\",n.start,n.bufferedStart),!0):!1}function wl(n,e,t){let{MAX_TIME_MISSING_FROM_COMPLETE_SEGMENT:r}=L.getCurrent();return n.bufferedEnd===void 0||e!==null&&e.bufferedStart!==void 0&&e.bufferedStart-n.bufferedEnd<.1?!1:t>n.bufferedEnd&&n.end-n.bufferedEnd>r?(m.info(\"Stream: The end of the wanted segment has been garbage collected\",n.end,n.bufferedEnd),!0):!1}function Dl(n,e){var o,s;if(n.length<2)return!0;let r=(o=n[n.length-1].buffered)==null?void 0:o.start;if(e!==void 0&&r!==void 0&&e-r>.05)return!0;let a=(s=n[n.length-2].buffered)==null?void 0:s.start;return a===void 0||r===void 0?!0:Math.abs(a-r)>.01}function Bl(n,e){var o,s;if(n.length<2)return!0;let r=(o=n[n.length-1].buffered)==null?void 0:o.end;if(e!==void 0&&r!==void 0&&r-e>.05)return!0;let a=(s=n[n.length-2].buffered)==null?void 0:s.end;return a===void 0||r===void 0?!0:Math.abs(a-r)>.01}function Nl(n,e,t){return n.filter((r,i,a)=>{let o=i===0?null:a[i-1],s=i>=a.length-1?null:a[i+1],u=null;if(Ol(r,o,e.start)){if(u=t(r.infos),Dl(u,r.bufferedStart))return!1;m.debug(\"Stream: skipping segment gc-ed at the start\",r.start,r.bufferedStart)}if(wl(r,s,e.end)){if(u=u!=null?u:t(r.infos),Bl(u,r.bufferedEnd))return!1;m.debug(\"Stream: skipping segment gc-ed at the end\",r.end,r.bufferedEnd)}return!0})}function Bn(n,e){let t=n-e,{SEGMENT_PRIORITIES_STEPS:r}=L.getCurrent();for(let i=0;i<r.length;i++)if(t<r[i])return i;return r.length}function ba(n,e,t,r,i,a,o){var x,P,A;let{representation:s}=n,u=(P=(x=t.getIsPaused())!=null?x:t.getReference().getValue().paused.pending)!=null?P:t.getReference().getValue().paused.last,f=(A=t.getPlaybackRate())!=null?A:t.getReference().getValue().speed,l=e;(u===void 0||f===void 0||u||f<=0)&&(l-=.1);let d=Ul(n,l,i),c=s.index.shouldRefresh(d.start,d.end),p=o.getPendingOperations().filter(M=>M.type===2).map(M=>M.value),g=o.getLastKnownInventory(),h=t.getCurrentTime();h===void 0&&(h=t.getReference().getValue().position.getWanted());let I=o.getSegmentHistory.bind(o),{segmentsToLoad:y,segmentsOnHold:_,isBufferFull:R}=Ia({content:n,bufferedSegments:g,currentPlaybackTime:h,fastSwitchThreshold:r,getBufferedHistory:I,neededRange:d,segmentsBeingPushed:p,maxBufferSize:a}),T=y.map(M=>({priority:Bn(M.time,l),segment:M})),C=s.index.isInitialized()&&!s.index.isStillAwaitingFutureSegments()&&d.hasReachedPeriodEnd&&T.length===0&&_.length===0,E=null;return p.length>0&&(E=Math.min(...p.map(M=>M.segment.time))),_.length>0&&(E=E!==null?Math.min(E,_[0].time):_[0].time),T.length>0&&(E=E!==null?Math.min(E,T[0].segment.time):T[0].segment.time),{imminentDiscontinuity:ha(n,d,E,C,g),hasFinishedLoading:C,neededSegments:T,isBufferFull:R,shouldRefreshManifest:c}}function Ul(n,e,t){var d;let r,{manifest:i,period:a,representation:o}=n,s=o.index.getLastAvailablePosition(),u=o.index;!v(s)&&Tt.isNative(n.adaptation.type)&&e>=s&&u.isInitialized()&&!u.isStillAwaitingFutureSegments()&&Ll(i,a,e)?r=s-1:r=e-.1;let f=r+t,l;return!o.index.isInitialized()||o.index.isStillAwaitingFutureSegments()||a.end===void 0?l=!1:s===void 0?l=f>=a.end:s===null?l=!0:l=f>=s,{start:Math.max(r,a.start),end:Math.min(f,(d=a.end)!=null?d:1/0),hasReachedPeriodEnd:l}}function Ll(n,e,t){var i;let r=n.getPeriodAfter(e);return e.containsTime(t,r)&&n.isLastPeriodKnown&&e.id===((i=n.periods[n.periods.length-1])==null?void 0:i.id)}function Sa(n){return new Promise(e=>{setTimeout(e,n)})}async function Nn(n,e,t,r,i){try{return await e.pushChunk(t)}catch(a){if(i.isCancelled()&&a instanceof oe)throw a;if(!(a instanceof Ce)||!a.isBufferFull){let u=a instanceof Error?a.toString():\"An unknown error happened when pushing content\";throw new X(\"BUFFER_APPEND_ERROR\",u,{tracks:[ct(t.inventoryInfos.adaptation)]})}let{position:o}=n.getReference().getValue(),s=o.getWanted();try{m.warn(\"Stream: Running garbage collector\");let u=Math.max(s-5,0),f=s+r.getValue()+12;if(await e.removeBuffer(0,u),await e.removeBuffer(f,Number.MAX_VALUE),await Sa(200),i.cancellationError!==null)throw i.cancellationError;return await e.pushChunk(t)}catch(u){if(u instanceof oe)throw u;let f=u instanceof Error?u.toString():\"Could not clean the buffer\";throw new X(\"BUFFER_FULL_ERROR\",f,{tracks:[ct(t.inventoryInfos.adaptation)]})}}}async function ya({playbackObserver:n,content:e,initSegmentUniqueId:t,segment:r,segmentSink:i,bufferGoal:a},o){if(o.cancellationError!==null)throw o.cancellationError;let s=e.representation.getMimeTypeString(),u={initSegmentUniqueId:t,chunk:null,timestampOffset:0,appendWindow:[void 0,void 0],codec:s},f=H({segment:r,chunkSize:void 0,start:0,end:0},e),l=await Nn(n,i,{data:u,inventoryInfos:f},a,o);return{content:e,segment:r,buffered:l}}async function _a({playbackObserver:n,bufferGoal:e,content:t,initSegmentUniqueId:r,parsedSegment:i,segment:a,segmentSink:o},s){var E,k;if(i.chunkData===null)return null;if(s.cancellationError!==null)throw s.cancellationError;let{chunkData:u,chunkInfos:f,chunkOffset:l,chunkSize:d,appendWindow:c}=i,p=t.representation.getMimeTypeString(),{APPEND_WINDOW_SECURITIES:g}=L.getCurrent(),h=[c[0]!==void 0?Math.max(0,c[0]-g.START):void 0,c[1]!==void 0?c[1]+g.END:void 0],I={initSegmentUniqueId:r,chunk:u,timestampOffset:l,appendWindow:h,codec:p},y=(E=f==null?void 0:f.time)!=null?E:a.time,_=(k=f==null?void 0:f.duration)!=null?k:a.duration,R=y+_;h[0]!==void 0&&(y=Math.max(y,h[0])),h[1]!==void 0&&(R=Math.min(R,h[1]));let T=H({segment:a,chunkSize:d,start:y,end:R},t),C=await Nn(n,o,{data:I,inventoryInfos:T},e,s);return{content:t,segment:a,buffered:C}}function Ta({content:n,options:e,playbackObserver:t,segmentSink:r,segmentFetcher:i,terminate:a},o,s){let{period:u,adaptation:f,representation:l}=n,{bufferGoal:d,maxBufferSize:c,drmSystemId:p,fastSwitchThreshold:g}=e,h=f.type,I=new z;I.linkToSignal(s);let y=new z;y.linkToSignal(I.signal);let _={segment:l.index.getInitSegment(),uniqueId:null,isLoaded:!1};I.signal.register(()=>{_.uniqueId!==null&&r.freeInitSegment(_.uniqueId)});let R=new j({initSegment:null,segmentQueue:[]},y.signal),T=_.segment!==null;T||(_.isLoaded=!0);let C=!1;if(p!==void 0){let A=l.getEncryptionData(p);if(A.length>0&&A.every(M=>M.keyIds!==void 0)&&(C=!0,o.encryptionDataEncountered(A.map(M=>H({content:n},M))),I.isUsed()))return}let E=new Dn(n,R,i,T);E.addEventListener(\"error\",A=>{y.signal.isCancelled()||(I.cancel(),o.error(A))}),E.addEventListener(\"parsedInitSegment\",x),E.addEventListener(\"parsedMediaSegment\",x),E.addEventListener(\"emptyQueue\",k),E.addEventListener(\"requestRetry\",A=>{if(o.warning(A.error),y.signal.isCancelled())return;let M=A.segment,{index:D}=l;D.isSegmentStillAvailable(M)===!1?k():D.canBeOutOfSyncError(A.error,M)&&o.manifestMightBeOufOfSync()}),E.addEventListener(\"fullyLoadedSegment\",A=>{r.signalSegmentComplete(H({segment:A},n)).catch(P)}),E.start(),y.signal.register(()=>{E.removeEventListener(),E.stop()}),t.listen(k,{includeLastObservation:!1,clearSignal:y.signal}),n.manifest.addEventListener(\"manifestUpdate\",k,y.signal),d.onUpdate(k,{emitCurrentValue:!1,clearSignal:y.signal}),c.onUpdate(k,{emitCurrentValue:!1,clearSignal:y.signal}),a.onUpdate(k,{emitCurrentValue:!1,clearSignal:y.signal}),k();return;function k(){if(y.isUsed())return;let A=t.getReference().getValue(),M=A.position.getWanted(),D=ba(n,M,t,g.getValue(),d.getValue(),c.getValue(),r),{neededSegments:w}=D,O=null;if(l.index.isInitialized()){if(w.length>0&&!_.isLoaded&&_.segment!==null){let q=w[0].priority;O={segment:_.segment,priority:q}}}else if(_.segment===null)m.warn(\"Stream: Uninitialized index without an initialization segment\");else if(_.isLoaded)m.warn(\"Stream: Uninitialized index with an already loaded initialization segment\");else{let q=A.position.getWanted();O={segment:_.segment,priority:Bn(u.start,q)}}let N=a.getValue();if(N===null)R.setValue({initSegment:O,segmentQueue:w});else if(N.urgent){m.debug(\"Stream: Urgent switch, terminate now.\",h),R.setValue({initSegment:null,segmentQueue:[]}),R.finish(),y.cancel(),o.terminating();return}else{let q=w[0],Q=E.getRequestedInitSegment(),G=E.getRequestedMediaSegment(),Y=G===null||q===void 0||G.id!==q.segment.id?[]:[q],V=Q===null?null:O;if(R.setValue({initSegment:V,segmentQueue:Y}),Y.length===0&&V===null){m.debug(\"Stream: No request left, terminate\",h),R.finish(),y.cancel(),o.terminating();return}}if(o.streamStatusUpdate({period:u,position:A.position.getWanted(),bufferType:h,imminentDiscontinuity:D.imminentDiscontinuity,isEmptyStream:!1,hasFinishedLoading:D.hasFinishedLoading,neededSegments:D.neededSegments}),y.signal.isCancelled())return;let{UPTO_CURRENT_POSITION_CLEANUP:W}=L.getCurrent();if(D.isBufferFull){let q=Math.max(0,M-W);q>0&&r.removeBuffer(0,q).catch(P)}D.shouldRefreshManifest&&o.needsManifestRefresh()}function x(A){if(!I.isUsed()){for(let M of A.protectionData)l.addProtectionData(M.initDataType,M.keyId,M.initData);if(!C){let M=l.getAllEncryptionData();if(M.length>0&&(o.encryptionDataEncountered(M.map(D=>H({content:n},D))),C=!0,I.isUsed()))return}if(A.segmentType===\"init\"){if(!l.index.isInitialized()&&A.segmentList!==void 0&&l.index.initialize(A.segmentList),_.isLoaded=!0,A.initializationData!==null){let M=l.uniqueId;_.uniqueId=M,r.declareInitSegment(M,A.initializationData),ya({playbackObserver:t,bufferGoal:d,content:n,initSegmentUniqueId:M,segment:A.segment,segmentData:A.initializationData,segmentSink:r},I.signal).then(D=>{D!==null&&o.addedSegment(D)}).catch(P)}k();return}else{let{inbandEvents:M,predictedSegments:D,needsManifestRefresh:w}=A;if(D!==void 0&&l.index.addPredictedSegments(D,A.segment),w===!0&&(o.needsManifestRefresh(),I.isUsed())||M!==void 0&&M.length>0&&(o.inbandEvent(M),I.isUsed()))return;let O=_.uniqueId;_a({playbackObserver:t,bufferGoal:d,content:n,initSegmentUniqueId:O,parsedSegment:A,segment:A.segment,segmentSink:r},I.signal).then(N=>{N!==null&&o.addedSegment(N)}).catch(P)}}}function P(A){I.isUsed()&&A instanceof oe||(I.cancel(),o.error(A))}}var Us=Ta;function Ea(n,e,t,r,i){var c,p,g,h;if(t.switchingMode===\"lazy\")return{type:\"continue\",value:void 0};let a=r.getLastKnownInventory(),o=[];for(let I of a)I.infos.period.id===n.id&&(I.infos.adaptation.id!==e.id||!ce(t.representationIds,I.infos.representation.id))&&Gt(o,{start:(c=I.bufferedStart)!=null?c:I.start,end:(p=I.bufferedEnd)!=null?p:I.end});let s=r.getPendingOperations();for(let I of s)if(I.type===0){let y=I.value.inventoryInfos;if(y.period.id===n.id&&(y.adaptation.id!==e.id||!ce(t.representationIds,y.representation.id))){let _=y.segment.time,R=_+y.segment.duration;Gt(o,{start:_,end:R})}}if(o.length===0)return{type:\"continue\",value:void 0};if(t.switchingMode===\"reload\"){let I=i.getReadyState();if(I===void 0||I>1)return{type:\"needs-reload\",value:void 0}}let u=t.switchingMode===\"direct\",f=[],l=Kt(a,n);if(l!==null&&(l.bufferedEnd===void 0||n.start-l.bufferedEnd<1)&&f.push({start:0,end:n.start+1}),!u){let{ADAP_REP_SWITCH_BUFFER_PADDINGS:I}=L.getCurrent(),y=e.type,_=(g=I[y].before)!=null?g:0,R=(h=I[y].after)!=null?h:0,T=i.getCurrentTime();T===void 0&&(T=i.getReference().getValue().position.getPolled()),f.push({start:T-_,end:T+R})}if(n.end!==void 0){let I=jt(a,n);I!==null&&(I.bufferedStart===void 0||I.bufferedStart-n.end<1)&&f.push({start:n.end-1,end:Number.MAX_VALUE})}let d=Br(o,f);return d.length===0?{type:\"continue\",value:void 0}:u?{type:\"flush-buffer\",value:d}:{type:\"clean-buffer\",value:d}}function Ra({playbackObserver:n,content:e,options:t,representationEstimator:r,segmentSink:i,segmentFetcherCreator:a,wantedBufferAhead:o,maxVideoBufferSize:s},u,f){let{manifest:l,period:d,adaptation:c}=e,p=new z;p.linkToSignal(f);let g=new Map,h=new j(null,p.signal),I,y=e.representations.getValue().representationIds,_=e.adaptation.representations.filter(w=>ce(y,w.id)&&w.decipherable!==!1&&w.isSupported!==!1),R=new j(_,p.signal),{estimates:T,callbacks:C}=r({manifest:l,period:d,adaptation:c},h,R,n,p.signal),E=a.createSegmentFetcher(c.type,{onRequestBegin:C.requestBegin,onRequestEnd:C.requestEnd,onProgress:C.requestProgress,onMetrics:C.metrics}),k=new j(0);T.onUpdate(({bitrate:w,knownStableBitrate:O})=>{t.enableFastSwitching&&k.setValueIfChanged(O),!(w===void 0||w===I)&&(I=w,m.debug(`Stream: new ${c.type} bitrate estimate`,w),u.bitrateEstimateChange({type:c.type,bitrate:w}))},{emitCurrentValue:!0,clearSignal:p.signal});let x;e.representations.onUpdate(w=>{x!==void 0&&x.cancel();let O=e.representations.getValue().representationIds,N=e.adaptation.representations.filter(W=>ce(O,W.id));R.setValueIfChanged(N),x=new z,x.linkToSignal(p.signal),P(w,x.signal).catch(W=>{(x==null?void 0:x.isUsed())===!0&&z.isCancellationError(W)||(p.cancel(),u.error(W))})},{clearSignal:p.signal,emitCurrentValue:!0});return;async function P(w,O){let N=Ea(d,c,w,i,n);switch(N.type){case\"continue\":break;case\"needs-reload\":return wt(()=>{n.listen(()=>{if(O.isCancelled())return;let{DELTA_POSITION_AFTER_RELOAD:W}=L.getCurrent(),q=W.bitrateSwitch;return u.waitingMediaSourceReload({bufferType:c.type,period:d,timeOffset:q,stayInPeriod:!0})},{includeLastObservation:!0,clearSignal:O})});case\"flush-buffer\":case\"clean-buffer\":for(let W of N.value)if(await i.removeBuffer(W.start,W.end),O.isCancelled())return;if(N.type===\"flush-buffer\"&&(u.needsBufferFlush(),O.isCancelled()))return;break;default:We(N)}A(O)}function A(w){let O=new z;O.linkToSignal(w);let{representation:N}=T.getValue();if(N===null)return;let W=new j(null,O.signal);T.onUpdate(G=>{if(!(G.representation===null||G.representation.id===N.id))return G.urgent?(m.info(\"Stream: urgent Representation switch\",c.type),W.setValue({urgent:!0})):(m.info(\"Stream: slow Representation switch\",c.type),W.setValue({urgent:!1}))},{clearSignal:O.signal,emitCurrentValue:!0});let q={type:c.type,adaptation:c,period:d,representation:N};if(h.setValue(N),p.isUsed()||(u.representationChange(q),p.isUsed()))return;let Q={streamStatusUpdate:u.streamStatusUpdate,encryptionDataEncountered:u.encryptionDataEncountered,manifestMightBeOufOfSync:u.manifestMightBeOufOfSync,needsManifestRefresh:u.needsManifestRefresh,inbandEvent:u.inbandEvent,warning:u.warning,error(G){p.cancel(),u.error(G)},addedSegment(G){C.addedSegment(G)},terminating(){if(!O.isUsed())return O.cancel(),A(w)}};M(N,W,Q,w)}function M(w,O,N,W){let q=new z;q.linkToSignal(W);let Q=Jt(o,V=>V*D(w),q.signal),G=c.type===\"video\"?s:new j(1/0);m.info(\"Stream: changing representation\",c.type,w.id,w.bitrate);let Y=H({},N,{error(V){var le;let $=be(V,{defaultCode:\"NONE\",defaultReason:\"Unknown `RepresentationStream` error\"});if($.code!==\"BUFFER_FULL_ERROR\")N.error(V);else{let ye=o.getValue(),Ge=((le=g.get(w.id))!=null?le:1)*.7;if(Ge<=.05||ye*Ge<=2)throw $;g.set(w.id,Ge),wn(4e3,p.signal).then(()=>M(w,O,N,W)).catch(B)}},terminating(){q.cancel(),N.terminating()}});Us({playbackObserver:n,content:{representation:w,adaptation:c,period:d,manifest:l},segmentSink:i,segmentFetcher:E,terminate:O,options:{bufferGoal:Q,maxBufferSize:G,drmSystemId:t.drmSystemId,fastSwitchThreshold:k}},Y,W),l.addEventListener(\"manifestUpdate\",V=>{for(let $ of V.updatedPeriods)if($.period.id===d.id){for(let le of $.result.updatedAdaptations)if(le.adaptation===c.id){for(let ye of le.removedRepresentations)if(ye===w.id)return W.isCancelled()?void 0:u.waitingMediaSourceReload({bufferType:c.type,period:d,timeOffset:0,stayInPeriod:!0})}}else if($.period.start>d.start)break},W)}function D(w){let O=g.get(w.id),N=O!==void 0?O:1;return O===void 0&&g.set(w.id,N),N}}var Ls=Ra;function Fl(n,e){let[t,...r]=n.split(\";\"),[i,...a]=e.split(\";\");if(t!==i)return!1;let o=K(r,l=>Ue(l,\"codecs=\")),s=K(a,l=>Ue(l,\"codecs=\"));if(o===void 0||s===void 0)return!1;let u=o.substring(7),f=s.substring(7);return u.split(\".\")[0]===f.split(\".\")[0]}var Fs=Fl;function Pa(n,e,t,r,i,a){var p,g,h,I;if(n.codec!==void 0&&a.onCodecSwitch===\"reload\"&&!zl(t,n.codec))return{type:\"needs-reload\",value:void 0};let o=n.getLastKnownInventory(),s=[];for(let y of o)y.infos.period.id===e.id&&y.infos.adaptation.id!==t.id&&Gt(s,{start:(p=y.bufferedStart)!=null?p:y.start,end:(g=y.bufferedEnd)!=null?g:y.end});let u=n.getPendingOperations();for(let y of u)if(y.type===0){let _=y.value.inventoryInfos;if(_.period.id===e.id&&_.adaptation.id!==t.id){let R=_.segment.time,T=R+_.segment.duration;Gt(s,{start:R,end:T})}}if(s.length===0)return{type:\"continue\",value:void 0};if(r===\"reload\"){let y=i.getReadyState();if(y===void 0||y>1)return{type:\"needs-reload\",value:void 0}}let f=r===\"direct\",l=[],d=Kt(o,e);if(d!==null&&(d.bufferedEnd===void 0||e.start-d.bufferedEnd<1)&&l.push({start:0,end:e.start+1}),!f){let y=t.type,{ADAP_REP_SWITCH_BUFFER_PADDINGS:_}=L.getCurrent(),R=(h=_[y].before)!=null?h:0,T=(I=_[y].after)!=null?I:0,C=i.getCurrentTime();C===void 0&&(C=i.getReference().getValue().position.getPolled()),l.push({start:C-R,end:C+T})}if(e.end!==void 0){let y=jt(o,e);y!==null&&(y.bufferedStart===void 0||y.bufferedStart-e.end<1)&&l.push({start:e.end-1,end:Number.MAX_VALUE})}let c=Br(s,l);return c.length===0?{type:\"continue\",value:void 0}:f&&t.type!==\"text\"?{type:\"flush-buffer\",value:c}:{type:\"clean-buffer\",value:c}}function zl(n,e){return n.representations.some(t=>t.isSupported===!0&&t.decipherable!==!1&&Fs(t.getMimeTypeString(),e))}function va({bufferType:n,content:e,garbageCollectors:t,playbackObserver:r,representationEstimator:i,segmentFetcherCreator:a,segmentSinksStore:o,options:s,wantedBufferAhead:u,maxVideoBufferSize:f},l,d){let{manifest:c,period:p}=e,g=new j(void 0,d);if(l.periodStreamReady({type:n,manifest:c,period:p,adaptationRef:g}),d.isCancelled())return;let h,I=!0;g.onUpdate(R=>{(async()=>{var w;if(R===void 0)return;let T=new z;if(T.linkToSignal(d),h==null||h.cancel(),h=T,R===null){m.info(`Stream: Set no ${n} Adaptation. P:`,p.start);let O=o.getStatus(n);if(O.type===\"initialized\"){if(m.info(`Stream: Clearing previous ${n} SegmentSink`),Tt.isNative(n))return _(0,!0,T.signal);{let N=(w=p.end)!=null?w:1/0;if(p.start>N)m.warn(\"Stream: Can't free buffer: period's start is after its end\");else if(await O.value.removeBuffer(p.start,N),T.isUsed())return}}else if(O.type===\"uninitialized\"&&(o.disableSegmentSink(n),T.isUsed()))return;return l.adaptationChange({type:n,adaptation:null,period:p}),T.isUsed()?void 0:zs(r,u,n,{period:p},l,T.signal)}let C=p.adaptations[n],E=K(C!=null?C:[],O=>O.id===R.adaptationId);if(E===void 0){h.cancel(),m.warn(\"Stream: Unfound chosen Adaptation choice\",R.adaptationId);return}let{DELTA_POSITION_AFTER_RELOAD:k}=L.getCurrent(),x=!1,P;if(I)P=0;else if(R.relativeResumingPosition!==void 0)P=R.relativeResumingPosition;else switch(x=!0,n){case\"audio\":P=k.trackSwitch.audio;break;case\"video\":P=k.trackSwitch.video;break;default:P=k.trackSwitch.other;break}if(I=!1,Tt.isNative(n)&&o.getStatus(n).type===\"disabled\")return _(P,!0,T.signal);c.addEventListener(\"manifestUpdate\",O=>{for(let N of O.updatedPeriods)if(N.period.id===p.id){for(let W of N.result.removedAdaptations)if(W.id===E.id)return _(P,!0,T.signal)}else if(N.period.start>p.start)break},h.signal);let{representations:A}=R;if(m.info(`Stream: Updating ${n} adaptation`,`A: ${E.id}`,`P: ${p.start}`),l.adaptationChange({type:n,adaptation:E,period:p}),T.isUsed())return;let M=Wl(o,n,E),D=Pa(M,p,E,R.switchingMode,r,s);if(D.type===\"needs-reload\")return _(P,!0,T.signal);if(await o.waitForUsableBuffers(T.signal),!T.isUsed()){if(D.type===\"flush-buffer\"||D.type===\"clean-buffer\"){for(let{start:O,end:N}of D.value)if(await M.removeBuffer(O,N),T.isUsed())return;if(D.type===\"flush-buffer\"&&(l.needsBufferFlush({relativeResumingPosition:P,relativePosHasBeenDefaulted:x}),T.isUsed()))return}t.get(M)(T.signal),y(E,A,M,T.signal)}})().catch(T=>{T instanceof oe||(h==null||h.cancel(),l.error(T))})},{clearSignal:d,emitCurrentValue:!0});function y(R,T,C,E){let k=ql(r,R.type);Ls({content:{manifest:c,period:p,adaptation:R,representations:T},options:s,playbackObserver:k,representationEstimator:i,segmentSink:C,segmentFetcherCreator:a,wantedBufferAhead:u,maxVideoBufferSize:f},ie(J({},l),{error:x}),E);function x(P){if(!Tt.isNative(n)){m.error(`Stream: ${n} Stream crashed. Aborting it.`,P instanceof Error?P:\"\"),o.disposeSegmentSink(n);let A=be(P,{defaultCode:\"NONE\",defaultReason:\"Unknown `AdaptationStream` error\"});return l.warning(A),E.isCancelled()?void 0:zs(r,u,n,{period:p},l,E)}m.error(`Stream: ${n} Stream crashed. Stopping playback.`,P instanceof Error?P:\"\"),l.error(P)}}function _(R,T,C){wt(()=>{r.listen(()=>{C.isCancelled()||l.waitingMediaSourceReload({bufferType:n,period:p,timeOffset:R,stayInPeriod:T})},{includeLastObservation:!0,clearSignal:C})})}}function Wl(n,e,t){let r=n.getStatus(e);if(r.type===\"initialized\")return m.info(\"Stream: Reusing a previous SegmentSink for the type\",e),r.value;let i=Vl(t);return n.createSegmentSink(e,i)}function Vl(n){let e=n.representations.filter(t=>t.isSupported===!0&&t.decipherable!==!1);if(e.length===0)throw new X(\"NO_PLAYABLE_REPRESENTATION\",\"No Representation in the chosen \"+n.type+\" Adaptation can be played\",{tracks:[ct(n)]});return e[0].getMimeTypeString()}function ql(n,e){return n.deriveReadOnlyObserver(function(r,i){let a=new j(o(),i);return r.onUpdate(s,{clearSignal:i,emitCurrentValue:!1}),a;function o(){let u=r.getValue(),f=u.buffered[e],l=f!==null?Dr(f,u.position.getWanted()):0;return H({},u,{bufferGap:l,buffered:f})}function s(){a.setValue(o())}})}function zs(n,e,t,r,i,a){let{period:o}=r,s=!1;e.onUpdate(u,{emitCurrentValue:!1,clearSignal:a}),n.listen(u,{includeLastObservation:!1,clearSignal:a}),u();function u(){let f=n.getReference().getValue(),l=e.getValue(),d=f.position.getWanted();o.end!==void 0&&d+l>=o.end&&(m.debug('Stream: full \"empty\" AdaptationStream',t),s=!0),i.streamStatusUpdate({period:o,bufferType:t,imminentDiscontinuity:null,position:d,isEmptyStream:!0,hasFinishedLoading:s,neededSegments:[]})}}var Ws=va;function Fr(n,e){if(e.length===0)return[];let t=[],r=n.getLastKnownInventory();for(let i=0;i<r.length;i++){let a=r[i];if(e.some(s=>a.infos.period.id===s.period.id&&a.infos.adaptation.id===s.adaptation.id&&a.infos.representation.id===s.representation.id)){let{bufferedStart:s,bufferedEnd:u}=a;if(s===void 0||u===void 0)return m.warn(\"SO: No buffered start or end found from a segment.\"),[{start:0,end:Number.MAX_VALUE}];let f=t[t.length-1];f!==void 0&&f.end===s?f.end=u:t.push({start:s,end:u})}}return t}function Ca(n,e,t,r,i,a,o,s){let{manifest:u,initialPeriod:f}=n,{maxBufferAhead:l,maxBufferBehind:d,wantedBufferAhead:c,maxVideoBufferSize:p}=a,{MINIMUM_MAX_BUFFER_AHEAD:g,MAXIMUM_MAX_BUFFER_AHEAD:h,MAXIMUM_MAX_BUFFER_BEHIND:I}=L.getCurrent(),y=new Cn(T=>{var x,P;let{bufferType:C}=T,E=(x=I[C])!=null?x:1/0,k=(P=h[C])!=null?P:1/0;return A=>{Nr({segmentSink:T,playbackObserver:e,maxBufferBehind:Jt(d,M=>Math.min(M,E),A),maxBufferAhead:Jt(l,M=>{var w;let D=Math.max(M,(w=g[C])!=null?w:0);return Math.min(D,k)},A)},A)}});for(let T of r.getBufferTypes())_(T,f);function _(T,C){let E=new Dt((D,w)=>D.start-w.start),k=!1,x=new z;return x.linkToSignal(s),e.listen(({position:D})=>{var N;let w=D.getWanted();if(!k||!A(w))return;for(m.info(\"Stream: Destroying all PeriodStreams due to out of bounds situation\",T,w),k=!1;E.length()>0;){let W=E.get(E.length()-1);E.removeElement(W),o.periodStreamCleared({type:T,manifest:u,period:W})}x.cancel(),x=new z,x.linkToSignal(s);let O=(N=u.getPeriodForTime(w))!=null?N:u.getNextPeriod(w);if(O===void 0){m.warn(\"Stream: The wanted position is not found in the Manifest.\"),k=!0;return}P(O)},{clearSignal:s,includeLastObservation:!0}),u.addEventListener(\"decipherabilityUpdate\",D=>{s.isCancelled()||M(D).catch(w=>{s.isCancelled()||(x.cancel(),o.error(w))})},s),P(C);function P(D){let w=ie(J({},o),{waitingMediaSourceReload(O){let N=E.head();N===void 0||N.id!==O.period.id?o.lockedStream({bufferType:O.bufferType,period:O.period}):o.needsMediaSourceReload({timeOffset:O.timeOffset,minimumPosition:O.stayInPeriod?O.period.start:void 0,maximumPosition:O.stayInPeriod?O.period.end:void 0})},periodStreamReady(O){k=!0,E.add(O.period),o.periodStreamReady(O)},periodStreamCleared(O){E.removeElement(O.period),o.periodStreamCleared(O)},error(O){x.cancel(),o.error(O)}});R(T,D,w,x.signal)}function A(D){let w=E.head(),O=E.last();return w===void 0||O===void 0?!0:w.start>D||(v(O.end)?1/0:O.end)<D}async function M(D){let w=r.getStatus(T),O=D.filter(Y=>Y.adaptation.type===T);if(O.length===0||w.type!==\"initialized\"||O.every(Y=>Y.representation.decipherable===!0))return;let N=w.value,W=O.filter(Y=>Y.representation.decipherable===void 0),q=O.filter(Y=>Y.representation.decipherable===!1),Q=Fr(N,q),G=Fr(N,W);for(k=!1,m.info(\"Stream: Destroying all PeriodStreams for decipherability matters\",T);E.length()>0;){let Y=E.get(E.length()-1);E.removeElement(Y),o.periodStreamCleared({type:T,manifest:u,period:Y})}x.cancel(),x=new z,x.linkToSignal(s);for(let{start:Y,end:V}of[...Q,...G]){if(s.isCancelled())return;if(Y<V){if(s.isCancelled())return;await N.removeBuffer(Y,V)}}wt(()=>{if(s.isCancelled())return;let Y=e.getReference().getValue();if(Vs(Y,Q)){if(o.needsDecipherabilityFlush(),s.isCancelled())return}else if(Vs(Y,G)&&(o.needsBufferFlush(),s.isCancelled()))return;let V=Y.position.getWanted(),$=u.getPeriodForTime(V);if($===void 0){o.error(new X(\"MEDIA_TIME_NOT_FOUND\",\"The wanted position is not found in the Manifest.\"));return}P($)})}}function R(T,C,E,k){m.info(\"Stream: Creating new Stream for\",T,C.start);let x=null,P=new z;P.linkToSignal(k),e.listen(({position:O},N)=>{if(C.end!==void 0&&O.getWanted()>=C.end){let W=u.getPeriodAfter(C);if(C.containsTime(O.getWanted(),W))return;m.info(\"Stream: Destroying PeriodStream as the current playhead moved above it\",T,C.start,O.getWanted(),C.end),N(),E.periodStreamCleared({type:T,manifest:u,period:C}),P.cancel()}},{clearSignal:k,includeLastObservation:!0});let A={bufferType:T,content:{manifest:u,period:C},garbageCollectors:y,maxVideoBufferSize:p,segmentFetcherCreator:i,segmentSinksStore:r,options:a,playbackObserver:e,representationEstimator:t,wantedBufferAhead:c},M=ie(J({},E),{streamStatusUpdate(O){if(O.hasFinishedLoading){let N=u.getPeriodAfter(C);N!==null&&D(N)}else x!==null&&(m.info(\"Stream: Destroying next PeriodStream due to current one being active\",T,x.period.start),E.periodStreamCleared({type:T,manifest:u,period:x.period}),x.canceller.cancel(),x=null);E.streamStatusUpdate(O)},error(O){x!==null&&(x.canceller.cancel(),x=null),P.cancel(),E.error(O)}});Ws(A,M,P.signal),w(P.signal);function D(O){if(x!==null){if(x.period.id===O.id)return;m.warn(\"Stream: Creating next `PeriodStream` while one was already created.\",T,O.id,x.period.id),E.periodStreamCleared({type:T,manifest:u,period:x.period}),x.canceller.cancel()}let N=new z;N.linkToSignal(k),x={canceller:N,period:O},R(T,O,E,x.canceller.signal)}function w(O){u.addEventListener(\"manifestUpdate\",N=>{for(let W of N.removedPeriods)if(W.id===C.id){if(u.periods.length>0&&u.periods[0].start<=W.start)return wt(()=>{if(!O.isCancelled())return o.needsMediaSourceReload({timeOffset:0,minimumPosition:void 0,maximumPosition:void 0})})}else if(W.start>C.start)break;if(N.addedPeriods.length>0&&x!==null){let W=u.getPeriodAfter(C);(W===null||x.period.id!==W.id)&&(m.warn(\"Stream: Destroying next PeriodStream due to new one being added\",T,x.period.start),E.periodStreamCleared({type:T,manifest:u,period:x.period}),x.canceller.cancel(),x=null)}},O)}}}function Vs(n,e){if(e.length===0)return!1;let t=n.position.getPolled();return n.speed>=0?e[e.length-1].end>=t-5:e[0].start<=t+5}var qs=Ca;var Hs=qs;var Un=class extends fe{constructor(e,t,r){super(),this._canceller=new z,this._manifest=e,this._activeStreams=new Map,this._allBufferTypes=r,this._lastCurrentPeriodId=null;let i=new xa(e);this._maximumPositionCalculator=i;let a=this._canceller.signal;t.listen(({position:o})=>{let s=o.getWanted();if(s<e.getMinimumSafePosition()){let u=new X(\"MEDIA_TIME_BEFORE_MANIFEST\",\"The current position is behind the earliest time announced in the Manifest.\");this.trigger(\"warning\",u)}else if(s>i.getMaximumAvailablePosition()){let u=new X(\"MEDIA_TIME_AFTER_MANIFEST\",\"The current position is after the latest time announced in the Manifest.\");this.trigger(\"warning\",u)}},{includeLastObservation:!0,clearSignal:a}),e.addEventListener(\"manifestUpdate\",()=>{this.trigger(\"endingPositionChange\",this._getManifestEndTime()),!a.isCancelled()&&this._checkEndOfStream()},a)}getCurrentEndingTime(){return this._getManifestEndTime()}onAdaptationChange(e,t,r){if(this._manifest.isLastPeriodKnown){let i=this._manifest.periods[this._manifest.periods.length-1];if(t.id===(i==null?void 0:i.id)&&(e===\"audio\"||e===\"video\")){e===\"audio\"?this._maximumPositionCalculator.updateLastAudioAdaptation(r):this._maximumPositionCalculator.updateLastVideoAdaptation(r);let a=this._maximumPositionCalculator.getEndingPosition(),o=a!==void 0?{isEnd:!0,endingPosition:a}:{isEnd:!1,endingPosition:this._maximumPositionCalculator.getMaximumAvailablePosition()};this.trigger(\"endingPositionChange\",o)}}this._canceller.isUsed()||r===null&&this._addActivelyLoadedPeriod(t,e)}onRepresentationChange(e,t){this._addActivelyLoadedPeriod(t,e)}onPeriodCleared(e,t){this._removeActivelyLoadedPeriod(t,e)}onLastSegmentFinishedLoading(e){let t=this._lazilyCreateActiveStreamInfo(e);t.hasFinishedLoadingLastPeriod||(t.hasFinishedLoadingLastPeriod=!0,this._checkEndOfStream())}onLastSegmentLoadingResume(e){let t=this._lazilyCreateActiveStreamInfo(e);t.hasFinishedLoadingLastPeriod&&(t.hasFinishedLoadingLastPeriod=!1,this._checkEndOfStream())}dispose(){this.removeEventListener(),this._canceller.cancel()}_addActivelyLoadedPeriod(e,t){let r=this._lazilyCreateActiveStreamInfo(t);r.activePeriods.has(e)||(r.activePeriods.add(e),this._checkCurrentPeriod())}_removeActivelyLoadedPeriod(e,t){let r=this._activeStreams.get(t);r!==void 0&&r.activePeriods.has(e)&&(r.activePeriods.removeElement(e),this._checkCurrentPeriod())}_checkCurrentPeriod(){if(this._allBufferTypes.length===0)return;let e=this._activeStreams.get(this._allBufferTypes[0]);if(e!==void 0)for(let t of e.activePeriods.toArray()){let r=!0;for(let i of this._allBufferTypes){let a=this._activeStreams.get(i);if(a===void 0)return;if(!a.activePeriods.toArray().some(u=>u.id===t.id)){r=!1;break}}if(r){this._lastCurrentPeriodId!==t.id&&(this._lastCurrentPeriodId=t.id,this.trigger(\"periodChange\",t));return}}}_getManifestEndTime(){let e=this._maximumPositionCalculator.getEndingPosition();return e!==void 0?{isEnd:!0,endingPosition:e}:{isEnd:!1,endingPosition:this._maximumPositionCalculator.getMaximumAvailablePosition()}}_lazilyCreateActiveStreamInfo(e){let t=this._activeStreams.get(e);return t===void 0&&(t={activePeriods:new Dt((r,i)=>r.start-i.start),hasFinishedLoadingLastPeriod:!1},this._activeStreams.set(e,t)),t}_checkEndOfStream(){if(!this._manifest.isLastPeriodKnown)return;this._allBufferTypes.every(t=>{let r=this._activeStreams.get(t);return r!==void 0&&r.hasFinishedLoadingLastPeriod})?this.trigger(\"endOfStream\",null):this.trigger(\"resumeStream\",null)}},xa=class{constructor(e){this._manifest=e,this._lastAudioAdaptation=void 0,this._lastVideoAdaptation=void 0}updateLastAudioAdaptation(e){this._lastAudioAdaptation=e}updateLastVideoAdaptation(e){this._lastVideoAdaptation=e}getMaximumAvailablePosition(){if(this._manifest.isDynamic)return this._manifest.getMaximumSafePosition();if(this._lastVideoAdaptation===void 0||this._lastAudioAdaptation===void 0)return this._manifest.getMaximumSafePosition();if(this._lastAudioAdaptation===null){if(this._lastVideoAdaptation===null)return this._manifest.getMaximumSafePosition();{let e=zr(this._lastVideoAdaptation);return typeof e!=\"number\"?this._manifest.getMaximumSafePosition():e}}else if(this._lastVideoAdaptation===null){let e=zr(this._lastAudioAdaptation);return typeof e!=\"number\"?this._manifest.getMaximumSafePosition():e}else{let e=zr(this._lastAudioAdaptation),t=zr(this._lastVideoAdaptation);return typeof e!=\"number\"||typeof t!=\"number\"?this._manifest.getMaximumSafePosition():Math.min(e,t)}}getEndingPosition(){var e,t;if(!this._manifest.isDynamic)return this.getMaximumAvailablePosition();if(!(this._lastVideoAdaptation===void 0||this._lastAudioAdaptation===void 0)){if(this._lastAudioAdaptation===null)return this._lastVideoAdaptation===null?void 0:(e=Wr(this._lastVideoAdaptation))!=null?e:void 0;if(this._lastVideoAdaptation===null)return(t=Wr(this._lastAudioAdaptation))!=null?t:void 0;{let r=Wr(this._lastAudioAdaptation),i=Wr(this._lastVideoAdaptation);return typeof r!=\"number\"||typeof i!=\"number\"?void 0:Math.min(r,i)}}}};function zr(n){let{representations:e}=n,t=null,r;for(let i of e)if(i.index!==r){r=i.index;let a=i.index.getLastAvailablePosition();if(a===void 0)return;a!==null&&(t=v(t)?a:Math.min(t,a))}return t}function Wr(n){let{representations:e}=n,t=null,r;for(let i=0;i<e.length;i++)if(e[i].index!==r){r=e[i].index;let a=e[i].index.getEnd();if(a===void 0)return;a!==null&&(t=v(t)?a:Math.min(t,a))}return t}function Aa(n,e,t,r,i,a){a.register(()=>{e.interruptDurationSetting()});let o=new Un(n,t,r.getBufferTypes());a.register(()=>{o.dispose()}),o.addEventListener(\"warning\",u=>i.onWarning(u)),o.addEventListener(\"periodChange\",u=>i.onPeriodChanged(u)),o.addEventListener(\"endingPositionChange\",u=>{e.setDuration(u.endingPosition,u.isEnd)}),o.addEventListener(\"endOfStream\",()=>{m.debug(\"Init: end-of-stream order received.\"),e.maintainEndOfStream()}),o.addEventListener(\"resumeStream\",()=>{e.stopEndOfStream()});let s=o.getCurrentEndingTime();return e.setDuration(s.endingPosition,s.isEnd),o}function ka(n,e){let t={audio:null,video:null,text:null};if(e!==null&&(t.text=e.getBufferedRanges()),n===null)return t;let r=K(n.sourceBuffers,s=>s.type===\"audio\"),i=K(n.sourceBuffers,s=>s.type===\"video\"),a=r==null?void 0:r.getBuffered();a!==void 0&&(t.audio=a);let o=i==null?void 0:i.getBuffered();return o!==void 0&&(t.video=o),t}function Ma(n,e){if(typeof n.changeType==\"function\"){try{n.changeType(e)}catch(t){return m.warn(\"Could not call 'changeType' on the given SourceBuffer:\",t instanceof Error?t:\"\"),!1}return!0}return!1}var Hl=[\"\",\"webkit\",\"moz\",\"ms\"];function Gl(n,e){let t=document.createElement(n.tagName),r=\"on\"+e;return r in t?!0:(t.setAttribute(r,\"return;\"),typeof t[r]==\"function\")}function Kl(n,e){return e.filter(t=>Gl(n,t))[0]}function jl(n,e){return n.reduce((t,r)=>t.concat((e===void 0?Hl:e).map(i=>i+r)),[])}function Re(n,e){let t,r=jl(n,e);return(i,a,o)=>{if(!o.isCancelled()){if(typeof HTMLElement!=\"undefined\"&&i instanceof HTMLElement)if(typeof t==\"undefined\"&&(t=Kl(i,r)),ee(t))i.addEventListener(t,a),o.register(()=>{t!==void 0&&i.removeEventListener(t,a)});else{b.CURRENT_ENV===b.DEV&&m.warn(`compat: element ${i.tagName} does not support any of these events: `+r.join(\", \"));return}r.forEach(s=>{let u=!1;typeof i.addEventListener==\"function\"?i.addEventListener(s,a):(u=!0,i[\"on\"+s]=a),o.register(()=>{typeof i.removeEventListener==\"function\"&&i.removeEventListener(s,a),u&&delete i[\"on\"+s]})})}}}var VD=Re([\"loadedmetadata\"]),qD=Re([\"timeupdate\"]),HD=Re([\"addtrack\"]),GD=Re([\"removetrack\"]),Qt=Re([\"sourceopen\",\"webkitsourceopen\"]),Vr=Re([\"sourceclose\",\"webkitsourceclose\"]),qr=Re([\"sourceended\",\"webkitsourceended\"]),Gs=Re([\"update\"]),Ks=Re([\"removesourcebuffer\"]),KD=Re([\"keymessage\",\"message\"]),jD=Re([\"keyadded\",\"ready\"]),YD=Re([\"keyerror\",\"error\"]),QD=Re([\"keystatuseschange\"]),$D=Re([\"seeking\"]),XD=Re([\"seeked\"]),ZD=Re([\"ended\"]);function Yl(n){let e=[];for(let t=0;t<n.length;t++){let r=n[t];r.updating&&e.push(r)}return e}function Ln(n,e){if(m.debug(\"Init: Trying to call endOfStream\"),n.readyState!==\"open\"){m.debug(\"Init: MediaSource not open, cancel endOfStream\");return}let{sourceBuffers:t}=n,r=Yl(t);if(r.length===0){m.info(\"Init: Triggering end of stream\");try{n.endOfStream()}catch(a){m.error(\"Unable to call endOfStream\",a instanceof Error?a:new Error(\"Unknown error\"))}return}m.debug(\"Init: Waiting SourceBuffers to be updated before calling endOfStream.\");let i=new z;i.linkToSignal(e);for(let a of r)Gs(a,()=>{i.cancel(),Ln(n,e)},i.signal);Ks(t,()=>{i.cancel(),Ln(n,e)},i.signal)}function js(n,e){let t=new z;t.linkToSignal(e),Qt(n,()=>{m.debug(\"Init: MediaSource re-opened while end-of-stream is active\"),t.cancel(),t=new z,t.linkToSignal(e),Ln(n,t.signal)},e),Ln(n,t.signal)}var Ql=!1,$l=!1,Ys=!1,Xl=!1,Zl=!1,Jl=!1,ef=!1,tf=!1,nf=!1,rf=!1,af=!1,of=!1,sf=!1,Oa=!1,uf=!1;(function(){var e,t,r;ar||(typeof se.MSInputMethodContext!=\"undefined\"&&typeof document.documentMode!=\"undefined\"?($l=!0,Ys=!0):navigator.appName===\"Microsoft Internet Explorer\"||navigator.appName===\"Netscape\"&&/(Trident|Edge)\\//.test(navigator.userAgent)?Ys=!0:navigator.userAgent.toLowerCase().indexOf(\"edg/\")!==-1?Ql=!0:navigator.userAgent.toLowerCase().indexOf(\"firefox\")!==-1?Xl=!0:typeof navigator.platform==\"string\"&&/iPad|iPhone|iPod/.test(navigator.platform)?Jl=!0:(Object.prototype.toString.call(se.HTMLElement).indexOf(\"Constructor\")>=0||((t=(e=se.safari)==null?void 0:e.pushNotification)==null?void 0:t.toString())===\"[object SafariRemoteNotification]\"||/Safari\\/(\\d+)/.test(navigator.userAgent)&&/Version\\/(\\d+)/.test(navigator.userAgent)&&((r=navigator.vendor)==null?void 0:r.indexOf(\"Apple\"))!==-1&&!/Chrome\\/(\\d+)/.test(navigator.userAgent)&&!/Chromium\\/(\\d+)/.test(navigator.userAgent))&&(Zl=!0),/SamsungBrowser/.test(navigator.userAgent)&&(ef=!0),navigator.userAgent.indexOf(\"PlayStation 4\")!==-1?sf=!0:navigator.userAgent.indexOf(\"PlayStation 5\")!==-1?Oa=!0:/Tizen/.test(navigator.userAgent)?tf=!0:/[Ww]eb[O0]S/.test(navigator.userAgent)?(nf=!0,/[Ww]eb[O0]S.TV-2022/.test(navigator.userAgent)||/[Cc]hr[o0]me\\/87/.test(navigator.userAgent)?af=!0:(/[Ww]eb[O0]S.TV-2021/.test(navigator.userAgent)||/[Cc]hr[o0]me\\/79/.test(navigator.userAgent))&&(rf=!0)):/[Pp]anasonic/.test(navigator.userAgent)?of=!0:navigator.userAgent.indexOf(\"Xbox\")!==-1&&(uf=!0))})();function wa(){return Oa}var df=365*24*3600,Fn=class{constructor(e){this._mediaSource=e,this._currentMediaSourceDurationUpdateCanceller=null}updateDuration(e,t){this._currentMediaSourceDurationUpdateCanceller!==null&&this._currentMediaSourceDurationUpdateCanceller.cancel(),this._currentMediaSourceDurationUpdateCanceller=new z;let r=this._mediaSource,i=this._currentMediaSourceDurationUpdateCanceller.signal,a=cf(r,i),o=new z;o.linkToSignal(i),a.onUpdate(s,{emitCurrentValue:!0,clearSignal:i});function s(){if(o.cancel(),!a.getValue())return;o=new z,o.linkToSignal(i);let u=ff(r.sourceBuffers,o.signal),f=new z;return f.linkToSignal(o.signal),u.onUpdate(l=>{f.cancel(),f=new z,f.linkToSignal(o.signal),!l&&$s(r,e,t,f.signal)},{clearSignal:o.signal,emitCurrentValue:!0})}}stopUpdating(){this._currentMediaSourceDurationUpdateCanceller!==null&&(this._currentMediaSourceDurationUpdateCanceller.cancel(),this._currentMediaSourceDurationUpdateCanceller=null)}};function lf(n,e,t){let r=e;t||(r=wa()?1/0:Qs(e));let i=0;for(let a=0;a<n.sourceBuffers.length;a++){let o=n.sourceBuffers[a],s=o.buffered.length;s>0&&(i=Math.max(o.buffered.end(s-1)))}if(r===n.duration)return\"success\";if(i>r){if(i<n.duration)try{m.info(\"Init: Updating duration to what is currently buffered\",i),n.duration=i}catch(a){return m.warn(\"Duration Updater: Can't update duration on the MediaSource.\",a instanceof Error?a:\"\"),\"failed\"}return\"partial\"}else{let a=n.duration;try{if(m.info(\"Init: Updating duration\",r),n.duration=r,n.readyState===\"open\"&&!isFinite(r)){let s=Qs(e);m.info(\"Init: calling `mediaSource.setLiveSeekableRange`\",s),n.setLiveSeekableRange(0,s)}}catch(s){return m.warn(\"Duration Updater: Can't update duration on the MediaSource.\",s instanceof Error?s:\"\"),\"failed\"}let o=Math.abs(n.duration-r);if(o>=.1){let s=Math.abs(n.duration-a);return o<s?\"partial\":\"failed\"}return\"success\"}}function ff(n,e){if(n.length===0){let i=new j(!1);return i.finish(),i}let t=new j(!1,e);r();for(let i=0;i<n.length;i++){let a=n[i];a.addEventListener(\"updatestart\",r),a.addEventListener(\"update\",r),e.register(()=>{a.removeEventListener(\"updatestart\",r),a.removeEventListener(\"update\",r)})}return t;function r(){for(let i=0;i<n.length;i++)if(n[i].updating){t.setValueIfChanged(!0);return}t.setValueIfChanged(!1)}}function cf(n,e){let t=new j(n.readyState===\"open\",e);return Qt(n,()=>{m.debug(\"Init: Reacting to MediaSource open in duration updater\"),t.setValueIfChanged(!0)},e),qr(n,()=>{m.debug(\"Init: Reacting to MediaSource ended in duration updater\"),t.setValueIfChanged(!1)},e),Vr(n,()=>{m.debug(\"Init: Reacting to MediaSource close in duration updater\"),t.setValueIfChanged(!1)},e),t}function $s(n,e,t,r){if(lf(n,e,t)===\"success\")return;let a=setTimeout(()=>{o(),$s(n,e,t,r)},2e3),o=r.register(()=>{clearTimeout(a)})}function Qs(n){return Math.max(Math.pow(2,32),n+df)}var zn=class extends fe{constructor(e){if(super(),this.id=e,this.sourceBuffers=[],this._canceller=new z,v(Pt))throw new X(\"MEDIA_SOURCE_NOT_SUPPORTED\",\"No MediaSource Object was found in the current browser.\");m.info(\"Init: Creating MediaSource\");let t=new Pt;this.readyState=t.readyState;let r=t.handle;this.handle=v(r)?{type:\"media-source\",value:t}:{type:\"handle\",value:r},this._mediaSource=t,this._durationUpdater=new Fn(t),this._endOfStreamCanceller=null,Qt(t,()=>{this.readyState=t.readyState,this.trigger(\"mediaSourceOpen\",null)},this._canceller.signal),qr(t,()=>{this.readyState=t.readyState,this.trigger(\"mediaSourceEnded\",null)},this._canceller.signal),Vr(t,()=>{this.readyState=t.readyState,this.trigger(\"mediaSourceClose\",null)},this._canceller.signal)}addSourceBuffer(e,t){let r=this._mediaSource.addSourceBuffer(t),i=new Da(e,t,r);return this.sourceBuffers.push(i),i}setDuration(e,t){this._durationUpdater.updateDuration(e,t)}interruptDurationSetting(){this._durationUpdater.stopUpdating()}maintainEndOfStream(){this._endOfStreamCanceller===null&&(this._endOfStreamCanceller=new z,this._endOfStreamCanceller.linkToSignal(this._canceller.signal),m.debug(\"Init: end-of-stream order received.\"),js(this._mediaSource,this._endOfStreamCanceller.signal))}stopEndOfStream(){this._endOfStreamCanceller!==null&&(m.debug(\"Init: resume-stream order received.\"),this._endOfStreamCanceller.cancel(),this._endOfStreamCanceller=null)}dispose(){this.sourceBuffers.forEach(e=>e.dispose()),this._canceller.cancel(),mf(this._mediaSource)}},Da=class{constructor(e,t,r){this.type=e,this.codec=t,this._canceller=new z,this._sourceBuffer=r,this._operationQueue=[],this._currentOperations=[];let i=o=>{let s;o instanceof Error?s=o:o.error instanceof Error?s=o.error:s=new Error(\"Unknown SourceBuffer Error\");let u=this._currentOperations;if(this._currentOperations=[],u.length===0)m.error(\"SBI: error for an unknown operation\",s);else{let f=new Ce(s.name,s.message,s.name===\"QuotaExceededError\");for(let l of u)l.reject(f)}},a=()=>{let o=this._currentOperations;this._currentOperations=[];try{for(let s of o)s.resolve(pa(this._sourceBuffer.buffered))}catch(s){for(let u of o)s instanceof Error&&s.name===\"InvalidStateError\"?u.resolve([]):u.reject(s)}this._performNextOperation()};r.addEventListener(\"error\",i),r.addEventListener(\"updateend\",a),this._canceller.signal.register(()=>{r.removeEventListener(\"error\",i),r.removeEventListener(\"updateend\",a)})}appendBuffer(...e){return m.debug(\"SBI: receiving order to push data to the SourceBuffer\",this.type),this._addToQueue({operationName:0,params:e})}remove(e,t){return m.debug(\"SBI: receiving order to remove data from the SourceBuffer\",this.type,e,t),this._addToQueue({operationName:1,params:[e,t]})}getBuffered(){try{return pa(this._sourceBuffer.buffered)}catch(e){return m.error(\"Failed to get buffered time range of SourceBuffer\",this.type,e instanceof Error?e:null),[]}}abort(){try{this._sourceBuffer.abort()}catch(e){m.debug(\"Init: Failed to abort SourceBuffer:\",e instanceof Error?e:null)}this._emptyCurrentQueue()}dispose(){try{this._sourceBuffer.abort()}catch(e){}this._emptyCurrentQueue()}_emptyCurrentQueue(){let e=new oe;this._currentOperations.length>0&&(this._currentOperations.forEach(t=>{t.reject(e)}),this._currentOperations=[]),this._operationQueue.length>0&&(this._operationQueue.forEach(t=>{t.reject(e)}),this._operationQueue=[])}_addToQueue(e){return new Promise((t,r)=>{let i=this._operationQueue.length===0&&this._currentOperations.length===0,a=H({resolve:t,reject:r},e);this._operationQueue.push(a),i&&this._performNextOperation()})}_performNextOperation(){var t,r,i,a,o;if(this._currentOperations.length!==0||this._sourceBuffer.updating)return;let e=this._operationQueue.shift();if(e!==void 0)if(e.operationName===0){this._currentOperations=[{operationName:0,resolve:e.resolve,reject:e.reject}];let s=e.params[0],u=e.params[1],f=s;if(this._operationQueue.length>0&&this._operationQueue[0].operationName===0){let l;s instanceof ArrayBuffer?l=new Uint8Array(s):s instanceof Uint8Array?l=s:l=new Uint8Array(s.buffer);let d=[l];for(;((t=this._operationQueue[0])==null?void 0:t.operationName)===0;){let c=this._operationQueue[0],p=(r=u.appendWindow)!=null?r:[void 0,void 0],g=(i=c.params[1].appendWindow)!=null?i:[void 0,void 0],h=(a=u.timestampOffset)!=null?a:0,I=(o=c.params[1].timestampOffset)!=null?o:0;if(p[0]===g[0]&&p[1]===g[1]&&u.codec===c.params[1].codec&&h===I){let y=c.params[0],_;y instanceof ArrayBuffer?_=new Uint8Array(y):y instanceof Uint8Array?_=y:_=new Uint8Array(y.buffer),d.push(_),this._operationQueue.splice(0,1),this._currentOperations.push({operationName:0,resolve:c.resolve,reject:c.reject})}else break}d.length>1&&(m.info(`MMSI: Merging ${d.length} segments together for perf`,this.type),f=Ot(...d))}try{this._appendBufferNow(f,u)}catch(l){let d=l instanceof Error?new Ce(l.name,l.message,l.name===\"QuotaExceededError\"):new Ce(\"Error\",\"Unknown SourceBuffer Error during appendBuffer\",!1);this._currentOperations.forEach(c=>{c.reject(d)}),this._currentOperations=[]}}else{this._currentOperations=[e];let[s,u]=e.params;m.debug(\"SBI: removing data from SourceBuffer\",this.type,s,u);try{this._sourceBuffer.remove(s,u)}catch(f){let l=f instanceof Error?new Ce(f.name,f.message,!1):new Ce(\"Error\",\"Unknown SourceBuffer Error during remove\",!1);e.reject(l),this._currentOperations=[]}}}_appendBufferNow(e,t){let r=this._sourceBuffer,{codec:i,timestampOffset:a,appendWindow:o=[]}=t;if(i!==void 0&&i!==this.codec&&(m.debug(\"SBI: updating codec\",i),Ma(r,i)?this.codec=i:m.debug(\"SBI: could not update codec\",i,this.codec)),a!==void 0&&r.timestampOffset!==a){let s=a;m.debug(\"SBI: updating timestampOffset\",i,r.timestampOffset,s),r.timestampOffset=s}if(o[0]===void 0)r.appendWindowStart>0&&(m.debug(\"SBI: re-setting `appendWindowStart` to `0`\"),r.appendWindowStart=0);else if(o[0]!==r.appendWindowStart){if(o[0]>=r.appendWindowEnd){let s=o[0]+1;m.debug(\"SBI: pre-updating `appendWindowEnd`\",s),r.appendWindowEnd=s}m.debug(\"SBI: setting `appendWindowStart`\",o[0]),r.appendWindowStart=o[0]}o[1]===void 0?r.appendWindowEnd!==1/0&&(m.debug(\"SBI: re-setting `appendWindowEnd` to `Infinity`\"),r.appendWindowEnd=1/0):o[1]!==r.appendWindowEnd&&(m.debug(\"SBI: setting `appendWindowEnd`\",o[1]),r.appendWindowEnd=o[1]),m.debug(\"SBI: pushing segment\",this.type),r.appendBuffer(e)}};function mf(n){if(n.readyState!==\"closed\"){let{readyState:e,sourceBuffers:t}=n;for(let r=t.length-1;r>=0;r--){let i=t[r];try{if(e===\"open\"){m.info(\"Init: Aborting SourceBuffer before removing\");try{i.abort()}catch(a){}}m.info(\"Init: Removing SourceBuffer from mediaSource\"),n.removeSourceBuffer(i)}catch(a){}}t.length>0&&m.info(\"Init: Not all SourceBuffers could have been removed.\")}}var pf=xe(),Hr=xe(),Xs=1/0,Wn=class extends fe{constructor(e,t,r){super(),this.id=e,this.sourceBuffers=[],this._canceller=new z,this.readyState=\"closed\",this._messageSender=r;let i=pf();this._messageSender({type:\"create-media-source\",contentId:t,mediaSourceId:i})}onMediaSourceReadyStateChanged(e){switch(e){case\"closed\":this.readyState=\"closed\",this.trigger(\"mediaSourceClose\",null);break;case\"open\":this.readyState=\"open\",this.trigger(\"mediaSourceOpen\",null);break;case\"ended\":this.readyState=\"ended\",this.trigger(\"mediaSourceEnded\",null);break}}addSourceBuffer(e,t){this._messageSender({type:\"add-source-buffer\",mediaSourceId:this.id,value:{sourceBufferType:e,codec:t}});let r=new Ba(e,t,this.id,this._messageSender);return this.sourceBuffers.push(r),r}setDuration(e,t){this._messageSender({type:\"update-media-source-duration\",mediaSourceId:this.id,value:{duration:e,isRealEndKnown:t}})}interruptDurationSetting(){this._messageSender({type:\"stop-media-source-duration\",mediaSourceId:this.id,value:null})}maintainEndOfStream(){this._messageSender({type:\"end-of-stream\",mediaSourceId:this.id,value:null})}stopEndOfStream(){this._messageSender({type:\"stop-end-of-stream\",mediaSourceId:this.id,value:null})}dispose(){this.sourceBuffers.forEach(e=>e.dispose()),this._canceller.cancel(),this._messageSender({type:\"dispose-media-source\",mediaSourceId:this.id,value:null})}},Ba=class{constructor(e,t,r,i){this.type=e,this.codec=t,this._canceller=new z,this._mediaSourceId=r,this._queuedOperations=[],this._pendingOperations=new Map,this._messageSender=i}onOperationSuccess(e,t){let r=this._pendingOperations.get(e);r===void 0?m.warn(\"SBI: unknown SourceBuffer operation succeeded\"):(this._pendingOperations.delete(e),r.resolve(t)),this._performNextQueuedOperationIfItExists()}onOperationFailure(e,t){let r=t.errorName===\"CancellationError\"?new oe:new Ce(t.errorName,t.message,t.isBufferFull),i=this._pendingOperations.get(e);i===void 0?m.info(\"SBI: unknown SourceBuffer operation failed\",r):(this._pendingOperations.delete(e),i.reject(r));let a=new oe;for(let o of this._queuedOperations)o.reject(a);this._queuedOperations=[]}appendBuffer(e,t){return new Promise((r,i)=>{if(this._queuedOperations.length>0||this._pendingOperations.size>=Xs){this._queuedOperations.push({operationName:0,params:[e,t],resolve:r,reject:i});return}try{let a;e instanceof ArrayBuffer?a=e:e.byteLength===e.buffer.byteLength?a=e.buffer:a=e.buffer.slice(e.byteOffset,e.byteLength+e.byteOffset);let o=Hr();this._messageSender({type:\"source-buffer-append\",mediaSourceId:this._mediaSourceId,sourceBufferType:this.type,operationId:o,value:{data:a,params:t}},[a]),this._addOperationToQueue(o,r,i)}catch(a){i(a)}})}remove(e,t){return new Promise((r,i)=>{if(this._queuedOperations.length>0||this._pendingOperations.size>=Xs){this._queuedOperations.push({operationName:1,params:[e,t],resolve:r,reject:i});return}try{let a=Hr();this._messageSender({type:\"source-buffer-remove\",mediaSourceId:this._mediaSourceId,sourceBufferType:this.type,operationId:a,value:{start:e,end:t}}),this._addOperationToQueue(a,r,i)}catch(a){i(a)}})}abort(){this._messageSender({type:\"abort-source-buffer\",mediaSourceId:this._mediaSourceId,sourceBufferType:this.type,value:null})}dispose(){this.abort(),this._canceller.cancel()}getBuffered(){}_addOperationToQueue(e,t,r){this._pendingOperations.set(e,{resolve:a,reject:o});let i=this._canceller.signal.register(s=>{this._pendingOperations.delete(e),r(s)});function a(s){i(),t(s)}function o(s){i(),r(s)}}_performNextQueuedOperationIfItExists(){let e=this._queuedOperations.shift();if(e!==void 0)try{if(e.operationName===0){let[t,r]=e.params,i;t instanceof ArrayBuffer?i=t:t.byteLength===t.buffer.byteLength?i=t.buffer:i=t.buffer.slice(t.byteOffset,t.byteLength+t.byteOffset);let a=Hr();this._messageSender({type:\"source-buffer-append\",mediaSourceId:this._mediaSourceId,sourceBufferType:this.type,operationId:a,value:{data:i,params:r}},[i]),this._addOperationToQueue(a,e.resolve,e.reject)}else{let[t,r]=e.params,i=Hr();this._messageSender({type:\"source-buffer-remove\",mediaSourceId:this._mediaSourceId,sourceBufferType:this.type,operationId:i,value:{start:t,end:r}}),this._addOperationToQueue(i,e.resolve,e.reject)}}catch(t){e.reject(t)}}};function Na(n){let e=n.map(o=>Math.log(o/n[0])),t=e.map(o=>o-e[0]+1),r=(t[t.length-1]-1)/(n.length*2+10),i=1/r;return n.map((o,s)=>a(s));function a(o){if(o===0)return 0;let s=Math.min(Math.max(1,o),n.length-1);return n[s]===n[s-1]?a(o-1):i*(r+(n[s]*t[s-1]-n[s-1]*t[s])/(n[s]-n[s-1]))+4}}var Fe=class{constructor(e){this._alpha=Math.exp(Math.log(.5)/e),this._lastEstimate=0,this._totalWeight=0}addSample(e,t){let r=Math.pow(this._alpha,e),i=t*(1-r)+r*this._lastEstimate;isNaN(i)||(this._lastEstimate=i,this._totalWeight+=e)}getEstimate(){let e=1-Math.pow(this._alpha,this._totalWeight);return this._lastEstimate/e}};var Vn=class{constructor(){this._currentRepresentationData=null,this._lastRepresentationWithGoodScore=null}addSample(e,t,r){let i=r/t,a=this._currentRepresentationData,o;a!==null&&a.representation.id===e.id?(o=a.ewma,a.ewma.addSample(t,i),a.loadedDuration+=r,a.loadedSegments++):(o=new Fe(5),o.addSample(t,i),this._currentRepresentationData={representation:e,ewma:o,loadedDuration:r,loadedSegments:0}),o.getEstimate()>1&&this._lastRepresentationWithGoodScore!==e&&(m.debug(\"ABR: New last stable representation\",e.bitrate),this._lastRepresentationWithGoodScore=e)}getEstimate(e){if(this._currentRepresentationData===null||this._currentRepresentationData.representation.id!==e.id)return;let{ewma:t,loadedSegments:r,loadedDuration:i}=this._currentRepresentationData,a=t.getEstimate(),o=r>=5&&i>=10?1:0;return{score:a,confidenceLevel:o}}getLastStableRepresentation(){return this._lastRepresentationWithGoodScore}};var Zs=6e3,gf=15e3,hf=3e3,If=1e3,bf=9e3,qn=class{constructor(e){this._levelsMap=Na(e).map(t=>t+4),this._bitrates=e,this._lastUnsuitableQualityTimestamp=void 0,this._blockRaiseDelay=Zs,m.debug(\"ABR: Steps for buffer based chooser.\",this._levelsMap.map((t,r)=>`bufferLevel: ${t}, bitrate: ${e[r]}`).join(\" ,\"))}onAddedSegment(e){let t=this._levelsMap,r=this._bitrates,{bufferGap:i,currentBitrate:a,currentScore:o,speed:s}=e;if(v(a)){this._currentEstimate=r[0];return}let u=-1;for(let g=0;g<r.length;g++){let h=r[g];if(h===a)u=g;else if(h>a)break}if(u<0||r.length!==t.length){m.info(\"ABR: Current Bitrate not found in the calculated levels\"),this._currentEstimate=r[0];return}let f;o!==void 0&&(f=s===0?o.score:o.score/s);let l=isFinite(i)?i:0,d=U();if(l<t[u]||f!==void 0&&f<1&&(o==null?void 0:o.confidenceLevel)===1){if((this._lastUnsuitableQualityTimestamp===void 0?-1:d-this._lastUnsuitableQualityTimestamp)<this._blockRaiseDelay+bf){let I=this._blockRaiseDelay+hf;this._blockRaiseDelay=Math.min(I,gf),m.debug(\"ABR: Incrementing blocking raise in BufferBasedChooser due to unstable quality\",this._blockRaiseDelay)}else{let I=this._blockRaiseDelay-If;this._blockRaiseDelay=Math.max(Zs,I),m.debug(\"ABR: Lowering quality in BufferBasedChooser\",this._blockRaiseDelay)}this._lastUnsuitableQualityTimestamp=d;let h=re(r,I=>I===a);for(let I=h-1;I>=0;I--)if(l>=t[I]){this._currentEstimate=r[I];return}this._currentEstimate=r[0];return}if(this._lastUnsuitableQualityTimestamp!==void 0&&d-this._lastUnsuitableQualityTimestamp<this._blockRaiseDelay||f===void 0||f<1.15||(o==null?void 0:o.confidenceLevel)!==1){this._currentEstimate=a;return}let c=t[u],p=(()=>{for(let g=u+1;g<t.length;g++)if(t[g]>c)return g})();if(p!==void 0){let g=t[p];if(i>=g){m.debug(\"ABR: Raising quality in BufferBasedChooser\",r[p]),this._currentEstimate=r[p];return}}this._currentEstimate=a}getLastEstimate(){return this._currentEstimate}};function Sf(n,e){let t=-1;for(let o=0;o<n.length;o++){let{segment:s}=n[o].content;if(s.duration<=0)continue;let u=s.time+s.duration;if(!s.complete&&o===n.length-1&&e-s.time>-1.2){t=o;break}if(u>e&&e-s.time>-1.2){t=o;break}}if(t<0)return[];let r=n[t],i=r.content.segment.time,a=[r];for(let o=t+1;o<n.length&&n[o].content.segment.time===i;o++)a.push(n[o]);return a}function Gr(n){if(n.progress.length<5)return;let e=new Fe(2),{progress:t}=n;for(let r=1;r<t.length;r++){let i=t[r].size-t[r-1].size,a=t[r].timestamp-t[r-1].timestamp,o=i*8/(a/1e3);e.addSample(a/1e3,o)}return e.getEstimate()}function Js(n,e){let t=(n.totalSize-n.size)*8;return Math.max(t/e,0)}function yf(n,e,t,r,i){if(r)return;let{bufferGap:a,speed:o,position:s}=e,u=isFinite(a)?a:0,f=s.getWanted()+u,l=Sf(n,f);if(l.length!==1)return;let d=l[0],c=U(),p=d.content.segment.duration*1.5;if(p=Math.min(p,3e3),p=Math.max(p,12e3),c-d.requestTimestamp<p)return;let g=d.progress.length>0?d.progress[d.progress.length-1]:void 0,h=Gr(d);if(g!==void 0&&h!==void 0){let C=Js(g,h);if((c-g.timestamp)/1e3<=C&&C-u/o>2500)return h}if(!d.content.segment.complete)return;let I=d.content.segment.duration,y=(c-d.requestTimestamp)/1e3,_=y<=(I*1.5+2)/o;if(v(t)||_)return;let R=I/y,T=t.bitrate*Math.min(.7,R);if(i===void 0||T<i)return T}function _f(n,e,t){if(t)return!0;let r=isFinite(n.bufferGap)?n.bufferGap:0,i=n.position.getWanted()+r,a=K(e,({content:d})=>d.segment.duration>0&&d.segment.time+d.segment.duration>i);if(a===void 0)return!0;let o=U(),s=a.progress.length>0?a.progress[a.progress.length-1]:void 0,u=Gr(a);if(s===void 0||u===void 0)return!0;let f=Js(s,u);return(o-s.timestamp)/1e3>f*1.2?!0:f-r/n.speed>-1.5}var Hn=class{constructor(e,t){let{ABR_STARVATION_GAP:r,OUT_OF_STARVATION_GAP:i,ABR_STARVATION_FACTOR:a,ABR_REGULAR_FACTOR:o}=L.getCurrent();this._initialBitrate=e,this._inStarvationMode=!1,this._lowLatencyMode=t,t?this._config={starvationGap:r.LOW_LATENCY,outOfStarvationGap:i.LOW_LATENCY,starvationBitrateFactor:a.LOW_LATENCY,regularBitrateFactor:o.LOW_LATENCY}:this._config={starvationGap:r.DEFAULT,outOfStarvationGap:i.DEFAULT,starvationBitrateFactor:a.DEFAULT,regularBitrateFactor:o.DEFAULT}}getBandwidthEstimate(e,t,r,i,a){let o,s,u=this._config,{bufferGap:f,position:l,duration:d}=e,c=isFinite(f)?f:0,{ABR_STARVATION_DURATION_DELTA:p}=L.getCurrent();return isNaN(d)||c+l.getWanted()<d-p?!this._inStarvationMode&&c<=u.starvationGap?(m.info(\"ABR: enter starvation mode.\"),this._inStarvationMode=!0):this._inStarvationMode&&c>=u.outOfStarvationGap&&(m.info(\"ABR: exit starvation mode.\"),this._inStarvationMode=!1):this._inStarvationMode&&(m.info(\"ABR: exit starvation mode.\"),this._inStarvationMode=!1),this._inStarvationMode&&(s=yf(i,e,r,this._lowLatencyMode,a),s!==void 0&&(m.info(\"ABR: starvation mode emergency estimate:\",s),t.reset(),o=v(r)?s:Math.min(s,r.bitrate))),v(o)&&(s=t.getEstimate(),s!==void 0?o=s*(this._inStarvationMode?u.starvationBitrateFactor:u.regularBitrateFactor):a!==void 0?o=a*(this._inStarvationMode?u.starvationBitrateFactor:u.regularBitrateFactor):o=this._initialBitrate),e.speed>1&&(o/=e.speed),{bandwidthEstimate:s,bitrateChosen:o}}isUrgent(e,t,r,i){return t===null?!0:e>=t.bitrate?!1:_f(i,r,this._lowLatencyMode)}};var Gn=class{constructor(){this.bandwidth=void 0,this.representation=null,this.algorithmType=3}update(e,t,r){this.representation=e,this.bandwidth=t,this.algorithmType=r}};var Kn=class{constructor(e,t){this._scoreCalculator=e,this._lastAbrEstimate=t,this._consecutiveWrongGuesses=0,this._blockGuessesUntil=0,this._lastMaintanableBitrate=null}getGuess(e,t,r,i,a){let{bufferGap:o,speed:s}=t,u=this._lastAbrEstimate.representation;if(u===null)return null;if(i>u.bitrate)return this._lastAbrEstimate.algorithmType===2&&(this._lastAbrEstimate.representation!==null&&(this._lastMaintanableBitrate=this._lastAbrEstimate.representation.bitrate),this._consecutiveWrongGuesses=0),null;let f=this._scoreCalculator.getEstimate(r);if(this._lastAbrEstimate.algorithmType!==2){if(f===void 0)return null;if(this._canGuessHigher(o,s,f)){let d=eu(e,r);if(d!==null)return d}return null}if(this._isLastGuessValidated(u,i,f)&&(m.debug(\"ABR: Guessed Representation validated\",u.bitrate),this._lastMaintanableBitrate=u.bitrate,this._consecutiveWrongGuesses=0),r.id!==u.id)return u;if(this._shouldStopGuess(r,f,o,a))return this._consecutiveWrongGuesses++,this._blockGuessesUntil=U()+Math.min(this._consecutiveWrongGuesses*15e3,12e4),Tf(e,r);if(f===void 0)return r;if(this._canGuessHigher(o,s,f)){let d=eu(e,r);if(d!==null)return d}return r}_canGuessHigher(e,t,{score:r,confidenceLevel:i}){return isFinite(e)&&e>=2.5&&U()>this._blockGuessesUntil&&i===1&&r/t>1.01}_shouldStopGuess(e,t,r,i){if(t!==void 0&&t.score<1.01)return!0;if((t===void 0||t.score<1.2)&&r<.6)return!0;let a=i.filter(s=>s.content.representation.id===e.id),o=U();for(let s of a){let u=o-s.requestTimestamp;if(s.content.segment.isInit){if(u>1e3)return!0}else{if(u>s.content.segment.duration*1e3+200)return!0;{let f=Gr(s);if(f!==void 0&&f<e.bitrate*.8)return!0}}}return!1}_isLastGuessValidated(e,t,r){return r!==void 0&&r.confidenceLevel===1&&r.score>1.5?!0:t>=e.bitrate&&(this._lastMaintanableBitrate===null||this._lastMaintanableBitrate<e.bitrate)}};function eu(n,e){let t=n.length,r=re(n,({id:i})=>i===e.id);if(r<0)return m.error(\"ABR: Current Representation not found.\"),null;for(;++r<t;)if(n[r].bitrate>e.bitrate)return n[r];return null}function Tf(n,e){let t=re(n,({id:r})=>r===e.id);if(t<0)return m.error(\"ABR: Current Representation not found.\"),null;for(;--t>=0;)if(n[t].bitrate<e.bitrate)return n[t];return null}var jn=class{constructor(){let{ABR_FAST_EMA:e,ABR_SLOW_EMA:t}=L.getCurrent();this._fastEWMA=new Fe(e),this._slowEWMA=new Fe(t),this._bytesSampled=0}addSample(e,t){let{ABR_MINIMUM_CHUNK_SIZE:r}=L.getCurrent();if(t<r)return;let i=t*8e3/e,a=e/1e3;this._bytesSampled+=t,this._fastEWMA.addSample(a,i),this._slowEWMA.addSample(a,i)}getEstimate(){let{ABR_MINIMUM_TOTAL_BYTES:e}=L.getCurrent();if(!(this._bytesSampled<e))return Math.min(this._fastEWMA.getEstimate(),this._slowEWMA.getEstimate())}reset(){let{ABR_FAST_EMA:e,ABR_SLOW_EMA:t}=L.getCurrent();this._fastEWMA=new Fe(e),this._slowEWMA=new Fe(t),this._bytesSampled=0}};function Ua(n,e){if(n.length===0)return[];n.sort((a,o)=>a.bitrate-o.bitrate);let t=n[0].bitrate,r=Math.max(e,t),i=re(n,a=>a.bitrate>r);return i===-1?n:n.slice(0,i)}function La(n,e){if(e.width===void 0||e.height===void 0)return n;let t=e.width*e.pixelRatio,r=e.height*e.pixelRatio,i=n.slice().sort((s,u)=>{var f,l;return((f=s.width)!=null?f:0)-((l=u.width)!=null?l:0)}),a=K(i,s=>typeof s.width==\"number\"&&s.width>=t&&typeof s.height==\"number\"&&s.height>=r);if(a===void 0)return n;let o=typeof a.width==\"number\"?a.width:0;return n.filter(s=>typeof s.width==\"number\"?s.width<=o:!0)}var Yn=class{constructor(){this._currentRequests={}}add(e){let{id:t,requestTimestamp:r,content:i}=e;this._currentRequests[t]={requestTimestamp:r,progress:[],content:i}}addProgress(e){let t=this._currentRequests[e.id];if(v(t)){if(b.CURRENT_ENV===b.DEV)throw new Error(\"ABR: progress for a request not added\");m.warn(\"ABR: progress for a request not added\");return}t.progress.push(e)}remove(e){if(v(this._currentRequests[e])){if(b.CURRENT_ENV===b.DEV)throw new Error(\"ABR: can't remove unknown request\");m.warn(\"ABR: can't remove unknown request\")}delete this._currentRequests[e]}getRequests(){return dr(this._currentRequests).filter(e=>!v(e)).sort((e,t)=>e.content.segment.time-t.content.segment.time)}};function Kr(n,e){let t=re(n,r=>r.bitrate>e);return t===-1?n[n.length-1]:t===0?n[0]:n[t-1]}var tu=new j(void 0);tu.finish();var nu=new j(1/0);nu.finish();function Fa(n){let e={},{initialBitrates:t,throttlers:r,lowLatencyMode:i}=n;return function(s,u,f,l,d){var I,y,_;let{type:c}=s.adaptation,p=a(c),g=(I=t[c])!=null?I:0,h={limitResolution:(y=r.limitResolution[c])!=null?y:tu,throttleBitrate:(_=r.throttleBitrate[c])!=null?_:nu};return Ef({bandwidthEstimator:p,context:s,currentRepresentation:u,filters:h,initialBitrate:g,playbackObserver:l,representations:f,lowLatencyMode:i},d)};function a(o){let s=e[o];if(v(s)){m.debug(\"ABR: Creating new BandwidthEstimator for \",o);let u=new jn;return e[o]=u,u}return s}}function Ef({bandwidthEstimator:n,context:e,currentRepresentation:t,filters:r,initialBitrate:i,lowLatencyMode:a,playbackObserver:o,representations:s},u){let f=new Vn,l=new Hn(i!=null?i:0,a),d=new Yn,c=B,p={metrics:_,requestBegin:R,requestProgress:T,requestEnd:C,addedSegment(E){c(E)}},g=new z;g.linkToSignal(u);let h=I(s.getValue(),g.signal);return s.onUpdate(y,{clearSignal:u}),{estimates:h,callbacks:p};function I(E,k){if(E.length<=1)return new j({bitrate:void 0,representation:E[0],urgent:!0,knownStableBitrate:void 0});let x=!1,P=E.sort((q,Q)=>q.bitrate-Q.bitrate),A=new qn(P.map(q=>q.bitrate)),M=new Gn,D=new Kn(f,M),w=o.getReference().getValue(),O=new j(W());return o.listen(q=>{w=q,N()},{includeLastObservation:!1,clearSignal:k}),c=function(q){if(w===null)return;let{position:Q,speed:G}=w,Y=q.buffered,V=Dr(Y,Q.getWanted()),{representation:$}=q.content,le=f.getEstimate($),ye=$.bitrate,me={bufferGap:V,currentBitrate:ye,currentScore:le,speed:G};A.onAddedSegment(me),N()},k.register(()=>{c=B}),r.throttleBitrate.onUpdate(N,{clearSignal:k}),r.limitResolution.onUpdate(N,{clearSignal:k}),O;function N(){O.setValue(W())}function W(){let{bufferGap:q,position:Q,maximumPosition:G}=w,Y=r.limitResolution.getValue(),V=r.throttleBitrate.getValue(),$=t.getValue(),le=Rf(P,Y,V),ye=d.getRequests(),{bandwidthEstimate:me,bitrateChosen:Ge}=l.getBandwidthEstimate(w,n,$,ye,M.bandwidth),De=f.getLastStableRepresentation(),he=De===null?void 0:De.bitrate/(w.speed>0?w.speed:1),{ABR_ENTER_BUFFER_BASED_ALGO:_e,ABR_EXIT_BUFFER_BASED_ALGO:Xt}=L.getCurrent();x&&q<=Xt?x=!1:!x&&isFinite(q)&&q>=_e&&(x=!0);let Ke=Kr(le,Ge),Me=A.getLastEstimate(),Nt=Ke.bitrate,ut=null;x&&Me!==void 0&&Me>Nt&&(ut=Kr(le,Me),Nt=ut.bitrate);let dt=null;return a&&$!==null&&e.manifest.isDynamic&&G-Q.getWanted()<40&&(dt=D.getGuess(P,w,$,Nt,ye)),dt!==null&&dt.bitrate>Nt?(m.debug(\"ABR: Choosing representation with guess-based estimation.\",dt.bitrate,dt.id),M.update(dt,me,2),{bitrate:me,representation:dt,urgent:$===null||dt.bitrate<$.bitrate,knownStableBitrate:he}):ut!==null?(m.debug(\"ABR: Choosing representation with buffer-based estimation.\",ut.bitrate,ut.id),M.update(ut,me,0),{bitrate:me,representation:ut,urgent:l.isUrgent(ut.bitrate,$,ye,w),knownStableBitrate:he}):(m.debug(\"ABR: Choosing representation with bandwidth estimation.\",Ke.bitrate,Ke.id),M.update(Ke,me,1),{bitrate:me,representation:Ke,urgent:l.isUrgent(Ke.bitrate,$,ye,w),knownStableBitrate:he})}}function y(){let E=s.getValue();g.cancel(),g=new z,g.linkToSignal(u),I(E,g.signal).onUpdate(function(P){h.setValue(P)},{clearSignal:g.signal,emitCurrentValue:!0})}function _(E){let{requestDuration:k,segmentDuration:x,size:P,content:A}=E;if(n.addSample(k,P),!A.segment.isInit){let{segment:M,representation:D}=A;if(x===void 0&&!M.complete)return;let w=x!=null?x:M.duration;f.addSample(D,k/1e3,w)}}function R(E){d.add(E)}function T(E){d.addProgress(E)}function C(E){d.remove(E.id)}}function Rf(n,e,t){let r=n;return t!==void 0&&t<1/0&&(r=Ua(r,t)),e!==void 0&&(r=La(r,e)),r}var ru=Fa;function jr(){var t;if(typeof((t=se.crypto)==null?void 0:t.randomUUID)==\"function\")return se.crypto.randomUUID();let n=new Date().getTime(),e=U();return\"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx\".replace(/[xy]/g,function(r){let i=Math.random()*16;return n>0?(i=(n+i)%16|0,n=Math.floor(n/16)):(i=(e+i)%16|0,e=Math.floor(e/16)),(r===\"x\"?i:i&3|8).toString(16)})}var Pf=4,Qn=class{constructor(e){var t,r;this._sessionId=(t=e.sessionId)!=null?t:jr(),this._contentId=(r=e.contentId)!=null?r:jr(),this._typePreference=e.communicationType===\"headers\"?0:1,this._bufferStarvationToggle=!1,this._playbackObserver=null,this._lastThroughput={},this._canceller=null}startMonitoringPlayback(e){var t;(t=this._canceller)==null||t.cancel(),this._canceller=new z,this._playbackObserver=e,e.listen(r=>{r.rebuffering!==null&&(this._bufferStarvationToggle=!0)},{includeLastObservation:!0,clearSignal:this._canceller.signal})}stopMonitoringPlayback(){var e;(e=this._canceller)==null||e.cancel(),this._canceller=null,this._playbackObserver=null}updateThroughput(e,t){this._lastThroughput[e]=t}_getCommonCmcdData(e){var i;let t={};t.bs=this._bufferStarvationToggle,this._bufferStarvationToggle=!1,t.cid=this._contentId,t.mtp=e!==void 0?Math.floor(Math.round(e/1e3/100)*100):void 0,t.sid=this._sessionId;let r=(i=this._playbackObserver)==null?void 0:i.getReference().getValue();return t.pr=r===void 0||r.speed===1?void 0:r.speed,r!==void 0&&(t.su=r.rebuffering!==null),t}getCmcdDataForManifest(e){var r;let t=this._getCommonCmcdData((r=this._lastThroughput.video)!=null?r:this._lastThroughput.audio);switch(t.ot=\"m\",e){case\"dash\":t.sf=\"d\";break;case\"smooth\":t.sf=\"s\";break;default:t.sf=\"o\";break}return this._producePayload(t)}getCmcdDataForSegmentRequest(e){var o,s,u,f;let t=(o=this._playbackObserver)==null?void 0:o.getReference().getValue(),r=this._getCommonCmcdData(this._lastThroughput[e.adaptation.type]);switch(r.br=Math.round(e.representation.bitrate/1e3),r.d=Math.round(e.segment.duration*1e3),e.adaptation.type){case\"video\":r.ot=\"v\";break;case\"audio\":r.ot=\"a\";break;case\"text\":r.ot=\"c\";break}e.segment.isInit&&(r.ot=\"i\");let i;if(t!==void 0&&(r.ot===\"v\"||r.ot===\"a\"||r.ot===\"av\")){let l=t.buffered[e.adaptation.type];if(!v(l)){let d=(f=(u=(s=this._playbackObserver)==null?void 0:s.getCurrentTime())!=null?u:t.position.getWanted())!=null?f:t.position.getPolled();for(let c of l)if(d>=c.start&&d<c.end){i=(c.end-d)*1e3,r.bl=Math.floor(Math.round(i/100)*100);break}}}let a=i===void 0||t===void 0?void 0:i/t.speed;if(r.dl=a===void 0?void 0:Math.floor(Math.round(a/100)*100),a!==void 0){let d=e.representation.bitrate*e.segment.duration/1e3/(a/1e3);r.rtp=Math.floor(Math.round(d*Pf/100)*100)}switch(e.manifest.transport){case\"dash\":r.sf=\"d\";break;case\"smooth\":r.sf=\"s\";break;default:r.sf=\"o\";break}return r.st=e.manifest.isDynamic?\"l\":\"v\",r.tb=e.adaptation.representations.reduce((l,d)=>d.isSupported!==!0||d.decipherable===!1?l:l===void 0?Math.round(d.bitrate/1e3):Math.max(l,Math.round(d.bitrate/1e3)),void 0),this._producePayload(r)}_producePayload(e){let t={object:\"\",request:\"\",session:\"\",status:\"\"},r=\"\",i=(f,l)=>{this._typePreference===0?t[l]+=f:r+=f},a=(f,l)=>{let d=e[f];if(d!==void 0){let c=`${f}=${String(d)},`;i(c,l)}},o=(f,l)=>{if(e[f]===!0){let d=`${f},`;i(d,l)}},s=(f,l)=>{let d=e[f];if(d!==void 0){let p=`prop=${`\"${d.replace(\"\\\\\",\"\\\\\\\\\").replace('\"','\\\\\"')}\"`},`;i(p,l)}},u=(f,l)=>{let d=e[f];if(d!==void 0){let c=`prop=${d},`;i(c,l)}};return a(\"br\",\"object\"),a(\"bl\",\"request\"),o(\"bs\",\"status\"),s(\"cid\",\"session\"),a(\"d\",\"object\"),a(\"dl\",\"request\"),a(\"mtp\",\"request\"),u(\"ot\",\"object\"),a(\"pr\",\"session\"),a(\"rtp\",\"status\"),u(\"sf\",\"session\"),s(\"sid\",\"session\"),u(\"st\",\"session\"),o(\"su\",\"request\"),a(\"tb\",\"object\"),this._typePreference===0?(t.object[t.object.length-1]===\",\"&&(t.object=t.object.substring(0,t.object.length-1)),t.request[t.request.length-1]===\",\"&&(t.request=t.request.substring(0,t.request.length-1)),t.session[t.session.length-1]===\",\"&&(t.session=t.session.substring(0,t.session.length-1)),t.status[t.status.length-1]===\",\"&&(t.status=t.status.substring(0,t.status.length-1)),m.debug(\"CMCD: proposing headers payload\"),{type:\"headers\",value:{\"CMCD-Object\":t.object,\"CMCD-Request\":t.request,\"CMCD-Session\":t.session,\"CMCD-Status\":t.status}}):(r[r.length-1]===\",\"&&(r=r.substring(0,r.length-1)),r=encodeURIComponent(r),m.debug(\"CMCD: proposing query string payload\",r),{type:\"query\",value:[[\"CMCD\",r]]})}};var iu=Qn;function st(n){return n instanceof ae?new Ye(\"PIPELINE_LOAD_ERROR\",n):be(n,{defaultCode:\"PIPELINE_LOAD_ERROR\",defaultReason:\"Unknown error when fetching the Manifest\"})}function za(n){let e=(Math.random()*2-1)*.3;return n*(e+1)}function vf(n){return n instanceof ae?n.type===Et.ERROR_HTTP_CODE?n.status>=500||n.status===404||n.status===415||n.status===412:n.type===Et.TIMEOUT||n.type===Et.ERROR_EVENT:n instanceof je?typeof n.canRetry==\"boolean\"?n.canRetry:n.xhr!==void 0?n.xhr.status>=500||n.xhr.status===404||n.xhr.status===415||n.xhr.status===412:!1:Ut(n)&&n.code===\"INTEGRITY_ERROR\"}async function Wa(n,e,t,r,i){if(i.cancellationError!==null)return Promise.reject(i.cancellationError);let{baseDelay:a,maxDelay:o,maxRetry:s,onRetry:u}=r;n!==null&&n.length===0&&m.warn(\"Fetchers: no CDN given to `scheduleRequestWithCdns`.\");let f=new Map,l=d();if(l===void 0)throw new Error(\"No CDN to request\");return c(l);function d(){if(n===null){let I=f.get(null);return I!==void 0&&I.isBlacklisted?void 0:null}else{if(e===null)return h(n);{let I=e.getCdnPreferenceForResource(n);return h(I)}}}async function c(I){try{return await t(I,i)}catch(y){if(z.isCancellationError(y))throw y;I!==null&&e!==null&&e.downgradeCdn(I);let _=f.get(I);if(_===void 0?(_={errorCounter:1,blockedUntil:void 0,isBlacklisted:!1},f.set(I,_)):_.errorCounter++,!vf(y))return _.blockedUntil=void 0,_.isBlacklisted=!0,p(y);if(_.errorCounter>s)_.blockedUntil=void 0,_.isBlacklisted=!0;else{let R=_.errorCounter,T=Math.min(a*Math.pow(2,R-1),o),C=za(T);_.blockedUntil=U()+C}return p(y)}}async function p(I){let y=d();if(i.isCancelled())throw i.cancellationError;if(y===void 0)throw I;if(u(I),i.isCancelled())throw i.cancellationError;return g(y,I)}function g(I,y){let _=f.get(I);if(_===void 0||_.blockedUntil===void 0)return c(I);let R=U(),T=_.blockedUntil-R;if(T<=0)return c(I);let C=new z,E=C.linkToSignal(i);return new Promise((k,x)=>{e==null||e.addEventListener(\"priorityChange\",()=>{let M=d();if(i.isCancelled())throw i.cancellationError;if(M===void 0)return A(y);M!==I&&(C.cancel(),g(M,y).then(P,A))},C.signal),wn(T,C.signal).then(()=>c(I).then(P,A),B);function P(M){E(),k(M)}function A(M){E(),x(M)}})}function h(I){var _;if(f.size===0)return I[0];let y=U();return(_=I.filter(R=>{var T;return((T=f.get(R))==null?void 0:T.isBlacklisted)!==!0}).reduce((R,T)=>{var E;let C=(E=f.get(T))==null?void 0:E.blockedUntil;return C!==void 0&&C<=y&&(C=void 0),R===void 0?[T,C]:R[1]===void 0?R:C===void 0?[T,void 0]:C<R[1]?[T,C]:R},void 0))==null?void 0:_[0]}}function Va(n,e,t){return Wa(null,null,n,e,t)}var $n=class extends fe{constructor(e,t,r){super(),this.scheduleManualRefresh=B,this._manifestUrls=e,this._pipelines=t.manifest,this._transportName=t.transportName,this._settings=r,this._canceller=new z,this._isStarted=!1,this._isRefreshPending=!1,this._consecutiveUnsafeMode=0,this._prioritizedContentUrl=null}dispose(){this._canceller.cancel(),this.removeEventListener()}start(){if(this._isStarted)return;this._isStarted=!0;let e,t=this._settings.initialManifest;t instanceof Ft?e=Promise.resolve({manifest:t}):t!==void 0?e=this.parse(t,{previousManifest:null,unsafeMode:!1},void 0):e=this._fetchManifest(void 0).then(r=>r.parse({previousManifest:null,unsafeMode:!1})),e.then(r=>{this.trigger(\"manifestReady\",r.manifest),this._canceller.isUsed()||this._recursivelyRefreshManifest(r.manifest,r)}).catch(r=>this._onFatalError(r))}updateContentUrls(e,t){var r;this._prioritizedContentUrl=(r=e==null?void 0:e[0])!=null?r:void 0,t&&this.scheduleManualRefresh({enablePartialRefresh:!1,delay:0,canUseUnsafeMode:!1})}async _fetchManifest(e){var f;let t=this._canceller.signal,r=this._settings,i=this._transportName,a=this._pipelines,o=e!=null?e:(f=this._manifestUrls)==null?void 0:f[0],s=this._getBackoffSetting(l=>{this.trigger(\"warning\",st(l))});try{let l=await u(o);return{parse:d=>this._parseLoadedManifest(l,d,o)}}catch(l){throw st(l)}function u(l){var I;let{loadManifest:d}=a,c=r.requestTimeout===void 0?L.getCurrent().DEFAULT_REQUEST_TIMEOUT:r.requestTimeout,p=r.connectionTimeout===void 0?L.getCurrent().DEFAULT_CONNECTION_TIMEOUT:r.connectionTimeout;c<0&&(c=void 0),p<0&&(p=void 0);let g={timeout:c,connectionTimeout:p,cmcdPayload:(I=r.cmcdDataBuilder)==null?void 0:I.getCmcdDataForManifest(i)};return Va(()=>d(l,g,t),s,t)}}parse(e,t,r){return this._parseLoadedManifest({responseData:e,size:void 0,requestDuration:void 0},t,r)}async _parseLoadedManifest(e,t,r){var h;let i=U(),a=this._canceller.signal,o=this.trigger.bind(this),{sendingTime:s,receivedTime:u}=e,f=this._getBackoffSetting(I=>{this.trigger(\"warning\",st(I))}),l=r!=null?r:(h=this._manifestUrls)==null?void 0:h[0],d={externalClockOffset:t.externalClockOffset,unsafeMode:t.unsafeMode,previousManifest:t.previousManifest,originalUrl:l};try{let I=this._pipelines.parseManifest(e,d,p,a,c);if(Cf(I)){let{manifest:y,warnings:_}=await I;return g(y,_)}else return g(I.manifest,I.warnings)}catch(I){throw be(I,{defaultCode:\"PIPELINE_PARSE_ERROR\",defaultReason:\"Unknown error when parsing the Manifest\"})}async function c(I){try{return await Va(I,f,a)}catch(y){throw st(y)}}function p(I){for(let y of I){if(a.isCancelled())return;let _=be(y,{defaultCode:\"PIPELINE_PARSE_ERROR\",defaultReason:\"Unknown error when parsing the Manifest\"});o(\"warning\",_)}}function g(I,y){p(y);let _=U()-i;return m.info(`MF: Manifest parsed in ${_}ms`),{manifest:I,sendingTime:s,receivedTime:u,parsingTime:_}}}_getBackoffSetting(e){let{DEFAULT_MAX_MANIFEST_REQUEST_RETRY:t,INITIAL_BACKOFF_DELAY_BASE:r,MAX_BACKOFF_DELAY_BASE:i}=L.getCurrent(),{lowLatencyMode:a,maxRetry:o}=this._settings,s=a?r.LOW_LATENCY:r.REGULAR,u=a?i.LOW_LATENCY:i.REGULAR,f=o!=null?o:t;return{onRetry:e,baseDelay:s,maxDelay:u,maxRetry:f}}_recursivelyRefreshManifest(e,{sendingTime:t,parsingTime:r,updatingTime:i}){let{MAX_CONSECUTIVE_MANIFEST_PARSING_IN_UNSAFE_MODE:a,MIN_MANIFEST_PARSING_TIME_TO_ENTER_UNSAFE_MODE:o}=L.getCurrent(),s=r!==void 0?r+(i!=null?i:0):void 0,u=!1;this._consecutiveUnsafeMode>0?u=this._consecutiveUnsafeMode<a:s!==void 0&&(u=s>=o);let f=t===void 0?0:U()-t,l=Math.max(this._settings.minimumManifestUpdateInterval-f,0),d=new z;if(d.linkToSignal(this._canceller.signal),this.scheduleManualRefresh=c=>{let{enablePartialRefresh:p,delay:g,canUseUnsafeMode:h}=c,I=h&&u,y=t===void 0?0:U()-t,_=Math.max(this._settings.minimumManifestUpdateInterval-y,0),R=setTimeout(()=>{d.cancel(),this._triggerNextManifestRefresh(e,{enablePartialRefresh:p,unsafeMode:I})},Math.max((g!=null?g:0)-y,_));d.signal.register(()=>{clearTimeout(R)})},e.expired!==null){let c=setTimeout(()=>{var p;(p=e.expired)==null||p.then(()=>{d.cancel(),this._triggerNextManifestRefresh(e,{enablePartialRefresh:!1,unsafeMode:u})},B)},l);d.signal.register(()=>{clearTimeout(c)})}if(e.lifetime!==void 0&&e.lifetime>=0){let c=e.lifetime*1e3-f,p;s===void 0?p=c:e.lifetime<3&&s>=100?(p=Math.min(Math.max(3e3-f,Math.max(c,0)+s),c*6),m.info(\"MUS: Manifest update rythm is too frequent. Postponing next request.\",c,p)):s>=e.lifetime*1e3/10?(p=Math.min(Math.max(c,0)+s,c*6),m.info(\"MUS: Manifest took too long to parse. Postponing next request\",p,p)):p=c;let g=setTimeout(()=>{d.cancel(),this._triggerNextManifestRefresh(e,{enablePartialRefresh:!1,unsafeMode:u})},Math.max(p,l));d.signal.register(()=>{clearTimeout(g)})}}_triggerNextManifestRefresh(e,{enablePartialRefresh:t,unsafeMode:r}){let i=e.updateUrl,a,o;this._prioritizedContentUrl!==null?(a=!0,o=this._prioritizedContentUrl,this._prioritizedContentUrl=null):(a=!t||i===void 0,o=a?e.getUrls()[0]:i);let s=e.clockOffset;r?(this._consecutiveUnsafeMode+=1,m.info('Init: Refreshing the Manifest in \"unsafeMode\" for the '+String(this._consecutiveUnsafeMode)+\" consecutive time.\")):this._consecutiveUnsafeMode>0&&(m.info('Init: Not parsing the Manifest in \"unsafeMode\" anymore after '+String(this._consecutiveUnsafeMode)+\" consecutive times.\"),this._consecutiveUnsafeMode=0),!this._isRefreshPending&&(this._isRefreshPending=!0,this._fetchManifest(o).then(u=>u.parse({externalClockOffset:s,previousManifest:e,unsafeMode:r})).then(u=>{this._isRefreshPending=!1;let{manifest:f,sendingTime:l,parsingTime:d}=u,c=U();if(a)e.replace(f);else try{e.update(f)}catch(g){let h=g instanceof Error?g.message:\"unknown error\";m.warn(`MUS: Attempt to update Manifest failed: ${h}`,\"Re-downloading the Manifest fully\");let{FAILED_PARTIAL_UPDATE_MANIFEST_REFRESH_DELAY:I}=L.getCurrent(),y=l===void 0?0:U()-l,_=Math.max(this._settings.minimumManifestUpdateInterval-y,0),R=B,T=setTimeout(()=>{R(),this._triggerNextManifestRefresh(e,{enablePartialRefresh:!1,unsafeMode:!1})},Math.max(I-y,_));R=this._canceller.signal.register(()=>{clearTimeout(T)});return}let p=U()-c;this._recursivelyRefreshManifest(e,{sendingTime:l,parsingTime:d,updatingTime:p})}).catch(u=>{this._isRefreshPending=!1,this._onFatalError(u)}))}_onFatalError(e){this._canceller.isUsed()||(this.trigger(\"error\",e),this.dispose())}};function Cf(n){return n instanceof Promise}var qa=$n;var Xn=class extends fe{constructor(e){super(),this._downgradedCdnList={metadata:[],timeouts:[]},e.register(()=>{for(let t of this._downgradedCdnList.timeouts)clearTimeout(t);this._downgradedCdnList={metadata:[],timeouts:[]}})}getCdnPreferenceForResource(e){return e.length<=1?e:this._innerGetCdnPreferenceForResource(e)}downgradeCdn(e){let t=au(this._downgradedCdnList.metadata,e);t>=0&&this._removeIndexFromDowngradeList(t);let{DEFAULT_CDN_DOWNGRADE_TIME:r}=L.getCurrent(),i=r;this._downgradedCdnList.metadata.push(e);let a=setTimeout(()=>{let o=au(this._downgradedCdnList.metadata,e);o>=0&&this._removeIndexFromDowngradeList(o),this.trigger(\"priorityChange\",null)},i);this._downgradedCdnList.timeouts.push(a),this.trigger(\"priorityChange\",null)}_innerGetCdnPreferenceForResource(e){let[t,r]=e.reduce((i,a)=>(this._downgradedCdnList.metadata.some(o=>o.id===a.id&&o.baseUrl===a.baseUrl)?i[1].push(a):i[0].push(a),i),[[],[]]);return t.concat(r)}_removeIndexFromDowngradeList(e){this._downgradedCdnList.metadata.splice(e,1);let t=this._downgradedCdnList.timeouts.splice(e,1);clearTimeout(t[0])}};function au(n,e){return n.length===0?-1:e.id!==void 0?re(n,t=>t.id===e.id):re(n,t=>t.baseUrl===e.baseUrl)}function Ha(n,e){let t=new WeakMap;return{createRequest(r,i,a,o){let s=f=>e(r,a,f),u=n.create(s,i,a,o);return t.set(u,s),u},updatePriority(r,i){let a=t.get(r);if(a===void 0){m.warn(\"Fetchers: Cannot update the priority of a request: task not found.\");return}n.updatePriority(a,i)}}}var Ga=class{constructor(){this._cache=new WeakMap}add({representation:e,segment:t},r){t.isInit&&this._cache.set(e,r)}get({representation:e,segment:t}){if(t.isInit){let r=this._cache.get(e);if(r!==void 0)return r}return null}},ou=Ga;var xf=xe();function Ka({bufferType:n,pipeline:e,cdnPrioritizer:t,cmcdDataBuilder:r,eventListeners:i,requestOptions:a}){let o;a.connectionTimeout===void 0||a.connectionTimeout<0?o=void 0:o=a.connectionTimeout;let s={timeout:a.requestTimeout<0?void 0:a.requestTimeout,connectionTimeout:o,cmcdPayload:void 0},u=ce([\"audio\",\"video\"],n)?new ou:void 0,{loadSegment:f,parseSegment:l}=e;return async function(c,p,g){var Q,G,Y;let{segment:h,adaptation:I,representation:y,manifest:_,period:R}=c,T=Rt(c),C=xf(),E,k=[],x=0,P=!1,A={segment:h,type:I.type,language:I.language,isLive:_.isLive,periodStart:R.start,periodEnd:R.end,mimeType:y.mimeType,codecs:y.codecs[0],manifestPublishTime:_.publishTime},M={onProgress(V){var $;E===void 0&&V.totalSize!==void 0&&V.size<V.totalSize&&(($=i.onProgress)==null||$.call(i,{duration:V.duration,size:V.size,totalSize:V.totalSize,timestamp:U(),id:C}))},onNewChunk(V){p.onChunk(N(V,!0))}},D=u!==void 0?u.get(c):null;if(D!==null)return m.debug(\"SF: Found wanted segment in cache\",T),p.onChunk(N(D,!1)),Promise.resolve();m.debug(\"SF: Beginning request\",T),(Q=i.onRequestBegin)==null||Q.call(i,{requestTimestamp:U(),id:C,content:c}),g.register(w);try{let V=await Wa(c.representation.cdnMetadata,t,O,H({onRetry:W},a),g);if(V.resultType===\"segment-loaded\"){let $=V.resultData.responseData;u!==void 0&&u.add(c,V.resultData.responseData),p.onChunk(N($,!1))}else V.resultType===\"segment-created\"&&p.onChunk(N(V.resultData,!1));m.debug(\"SF: Segment request ended with success\",T),p.onAllChunksReceived(),V.resultType!==\"segment-created\"?(E=V.resultData,q()):E=null,g.isCancelled()||(G=i.onRequestEnd)==null||G.call(i,{id:C}),g.deregister(w)}catch(V){throw g.deregister(w),E=null,V instanceof oe?(m.debug(\"SF: Segment request aborted\",T),V):(m.debug(\"SF: Segment request failed\",T),(Y=i.onRequestEnd)==null||Y.call(i,{id:C}),st(V))}function w(){var V;E===void 0&&(m.debug(\"SF: Segment request cancelled\",T),E=null,(V=i.onRequestEnd)==null||V.call(i,{id:C}))}function O(V){return s.cmcdPayload=r==null?void 0:r.getCmcdDataForSegmentRequest(c),f(V,A,s,g,M)}function N(V,$){k.push(!1);let le=k.length-1;return function(me){let Ge={data:V,isChunked:$};try{let De=l(Ge,A,me);return k[le]||(x=x!==void 0&&De.segmentType===\"media\"&&De.chunkInfos!==null&&De.chunkInfos.duration!==void 0?x+De.chunkInfos.duration:void 0,k[le]=!0,q()),De}catch(De){throw be(De,{defaultCode:\"PIPELINE_PARSE_ERROR\",defaultReason:\"Unknown parsing error\"})}}}function W(V){p.onRetry(st(V))}function q(){var V;P||!v(E)&&E.size!==void 0&&E.requestDuration!==void 0&&k.length>0&&k.every($=>$)&&(P=!0,(V=i.onMetrics)==null||V.call(i,{size:E.size,requestDuration:E.requestDuration,content:c,segmentDuration:x}))}}}function su({maxRetry:n,lowLatencyMode:e,requestTimeout:t,connectionTimeout:r}){let{DEFAULT_MAX_REQUESTS_RETRY_ON_ERROR:i,DEFAULT_REQUEST_TIMEOUT:a,DEFAULT_CONNECTION_TIMEOUT:o,INITIAL_BACKOFF_DELAY_BASE:s,MAX_BACKOFF_DELAY_BASE:u}=L.getCurrent();return{maxRetry:n!=null?n:i,baseDelay:e?s.LOW_LATENCY:s.REGULAR,maxDelay:e?u.LOW_LATENCY:u.REGULAR,requestTimeout:t===void 0?a:t,connectionTimeout:r===void 0?o:r}}var Jn=class{constructor({prioritySteps:e}){if(this._minPendingPriority=null,this._waitingQueue=[],this._pendingTasks=[],this._prioritySteps=e,this._prioritySteps.high>=this._prioritySteps.low)throw new Error(\"TP: the max high level priority should be given a lowerpriority number than the min low priority.\")}create(e,t,r,i){let a;return Bt(i,(o,s)=>(a={hasEnded:!1,priority:t,trigger:()=>{if(a.hasEnded)return;let f=()=>{p(),this._endTask(a)},l=g=>{r.beforeEnded(),f(),o(g)},d=g=>{f(),s(g)},c=new z,p=c.linkToSignal(i);a.interrupter=c,c.signal.register(()=>{a.interrupter=null,i.isCancelled()||r.beforeInterrupted()}),this._minPendingPriority=this._minPendingPriority===null?a.priority:Math.min(this._minPendingPriority,a.priority),this._pendingTasks.push(a),a.taskFn(c.signal).then(l).catch(g=>{!i.isCancelled()&&c.isUsed()&&g instanceof oe||d(g)})},taskFn:e,interrupter:null},this._canBeStartedNow(a)?(a.trigger(),this._isRunningHighPriorityTasks()&&this._interruptCancellableTasks()):this._waitingQueue.push(a),()=>this._endTask(a)))}_endTask(e){e.hasEnded=!0;let t=Zn(e.taskFn,this._waitingQueue);if(t>=0)this._waitingQueue.splice(t,1);else{let r=Zn(e.taskFn,this._pendingTasks);if(r<0)return;this._pendingTasks.splice(r,1),this._pendingTasks.length>0?this._minPendingPriority===e.priority&&(this._minPendingPriority=Math.min(...this._pendingTasks.map(i=>i.priority))):this._minPendingPriority=null,this._loopThroughWaitingQueue()}}updatePriority(e,t){let r=Zn(e,this._waitingQueue);if(r>=0){let s=this._waitingQueue[r];if(s.priority===t||(s.priority=t,!this._canBeStartedNow(s)))return;this._findAndRunWaitingQueueTask(r),this._isRunningHighPriorityTasks()&&this._interruptCancellableTasks();return}let i=Zn(e,this._pendingTasks);if(i<0){m.warn(\"TP: request to update the priority of a non-existent task\");return}let a=this._pendingTasks[i];if(a.priority===t)return;let o=a.priority;a.priority=t,this._minPendingPriority===null||t<this._minPendingPriority?this._minPendingPriority=t:this._minPendingPriority===o&&(this._pendingTasks.length===1?this._minPendingPriority=t:this._minPendingPriority=Math.min(...this._pendingTasks.map(s=>s.priority)),this._loopThroughWaitingQueue()),this._isRunningHighPriorityTasks()&&this._interruptCancellableTasks()}_loopThroughWaitingQueue(){let e=this._waitingQueue.reduce((t,r)=>t===null||t>r.priority?r.priority:t,null);if(!(e===null||this._minPendingPriority!==null&&this._minPendingPriority<e))for(let t=0;t<this._waitingQueue.length;t++){let r=this._minPendingPriority===null?e:Math.min(this._minPendingPriority,e);this._waitingQueue[t].priority<=r&&(this._findAndRunWaitingQueueTask(t),t--)}}_interruptCancellableTasks(){for(let e=0;e<this._pendingTasks.length;e++){let t=this._pendingTasks[e];if(t.priority>=this._prioritySteps.low)return this._interruptPendingTask(t),this._interruptCancellableTasks()}}_findAndRunWaitingQueueTask(e){return e>=this._waitingQueue.length||e<0?(m.warn(\"TP : Tried to start a non existing task\"),!1):(this._waitingQueue.splice(e,1)[0].trigger(),!0)}_interruptPendingTask(e){var r;let t=Zn(e.taskFn,this._pendingTasks);if(t<0){m.warn(\"TP: Interrupting a non-existent pending task. Aborting...\");return}this._pendingTasks.splice(t,1),this._waitingQueue.push(e),this._pendingTasks.length===0?this._minPendingPriority=null:this._minPendingPriority===e.priority&&(this._minPendingPriority=Math.min(...this._pendingTasks.map(i=>i.priority))),(r=e.interrupter)==null||r.cancel()}_canBeStartedNow(e){return this._minPendingPriority===null||e.priority<=this._minPendingPriority}_isRunningHighPriorityTasks(){return this._minPendingPriority!==null&&this._minPendingPriority<=this._prioritySteps.high}};function Zn(n,e){return re(e,t=>t.taskFn===n)}var er=class{constructor(e,t,r,i){let a=new Xn(i),{MIN_CANCELABLE_PRIORITY:o,MAX_HIGH_PRIORITY_LEVEL:s}=L.getCurrent();this._transport=e,this._prioritizer=new Jn({prioritySteps:{high:s,low:o}}),this._cdnPrioritizer=a,this._backoffOptions=r,this._cmcdDataBuilder=t}createSegmentFetcher(e,t){let r=su(this._backoffOptions),i=this._transport[e],a=Ka({bufferType:e,pipeline:i,cdnPrioritizer:this._cdnPrioritizer,cmcdDataBuilder:this._cmcdDataBuilder,eventListeners:t,requestOptions:r});return Ha(this._prioritizer,a)}};var ja=er;var tr=class{constructor(e){this._segmentSinksStore=e,this._currentFreezeTimestamp=null}needToReload(e){let{readyState:t,rebuffering:r,freezing:i}=e;if((e.bufferGap!==void 0&&isFinite(e.bufferGap)?e.bufferGap:0)<6||r===null&&i===null||t>1)return this._currentFreezeTimestamp=null,!1;let o=U();this._currentFreezeTimestamp===null&&(this._currentFreezeTimestamp=o);let s=r!==null&&o-r.timestamp>4e3,u=i!==null&&o-i.timestamp>4e3;if((s||u)&&U()-this._currentFreezeTimestamp>4e3){let f=this._segmentSinksStore.getStatus(\"audio\"),l=this._segmentSinksStore.getStatus(\"video\"),d=!0,c=!0;for(let p of[f,l])if(p.type===\"initialized\")for(let g of p.value.getLastKnownInventory()){let{representation:h}=g.infos;if(h.decipherable===!1)return m.warn(\"Init: we have undecipherable segments left in the buffer, reloading\"),this._currentFreezeTimestamp=null,!0;h.contentProtections!==void 0&&(c=!1,h.decipherable!==!0&&(d=!1))}if(!c&&d)return m.warn(\"Init: we are frozen despite only having decipherable segments left in the buffer, reloading\"),this._currentFreezeTimestamp=null,!0}return!1}};var{DEFAULT_WANTED_BUFFER_AHEAD:Af,DEFAULT_MAX_VIDEO_BUFFER_SIZE:kf,DEFAULT_MAX_BUFFER_AHEAD:Mf,DEFAULT_MAX_BUFFER_BEHIND:Of}=L.getCurrent(),Ya=new j(Af),Qa=new j(kf),$a=new j(Mf),Xa=new j(Of),Yr=new j({height:void 0,width:void 0,pixelRatio:1}),Qr=new j(1/0);function Z(n,e){m.debug(\"<--- Sending to Main:\",n.type),e===void 0?postMessage(n):postMessage(n,e)}function we(n){return be(n,{defaultCode:\"NONE\",defaultReason:\"An unknown error stopped content playback.\"}).serialize()}var nr=class{constructor(){this._refs=new Map}reset(){var e,t,r,i,a,o,s,u,f,l,d,c;for(let p of this._refs.keys())(t=(e=this._refs.get(p))==null?void 0:e.audio)==null||t.trackReference.finish(),(i=(r=this._refs.get(p))==null?void 0:r.audio)==null||i.representations.finish(),(o=(a=this._refs.get(p))==null?void 0:a.video)==null||o.trackReference.finish(),(u=(s=this._refs.get(p))==null?void 0:s.video)==null||u.representations.finish(),(l=(f=this._refs.get(p))==null?void 0:f.text)==null||l.trackReference.finish(),(c=(d=this._refs.get(p))==null?void 0:d.text)==null||c.representations.finish();this._refs=new Map}addTrackSetter(e,t,r){var s,u;let i=this._refs.get(e);i===void 0&&(i={},this._refs.set(e,i)),i[t]!==void 0&&(m.warn(\"WP: Track for periodId already declared\",e,t),(s=i[t])==null||s.trackReference.finish(),(u=i[t])==null||u.representations.finish());let a=r.getValue(),o;v(a)?o=new j({representationIds:[],switchingMode:\"lazy\"}):(o=new j(a.representations.getValue()),r.setValue(H({},a,{representations:o}))),i[t]={trackReference:r,representations:o}}setTrack(e,t,r){var a;let i=(a=this._refs.get(e))==null?void 0:a[t];return i===void 0?(m.debug(\"WP: Setting track for inexistent periodId\",e,t),!1):(v(r)?(i.representations=new j({representationIds:[],switchingMode:\"lazy\"}),i.trackReference.setValue(r)):(i.representations=new j(r.initialRepresentations),i.trackReference.setValue({adaptationId:r.adaptationId,switchingMode:r.switchingMode,representations:i.representations,relativeResumingPosition:r.relativeResumingPosition})),!0)}updateRepresentations(e,t,r,i){var s;let a=(s=this._refs.get(e))==null?void 0:s[r];if(a===void 0)return m.debug(\"WP: Setting track for inexistent periodId\",e,r),!1;let o=a.trackReference.getValue();return v(o)||o.adaptationId!==t?(m.debug(\"WP: Desynchronized Adaptation id\",o==null?void 0:o.adaptationId,t),!1):(a.representations.setValue(i),!0)}removeTrackSetter(e,t){let r=this._refs.get(e),i=r==null?void 0:r[t];return r===void 0||i===void 0?(m.debug(\"WP: Removing track setter for inexistent periodId\",e,t),!1):(i.trackReference.finish(),i.representations.finish(),delete r[t],Object.keys(r).length===0&&this._refs.delete(e),!0)}};var rr=class{constructor(e,t){this._contentId=e,this._messageSender=t,this._queues={pushTextData:[],remove:[]}}pushTextData(e){return new Promise((t,r)=>{this._messageSender({type:\"push-text-data\",contentId:this._contentId,value:e}),this._queues.pushTextData.push({resolve:t,reject:r})})}remove(e,t){return new Promise((r,i)=>{this._messageSender({type:\"remove-text-data\",contentId:this._contentId,value:{start:e,end:t}}),this._queues.remove.push({resolve:r,reject:i})})}reset(){this._messageSender({type:\"reset-text-displayer\",contentId:this._contentId,value:null}),this._resetCurrentQueue()}stop(){this._messageSender({type:\"stop-text-displayer\",contentId:this._contentId,value:null}),this._resetCurrentQueue()}_resetCurrentQueue(){let e=new oe;this._queues.pushTextData.forEach(t=>{t.reject(e)}),this._queues.remove.forEach(t=>{t.reject(e)})}onPushedTrackSuccess(e){let t=this._queues.pushTextData.shift();if(t===void 0){m.error(\"WMS: pushTextData success for inexistant operation\");return}t.resolve(e)}onPushedTrackError(e){let t=this._queues.pushTextData.shift();if(t===void 0){m.error(\"WMS: pushTextData error for inexistant operation\");return}t.reject(e)}onRemoveSuccess(e){let t=this._queues.remove.shift();if(t===void 0){m.error(\"WMS: remove success for inexistant operation\");return}t.resolve(e)}onRemoveError(e){let t=this._queues.pushTextData.shift();if(t===void 0){m.error(\"WMS: pushTextData error for inexistant operation\");return}t.reject(e)}};var uu=xe(),$t=class{constructor({hasMseInWorker:e,hasVideo:t}){this._currentContent=null,this._currentMediaSourceCanceller=new z,this._hasVideo=t,this._hasMseInWorker=e;let r=new z;this._contentCanceller=r}initializeNewContent(e){return new Promise((t,r)=>{var x,P;this.disposeCurrentContent();let i=this._contentCanceller,a=new z;this._currentMediaSourceCanceller=a,a.linkToSignal(i.signal);let{contentId:o,url:s,hasText:u,transportOptions:f}=e,l=null;Se(de.transports.dash!==void 0,\"Multithread RxPlayer should have access to the DASH feature\");let d=typeof f.representationFilter==\"string\"?Io(f.representationFilter):void 0,c=de.transports.dash(ie(J({},f),{representationFilter:d})),p=e.cmcd===void 0?null:new iu(e.cmcd),g=new qa(s===void 0?void 0:[s],c,J({cmcdDataBuilder:p},e.manifestRetryOptions)),h=ru({initialBitrates:{audio:(x=e.initialAudioBitrate)!=null?x:0,video:(P=e.initialVideoBitrate)!=null?P:0},lowLatencyMode:f.lowLatencyMode,throttlers:{limitResolution:{video:Yr},throttleBitrate:{video:Qr}}}),I=a.signal.register(A=>{r(A)}),y=new ja(c,p,e.segmentRetryOptions,i.signal),_=new nr,[R,T,C]=du(o,{hasMseInWorker:this._hasMseInWorker,hasVideo:this._hasVideo,hasText:u},a.signal),E=new tr(T);this._currentContent={cmcdDataBuilder:p,contentId:o,decipherabilityFreezeDetector:E,mediaSource:R,manifest:null,manifestFetcher:g,representationEstimator:h,segmentSinksStore:T,segmentFetcherCreator:y,workerTextSender:C,trackChoiceSetter:_},R.addEventListener(\"mediaSourceOpen\",function(){k()},a.signal),i.signal.register(()=>{g.dispose()}),g.addEventListener(\"warning\",A=>{Z({type:\"warning\",contentId:o,value:we(A)})},i.signal),g.addEventListener(\"manifestReady\",A=>{if(l!==null){m.warn(\"WP: Multiple `manifestReady` events, ignoring\");return}l=A,this._currentContent!==null&&(this._currentContent.manifest=l),k()},a.signal),g.addEventListener(\"error\",A=>{r(A)},i.signal),g.start();function k(){if(l===null||R.readyState===\"closed\"||a.isUsed())return;let A=l.getMetadataSnapshot();l.addEventListener(\"manifestUpdate\",M=>{if(l===null)return;let D=H(l.getMetadataSnapshot(),{periods:[]});Z({type:\"manifest-update\",contentId:o,value:{manifest:D,updates:M}})},i.signal),I(),t(A)}})}getCurrentContent(){return this._currentContent}scheduleManifestRefresh(e){var t;(t=this._currentContent)==null||t.manifestFetcher.scheduleManualRefresh(e)}reloadMediaSource(e){if(this._currentMediaSourceCanceller.cancel(),this._currentContent===null)return Promise.reject(new Error(\"CP: No content anymore\"));this._currentContent.trackChoiceSetter.reset(),this._currentMediaSourceCanceller=new z,Z({type:\"reloading-media-source\",contentId:this._currentContent.contentId,value:e},[]);let[t,r,i]=du(this._currentContent.contentId,{hasMseInWorker:this._hasMseInWorker,hasVideo:this._hasVideo,hasText:this._currentContent.workerTextSender!==null},this._currentMediaSourceCanceller.signal);return this._currentContent.mediaSource=t,this._currentContent.segmentSinksStore=r,this._currentContent.workerTextSender=i,new Promise((a,o)=>{t.addEventListener(\"mediaSourceOpen\",function(){a()},this._currentMediaSourceCanceller.signal),t.addEventListener(\"mediaSourceClose\",function(){o(new Error(\"MediaSource ReadyState changed to close during init.\"))},this._currentMediaSourceCanceller.signal),this._currentMediaSourceCanceller.signal.register(s=>{o(s)})})}disposeCurrentContent(){this._contentCanceller.cancel(),this._contentCanceller=new z}};function du(n,e,t){let r;if(e.hasMseInWorker){let s=new zn(uu());r=s;let u,f=s.handle;if(f.type===\"handle\")u={type:\"handle\",value:f.value};else{let l=URL.createObjectURL(f.value);u={type:\"url\",value:l},t.register(()=>{URL.revokeObjectURL(l)})}Z({type:\"attach-media-source\",contentId:n,value:u,mediaSourceId:r.id},[f.value])}else r=new Wn(uu(),n,Z);let i=e.hasText?new rr(n,Z):null,{hasVideo:a}=e,o=new Tt(r,a,i);return t.register(()=>{o.disposeAll(),i==null||i.stop(),r.dispose()}),[r,o,i]}function Za(){let n=!1,e=new $t({hasMseInWorker:!1,hasVideo:!0}),t=null,r=new ts;de.dashParsers.wasm=r,de.dashParsers.fastJs=Vo,de.transports.dash=Es;let i=null;onmessage=function(a){var s,u,f;m.debug(\"Worker: received message\",a.data.type);let o=a.data;switch(o.type){case\"init\":Se(!n),n=!0,no(o.value),lu(o.value.logLevel,o.value.logFormat,o.value.sendBackLogs),o.value.dashWasmUrl!==void 0&&r.isCompatible()&&r.initialize({wasmUrl:o.value.dashWasmUrl}).catch(l=>{let d=l instanceof Error?l.toString():\"Unknown Error\";m.error(\"Worker: Could not initialize DASH_WASM parser\",d)}),(!o.value.hasVideo||o.value.hasMseInWorker)&&(e.disposeCurrentContent(),e=new $t({hasMseInWorker:o.value.hasMseInWorker,hasVideo:o.value.hasVideo})),de.codecSupportProber=o.value.hasMseInWorker?yo:_o,Z({type:\"init-success\",value:null});break;case\"log-level-update\":lu(o.value.logLevel,o.value.logFormat,o.value.sendBackLogs);break;case\"prepare\":wf(e,o.value);break;case\"start\":{let l=e.getCurrentContent();if(o.contentId!==(l==null?void 0:l.contentId))return;t!==null&&(t.cancel(),t=null);let d=new z,c=new j(H(o.value.initialObservation,{position:new Mt(...o.value.initialObservation.position)}));i=c,t=d,t.signal.register(()=>{c.finish()}),fu(o.value,e,c,d.signal);break}case\"observation\":{let l=e.getCurrentContent();if(o.contentId!==(l==null?void 0:l.contentId))return;let d=o.value,{buffered:c}=d,p=ka(l.mediaSource,null);p.audio!==null&&(c.audio=p.audio),p.video!==null&&(c.video=p.video),i==null||i.setValue(H(d,{position:new Mt(...o.value.position)}));break}case\"ref-update\":Df(o);break;case\"stop\":if(o.contentId!==((s=e.getCurrentContent())==null?void 0:s.contentId))return;e.disposeCurrentContent(),t!==null&&(t.cancel(),t=null);break;case\"sb-success\":{let l=e.getCurrentContent();if(o.mediaSourceId!==(l==null?void 0:l.mediaSource.id))return;let{sourceBuffers:d}=l.mediaSource,c=K(d,p=>p.type===o.sourceBufferType);if(c===void 0){m.info(\"WP: Success for an unknown SourceBuffer\",o.sourceBufferType);return}if(c.onOperationSuccess===void 0){m.warn(\"WP: A SourceBufferInterface with MSE performed a cross-thread operation\",o.sourceBufferType);return}c.onOperationSuccess(o.operationId,o.value.buffered);break}case\"sb-error\":{let l=e.getCurrentContent();if(o.mediaSourceId!==(l==null?void 0:l.mediaSource.id))return;let{sourceBuffers:d}=l.mediaSource,c=K(d,p=>p.type===o.sourceBufferType);if(c===void 0){m.info(\"WP: Error for an unknown SourceBuffer\",o.sourceBufferType);return}if(c.onOperationFailure===void 0){m.warn(\"WP: A SourceBufferInterface with MSE performed a cross-thread operation\",o.sourceBufferType);return}c.onOperationFailure(o.operationId,o.value);break}case\"media-source-ready-state-change\":{let l=e.getCurrentContent();if(o.mediaSourceId!==(l==null?void 0:l.mediaSource.id))return;if(l.mediaSource.onMediaSourceReadyStateChanged===void 0){m.warn(\"WP: A MediaSourceInterface with MSE performed a cross-thread operation\");return}l.mediaSource.onMediaSourceReadyStateChanged(o.value);break}case\"decipherability-update\":{if(o.contentId!==((u=e.getCurrentContent())==null?void 0:u.contentId))return;let l=e.getCurrentContent();if(l===null||l.manifest===null)return;let d=o.value;l.manifest.updateRepresentationsDeciperability(c=>{for(let p of d)if(c.representation.uniqueId===p.representationUniqueId)return p.decipherable;return c.representation.decipherable});break}case\"codec-support-update\":{let l=e.getCurrentContent();if(l===null||l.manifest===null)return;if(typeof((f=de.codecSupportProber)==null?void 0:f.updateCache)==\"function\")for(let{mimeType:d,codec:c,result:p}of o.value)de.codecSupportProber.updateCache(d,c,p);try{let d=l.manifest.refreshCodecSupport(o.value);d!==null&&Z({type:\"warning\",contentId:l.contentId,value:we(d)})}catch(d){Z({type:\"error\",contentId:l.contentId,value:we(d)})}break}case\"urls-update\":{let l=e.getCurrentContent();if(l===null||l.contentId!==o.contentId)return;l.manifestFetcher.updateContentUrls(o.value.urls,o.value.refreshNow);break}case\"track-update\":{let l=e.getCurrentContent();if(l===null||l.contentId!==o.contentId)return;l.trackChoiceSetter.setTrack(o.value.periodId,o.value.bufferType,o.value.choice);break}case\"rep-update\":{let l=e.getCurrentContent();if(l===null||l.contentId!==o.contentId)return;l.trackChoiceSetter.updateRepresentations(o.value.periodId,o.value.adaptationId,o.value.bufferType,o.value.choice);break}case\"add-text-success\":{let l=e.getCurrentContent();if(l===null||l.contentId!==o.contentId)return;if(l.workerTextSender===null){m.error(\"WP: Added text track but text track aren't enabled\");return}l.workerTextSender.onPushedTrackSuccess(o.value.ranges);break}case\"push-text-error\":{let l=e.getCurrentContent();if(l===null||l.contentId!==o.contentId)return;if(l.workerTextSender===null){m.error(\"WP: Added text track but text track aren't enabled\");return}l.workerTextSender.onPushedTrackError(new Error(o.value.message));break}case\"remove-text-success\":{let l=e.getCurrentContent();if(l===null||l.contentId!==o.contentId)return;if(l.workerTextSender===null){m.error(\"WP: Removed text track but text track aren't enabled\");return}l.workerTextSender.onRemoveSuccess(o.value.ranges);break}case\"remove-text-error\":{let l=e.getCurrentContent();if(l===null||l.contentId!==o.contentId)return;if(l.workerTextSender===null){m.error(\"WP: Removed text track but text track aren't enabled\");return}l.workerTextSender.onRemoveError(new Error(o.value.message));break}case\"pull-segment-sink-store-infos\":{Bf(e,o.value.messageId);break}default:We(o)}}}function wf(n,e){n.initializeNewContent(e).then(t=>{Z({type:\"manifest-ready\",contentId:e.contentId,value:{manifest:t}})},t=>{Z({type:\"error\",contentId:e.contentId,value:we(t)})})}function Df(n){switch(n.value.name){case\"wantedBufferAhead\":Ya.setValueIfChanged(n.value.newVal);break;case\"maxVideoBufferSize\":Qa.setValueIfChanged(n.value.newVal);break;case\"maxBufferBehind\":Xa.setValueIfChanged(n.value.newVal);break;case\"maxBufferAhead\":$a.setValueIfChanged(n.value.newVal);break;case\"limitVideoResolution\":Yr.setValueIfChanged(n.value.newVal);break;case\"throttleVideoBitrate\":Qr.setValueIfChanged(n.value.newVal);break;default:We(n.value)}}function fu(n,e,t,r){var x;let i=new z;i.linkToSignal(r);let a=new Map,o=e.getCurrentContent();if(o===null||o.manifest===null){let P=new Ie(\"NONE\",\"Loading content when none is prepared\");Z({type:\"error\",contentId:void 0,value:we(P)});return}let{contentId:s,cmcdDataBuilder:u,manifest:f,mediaSource:l,representationEstimator:d,segmentSinksStore:c,segmentFetcherCreator:p}=o,{drmSystemId:g,enableFastSwitching:h,initialTime:I,onCodecSwitch:y}=n;if(t.onUpdate(P=>{o.decipherabilityFreezeDetector.needToReload(P)&&k({timeOffset:0,minimumPosition:0,maximumPosition:1/0}),[\"video\",\"audio\",\"text\"].forEach(A=>{var D;let M=c.getStatus(A);M.type===\"initialized\"&&M.value.synchronizeInventory((D=P.buffered[A])!=null?D:[])})}),((x=f.getPeriodForTime(I))!=null?x:f.getNextPeriod(I))===void 0){let P=new X(\"MEDIA_STARTING_TIME_NOT_FOUND\",\"Wanted starting time not found in the Manifest.\");Z({type:\"error\",contentId:s,value:we(P)});return}let R=new yn(t,s,Z,i.signal);u==null||u.startMonitoringPlayback(R),i.signal.register(()=>{u==null||u.stopMonitoringPlayback()});let T=Aa(f,l,R,c,{onWarning:P=>Z({type:\"warning\",contentId:s,value:we(P)}),onPeriodChanged:P=>{Z({type:\"active-period-changed\",contentId:s,value:{periodId:P.id}})}},i.signal);Hs({initialPeriod:f.periods[0],manifest:f},R,d,c,p,{wantedBufferAhead:Ya,maxVideoBufferSize:Qa,maxBufferAhead:$a,maxBufferBehind:Xa,drmSystemId:g,enableFastSwitching:h,onCodecSwitch:y},C(),i.signal);function C(){return{needsBufferFlush(P){Z({type:\"needs-buffer-flush\",contentId:s,value:P})},streamStatusUpdate(P){E(P),f.isLastPeriodKnown&&P.period.id===f.periods[f.periods.length-1].id&&(P.hasFinishedLoading||P.isEmptyStream?T.onLastSegmentFinishedLoading(P.bufferType):T.onLastSegmentLoadingResume(P.bufferType))},needsManifestRefresh(){e.scheduleManifestRefresh({enablePartialRefresh:!0,canUseUnsafeMode:!0})},manifestMightBeOufOfSync(){let{OUT_OF_SYNC_MANIFEST_REFRESH_DELAY:P}=L.getCurrent();e.scheduleManifestRefresh({enablePartialRefresh:!1,canUseUnsafeMode:!1,delay:P})},lockedStream(P){Z({type:\"locked-stream\",contentId:s,value:{periodId:P.period.id,bufferType:P.bufferType}})},adaptationChange(P){var A,M;T.onAdaptationChange(P.type,P.period,P.adaptation),!i.signal.isCancelled()&&Z({type:\"adaptation-changed\",contentId:s,value:{adaptationId:(M=(A=P.adaptation)==null?void 0:A.id)!=null?M:null,periodId:P.period.id,type:P.type}})},representationChange(P){var A,M;T.onRepresentationChange(P.type,P.period),!i.signal.isCancelled()&&Z({type:\"representation-changed\",contentId:s,value:{adaptationId:P.adaptation.id,representationId:(M=(A=P.representation)==null?void 0:A.id)!=null?M:null,periodId:P.period.id,type:P.type}})},inbandEvent(P){Z({type:\"inband-event\",contentId:s,value:P})},warning(P){Z({type:\"warning\",contentId:s,value:we(P)})},periodStreamReady(P){o!==null&&(o.trackChoiceSetter.addTrackSetter(P.period.id,P.type,P.adaptationRef),Z({type:\"period-stream-ready\",contentId:s,value:{periodId:P.period.id,bufferType:P.type}}))},periodStreamCleared(P){if(o===null)return;let A=a.get(P.period);A!==void 0&&(A.delete(P.type),A.size===0&&a.delete(P.period)),o.trackChoiceSetter.removeTrackSetter(P.period.id,P.type),Z({type:\"period-stream-cleared\",contentId:s,value:{periodId:P.period.id,bufferType:P.type}})},bitrateEstimateChange(P){var A;o!==null&&((A=o.cmcdDataBuilder)==null||A.updateThroughput(P.type,P.bitrate)),Z({type:\"bitrate-estimate-change\",contentId:s,value:{bitrate:P.bitrate,bufferType:P.type}})},needsMediaSourceReload(P){k(P)},needsDecipherabilityFlush(){Z({type:\"needs-decipherability-flush\",contentId:s,value:null})},encryptionDataEncountered(P){for(let A of P){let M=A.content,D=J({},M);D.manifest instanceof Ft&&(D.manifest=D.manifest.getMetadataSnapshot()),D.period instanceof mt&&(D.period=D.period.getMetadataSnapshot()),D.adaptation instanceof ft&&(D.adaptation=D.adaptation.getMetadataSnapshot()),D.representation instanceof rn&&(D.representation=D.representation.getMetadataSnapshot()),Z({type:\"encryption-data-encountered\",contentId:s,value:{keyIds:A.keyIds,values:A.values,content:D,type:A.type}})}},error(P){Z({type:\"error\",contentId:s,value:we(P)})}}}function E(P){let{imminentDiscontinuity:A}=P,M=a.get(P.period),D=M==null?void 0:M.get(P.bufferType);if(D!==void 0){if(D.discontinuity===null){if(A===null)return}else if(A!==null&&D.discontinuity.start===A.start&&D.discontinuity.end===A.end)return}M===void 0&&(M=new Map,a.set(P.period,M));let w={periodId:P.period.id,bufferType:P.bufferType,discontinuity:P.imminentDiscontinuity,position:P.position};M.set(P.bufferType,w),Z({type:\"discontinuity-update\",contentId:s,value:w})}function k(P){let M=t.getValue().position.getWanted();i!==null&&i.cancel(),e.reloadMediaSource(P).then(()=>{fu({initialTime:M,drmSystemId:n.drmSystemId,enableFastSwitching:n.enableFastSwitching,onCodecSwitch:n.onCodecSwitch},e,t,r)},D=>{Z({type:\"error\",contentId:s,value:we(D)})})}}function lu(n,e,t){t?m.setLevel(n,\"standard\",(r,i)=>{let a=i.map(o=>o instanceof Error?we(o):o);postMessage({type:\"log\",value:{logLevel:r,logs:a}})}):m.setLevel(n,e)}function Bf(n,e){let t=n.getCurrentContent();if(t===null)return;let r=t.segmentSinksStore.getSegmentSinksMetrics();Z({type:\"segment-sink-store-update\",contentId:t.contentId,value:{segmentSinkMetrics:r,messageId:e}})}var cu=Za;cu();})();\n" + "})()"], { type: "application/javascript" });
exports.EMBEDDED_WORKER = blob;
exports.default = blob;
