"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
exports.EMBEDDED_WORKER_ES5 = void 0;
var blob = new Blob(["(function(){" + "/*! For license information please see worker.es5.js.LICENSE.txt */\n!function(){var e={633:function(e,t,n){var r=n(738).default;function i(){\"use strict\";e.exports=i=function(){return n},e.exports.__esModule=!0,e.exports.default=e.exports;var t,n={},a=Object.prototype,o=a.hasOwnProperty,s=Object.defineProperty||function(e,t,n){e[t]=n.value},u=\"function\"==typeof Symbol?Symbol:{},l=u.iterator||\"@@iterator\",d=u.asyncIterator||\"@@asyncIterator\",c=u.toStringTag||\"@@toStringTag\";function f(e,t,n){return Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}),e[t]}try{f({},\"\")}catch(t){f=function(e,t,n){return e[t]=n}}function p(e,t,n,r){var i=t&&t.prototype instanceof S?t:S,a=Object.create(i.prototype),o=new O(r||[]);return s(a,\"_invoke\",{value:P(e,n,o)}),a}function h(e,t,n){try{return{type:\"normal\",arg:e.call(t,n)}}catch(e){return{type:\"throw\",arg:e}}}n.wrap=p;var v=\"suspendedStart\",m=\"suspendedYield\",g=\"executing\",b=\"completed\",y={};function S(){}function _(){}function E(){}var w={};f(w,l,(function(){return this}));var T=Object.getPrototypeOf,A=T&&T(T(D([])));A&&A!==a&&o.call(A,l)&&(w=A);var I=E.prototype=S.prototype=Object.create(w);function k(e){[\"next\",\"throw\",\"return\"].forEach((function(t){f(e,t,(function(e){return this._invoke(t,e)}))}))}function R(e,t){function n(i,a,s,u){var l=h(e[i],e,a);if(\"throw\"!==l.type){var d=l.arg,c=d.value;return c&&\"object\"==r(c)&&o.call(c,\"__await\")?t.resolve(c.__await).then((function(e){n(\"next\",e,s,u)}),(function(e){n(\"throw\",e,s,u)})):t.resolve(c).then((function(e){d.value=e,s(d)}),(function(e){return n(\"throw\",e,s,u)}))}u(l.arg)}var i;s(this,\"_invoke\",{value:function(e,r){function a(){return new t((function(t,i){n(e,r,t,i)}))}return i=i?i.then(a,a):a()}})}function P(e,n,r){var i=v;return function(a,o){if(i===g)throw new Error(\"Generator is already running\");if(i===b){if(\"throw\"===a)throw o;return{value:t,done:!0}}for(r.method=a,r.arg=o;;){var s=r.delegate;if(s){var u=x(s,r);if(u){if(u===y)continue;return u}}if(\"next\"===r.method)r.sent=r._sent=r.arg;else if(\"throw\"===r.method){if(i===v)throw i=b,r.arg;r.dispatchException(r.arg)}else\"return\"===r.method&&r.abrupt(\"return\",r.arg);i=g;var l=h(e,n,r);if(\"normal\"===l.type){if(i=r.done?b:m,l.arg===y)continue;return{value:l.arg,done:r.done}}\"throw\"===l.type&&(i=b,r.method=\"throw\",r.arg=l.arg)}}}function x(e,n){var r=n.method,i=e.iterator[r];if(i===t)return n.delegate=null,\"throw\"===r&&e.iterator.return&&(n.method=\"return\",n.arg=t,x(e,n),\"throw\"===n.method)||\"return\"!==r&&(n.method=\"throw\",n.arg=new TypeError(\"The iterator does not provide a '\"+r+\"' method\")),y;var a=h(i,e.iterator,n.arg);if(\"throw\"===a.type)return n.method=\"throw\",n.arg=a.arg,n.delegate=null,y;var o=a.arg;return o?o.done?(n[e.resultName]=o.value,n.next=e.nextLoc,\"return\"!==n.method&&(n.method=\"next\",n.arg=t),n.delegate=null,y):o:(n.method=\"throw\",n.arg=new TypeError(\"iterator result is not an object\"),n.delegate=null,y)}function C(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function M(e){var t=e.completion||{};t.type=\"normal\",delete t.arg,e.completion=t}function O(e){this.tryEntries=[{tryLoc:\"root\"}],e.forEach(C,this),this.reset(!0)}function D(e){if(e||\"\"===e){var n=e[l];if(n)return n.call(e);if(\"function\"==typeof e.next)return e;if(!isNaN(e.length)){var i=-1,a=function n(){for(;++i<e.length;)if(o.call(e,i))return n.value=e[i],n.done=!1,n;return n.value=t,n.done=!0,n};return a.next=a}}throw new TypeError(r(e)+\" is not iterable\")}return _.prototype=E,s(I,\"constructor\",{value:E,configurable:!0}),s(E,\"constructor\",{value:_,configurable:!0}),_.displayName=f(E,c,\"GeneratorFunction\"),n.isGeneratorFunction=function(e){var t=\"function\"==typeof e&&e.constructor;return!!t&&(t===_||\"GeneratorFunction\"===(t.displayName||t.name))},n.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,E):(e.__proto__=E,f(e,c,\"GeneratorFunction\")),e.prototype=Object.create(I),e},n.awrap=function(e){return{__await:e}},k(R.prototype),f(R.prototype,d,(function(){return this})),n.AsyncIterator=R,n.async=function(e,t,r,i,a){void 0===a&&(a=Promise);var o=new R(p(e,t,r,i),a);return n.isGeneratorFunction(t)?o:o.next().then((function(e){return e.done?e.value:o.next()}))},k(I),f(I,c,\"Generator\"),f(I,l,(function(){return this})),f(I,\"toString\",(function(){return\"[object Generator]\"})),n.keys=function(e){var t=Object(e),n=[];for(var r in t)n.push(r);return n.reverse(),function e(){for(;n.length;){var r=n.pop();if(r in t)return e.value=r,e.done=!1,e}return e.done=!0,e}},n.values=D,O.prototype={constructor:O,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method=\"next\",this.arg=t,this.tryEntries.forEach(M),!e)for(var n in this)\"t\"===n.charAt(0)&&o.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=t)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if(\"throw\"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var n=this;function r(r,i){return s.type=\"throw\",s.arg=e,n.next=r,i&&(n.method=\"next\",n.arg=t),!!i}for(var i=this.tryEntries.length-1;i>=0;--i){var a=this.tryEntries[i],s=a.completion;if(\"root\"===a.tryLoc)return r(\"end\");if(a.tryLoc<=this.prev){var u=o.call(a,\"catchLoc\"),l=o.call(a,\"finallyLoc\");if(u&&l){if(this.prev<a.catchLoc)return r(a.catchLoc,!0);if(this.prev<a.finallyLoc)return r(a.finallyLoc)}else if(u){if(this.prev<a.catchLoc)return r(a.catchLoc,!0)}else{if(!l)throw new Error(\"try statement without catch or finally\");if(this.prev<a.finallyLoc)return r(a.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc<=this.prev&&o.call(r,\"finallyLoc\")&&this.prev<r.finallyLoc){var i=r;break}}i&&(\"break\"===e||\"continue\"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var a=i?i.completion:{};return a.type=e,a.arg=t,i?(this.method=\"next\",this.next=i.finallyLoc,y):this.complete(a)},complete:function(e,t){if(\"throw\"===e.type)throw e.arg;return\"break\"===e.type||\"continue\"===e.type?this.next=e.arg:\"return\"===e.type?(this.rval=this.arg=e.arg,this.method=\"return\",this.next=\"end\"):\"normal\"===e.type&&t&&(this.next=t),y},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),M(n),y}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var r=n.completion;if(\"throw\"===r.type){var i=r.arg;M(n)}return i}}throw new Error(\"illegal catch attempt\")},delegateYield:function(e,n,r){return this.delegate={iterator:D(e),resultName:n,nextLoc:r},\"next\"===this.method&&(this.arg=t),y}},n}e.exports=i,e.exports.__esModule=!0,e.exports.default=e.exports},738:function(e){function t(n){return e.exports=t=\"function\"==typeof Symbol&&\"symbol\"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&\"function\"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?\"symbol\":typeof e},e.exports.__esModule=!0,e.exports.default=e.exports,t(n)}e.exports=t,e.exports.__esModule=!0,e.exports.default=e.exports},756:function(e,t,n){var r=n(633)();e.exports=r;try{regeneratorRuntime=r}catch(e){\"object\"==typeof globalThis?globalThis.regeneratorRuntime=r:Function(\"r\",\"regeneratorRuntime = r\")(r)}}},t={};function n(r){var i=t[r];if(void 0!==i)return i.exports;var a=t[r]={exports:{}};return e[r](a,a.exports,n),a.exports}n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,{a:t}),t},n.d=function(e,t){for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.g=function(){if(\"object\"==typeof globalThis)return globalThis;try{return this||new Function(\"return this\")()}catch(e){if(\"object\"==typeof window)return window}}(),n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},function(){\"use strict\";function e(t,n){return e=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(e,t){return e.__proto__=t,e},e(t,n)}function t(n,r,i){return t=function(){if(\"undefined\"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if(\"function\"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}()?Reflect.construct.bind():function(t,n,r){var i=[null];i.push.apply(i,n);var a=new(Function.bind.apply(t,i));return r&&e(a,r.prototype),a},t.apply(null,arguments)}var r={DEFAULT_REQUEST_TIMEOUT:3e4,DEFAULT_CONNECTION_TIMEOUT:15e3,DEFAULT_TEXT_TRACK_MODE:\"native\",DEFAULT_ENABLE_FAST_SWITCHING:!0,DELTA_POSITION_AFTER_RELOAD:{bitrateSwitch:-.1,trackSwitch:{audio:0,video:0,other:0}},DEFAULT_CODEC_SWITCHING_BEHAVIOR:\"continue\",DEFAULT_AUTO_PLAY:!1,DEFAULT_WANTED_BUFFER_AHEAD:30,DEFAULT_MAX_BUFFER_AHEAD:1/0,DEFAULT_MAX_BUFFER_BEHIND:1/0,DEFAULT_MAX_VIDEO_BUFFER_SIZE:1/0,MAXIMUM_MAX_BUFFER_AHEAD:{text:18e3},MINIMUM_MAX_BUFFER_AHEAD:{text:120},MAXIMUM_MAX_BUFFER_BEHIND:{text:18e3},DEFAULT_BASE_BANDWIDTH:0,INACTIVITY_DELAY:6e4,DEFAULT_THROTTLE_VIDEO_BITRATE_WHEN_HIDDEN:!1,DEFAULT_VIDEO_RESOLUTION_LIMIT:\"none\",DEFAULT_LIVE_GAP:{DEFAULT:10,LOW_LATENCY:3.5},BUFFER_DISCONTINUITY_THRESHOLD:.2,BITRATE_REBUFFERING_RATIO:1.5,DEFAULT_MAX_MANIFEST_REQUEST_RETRY:4,DEFAULT_CDN_DOWNGRADE_TIME:60,DEFAULT_MAX_REQUESTS_RETRY_ON_ERROR:4,INITIAL_BACKOFF_DELAY_BASE:{REGULAR:200,LOW_LATENCY:50},MAX_BACKOFF_DELAY_BASE:{REGULAR:3e3,LOW_LATENCY:1e3},SAMPLING_INTERVAL_MEDIASOURCE:1e3,SAMPLING_INTERVAL_LOW_LATENCY:500,SAMPLING_INTERVAL_NO_MEDIASOURCE:500,ABR_ENTER_BUFFER_BASED_ALGO:10,ABR_EXIT_BUFFER_BASED_ALGO:5,ABR_MINIMUM_TOTAL_BYTES:15e4,ABR_MINIMUM_CHUNK_SIZE:16e3,ABR_STARVATION_FACTOR:{DEFAULT:.72,LOW_LATENCY:.72},ABR_REGULAR_FACTOR:{DEFAULT:.72,LOW_LATENCY:.72},ABR_STARVATION_GAP:{DEFAULT:5,LOW_LATENCY:5},OUT_OF_STARVATION_GAP:{DEFAULT:7,LOW_LATENCY:7},ABR_STARVATION_DURATION_DELTA:.1,ABR_FAST_EMA:2,ABR_SLOW_EMA:10,RESUME_GAP_AFTER_SEEKING:{DEFAULT:1.5,LOW_LATENCY:.5},RESUME_GAP_AFTER_NOT_ENOUGH_DATA:{DEFAULT:.5,LOW_LATENCY:.5},RESUME_GAP_AFTER_BUFFERING:{DEFAULT:5,LOW_LATENCY:.5},REBUFFERING_GAP:{DEFAULT:.5,LOW_LATENCY:.2},MINIMUM_BUFFER_AMOUNT_BEFORE_FREEZING:2,UNFREEZING_SEEK_DELAY:6e3,FREEZING_STALLED_DELAY:600,UNFREEZING_DELTA_POSITION:.001,SEGMENT_SYNCHRONIZATION_DELAY:1500,MISSING_DATA_TRIGGER_SYNC_DELAY:.1,MAX_TIME_MISSING_FROM_COMPLETE_SEGMENT:.15,MAX_MANIFEST_BUFFERED_START_END_DIFFERENCE:.4,MAX_MANIFEST_BUFFERED_DURATION_DIFFERENCE:.3,MINIMUM_SEGMENT_SIZE:.005,APPEND_WINDOW_SECURITIES:{START:.2,END:.1},MAXIMUM_HTML_TEXT_TRACK_UPDATE_INTERVAL:50,TEXT_TRACK_SIZE_CHECKS_INTERVAL:250,BUFFER_PADDING:{audio:1,video:3,other:1},SEGMENT_PRIORITIES_STEPS:[2,4,8,12,18,25],MAX_HIGH_PRIORITY_LEVEL:1,MIN_CANCELABLE_PRIORITY:3,EME_DEFAULT_VIDEO_CODECS:['video/mp4;codecs=\"avc1.4d401e\"','video/mp4;codecs=\"avc1.42e01e\"','video/webm;codecs=\"vp8\"'],EME_DEFAULT_AUDIO_CODECS:['audio/mp4;codecs=\"mp4a.40.2\"',\"audio/webm;codecs=opus\"],EME_DEFAULT_WIDEVINE_ROBUSTNESSES:[\"HW_SECURE_ALL\",\"HW_SECURE_DECODE\",\"HW_SECURE_CRYPTO\",\"SW_SECURE_DECODE\",\"SW_SECURE_CRYPTO\"],EME_DEFAULT_PLAYREADY_RECOMMENDATION_ROBUSTNESSES:[\"3000\",\"2000\"],EME_KEY_SYSTEMS:{clearkey:[\"webkit-org.w3.clearkey\",\"org.w3.clearkey\"],widevine:[\"com.widevine.alpha\"],playready:[\"com.microsoft.playready.recommendation\",\"com.microsoft.playready\",\"com.chromecast.playready\",\"com.youtube.playready\"],fairplay:[\"com.apple.fps.1_0\"]},MAX_CONSECUTIVE_MANIFEST_PARSING_IN_UNSAFE_MODE:10,MIN_MANIFEST_PARSING_TIME_TO_ENTER_UNSAFE_MODE:200,MIN_DASH_S_ELEMENTS_TO_PARSE_UNSAFELY:300,OUT_OF_SYNC_MANIFEST_REFRESH_DELAY:3e3,FAILED_PARTIAL_UPDATE_MANIFEST_REFRESH_DELAY:3e3,DASH_FALLBACK_LIFETIME_WHEN_MINIMUM_UPDATE_PERIOD_EQUAL_0:3,EME_DEFAULT_MAX_SIMULTANEOUS_MEDIA_KEY_SESSIONS:15,EME_MAX_STORED_PERSISTENT_SESSION_INFORMATION:1e3,EME_WAITING_DELAY_LOADED_SESSION_EMPTY_KEYSTATUSES:100,FORCED_ENDED_THRESHOLD:8e-4,ADAP_REP_SWITCH_BUFFER_PADDINGS:{video:{before:5,after:5},audio:{before:2,after:2.5},text:{before:0,after:0}},SOURCE_BUFFER_FLUSHING_INTERVAL:500,CONTENT_REPLACEMENT_PADDING:1.2,CACHE_LOAD_DURATION_THRESHOLDS:{video:50,audio:10},STREAM_EVENT_EMITTER_POLL_INTERVAL:250,DEFAULT_MAXIMUM_TIME_ROUNDING_ERROR:.001,BUFFERED_HISTORY_RETENTION_TIME:6e4,BUFFERED_HISTORY_MAXIMUM_ENTRIES:200,MIN_BUFFER_AHEAD:5,UPTO_CURRENT_POSITION_CLEANUP:5,DEFAULT_VIDEO_REPRESENTATIONS_SWITCHING_MODE:\"seamless\",DEFAULT_AUDIO_REPRESENTATIONS_SWITCHING_MODE:\"seamless\",DEFAULT_VIDEO_TRACK_SWITCHING_MODE:\"reload\",DEFAULT_AUDIO_TRACK_SWITCHING_MODE:\"seamless\"};var i=\"function\"==typeof Object.assign?Object.assign:function(e){if(null==e)throw new TypeError(\"Cannot convert undefined or null to object\");for(var t=Object(e),n=0;n<(arguments.length<=1?0:arguments.length-1);n++){var r=n+1<1||arguments.length<=n+1?void 0:arguments[n+1];for(var i in r)Object.prototype.hasOwnProperty.call(r,i)&&(t[i]=r[i])}return t};function a(e){return null!=e&&!Array.isArray(e)&&\"object\"==typeof e}function o(e){for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];if(0===n.length)return e;var s=n.shift();if(a(e)&&a(s))for(var u in s)if(a(s[u])){var l=e[u];void 0===l&&(l={},e[u]=l),o(l,s[u])}else{var d;i(e,((d={})[u]=s[u],d))}return o.apply(void 0,[e].concat(n))}var s=new(function(){function e(){this._config=r}var t=e.prototype;return t.update=function(e){var t=o(this._config,e);this._config=t},t.getCurrent=function(){return this._config},e}());function u(e){if(void 0===e)throw new ReferenceError(\"this hasn't been initialised - super() hasn't been called\");return e}function l(t,n){t.prototype=Object.create(n.prototype),t.prototype.constructor=t,e(t,n)}function d(e){return d=Object.setPrototypeOf?Object.getPrototypeOf.bind():function(e){return e.__proto__||Object.getPrototypeOf(e)},d(e)}function c(n){var r=\"function\"==typeof Map?new Map:void 0;return c=function(n){if(null===n||!function(e){try{return-1!==Function.toString.call(e).indexOf(\"[native code]\")}catch(t){return\"function\"==typeof e}}(n))return n;if(\"function\"!=typeof n)throw new TypeError(\"Super expression must either be null or a function\");if(void 0!==r){if(r.has(n))return r.get(n);r.set(n,i)}function i(){return t(n,arguments,d(this).constructor)}return i.prototype=Object.create(n.prototype,{constructor:{value:i,enumerable:!1,writable:!0,configurable:!0}}),e(i,n)},c(n)}var f=function(e){function t(n,r,i){var a;switch(a=e.call(this)||this,Object.setPrototypeOf(u(a),t.prototype),a.name=\"RequestError\",a.url=n,a.status=r,a.type=i,i){case\"TIMEOUT\":a.message=\"The request timed out\";break;case\"ERROR_EVENT\":a.message=\"An error prevented the request to be performed successfully\";break;case\"PARSE_ERROR\":a.message=\"An error happened while formatting the response data\";break;case\"ERROR_HTTP_CODE\":a.message=\"An HTTP status code indicating failure was received: \"+String(a.status)}return a}return l(t,e),t.prototype.serialize=function(){return{url:this.url,status:this.status,type:this.type}},t}(c(Error)),p={TIMEOUT:\"TIMEOUT\",ERROR_EVENT:\"ERROR_EVENT\",ERROR_HTTP_CODE:\"ERROR_HTTP_CODE\",PARSE_ERROR:\"PARSE_ERROR\"},h=p,v={NETWORK_ERROR:\"NETWORK_ERROR\",MEDIA_ERROR:\"MEDIA_ERROR\",ENCRYPTED_MEDIA_ERROR:\"ENCRYPTED_MEDIA_ERROR\",OTHER_ERROR:\"OTHER_ERROR\"};function m(e,t){return e+\": \"+t}var g=function(e){function t(n,r){var i;return i=e.call(this)||this,Object.setPrototypeOf(u(i),t.prototype),i.name=\"OtherError\",i.type=v.OTHER_ERROR,i.code=n,i.message=m(i.code,r),i.fatal=!1,i._originalMessage=r,i}return l(t,e),t.prototype.serialize=function(){return{name:this.name,code:this.code,reason:this._originalMessage}},t}(c(Error)),b=function(e){function t(n,r,i){var a;return a=e.call(this)||this,Object.setPrototypeOf(u(a),t.prototype),a.name=\"MediaError\",a.type=v.MEDIA_ERROR,a._originalMessage=r,a.code=n,a.message=m(a.code,r),a.fatal=!1,void 0!==(null==i?void 0:i.tracks)&&(null==i?void 0:i.tracks.length)>0&&(a.tracksInfo=i.tracks),a}return l(t,e),t.prototype.serialize=function(){return{name:this.name,code:this.code,reason:this._originalMessage,tracks:this.tracksInfo}},t}(c(Error)),y={dashParsers:{wasm:null,native:null,fastJs:null},codecSupportProber:null,createDebugElement:null,directfile:null,decrypt:null,htmlTextDisplayer:null,htmlTextTracksParsers:{},mainThreadMediaSourceInit:null,multithread:null,nativeTextDisplayer:null,nativeTextTracksParsers:{},transports:{}};function S(e){return null==e}var _=function(){function e(){this._listeners={}}var t=e.prototype;return t.addEventListener=function(e,t,n){var r=this,i=this._listeners[e];Array.isArray(i)?i.push(t):this._listeners[e]=[t],void 0!==n&&n.register((function(){r.removeEventListener(e,t)}))},t.removeEventListener=function(e,t){if(S(e))this._listeners={};else{var n=this._listeners[e];if(Array.isArray(n))if(S(t))delete this._listeners[e];else{var r=n.indexOf(t);-1!==r&&n.splice(r,1),0===n.length&&delete this._listeners[e]}}},t.trigger=function(e,t){var n=this._listeners[e];Array.isArray(n)&&n.slice().forEach((function(e){try{e(t)}catch(e){0,console.error(\"RxPlayer: EventEmitter error\",e instanceof Error?e:null)}}))},e}();function E(){}var w=function(e){function t(){var t;return(t=e.call(this)||this).error=E,t.warn=E,t.info=E,t.debug=E,t._levels={NONE:0,ERROR:1,WARNING:2,INFO:3,DEBUG:4},t._currentLevel=\"NONE\",t}l(t,e);var n=t.prototype;return n.setLevel=function(e,t){var n,r=this._levels[e];\"number\"==typeof r?(n=r,this._currentLevel=e):(n=0,this._currentLevel=\"NONE\"),void 0===t?(this.error=n>=this._levels.ERROR?console.error.bind(console):E,this.warn=n>=this._levels.WARNING?console.warn.bind(console):E,this.info=n>=this._levels.INFO?console.info.bind(console):E,this.debug=n>=this._levels.DEBUG?console.log.bind(console):E):(this.error=n>=this._levels.ERROR?function(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return t(\"ERROR\",n)}:E,this.warn=n>=this._levels.WARNING?function(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return t(\"WARNING\",n)}:E,this.info=n>=this._levels.INFO?function(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return t(\"INFO\",n)}:E,this.debug=n>=this._levels.DEBUG?function(){for(var e=arguments.length,n=new Array(e),r=0;r<e;r++)n[r]=arguments[r];return t(\"DEBUG\",n)}:E),this.trigger(\"onLogLevelChange\",this._currentLevel)},n.getLevel=function(){return this._currentLevel},n.hasLevel=function(e){return this._levels[e]>=this._levels[this._currentLevel]},t}(_),T=new w;function A(e,t,n){if(\"function\"==typeof Array.prototype.find)return e.find(t,n);for(var r=e.length>>>0,i=0;i<r;i++){var a=e[i];if(t.call(n,a,i,e))return a}}function I(){var e=\"\",t=-1;return function(){return++t>=Number.MAX_SAFE_INTEGER&&(e+=\"0\",t=0),e+String(t)}}function k(e,t,n){if(\"function\"==typeof Array.prototype.includes)return e.includes(t,n);var r=e.length>>>0;if(0===r)return!1;for(var i,a,o=0|n,s=o>=0?Math.min(o,r-1):Math.max(r+o,0);s<r;){if((i=e[s])===(a=t)||\"number\"==typeof i&&\"number\"==typeof a&&isNaN(i)&&isNaN(a))return!0;s++}return!1}var R=[];function P(e){k(R,e)||(console.warn(e),R.push(e))}function x(e,t,n){if(\"function\"==typeof Array.prototype.findIndex)return e.findIndex(t,n);for(var r=e.length>>>0,i=0;i<r;i++)if(t.call(n,e[i],i,e))return i;return-1}function C(e,t){var n=\"undefined\"!=typeof Symbol&&e[Symbol.iterator]||e[\"@@iterator\"];if(n)return(n=n.call(e)).next.bind(n);if(Array.isArray(e)||(n=function(e,t){if(!e)return;if(\"string\"==typeof e)return M(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);\"Object\"===n&&e.constructor&&(n=e.constructor.name);if(\"Map\"===n||\"Set\"===n)return Array.from(e);if(\"Arguments\"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return M(e,t)}(e))||t&&e&&\"number\"==typeof e.length){n&&(e=n);var r=0;return function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}}}throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\")}function M(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var O=function(){function e(e,t){var n=this;this._value=e,this._listeners=[],this._isFinished=!1,this._onFinishCbs=[],void 0!==t&&(this._deregisterCancellation=t.register((function(){return n.finish()})))}var t=e.prototype;return t.getValue=function(){return this._value},t.setValue=function(e){if(!this._isFinished&&(this._value=e,0!==this._listeners.length))for(var t,n=C(this._listeners.slice());!(t=n()).done;){var r=t.value;try{r.hasBeenCleared||r.trigger(e,r.complete)}catch(e){}}},t.setValueIfChanged=function(e){e!==this._value&&this.setValue(e)},t.onUpdate=function(e,t){var n=this,r=function e(){if(void 0!==(null==t?void 0:t.clearSignal)&&t.clearSignal.deregister(e),!i.hasBeenCleared){i.hasBeenCleared=!0;var r=n._listeners.indexOf(i);r>=0&&n._listeners.splice(r,1)}},i={trigger:e,complete:r,hasBeenCleared:!1};this._listeners.push(i),!0===(null==t?void 0:t.emitCurrentValue)&&e(this._value,r),this._isFinished||i.hasBeenCleared?r():void 0!==(null==t?void 0:t.clearSignal)&&t.clearSignal.register(r)},t.waitUntilDefined=function(e,t){var n=this;this.onUpdate((function(t,r){void 0!==t&&(r(),e(n._value))}),{clearSignal:null==t?void 0:t.clearSignal,emitCurrentValue:!0})},t._onFinished=function(e,t){var n=this;if(t.isCancelled())return E;var r=function(){var e=x(n._onFinishCbs,(function(e){return e.trigger===i}));e>=0&&(n._onFinishCbs[e].hasBeenCleared=!0,n._onFinishCbs.splice(e,1))},i=function(){r(),e()},a=t.register(r);return this._onFinishCbs.push({trigger:i,hasBeenCleared:!1}),a},t.finish=function(){void 0!==this._deregisterCancellation&&this._deregisterCancellation(),this._isFinished=!0;for(var e,t=C(this._listeners.slice());!(e=t()).done;){var n=e.value;try{n.hasBeenCleared||(n.complete(),n.hasBeenCleared=!0)}catch(e){}}if(this._listeners.length=0,this._onFinishCbs.length>0){for(var r,i=C(this._onFinishCbs.slice());!(r=i()).done;){var a=r.value;try{a.hasBeenCleared||(a.trigger(),a.hasBeenCleared=!0)}catch(e){}}this._onFinishCbs.length=0}},e}();function D(e,t,n){var r=new O(t(e.getValue()),n);return e.onUpdate((function(e){r.setValue(t(e))}),{clearSignal:n}),e._onFinished((function(){r.finish()}),n),r}var N=O,U=new N(0);var L=\"undefined\"!=typeof performance?function(){return performance.now()+U.getValue()}:function(){return Date.now()+U.getValue()};function F(e){return Object.keys(e).map((function(t){return e[t]}))}var B=\"function\"==typeof Object.values?Object.values:F;var z=[\"audio\",\"video\",\"text\"];function W(e,t,n){return t>=e.start&&(void 0===e.end||t<e.end)||t===e.end&&(null===n||n.start>e.end)}function V(e){return F(e.adaptations).reduce((function(e,t){return S(t)?e:e.concat(t)}),[])}function j(e,t){var n,r,i={language:null!==(n=e.language)&&void 0!==n?n:\"\",normalized:null!==(r=e.normalizedLanguage)&&void 0!==r?r:\"\",audioDescription:!0===e.isAudioDescription,id:e.id,representations:(t?e.representations.filter((function(e){return!0===e.isSupported&&!1!==e.decipherable})):e.representations).map(q),label:e.label};return!0===e.isDub&&(i.dub=!0),i}function G(e){var t,n;return{language:null!==(t=e.language)&&void 0!==t?t:\"\",normalized:null!==(n=e.normalizedLanguage)&&void 0!==n?n:\"\",closedCaption:!0===e.isClosedCaption,id:e.id,label:e.label,forced:e.isForcedSubtitles}}function H(e,t){var n=void 0!==e.trickModeTracks?e.trickModeTracks.map((function(e){var n=(t?e.representations.filter((function(e){return!0===e.isSupported&&!1!==e.decipherable})):e.representations).map(K),r={id:e.id,representations:n,isTrickModeTrack:!0};return!0===e.isSignInterpreted&&(r.signInterpreted=!0),r})):void 0,r={id:e.id,representations:(t?e.representations.filter((function(e){return!0===e.isSupported&&!1!==e.decipherable})):e.representations).map(K),label:e.label};return!0===e.isSignInterpreted&&(r.signInterpreted=!0),!0===e.isTrickModeTrack&&(r.isTrickModeTrack=!0),void 0!==n&&(r.trickModeTracks=n),r}function q(e){var t=e.id,n=e.bitrate,r=e.codecs,i=e.isSpatialAudio,a=e.isSupported,o=e.decipherable;return{id:t,bitrate:n,codec:null==r?void 0:r[0],isSpatialAudio:i,isCodecSupported:a,decipherable:o}}function K(e){var t=e.id,n=e.bitrate,r=e.frameRate,i=e.width,a=e.height,o=e.codecs,s=e.hdrInfo,u=e.isSupported,l=e.decipherable;return{id:t,bitrate:n,frameRate:r,width:i,height:a,codec:null==o?void 0:o[0],hdrInfo:s,isCodecSupported:u,decipherable:l}}function Y(e){switch(e.type){case\"audio\":return{type:\"audio\",track:j(e,!1)};case\"video\":return{type:\"video\",track:H(e,!1)};case\"text\":return{type:\"text\",track:G(e)}}}function Q(e){return\"string\"==typeof e&&e.length>0}var X={aa:\"aar\",ab:\"abk\",ae:\"ave\",af:\"afr\",ak:\"aka\",am:\"amh\",an:\"arg\",ar:\"ara\",as:\"asm\",av:\"ava\",ay:\"aym\",az:\"aze\",ba:\"bak\",be:\"bel\",bg:\"bul\",bi:\"bis\",bm:\"bam\",bn:\"ben\",bo:\"bod\",br:\"bre\",bs:\"bos\",ca:\"cat\",ce:\"che\",ch:\"cha\",co:\"cos\",cr:\"cre\",cs:\"ces\",cu:\"chu\",cv:\"chv\",cy:\"cym\",da:\"dan\",de:\"deu\",dv:\"div\",dz:\"dzo\",ee:\"ewe\",el:\"ell\",en:\"eng\",eo:\"epo\",es:\"spa\",et:\"est\",eu:\"eus\",fa:\"fas\",ff:\"ful\",fi:\"fin\",fj:\"fij\",fo:\"fao\",fr:\"fra\",fy:\"fry\",ga:\"gle\",gd:\"gla\",gl:\"glg\",gn:\"grn\",gu:\"guj\",gv:\"glv\",ha:\"hau\",he:\"heb\",hi:\"hin\",ho:\"hmo\",hr:\"hrv\",ht:\"hat\",hu:\"hun\",hy:\"hye\",hz:\"her\",ia:\"ina\",id:\"ind\",ie:\"ile\",ig:\"ibo\",ii:\"iii\",ik:\"ipk\",io:\"ido\",is:\"isl\",it:\"ita\",iu:\"iku\",ja:\"jpn\",jv:\"jav\",ka:\"kat\",kg:\"kon\",ki:\"kik\",kj:\"kua\",kk:\"kaz\",kl:\"kal\",km:\"khm\",kn:\"kan\",ko:\"kor\",kr:\"kau\",ks:\"kas\",ku:\"kur\",kv:\"kom\",kw:\"cor\",ky:\"kir\",la:\"lat\",lb:\"ltz\",lg:\"lug\",li:\"lim\",ln:\"lin\",lo:\"lao\",lt:\"lit\",lu:\"lub\",lv:\"lav\",mg:\"mlg\",mh:\"mah\",mi:\"mri\",mk:\"mkd\",ml:\"mal\",mn:\"mon\",mr:\"mar\",ms:\"msa\",mt:\"mlt\",my:\"mya\",na:\"nau\",nb:\"nob\",nd:\"nde\",ne:\"nep\",ng:\"ndo\",nl:\"nld\",nn:\"nno\",no:\"nor\",nr:\"nbl\",nv:\"nav\",ny:\"nya\",oc:\"oci\",oj:\"oji\",om:\"orm\",or:\"ori\",os:\"oss\",pa:\"pan\",pi:\"pli\",pl:\"pol\",ps:\"pus\",pt:\"por\",qu:\"que\",rm:\"roh\",rn:\"run\",ro:\"ron\",ru:\"rus\",rw:\"kin\",sa:\"san\",sc:\"srd\",sd:\"snd\",se:\"sme\",sg:\"sag\",si:\"sin\",sk:\"slk\",sl:\"slv\",sm:\"smo\",sn:\"sna\",so:\"som\",sq:\"sqi\",sr:\"srp\",ss:\"ssw\",st:\"sot\",su:\"sun\",sv:\"swe\",sw:\"swa\",ta:\"tam\",te:\"tel\",tg:\"tgk\",th:\"tha\",ti:\"tir\",tk:\"tuk\",tl:\"tgl\",tn:\"tsn\",to:\"ton\",tr:\"tur\",ts:\"tso\",tt:\"tat\",tw:\"twi\",ty:\"tah\",ug:\"uig\",uk:\"ukr\",ur:\"urd\",uz:\"uzb\",ve:\"ven\",vi:\"vie\",vo:\"vol\",wa:\"wln\",wo:\"wol\",xh:\"xho\",yi:\"yid\",yo:\"yor\",za:\"zha\",zh:\"zho\",zu:\"zul\"},$={alb:\"sqi\",arm:\"hye\",baq:\"eus\",bur:\"mya\",chi:\"zho\",cze:\"ces\",dut:\"nld\",fre:\"fra\",geo:\"kat\",ger:\"deu\",gre:\"ell\",ice:\"isl\",mac:\"mkd\",mao:\"mri\",may:\"msa\",per:\"fas\",slo:\"slk\",rum:\"ron\",tib:\"bod\",wel:\"cym\"};function Z(e){if(S(e)||\"\"===e)return\"\";var t=function(e){var t;switch(e.length){case 2:t=X[e];break;case 3:t=$[e]}return t}((\"\"+e).toLowerCase().split(\"-\")[0]);return Q(t)?t:e}var J=Z;function ee(e,t){if(e.length!==t.length)return!1;if(e===t)return!0;for(var n=e.length-1;n>=0;n--)if(e[n]!==t[n])return!1;return!0}function te(e,t){var n=\"undefined\"!=typeof Symbol&&e[Symbol.iterator]||e[\"@@iterator\"];if(n)return(n=n.call(e)).next.bind(n);if(Array.isArray(e)||(n=function(e,t){if(!e)return;if(\"string\"==typeof e)return ne(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);\"Object\"===n&&e.constructor&&(n=e.constructor.name);if(\"Map\"===n||\"Set\"===n)return Array.from(e);if(\"Arguments\"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ne(e,t)}(e))||t&&e&&\"number\"==typeof e.length){n&&(e=n);var r=0;return function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}}}throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\")}function ne(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var re=I(),ie=function(){function e(e,t){var n,r,i,a,o;if(this.id=e.id,this.uniqueId=re(),this.bitrate=e.bitrate,this.codecs=[],void 0!==e.isSpatialAudio&&(this.isSpatialAudio=e.isSpatialAudio),void 0!==e.height&&(this.height=e.height),void 0!==e.width&&(this.width=e.width),void 0!==e.mimeType&&(this.mimeType=e.mimeType),void 0!==e.contentProtections&&(this.contentProtections=e.contentProtections),void 0!==e.frameRate&&(this.frameRate=e.frameRate),void 0!==e.hdrInfo&&(this.hdrInfo=e.hdrInfo),this.cdnMetadata=e.cdnMetadata,this.index=e.index,\"audio\"===t||\"video\"===t)if(null!==y.codecSupportProber){if(void 0!==e.supplementalCodecs){var s=y.codecSupportProber.isSupported(null!==(n=this.mimeType)&&void 0!==n?n:\"\",null!==(r=e.supplementalCodecs)&&void 0!==r?r:\"\");!1!==s&&(this.codecs=[e.supplementalCodecs],!0===s&&(this.isSupported=!0))}!0!==this.isSupported&&(this.codecs.length>0?this.codecs.push(null!==(i=e.codecs)&&void 0!==i?i:\"\"):(this.codecs=void 0===e.codecs?[]:[e.codecs],this.isSupported=y.codecSupportProber.isSupported(null!==(a=this.mimeType)&&void 0!==a?a:\"\",null!==(o=e.codecs)&&void 0!==o?o:\"\")))}else void 0!==e.supplementalCodecs&&this.codecs.push(e.supplementalCodecs),void 0!==e.codecs&&this.codecs.push(e.codecs);else void 0!==e.codecs&&this.codecs.push(e.codecs),this.isSupported=!0}var t=e.prototype;return t.refreshCodecSupport=function(e){var t,n=null!==(t=this.mimeType)&&void 0!==t?t:\"\",r=this.codecs;0===r.length&&(r=[\"\"]);for(var i=0;i<r.length;i++)for(var a,o=te(e);!(a=o()).done;){var s=a.value,u=r[i];if(s.codec===u&&s.mimeType===n){if(s.result)return this.isSupported=!0,void(this.codecs=[u]);if(i===r.length)return this.isSupported=!1,void(this.codecs=[u])}}},t.getMimeTypeString=function(){var e,t,n;return(null!==(e=this.mimeType)&&void 0!==e?e:\"\")+';codecs=\"'+(null!==(n=null===(t=this.codecs)||void 0===t?void 0:t[0])&&void 0!==n?n:\"\")+'\"'},t.getEncryptionData=function(e){for(var t,n,r=this.getAllEncryptionData(),i=[],a=0;a<r.length;a++)for(var o=!1,s=r[a],u=0;u<s.values.length;u++)if(s.values[u].systemId.toLowerCase()===e.toLowerCase())if(o)i[i.length-1].values.push(s.values[u]);else{var l=null===(n=null===(t=this.contentProtections)||void 0===t?void 0:t.keyIds)||void 0===n?void 0:n.map((function(e){return e.keyId}));i.push({type:s.type,keyIds:l,values:[s.values[u]]}),o=!0}return i},t.getAllEncryptionData=function(){var e,t;if(void 0===this.contentProtections||0===this.contentProtections.initData.length)return[];var n=null===(t=null===(e=this.contentProtections)||void 0===e?void 0:e.keyIds)||void 0===t?void 0:t.map((function(e){return e.keyId}));return this.contentProtections.initData.map((function(e){return{type:e.type,keyIds:n,values:e.values}}))},t.addProtectionData=function(e,t,n){var r=!1;if(void 0===this.contentProtections)return this.contentProtections={keyIds:void 0!==t?[{keyId:t}]:[],initData:[{type:e,values:n}]},!0;if(void 0!==t){var i=this.contentProtections.keyIds;if(void 0===i)this.contentProtections.keyIds=[{keyId:t}];else{for(var a,o=!1,s=te(i);!(a=s()).done;){ee(a.value.keyId,t)&&(o=!0)}o||(T.warn(\"Manifest: found unanounced key id.\"),i.push({keyId:t}))}}for(var u=this.contentProtections.initData,l=0;l<u.length;l++)if(u[l].type===e){for(var d=u[l].values,c=0;c<n.length;c++){var f=n[c],p=void 0;for(p=0;p<d.length;p++)if(f.systemId===d[p].systemId){if(ee(f.data,d[p].data))break;T.warn(\"Manifest: different init data for the same system ID\")}p===d.length&&(d.push(f),r=!0)}return r}return this.contentProtections.initData.push({type:e,values:n}),!0},t.getMetadataSnapshot=function(){return{id:this.id,uniqueId:this.uniqueId,bitrate:this.bitrate,codecs:this.codecs,mimeType:this.mimeType,width:this.width,height:this.height,frameRate:this.frameRate,isSupported:this.isSupported,hdrInfo:this.hdrInfo,contentProtections:this.contentProtections,decipherable:this.decipherable}},e}(),ae=ie;function oe(e,t){var n=\"undefined\"!=typeof Symbol&&e[Symbol.iterator]||e[\"@@iterator\"];if(n)return(n=n.call(e)).next.bind(n);if(Array.isArray(e)||(n=function(e,t){if(!e)return;if(\"string\"==typeof e)return se(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);\"Object\"===n&&e.constructor&&(n=e.constructor.name);if(\"Map\"===n||\"Set\"===n)return Array.from(e);if(\"Arguments\"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return se(e,t)}(e))||t&&e&&\"number\"==typeof e.length){n&&(e=n);var r=0;return function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}}}throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\")}function se(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var ue=function(){function e(t,n){void 0===n&&(n={});var r=t.trickModeTracks,i=n,a=i.representationFilter,o=i.isManuallyAdded;this.id=t.id,this.type=t.type,void 0!==t.isTrickModeTrack&&(this.isTrickModeTrack=t.isTrickModeTrack),void 0!==t.language&&(this.language=t.language,this.normalizedLanguage=J(t.language)),void 0!==t.closedCaption&&(this.isClosedCaption=t.closedCaption),void 0!==t.audioDescription&&(this.isAudioDescription=t.audioDescription),void 0!==t.isDub&&(this.isDub=t.isDub),void 0!==t.forcedSubtitles&&(this.isForcedSubtitles=t.forcedSubtitles),void 0!==t.isSignInterpreted&&(this.isSignInterpreted=t.isSignInterpreted),void 0!==t.label&&(this.label=t.label),void 0!==r&&r.length>0&&(this.trickModeTracks=r.map((function(t){return new e(t)})));for(var s,u=t.representations,l=[],d=0;d<u.length;d++){var c=new ae(u[d],this.type),f=!0;if(!S(a)){var p={id:c.id,bitrate:c.bitrate,codecs:c.codecs,height:c.height,width:c.width,frameRate:c.frameRate,hdrInfo:c.hdrInfo};if(void 0!==c.contentProtections&&(p.contentProtections={},void 0!==c.contentProtections.keyIds)){var h=c.contentProtections.keyIds.map((function(e){return e.keyId}));p.contentProtections.keyIds=h}f=a(p,{trackType:this.type,language:this.language,normalizedLanguage:this.normalizedLanguage,isClosedCaption:this.isClosedCaption,isDub:this.isDub,isAudioDescription:this.isAudioDescription,isSignInterpreted:this.isSignInterpreted})}f?(l.push(c),void 0===s&&(!0===c.isSupported?s=!0:!1===c.isSupported&&(s=!1))):T.debug(\"Filtering Representation due to representationFilter\",this.type,\"Adaptation: \"+this.id,\"Representation: \"+c.id,\"(\"+c.bitrate+\")\")}l.sort((function(e,t){return e.bitrate-t.bitrate})),this.representations=l,this.isSupported=s,this.manuallyAdded=!0===o}var t=e.prototype;return t.refreshCodecSupport=function(e){for(var t,n=oe(this.representations);!(t=n()).done;){var r=t.value;void 0===r.isSupported&&(r.refreshCodecSupport(e),!0!==this.isSupported&&!0===r.isSupported?this.isSupported=!0:void 0===this.isSupported&&!1===r.isSupported&&(this.isSupported=!1))}},t.getRepresentation=function(e){return A(this.representations,(function(t){var n=t.id;return e===n}))},t.getMetadataSnapshot=function(){for(var e,t=[],n=oe(this.representations);!(e=n()).done;){var r=e.value;t.push(r.getMetadataSnapshot())}return{id:this.id,type:this.type,isSupported:this.isSupported,language:this.language,isForcedSubtitles:this.isForcedSubtitles,isClosedCaption:this.isClosedCaption,isAudioDescription:this.isAudioDescription,isSignInterpreted:this.isSignInterpreted,normalizedLanguage:this.normalizedLanguage,representations:t,label:this.label,isDub:this.isDub}},e}();function le(e,t){var n=\"undefined\"!=typeof Symbol&&e[Symbol.iterator]||e[\"@@iterator\"];if(n)return(n=n.call(e)).next.bind(n);if(Array.isArray(e)||(n=function(e,t){if(!e)return;if(\"string\"==typeof e)return de(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);\"Object\"===n&&e.constructor&&(n=e.constructor.name);if(\"Map\"===n||\"Set\"===n)return Array.from(e);if(\"Arguments\"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return de(e,t)}(e))||t&&e&&\"number\"==typeof e.length){n&&(e=n);var r=0;return function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}}}throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\")}function de(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var ce,fe=function(){function e(e,t,n){if(this.id=e.id,this.adaptations=Object.keys(e.adaptations).reduce((function(r,i){var a=e.adaptations[i];if(S(a))return r;var o=a.map((function(e){var r=new ue(e,{representationFilter:n});return r.representations.length>0&&!1===r.isSupported&&t.push(r),r})).filter((function(e){return e.representations.length>0}));if(o.every((function(e){return!1===e.isSupported}))&&a.length>0&&(\"video\"===i||\"audio\"===i))throw new b(\"MANIFEST_INCOMPATIBLE_CODECS_ERROR\",\"No supported \"+i+\" adaptations\",{tracks:void 0});return o.length>0&&(r[i]=o),r}),{}),!Array.isArray(this.adaptations.video)&&!Array.isArray(this.adaptations.audio))throw new b(\"MANIFEST_PARSE_ERROR\",\"No supported audio and video tracks.\");this.duration=e.duration,this.start=e.start,S(this.duration)||S(this.start)||(this.end=this.start+this.duration),this.streamEvents=void 0===e.streamEvents?[]:e.streamEvents}var t=e.prototype;return t.refreshCodecSupport=function(e,t){var n=this;Object.keys(this.adaptations).forEach((function(r){var i=n.adaptations[r];if(void 0!==i){for(var a,o=!1,s=le(i);!(a=s()).done;){var u=a.value,l=u.isSupported;u.refreshCodecSupport(e),!1!==l&&!1===u.isSupported&&t.push(u),!1===o?o=u.isSupported:void 0===o&&!0===u.isSupported&&(o=!0)}if((\"video\"===r||\"audio\"===r)&&!1===o)throw new b(\"MANIFEST_INCOMPATIBLE_CODECS_ERROR\",\"No supported \"+r+\" adaptations\",{tracks:void 0})}}),{})},t.getAdaptations=function(){return V(this)},t.getAdaptationsForType=function(e){var t=this.adaptations[e];return null!=t?t:[]},t.getAdaptation=function(e){return A(this.getAdaptations(),(function(t){var n=t.id;return e===n}))},t.getSupportedAdaptations=function(e){return function(e,t){if(void 0===t)return V(e).filter((function(e){return!0===e.isSupported}));var n=e.adaptations[t];return void 0===n?[]:n.filter((function(e){return!0===e.isSupported}))}(this,e)},t.containsTime=function(e,t){return W(this,e,t)},t.getMetadataSnapshot=function(){for(var e,t={},n=le(this.getAdaptations());!(e=n()).done;){var r=e.value,i=t[r.type];void 0===i&&(i=[],t[r.type]=i),i.push(r.getMetadataSnapshot())}return{start:this.start,end:this.end,id:this.id,streamEvents:this.streamEvents,adaptations:t}},e}();function pe(e,t){var n=\"undefined\"!=typeof Symbol&&e[Symbol.iterator]||e[\"@@iterator\"];if(n)return(n=n.call(e)).next.bind(n);if(Array.isArray(e)||(n=function(e,t){if(!e)return;if(\"string\"==typeof e)return he(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);\"Object\"===n&&e.constructor&&(n=e.constructor.name);if(\"Map\"===n||\"Set\"===n)return Array.from(e);if(\"Arguments\"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return he(e,t)}(e))||t&&e&&\"number\"==typeof e.length){n&&(e=n);var r=0;return function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}}}throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\")}function he(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function ve(e,t,n){var r={updatedAdaptations:[],removedAdaptations:[],addedAdaptations:[]};e.start=t.start,e.end=t.end,e.duration=t.duration,e.streamEvents=t.streamEvents;for(var i=e.getAdaptations(),a=t.getAdaptations(),o=function(e){var t=i[e],o=x(a,(function(e){return e.id===t.id}));if(-1===o){T.warn('Manifest: Adaptation \"'+i[e].id+'\" not found when merging.');var u=i.splice(e,1)[0];e--,r.removedAdaptations.push({id:u.id,trackType:u.type})}else{var l=a.splice(o,1)[0],d=[],c=[],f=[];r.updatedAdaptations.push({adaptation:t.id,trackType:t.type,updatedRepresentations:d,addedRepresentations:c,removedRepresentations:f});for(var p,h=t.representations,v=l.representations.slice(),m=function(e){var t=h[e],r=x(v,(function(e){return e.id===t.id}));if(-1===r){T.warn('Manifest: Representation \"'+h[e].id+'\" not found when merging.');var i=h.splice(e,1)[0];e--,f.push(i.id)}else{var a=v.splice(r,1)[0];d.push(t.getMetadataSnapshot()),t.cdnMetadata=a.cdnMetadata,n===ce.Full?t.index._replace(a.index):t.index._update(a.index)}g=e},g=0;g<h.length;g++)m(g);if(v.length>0)T.warn(\"Manifest: \"+v.length+\" new Representations found when merging.\"),(p=t.representations).push.apply(p,v),c.push.apply(c,v.map((function(e){return e.getMetadataSnapshot()})))}s=e},s=0;s<i.length;s++)o(s);if(a.length>0){T.warn(\"Manifest: \"+a.length+\" new Adaptations found when merging.\");for(var u,l=pe(a);!(u=l()).done;){var d=u.value,c=e.adaptations[d.type];void 0===c?e.adaptations[d.type]=[d]:c.push(d),r.addedAdaptations.push(d.getMetadataSnapshot())}}return r}function me(e,t){var n=\"undefined\"!=typeof Symbol&&e[Symbol.iterator]||e[\"@@iterator\"];if(n)return(n=n.call(e)).next.bind(n);if(Array.isArray(e)||(n=function(e,t){if(!e)return;if(\"string\"==typeof e)return ge(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);\"Object\"===n&&e.constructor&&(n=e.constructor.name);if(\"Map\"===n||\"Set\"===n)return Array.from(e);if(\"Arguments\"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ge(e,t)}(e))||t&&e&&\"number\"==typeof e.length){n&&(e=n);var r=0;return function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}}}throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\")}function ge(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}!function(e){e[e.Full=0]=\"Full\",e[e.Partial=1]=\"Partial\"}(ce||(ce={}));var be=I(),ye=function(e){function t(t,n,r){var i,a;i=e.call(this)||this;var o=n.representationFilter,s=n.manifestUpdateUrl;i.manifestFormat=0,i.id=be(),i.expired=null!==(a=t.expired)&&void 0!==a?a:null,i.transport=t.transportType,i.clockOffset=t.clockOffset;var u=[];if(i.periods=t.periods.map((function(e){return new fe(e,u,o)})).sort((function(e,t){return e.start-t.start})),u.length>0){var l=new b(\"MANIFEST_INCOMPATIBLE_CODECS_ERROR\",\"An Adaptation contains only incompatible codecs.\",{tracks:u.map(Y)});r.push(l)}return i.adaptations=void 0===i.periods[0]?{}:i.periods[0].adaptations,i.timeBounds=t.timeBounds,i.isDynamic=t.isDynamic,i.isLive=t.isLive,i.isLastPeriodKnown=t.isLastPeriodKnown,i.uris=void 0===t.uris?[]:t.uris,i.updateUrl=s,i.lifetime=t.lifetime,i.clockOffset=t.clockOffset,i.suggestedPresentationDelay=t.suggestedPresentationDelay,i.availabilityStartTime=t.availabilityStartTime,i.publishTime=t.publishTime,i}l(t,e);var n=t.prototype;return n.refreshCodecSupport=function(e){for(var t,n=[],r=me(this.periods);!(t=r()).done;){t.value.refreshCodecSupport(e,n)}return n.length>0?new b(\"MANIFEST_INCOMPATIBLE_CODECS_ERROR\",\"An Adaptation contains only incompatible codecs.\",{tracks:n.map(Y)}):null},n.getPeriod=function(e){return A(this.periods,(function(t){return e===t.id}))},n.getPeriodForTime=function(e){return function(e,t){for(var n=null,r=e.periods.length-1;r>=0;r--){var i=e.periods[r];if(W(i,t,n))return i;n=i}}(this,e)},n.getNextPeriod=function(e){return A(this.periods,(function(t){return t.start>e}))},n.getPeriodAfter=function(e){return function(e,t){var n=t.end;if(void 0===n)return null;var r=A(e.periods,(function(e){return void 0===e.end||n<e.end}));return void 0===r?null:r}(this,e)},n.getUrls=function(){return this.uris},n.replace=function(e){this._performUpdate(e,ce.Full)},n.update=function(e){this._performUpdate(e,ce.Partial)},n.getMinimumSafePosition=function(){return function(e){var t,n,r=e.timeBounds;if(null===r.timeshiftDepth)return null!==(t=r.minimumSafePosition)&&void 0!==t?t:0;var i,a=r.maximumTimeData;if(r.maximumTimeData.isLinear){var o=L()-a.time;i=a.maximumSafePosition+o/1e3}else i=a.maximumSafePosition;var s=i-r.timeshiftDepth;return Math.max(null!==(n=r.minimumSafePosition)&&void 0!==n?n:0,s)}(this)},n.getLivePosition=function(){return function(e){var t=e.timeBounds.maximumTimeData;if(e.isLive&&void 0!==t.livePosition){if(!t.isLinear)return t.livePosition;var n=L()-t.time;return t.livePosition+n/1e3}}(this)},n.getMaximumSafePosition=function(){return function(e){var t=e.timeBounds.maximumTimeData;if(!t.isLinear)return t.maximumSafePosition;var n=L()-t.time;return t.maximumSafePosition+n/1e3}(this)},n.updateRepresentationsDeciperability=function(e){var t=function(e,t){for(var n,r=[],i=me(e.periods);!(n=i()).done;)for(var a,o=n.value,s=me(o.getAdaptations());!(a=s()).done;)for(var u,l=a.value,d=me(l.representations);!(u=d()).done;){var c=u.value,f={manifest:e,period:o,adaptation:l,representation:c},p=t(f);p!==c.decipherable&&(r.push(f),c.decipherable=p,T.debug('Decipherability changed for \"'+c.id+'\"',\"(\"+c.bitrate+\")\",String(c.decipherable)))}return r}(this,e);t.length>0&&this.trigger(\"decipherabilityUpdate\",t)},n.getAdaptations=function(){P(\"manifest.getAdaptations() is deprecated. Please use manifest.period[].getAdaptations() instead\");var e=this.periods[0];if(void 0===e)return[];var t=e.adaptations,n=[];for(var r in t)if(t.hasOwnProperty(r)){var i=t[r];n.push.apply(n,i)}return n},n.getAdaptationsForType=function(e){P(\"manifest.getAdaptationsForType(type) is deprecated. Please use manifest.period[].getAdaptationsForType(type) instead\");var t=this.periods[0];if(void 0===t)return[];var n=t.adaptations[e];return void 0===n?[]:n},n.getAdaptation=function(e){return P(\"manifest.getAdaptation(id) is deprecated. Please use manifest.period[].getAdaptation(id) instead\"),A(this.getAdaptations(),(function(t){var n=t.id;return e===n}))},n.getMetadataSnapshot=function(){for(var e,t=[],n=me(this.periods);!(e=n()).done;){var r=e.value;t.push(r.getMetadataSnapshot())}return{manifestFormat:1,id:this.id,periods:t,isDynamic:this.isDynamic,isLive:this.isLive,isLastPeriodKnown:this.isLastPeriodKnown,suggestedPresentationDelay:this.suggestedPresentationDelay,clockOffset:this.clockOffset,uris:this.uris,availabilityStartTime:this.availabilityStartTime,timeBounds:this.timeBounds}},n._performUpdate=function(e,t){var n;if(this.availabilityStartTime=e.availabilityStartTime,this.expired=e.expired,this.isDynamic=e.isDynamic,this.isLive=e.isLive,this.isLastPeriodKnown=e.isLastPeriodKnown,this.lifetime=e.lifetime,this.clockOffset=e.clockOffset,this.suggestedPresentationDelay=e.suggestedPresentationDelay,this.transport=e.transport,this.publishTime=e.publishTime,t===ce.Full)this.timeBounds=e.timeBounds,this.uris=e.uris,n=function(e,t){for(var n={updatedPeriods:[],addedPeriods:[],removedPeriods:[]},r=0,i=0;i<t.length;i++){for(var a=t[i],o=r,s=e[o];void 0!==s&&s.id!==a.id;)s=e[++o];if(void 0!==s){var u,l,d=ve(s,a,ce.Full);n.updatedPeriods.push({period:{id:s.id,start:s.start,end:s.end,duration:s.duration,streamEvents:s.streamEvents},result:d});var c=t.slice(r,i),f=o-r,p=e.splice.apply(e,[r,f].concat(c));(u=n.removedPeriods).push.apply(u,p.map((function(e){return{id:e.id,start:e.start,end:e.end}}))),(l=n.addedPeriods).push.apply(l,c.map((function(e){return e.getMetadataSnapshot()}))),r=i+1}}if(r>e.length)return T.error(\"Manifest: error when updating Periods\"),n;if(r<e.length){var h,v=e.splice(r,e.length-r);(h=n.removedPeriods).push.apply(h,v.map((function(e){return{id:e.id,start:e.start,end:e.end}})))}var m,g=t.slice(r,t.length);return g.length>0&&(e.push.apply(e,g),(m=n.addedPeriods).push.apply(m,g.map((function(e){return e.getMetadataSnapshot()})))),n}(this.periods,e.periods);else{this.timeBounds.maximumTimeData=e.timeBounds.maximumTimeData,this.updateUrl=e.uris[0],n=function(e,t){var n,r={updatedPeriods:[],addedPeriods:[],removedPeriods:[]};if(0===e.length)return e.splice.apply(e,[0,0].concat(t)),(n=r.addedPeriods).push.apply(n,t.map((function(e){return e.getMetadataSnapshot()}))),r;if(0===t.length)return r;var a=e[e.length-1];if(a.start<t[0].start){var o;if(a.end!==t[0].start)throw new b(\"MANIFEST_UPDATE_ERROR\",\"Cannot perform partial update: not enough data\");return e.push.apply(e,t),(o=r.addedPeriods).push.apply(o,t.map((function(e){return e.getMetadataSnapshot()}))),r}var s=x(e,(function(e){return e.id===t[0].id}));if(s<0)throw new b(\"MANIFEST_UPDATE_ERROR\",\"Cannot perform partial update: incoherent data\");var u=ve(e[s],t[0],ce.Partial);r.updatedPeriods.push({period:i(e[s].getMetadataSnapshot(),{adaptations:void 0}),result:u});for(var l=s+1,d=1;d<t.length;d++){for(var c=t[d],f=-1,p=l;p<e.length;p++)if(c.id===e[p].id){f=p;break}if(f<0){for(var h,v=-1,m=l;m<e.length;m++)if(c.start<e[m].start){v=m;break}var g=v-l,y=e.splice(l,g,c);r.addedPeriods.push(c.getMetadataSnapshot()),(h=r.removedPeriods).push.apply(h,y.map((function(e){return{id:e.id,start:e.start,end:e.end}})))}else{if(f>l){var S;T.warn(\"Manifest: old Periods not found in new when updating, removing\");var _=e.splice(l,f-l);(S=r.removedPeriods).push.apply(S,_.map((function(e){return{id:e.id,start:e.start,end:e.end}}))),f=l}var E=ve(e[f],c,ce.Full);r.updatedPeriods.push({period:i(e[f].getMetadataSnapshot(),{adaptations:void 0}),result:E})}l++}if(l<e.length){var w;T.warn(\"Manifest: Ending Periods not found in new when updating, removing\");var A=e.splice(l,e.length-l);(w=r.removedPeriods).push.apply(w,A.map((function(e){return{id:e.id,start:e.start,end:e.end}})))}return r}(this.periods,e.periods);for(var r=this.getMinimumSafePosition();this.periods.length>0;){var a=this.periods[0];if(void 0===a.end||a.end>r)break;this.periods.shift()}}this.adaptations=void 0===this.periods[0]?{}:this.periods[0].adaptations,this.trigger(\"manifestUpdate\",n)},t}(_);var Se=ye,_e=\"undefined\"!=typeof WorkerGlobalScope&&self instanceof WorkerGlobalScope,Ee=\"undefined\"==typeof window&&!_e,we=_e?self:Ee?n.g:window,Te=we,Ae=void 0===Te?void 0:S(Te.MediaSource)?S(Te.MozMediaSource)?S(Te.WebKitMediaSource)?Te.MSMediaSource:Te.WebKitMediaSource:Te.MozMediaSource:Te.MediaSource,Ie=new Map;var ke=new(function(){function e(){this._cachedCodecSupport=new Map}return e.prototype.isSupported=function(e,t){var n=(null!=e?e:\"\")+';codecs=\"'+(null!=t?t:\"\")+'\"',r=this._cachedCodecSupport.get(n);if(void 0!==r)return r;this._cachedCodecSupport.size>=50&&this._cachedCodecSupport.clear();var i=function(e){if(S(Ae))return _e&&T.error(\"Compat: Cannot request codec support in a worker without MSE.\"),!1;if(\"function\"==typeof Ae.isTypeSupported){var t=Ie.get(e);if(void 0!==t)return t;var n=Ae.isTypeSupported(e);return Ie.size>=200&&Ie.clear(),Ie.set(e,n),n}return!0}(n);return this._cachedCodecSupport.set(n,i),i},e}()),Re=function(){function e(){this._currentCacheSize=0,this._cachedCodecSupport=new Map}var t=e.prototype;return t.isSupported=function(e,t){var n,r=null===(n=this._cachedCodecSupport.get(e))||void 0===n?void 0:n.get(t);if(void 0!==r)return r},t.updateCache=function(e,t,n){this._currentCacheSize>=50&&(this._cachedCodecSupport.clear(),this._currentCacheSize=0);var r=this._cachedCodecSupport.get(e);if(void 0!==r)r.set(t,n);else{var i=new Map;i.set(t,n),this._cachedCodecSupport.set(e,i)}},e}(),Pe=new Re,xe=function(e){function t(n){var r;return r=e.call(this)||this,Object.setPrototypeOf(u(r),t.prototype),r.name=\"AssertionError\",r.message=n,r}return l(t,e),t}(c(Error));function Ce(e,t){0}function Me(e){throw new xe(\"Unreachable path taken\")}var Oe=\"<\",De=\"<\".charCodeAt(0),Ne=\">\",Ue=\">\".charCodeAt(0),Le=\"-\".charCodeAt(0),Fe=\"/\".charCodeAt(0),Be=\"!\".charCodeAt(0),ze=\"'\".charCodeAt(0),We='\"'.charCodeAt(0),Ve=\"[\".charCodeAt(0),je=\"]\".charCodeAt(0),Ge=\"\\r\\n\\t>/= \";function He(e,t){var n,r;void 0===t&&(t={});var i,a=null!==(n=t.pos)&&void 0!==n?n:0,o=!0===t.keepComments,s=!0===t.keepWhitespace;if(void 0!==t.attrValue)for(t.attrName=null!==(r=t.attrName)&&void 0!==r?r:\"id\",i=[];-1!==(a=p());)-1!==(a=e.lastIndexOf(\"<\",a))&&i.push(c()),e=e.substring(a),a=0;else i=u(\"\");return t.filter&&(i=qe(i,t.filter)),i;function u(t){for(var n=[];e[a];)if(e.charCodeAt(a)===De){if(e.charCodeAt(a+1)===Fe){var r=a+2;if(a=e.indexOf(Ne,a),-1===e.substring(r,a).indexOf(t)){var i=e.substring(0,a).split(\"\\n\");throw new Error(\"Unexpected close tag\\nLine: \"+(i.length-1)+\"\\nColumn: \"+(i[i.length-1].length+1)+\"\\nChar: \"+e[a])}return-1!==a&&(a+=1),n}if(e.charCodeAt(a+1)===Be){if(e.charCodeAt(a+2)===Le){for(var u=a;-1!==a&&(e.charCodeAt(a)!==Ue||e.charCodeAt(a-1)!==Le||e.charCodeAt(a-2)!==Le);)a=e.indexOf(Ne,a+1);-1===a&&(a=e.length),o&&n.push(e.substring(u,a+1))}else{if(e.charCodeAt(a+2)===Ve&&e.charCodeAt(a+8)===Ve&&\"cdata\"===e.substring(a+3,a+8).toLowerCase()){var d=e.indexOf(\"]]>\",a);-1===d?(n.push(e.substring(a+9)),a=e.length):(n.push(e.substring(a+9,d)),a=d+3);continue}var f=a+1;a+=2;for(var p=!1;(e.charCodeAt(a)!==Ue||p)&&e[a];)e.charCodeAt(a)===Ve?p=!0:p&&e.charCodeAt(a)===je&&(p=!1),a++;n.push(e.substring(f,a))}a++;continue}var h=c();n.push(h),\"?\"===h.tagName[0]&&(n.push.apply(n,h.children),h.children=[])}else{var v=l();if(s)v.length>0&&n.push(v);else{var m=v.trim();m.length>0&&n.push(m)}a++}return n}function l(){var t=a;return-2===(a=e.indexOf(Oe,a)-1)&&(a=e.length),e.slice(t,a+1)}function d(){for(var t=a;-1===Ge.indexOf(e[a])&&e[a];)a++;return e.slice(t,a)}function c(){var t=a;a++;for(var n=d(),r={},i=[];e.charCodeAt(a)!==Ue&&e[a];){var o=e.charCodeAt(a);if(o>64&&o<91||o>96&&o<123){for(var s=d(),l=e.charCodeAt(a);l&&l!==ze&&l!==We&&!(l>64&&l<91||l>96&&l<123)&&l!==Ue;)a++,l=e.charCodeAt(a);var c=void 0;l===ze||l===We?c=f():(c=null,a--),r[s]=null===c?null:Ye(c)}a++}return e.charCodeAt(a-1)!==Fe?(a++,i=u(n)):a++,{tagName:n,attributes:r,children:i,posStart:t,posEnd:a}}function f(){var t=e[a],n=a+1;return a=e.indexOf(t,n),e.slice(n,a)}function p(){var n=new RegExp(\"\\\\s\"+t.attrName+\"\\\\s*=['\\\"]\"+t.attrValue+\"['\\\"]\").exec(e);return n?n.index:-1}}function qe(e,t,n,r){void 0===n&&(n=0),void 0===r&&(r=\"\");var i=[];return e.forEach((function(e,a){if(\"object\"==typeof e&&(t(e,a,n,r)&&i.push(e),e.children.length>0)){var o=qe(e.children,t,n+1,(r?r+\".\":\"\")+a+\".\"+e.tagName);i=i.concat(o)}})),i}function Ke(e){if(Array.isArray(e)){var t=\"\";return e.forEach((function(e){t=(t+=\" \"+Ke(e)).trim()})),t}return\"object\"==typeof e?Ke(e.children):\" \"+Ye(e)}function Ye(e){return e.indexOf(\"&\")<0?e:e.replace(/&lt;/g,\"<\").replace(/&gt;/g,\">\").replace(/&quot;/g,'\"').replace(/&apos;/g,\"'\").replace(/&#x([A-Fa-f0-9]+);/g,(function(e,t){return String.fromCharCode(parseInt(t,16))})).replace(/&amp;/g,\"&\")}var Qe=/^(?:[a-z]+:)?\\/\\//i,Xe=/\\/\\.{1,2}\\//;function $e(){var e=arguments.length;if(0===e)return\"\";for(var t=\"\",n=0;n<e;n++){var r=n<0||arguments.length<=n?void 0:arguments[n];\"string\"==typeof r&&\"\"!==r&&(Qe.test(r)?t=r:(\"/\"===r[0]&&(r=r.substring(1)),\"/\"===t[t.length-1]&&(t=t.substring(0,t.length-1)),t=t+\"/\"+r))}return function(e){if(!Xe.test(e))return e;for(var t=[],n=e.split(\"/\"),r=0,i=n.length;r<i;r++)if(\"..\"===n[r])t.pop();else{if(\".\"===n[r])continue;t.push(n[r])}return t.join(\"/\")}(t)}function Ze(e){var t=e.lastIndexOf(\"/\");if(t<0)return e.length;if(Qe.test(e)){var n=e.indexOf(\"/\");if(n>=0&&t===n+1)return e.length}var r=e.indexOf(\"?\");return r>=0&&r<t?Ze(e.substring(0,r)):t+1}function Je(e){var t=Date.parse(e)-L();if(!isNaN(t))return t;T.warn(\"DASH Parser: Invalid clock received: \",e)}function et(e){for(var t=e.representations,n=null,r=0;r<t.length;r++){var i=t[r].index.getLastAvailablePosition();if(void 0===i)return;null!==i&&(n=null===n?i:Math.min(n,i))}return null===n?null:n}function tt(e){for(var t=e.representations,n=null,r=0;r<t.length;r++){var i=t[r].index.getFirstAvailablePosition();if(void 0===i)return;null!==i&&(n=null===n?i:Math.max(n,i))}return null===n?null:n}function nt(e){if(0===e.length)throw new Error(\"DASH Parser: no period available for a dynamic content\");var t=function(e){for(var t=0;t<=e.length-1;t++){var n=e[t].adaptations,r=void 0===n.audio?void 0:n.audio[0],i=void 0===n.video?void 0:n.video[0];if(void 0!==r||void 0!==i){var a=null,o=null;if(void 0!==r){var s=tt(r);if(void 0===s)return;a=s}if(void 0!==i){var u=tt(i);if(void 0===u)return;o=u}if(void 0!==r&&null===a||void 0!==i&&null===o)return void T.info(\"Parser utils: found Period with no segment. \",\"Going to next one to calculate first position\");if(null!==o)return null!==a?Math.max(a,o):o;if(null!==a)return a}}}(e),n=function(e){for(var t=e.length-1;t>=0;t--){var n=e[t].adaptations,r=void 0===n.audio?void 0:n.audio[0],i=void 0===n.video?void 0:n.video[0];if(void 0!==r||void 0!==i){var a=null,o=null;if(void 0!==r){var s=et(r);if(void 0===s)return{safe:void 0,unsafe:void 0};a=s}if(void 0!==i){var u=et(i);if(void 0===u)return{safe:void 0,unsafe:void 0};o=u}if(void 0!==r&&null===a||void 0!==i&&null===o)return T.info(\"Parser utils: found Period with no segment. \",\"Going to previous one to calculate last position\"),{safe:void 0,unsafe:void 0};if(null!==o)return null!==a?{safe:Math.min(a,o),unsafe:Math.max(a,o)}:{safe:o,unsafe:o};if(null!==a)return{safe:a,unsafe:a}}}return{safe:void 0,unsafe:void 0}}(e);return{minimumSafePosition:t,maximumSafePosition:n.safe,maximumUnsafePosition:n.unsafe}}var rt=function(){function e(e){this._isDynamic=e.isDynamic,this._timeShiftBufferDepth=e.isDynamic&&void 0!==e.timeShiftBufferDepth?e.timeShiftBufferDepth:null,this._serverTimestampOffset=e.serverTimestampOffset,this._availabilityStartTime=e.availabilityStartTime}var t=e.prototype;return t.setLastPosition=function(e,t){this._lastPosition=e,this._positionTime=t},t.lastPositionIsKnown=function(){return this._isDynamic?void 0!==this._positionTime&&void 0!==this._lastPosition:void 0!==this._lastPosition},t.getEstimatedMinimumSegmentTime=function(){var e;if(!this._isDynamic||null===this._timeShiftBufferDepth)return 0;var t=null!==(e=this.getEstimatedLiveEdge())&&void 0!==e?e:this.getEstimatedMaximumPosition(0);return void 0!==t?t-this._timeShiftBufferDepth:void 0},t.getEstimatedLiveEdge=function(){if(this._isDynamic&&void 0!==this._serverTimestampOffset)return(L()+this._serverTimestampOffset)/1e3-this._availabilityStartTime},t.getEstimatedMaximumPosition=function(e){if(!this._isDynamic)return this._lastPosition;var t=this.getEstimatedLiveEdge();return void 0!==t&&e!==1/0?t+e:void 0!==this._positionTime&&void 0!==this._lastPosition?Math.max(this._lastPosition-this._positionTime+L()/1e3,0):this._lastPosition},e}();var it=\"object\"==typeof we&&\"function\"==typeof we.TextDecoder,at=\"object\"==typeof we&&\"function\"==typeof we.TextEncoder;function ot(e){if(at)try{return(new TextEncoder).encode(e)}catch(e){var t=e instanceof Error?e:\"\";T.warn(\"Utils: could not use TextEncoder to encode string into UTF-8, fallbacking to another implementation\",t)}var n,r=encodeURIComponent(e);if(\"function\"==typeof unescape)n=unescape(r);else{var i=/[0-9a-fA-F]/,a=r.length;n=\"\";for(var o=0;o<r.length;o++){var s=!1;if(\"%\"===r[o])if(o<=a-6&&\"u\"===r[o+1]&&i.test(r[o+2])&&i.test(r[o+3])&&i.test(r[o+4])&&i.test(r[o+5])){var u=parseInt(r.substring(o+1,o+6),16);n+=String.fromCharCode(u),s=!0,o+=5}else if(o<=a-3&&i.test(r[o+1])&&i.test(r[o+2])){var l=parseInt(r.substring(o+1,o+3),16);n+=String.fromCharCode(l),s=!0,o+=2}s||(n+=r[o])}}for(var d=new Uint8Array(n.length),c=0;c<n.length;c++)d[c]=255&n.charCodeAt(c);return d}function st(e,t){var n=e.toString(16);return n.length>=t?n:new Array(t-n.length+1).join(\"0\")+n}function ut(e){if(it)try{return(new TextDecoder).decode(e)}catch(e){var t=e instanceof Error?e:\"\";T.warn(\"Utils: could not use TextDecoder to parse UTF-8, fallbacking to another implementation\",t)}var n=e;239===n[0]&&187===n[1]&&191===n[2]&&(n=n.subarray(3));var r,i=function(e){for(var t=\"\",n=0;n<e.length;n+=16e3){var r=e.subarray(n,n+16e3);t+=String.fromCharCode.apply(null,r)}return t}(n);if(\"function\"==typeof escape)r=escape(i);else{var a=/[A-Za-z0-9*_\\+-\\.\\/]/;r=\"\";for(var o=0;o<i.length;o++)if(a.test(i[o]))r+=i[o];else{var s=i.charCodeAt(o);r+=s>=256?\"%u\"+st(s,4):\"%\"+st(s,2)}}return decodeURIComponent(r)}function lt(e){for(var t=e.length,n=new Uint8Array(t/2),r=0,i=0;r<t;r+=2,i++)n[i]=255&parseInt(e.substring(r,r+2),16);return n}function dt(e,t){for(var n=t;n<e.length;){if(0===e[n])break;n+=1}return{end:n+1,string:ut(e.subarray(t,n))}}function ct(e,t){var n=\"undefined\"!=typeof Symbol&&e[Symbol.iterator]||e[\"@@iterator\"];if(n)return(n=n.call(e)).next.bind(n);if(Array.isArray(e)||(n=function(e,t){if(!e)return;if(\"string\"==typeof e)return ft(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);\"Object\"===n&&e.constructor&&(n=e.constructor.name);if(\"Map\"===n||\"Set\"===n)return Array.from(e);if(\"Arguments\"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ft(e,t)}(e))||t&&e&&\"number\"==typeof e.length){n&&(e=n);var r=0;return function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}}}throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\")}function ft(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var pt=function(e,t){for(var n,r=ct(t);!(n=r()).done;)for(var i,a=n.value,o=a.adaptation,s=ct(a.trickModeAttachedAdaptationIds);!(i=s()).done;)for(var u,l=i.value,d=ct(z);!(u=d()).done;){var c=e[u.value];if(void 0!==c)for(var f,p=ct(c);!(f=p()).done;){var h=f.value;h.id===l&&(void 0===h.trickModeTracks&&(h.trickModeTracks=[]),h.trickModeTracks.push(o))}}},ht=[\"subtitle\",\"caption\"];function vt(e,t,n,r){function i(e,t){var n=e.split(\"/\")[0];return k(z,n)?n:\"application/ttml+xml\"===e||\"application/mp4\"===e&&null!==t&&void 0!==A(t,(function(e){return\"urn:mpeg:dash:role:2011\"===e.schemeIdUri&&k(ht,e.value)}))?\"text\":void 0}function a(e){switch(e.substring(0,3)){case\"avc\":case\"hev\":case\"hvc\":case\"vp8\":case\"vp9\":case\"av1\":return\"video\";case\"vtt\":return\"text\"}switch(e.substring(0,4)){case\"mp4a\":return\"audio\";case\"wvtt\":case\"stpp\":return\"text\"}}if(null!==t){var o=i(t,r);if(void 0!==o)return o}if(null!==n){var s=a(n);if(void 0!==s)return s}for(var u=0;u<e.length;u++){var l=e[u].attributes,d=l.mimeType,c=l.codecs;if(void 0!==d){var f=i(d,r);if(void 0!==f)return f}if(void 0!==c){var p=a(c);if(void 0!==p)return p}}}var mt=/[, ]+/g;function gt(e,t,n){var r,i=e.repeatCount;return i>=0?i:(r=S(t)?void 0!==n?n:Number.MAX_VALUE:t.start,Math.ceil((r-e.start)/e.duration)-1)}function bt(e,t,n){var r=e.start,i=e.duration;return i<=0?r:r+(gt(e,t,n)+1)*i}function yt(e,t){var n;return e*t.timescale+(null!==(n=t.indexTimeOffset)&&void 0!==n?n:0)}function St(e,t){var n;return(e-(null!==(n=t.indexTimeOffset)&&void 0!==n?n:0))/t.timescale}function _t(e,t){var n,r=e.initialization,i={};return void 0!==t&&(i.isEMSGWhitelisted=t),{id:\"init\",isInit:!0,time:0,end:0,duration:0,timescale:1,range:S(r)?void 0:r.range,indexRange:e.indexRange,url:null!==(n=null==r?void 0:r.url)&&void 0!==n?n:null,complete:!0,privateInfos:i,timestampOffset:-e.indexTimeOffset/e.timescale}}function Et(e){return function(t,n,r){var i,a,o,s=Q(r)?parseInt(r,10):1;return i=String(e),a=s,(o=i.toString()).length>=a?o:(new Array(a+1).join(\"0\")+o).slice(-a)}}function wt(e,t,n){return function(e,t,n){return-1===e.indexOf(\"$\")?e:e.replace(/\\$\\$/g,\"$\").replace(/\\$RepresentationID\\$/g,String(t)).replace(/\\$Bandwidth(\\%0(\\d+)d)?\\$/g,Et(void 0===n?0:n))}(e,t,n)}function Tt(e,t){return function(n){return-1===n.indexOf(\"$\")?n:n.replace(/\\$\\$/g,\"$\").replace(/\\$Number(\\%0(\\d+)d)?\\$/g,(function(e,n,r){if(void 0===t)throw new Error(\"Segment number not defined in a $Number$ scheme\");return Et(t)(e,n,r)})).replace(/\\$Time(\\%0(\\d+)d)?\\$/g,(function(t,n,r){if(void 0===e)throw new Error(\"Segment time not defined in a $Time$ scheme\");return Et(e)(t,n,r)}))}}function At(e,t,n,r,i,a){for(var o,s,u,l=r.getEstimatedMaximumPosition(null!==(o=e.availabilityTimeOffset)&&void 0!==o?o:0),d=Math.min(t+n,null!=l?l:1/0),c=yt(t,e),f=yt(d,e),p=e.timeline,h=e.timescale,v=e.segmentUrlTemplate,m=e.startNumber,g=e.endNumber,b=null!=m?m:1,y=[],S=p.length,_=0;_<S;_++){var E=p[_],w=E.duration,T=E.start,A=E.range,I=void 0;I=void 0===l?i:Math.min(l*h,null!=i?i:1/0);for(var k=gt(E,p[_+1],I),R=!1!==e.availabilityTimeComplete||_!==S-1&&0!==k,P=(s=w,u=void 0,(u=c-T)>0?Math.floor(u/s):0),x=T+P*w;x<f&&P<=k;){var C=b+P;if(void 0!==g&&C>g)break;var M=null===v?null:Tt(x,C)(v),O=x-e.indexTimeOffset,D=w;O<0&&(D=w+O,O=0);var N={id:String(x),time:O/h,end:(O+D)/h,duration:D/h,isInit:!1,range:A,timescale:1,url:M,number:C,timestampOffset:-e.indexTimeOffset/h,complete:R,privateInfos:{isEMSGWhitelisted:a}};y.push(N),x=T+ ++P*w}if(x>=f)return y;if(b+=k+1,void 0!==g&&b>g)return y}return y}function It(e,t){if(t.timescale!==e.timescale){var n=e.timescale;e.timeline.push({start:t.time/t.timescale*n,duration:t.duration/t.timescale*n,repeatCount:void 0===t.count?0:t.count,range:t.range})}else e.timeline.push({start:t.time,duration:t.duration,repeatCount:void 0===t.count?0:t.count,range:t.range});return!0}var kt=function(){function e(e,t){var n,r,i,a,o,s=t.periodStart,u=t.periodEnd,l=t.representationId,d=t.representationBitrate,c=t.isEMSGWhitelisted,f=null!==(n=e.timescale)&&void 0!==n?n:1,p=(null!==(r=e.presentationTimeOffset)&&void 0!==r?r:0)-s*f,h=void 0===(null===(i=e.initialization)||void 0===i?void 0:i.media)?null:wt(e.initialization.media,l,d),v=void 0===e.media?null:wt(e.media,l,d);void 0!==e.initialization?o=e.initialization.range:void 0!==e.indexRange&&(o=[0,e.indexRange[0]-1]),this._index={indexRange:e.indexRange,indexTimeOffset:p,initialization:{url:h,range:o},segmentUrlTemplate:v,startNumber:e.startNumber,endNumber:e.endNumber,timeline:null!==(a=e.timeline)&&void 0!==a?a:[],timescale:f},this._manifestBoundsCalculator=t.manifestBoundsCalculator,this._scaledPeriodStart=yt(s,this._index),this._scaledPeriodEnd=S(u)?void 0:yt(u,this._index),this._isInitialized=this._index.timeline.length>0,this._isEMSGWhitelisted=c}var t=e.prototype;return t.getInitSegment=function(){return _t(this._index,this._isEMSGWhitelisted)},t.getSegments=function(e,t){return At(this._index,e,t,this._manifestBoundsCalculator,this._scaledPeriodEnd,this._isEMSGWhitelisted)},t.shouldRefresh=function(){return!1},t.getFirstAvailablePosition=function(){var e=this._index;return 0===e.timeline.length?null:St(Math.max(this._scaledPeriodStart,e.timeline[0].start),e)},t.getLastAvailablePosition=function(){var e,t=this._index.timeline;if(0===t.length)return null;var n=t[t.length-1];return St(Math.min(bt(n,null,this._scaledPeriodEnd),null!==(e=this._scaledPeriodEnd)&&void 0!==e?e:1/0),this._index)},t.getEnd=function(){return this.getLastAvailablePosition()},t.awaitSegmentBetween=function(){return!1},t.isSegmentStillAvailable=function(){return!0},t.checkDiscontinuity=function(){return null},t.canBeOutOfSyncError=function(){return!1},t.isStillAwaitingFutureSegments=function(){return!1},t.isInitialized=function(){return this._isInitialized},t.initialize=function(e){if(!this._isInitialized){for(var t=0;t<e.length;t++)It(this._index,e[t]);this._isInitialized=!0}},t.addPredictedSegments=function(){T.warn(\"Cannot add predicted segments to a `BaseRepresentationIndex`\")},t._replace=function(e){this._index=e._index,this._isInitialized=e._isInitialized,this._scaledPeriodEnd=e._scaledPeriodEnd,this._isEMSGWhitelisted=e._isEMSGWhitelisted},t._update=function(){T.error(\"Base RepresentationIndex: Cannot update a SegmentList\")},e}(),Rt=function(){function e(e,t){var n,r,i;if(void 0===e.duration)throw new Error(\"Invalid SegmentList: no duration\");var a=t.periodStart,o=t.periodEnd,s=t.representationId,u=t.representationBitrate,l=t.isEMSGWhitelisted;this._isEMSGWhitelisted=l,this._periodStart=a,this._periodEnd=o;var d=null!==(n=e.presentationTimeOffset)&&void 0!==n?n:0,c=null!==(r=e.timescale)&&void 0!==r?r:1,f=d-a*c,p=void 0===(null===(i=e.initialization)||void 0===i?void 0:i.media)?null:wt(e.initialization.media,s,u),h=e.list.map((function(e){return{url:void 0===e.media?null:wt(e.media,s,u),mediaRange:e.mediaRange}}));this._index={list:h,timescale:c,duration:e.duration,indexTimeOffset:f,indexRange:e.indexRange,initialization:S(e.initialization)?void 0:{url:p,range:e.initialization.range}}}var t=e.prototype;return t.getInitSegment=function(){var e=_t(this._index);return void 0===e.privateInfos&&(e.privateInfos={}),e.privateInfos.isEMSGWhitelisted=this._isEMSGWhitelisted,e},t.getSegments=function(e,t){for(var n=this._index,r=n.duration,i=n.list,a=n.timescale,o=r/a,s=function(e,t,n){return[e*n,(e+t)*n]}(e-this._periodStart,t,a),u=s[0],l=s[1],d=Math.min(i.length-1,Math.floor(l/r)),c=[],f=Math.floor(u/r);f<=d;){var p=i[f].mediaRange,h=i[f].url,v=f*o+this._periodStart,m={id:String(f),time:v,isInit:!1,range:p,duration:o,timescale:1,end:v+o,url:h,timestampOffset:-n.indexTimeOffset/a,complete:!0,privateInfos:{isEMSGWhitelisted:this._isEMSGWhitelisted}};c.push(m),f++}return c},t.shouldRefresh=function(e,t){return!1},t.getFirstAvailablePosition=function(){return this._periodStart},t.getLastAvailablePosition=function(){var e,t=this._index,n=t.duration,r=t.list;return Math.min(r.length*n/t.timescale+this._periodStart,null!==(e=this._periodEnd)&&void 0!==e?e:1/0)},t.getEnd=function(){return this.getLastAvailablePosition()},t.awaitSegmentBetween=function(){return!1},t.isSegmentStillAvailable=function(){return!0},t.checkDiscontinuity=function(){return null},t.canBeOutOfSyncError=function(){return!1},t.isStillAwaitingFutureSegments=function(){return!1},t.isInitialized=function(){return!0},t.initialize=function(){T.error(\"A `ListRepresentationIndex` does not need to be initialized\")},t.addPredictedSegments=function(){T.warn(\"Cannot add predicted segments to a `ListRepresentationIndex`\")},t._replace=function(e){this._index=e._index},t._update=function(){T.error(\"A `ListRepresentationIndex` cannot be updated\")},e}(),Pt=function(e){function t(n,r){var i;return i=e.call(this)||this,Object.setPrototypeOf(u(i),t.prototype),i.name=\"NetworkError\",i.type=v.NETWORK_ERROR,i.url=r.url,i.status=r.status,i.errorType=r.type,i._baseError=r,i.code=n,i.message=m(i.code,r.message),i.fatal=!1,i}l(t,e);var n=t.prototype;return n.isHttpError=function(e){return this.errorType===h.ERROR_HTTP_CODE&&this.status===e},n.serialize=function(){return{name:this.name,code:this.code,baseError:this._baseError.serialize()}},t}(c(Error));function xt(e){return s.getCurrent().DEFAULT_MAXIMUM_TIME_ROUNDING_ERROR*e}function Ct(e,t,n){var r=e.start,i=e.duration,a=e.repeatCount;return void 0===r&&(null===t?r=0:S(t.duration)||(r=t.start+t.duration*(t.repeatCount+1))),void 0!==i&&!isNaN(i)||null===n||void 0===n.start||isNaN(n.start)||void 0===r||isNaN(r)||(i=n.start-r),void 0===r||isNaN(r)||void 0===i||isNaN(i)||void 0!==a&&isNaN(a)?(T.warn('DASH: A \"S\" Element could not have been parsed.'),null):{start:r,duration:i,repeatCount:void 0===a?0:a}}function Mt(e){for(var t={},n=0,r=Object.keys(e.attributes);n<r.length;n++){var i=r[n],a=e.attributes[i];if(!S(a))switch(i){case\"t\":var o=parseInt(a,10);isNaN(o)?T.warn('DASH: invalid t (\"'+a+'\")'):t.start=o;break;case\"d\":var s=parseInt(a,10);isNaN(s)?T.warn('DASH: invalid d (\"'+a+'\")'):t.duration=s;break;case\"r\":var u=parseInt(a,10);isNaN(u)?T.warn('DASH: invalid r (\"'+a+'\")'):t.repeatCount=u}}return t}function Ot(e){for(var t={},n=0;n<e.attributes.length;n++){var r=e.attributes[n];switch(r.name){case\"t\":var i=parseInt(r.value,10);isNaN(i)?T.warn('DASH: invalid t (\"'+r.value+'\")'):t.start=i;break;case\"d\":var a=parseInt(r.value,10);isNaN(a)?T.warn('DASH: invalid d (\"'+r.value+'\")'):t.duration=a;break;case\"r\":var o=parseInt(r.value,10);isNaN(o)?T.warn('DASH: invalid r (\"'+r.value+'\")'):t.repeatCount=o}}return t}function Dt(e){var t=[];if(Array.isArray(e))for(var n=0;n<e.length;n++)t.push(Mt(e[n]));else for(var r=0;r<e.length;r++)t.push(Ot(e[r]));for(var i=[],a=0;a<t.length;a++){var o=Ct(t[a],void 0===i[i.length-1]?null:i[i.length-1],void 0===t[a+1]?null:t[a+1]);null!==o&&i.push(o)}return i}function Nt(e,t){var n,r=function(e,t){if(0===e.length||0===t.length)return null;var n=e[0].start,r=Array.isArray(t)?t[0].attributes.t:t[0].getAttribute(\"t\"),i=S(r)?null:parseInt(r,10);if(null===i||Number.isNaN(i))return null;if(n===i)return{prevSegmentsIdx:0,newElementsIdx:0,repeatNumberInPrevSegments:0,repeatNumberInNewElements:0};if(n<i)for(var a=e[0],o=0;;){if(a.repeatCount>0){var s=i-a.start;if(s%a.duration==0&&s/a.duration<=a.repeatCount)return{repeatNumberInPrevSegments:s/a.duration,prevSegmentsIdx:o,newElementsIdx:0,repeatNumberInNewElements:0}}if(++o>=e.length)return null;if((a=e[o]).start===i)return{prevSegmentsIdx:o,newElementsIdx:0,repeatNumberInPrevSegments:0,repeatNumberInNewElements:0};if(a.start>i)return null}else for(var u=0,l=Array.isArray(t)?t[0]:null,d=Array.isArray(t)?null:t[0],c=i;;){var f=null!==l?l.attributes.d:null==d?void 0:d.getAttribute(\"d\"),p=S(f)?null:parseInt(f,10);if(null===p||Number.isNaN(p))return null;var h=null!==l?l.attributes.r:null==d?void 0:d.getAttribute(\"r\"),v=S(h)?null:parseInt(h,10);if(null!==v){if(Number.isNaN(v)||v<0)return null;if(v>0){var m=n-c;if(m%p==0&&m/p<=v)return{repeatNumberInPrevSegments:0,repeatNumberInNewElements:m/p,prevSegmentsIdx:0,newElementsIdx:u}}c+=p*(v+1)}else c+=p;if(++u>=t.length)return null;Array.isArray(t)?l=t[u]:d=t[u];var g=null!==l?l.attributes.t:null==d?void 0:d.getAttribute(\"t\"),b=S(g)?null:parseInt(g,10);if(null!==b){if(Number.isNaN(b))return null;c=b}if(c===n)return{newElementsIdx:u,prevSegmentsIdx:0,repeatNumberInPrevSegments:0,repeatNumberInNewElements:0};if(c>i)return null}}(t,e);if(null===r)return T.warn('DASH: Cannot perform \"based\" update. Common segment not found.'),Dt(e);var i=r.prevSegmentsIdx,a=r.newElementsIdx,o=r.repeatNumberInPrevSegments,s=r.repeatNumberInNewElements,u=t.length-i+a-1;if(u>=e.length)return T.info('DASH: Cannot perform \"based\" update. New timeline too short'),Dt(e);var l=t.slice(i);if(o>0){var d=l[0];d.start+=d.duration*o,l[0].repeatCount-=o}if(s>0&&0!==a)return T.info('DASH: Cannot perform \"based\" update. The new timeline has a different form.'),Dt(e);var c=l[l.length-1],f=Array.isArray(e)?Mt(e[u]):Ot(e[u]),p=(null!==(n=f.repeatCount)&&void 0!==n?n:0)-s;if(f.duration!==c.duration||c.repeatCount>p)return T.info('DASH: Cannot perform \"based\" update. The new timeline has a different form at the beginning.'),Dt(e);void 0!==f.repeatCount&&f.repeatCount>c.repeatCount&&(c.repeatCount=f.repeatCount);var h=[],v=[];if(Array.isArray(e))for(var m=u+1;m<e.length;m++)v.push(Mt(e[m]));else for(var g=u+1;g<e.length;g++)v.push(Ot(e[g]));for(var b=0;b<v.length;b++){var y=Ct(v[b],void 0===h[h.length-1]?c:h[h.length-1],void 0===v[b+1]?null:v[b+1]);null!==y&&h.push(y)}return l.concat(h)}var Ut=function(){function e(t,n){var r,i,a,o,s;if(!e.isTimelineIndexArgument(t))throw new Error(\"The given index is not compatible with a TimelineRepresentationIndex.\");var u=n.availabilityTimeComplete,l=n.availabilityTimeOffset,d=n.manifestBoundsCalculator,c=n.isDynamic,f=n.isLastPeriod,p=n.representationId,h=n.representationBitrate,v=n.periodStart,m=n.periodEnd,g=n.isEMSGWhitelisted,b=null!==(r=t.timescale)&&void 0!==r?r:1,y=(null!==(i=t.presentationTimeOffset)&&void 0!==i?i:0)-v*b;this._manifestBoundsCalculator=d,this._isEMSGWhitelisted=g,this._isLastPeriod=f,this._lastUpdate=null!==(a=n.receivedTime)&&void 0!==a?a:L(),this._unsafelyBaseOnPreviousIndex=null,null!==n.unsafelyBaseOnPreviousRepresentation&&n.unsafelyBaseOnPreviousRepresentation.index instanceof e&&(n.unsafelyBaseOnPreviousRepresentation.index._unsafelyBaseOnPreviousIndex=null,this._unsafelyBaseOnPreviousIndex=n.unsafelyBaseOnPreviousRepresentation.index),this._isDynamic=c,this._parseTimeline=null!==(o=t.timelineParser)&&void 0!==o?o:null;var _,E=void 0===(null===(s=t.initialization)||void 0===s?void 0:s.media)?null:wt(t.initialization.media,p,h),w=void 0===t.media?null:wt(t.media,p,h);_=void 0===l&&void 0===u?1/0:null!=l?l:0,this._index={availabilityTimeComplete:null==u||u,availabilityTimeOffset:_,indexRange:t.indexRange,indexTimeOffset:y,initialization:S(t.initialization)?void 0:{url:E,range:t.initialization.range},segmentUrlTemplate:w,startNumber:t.startNumber,endNumber:t.endNumber,timeline:void 0===t.timeline?null:Lt(t.timeline,t.startNumber,t.endNumber),timescale:b},this._scaledPeriodStart=yt(v,this._index),this._scaledPeriodEnd=void 0===m?void 0:yt(m,this._index)}var t=e.prototype;return t.getInitSegment=function(){return _t(this._index,this._isEMSGWhitelisted)},t.getSegments=function(e,t){this._refreshTimeline(),null===this._index.timeline&&(this._index.timeline=this._getTimeline());var n=this._index;return At({segmentUrlTemplate:n.segmentUrlTemplate,startNumber:n.startNumber,endNumber:n.endNumber,timeline:n.timeline,timescale:n.timescale,indexTimeOffset:n.indexTimeOffset},e,t,this._manifestBoundsCalculator,this._scaledPeriodEnd,this._isEMSGWhitelisted)},t.shouldRefresh=function(){return!1},t.getFirstAvailablePosition=function(){this._refreshTimeline(),null===this._index.timeline&&(this._index.timeline=this._getTimeline());var e=this._index.timeline;return 0===e.length?null:St(Math.max(this._scaledPeriodStart,e[0].start),this._index)},t.getLastAvailablePosition=function(){var e;this._refreshTimeline(),null===this._index.timeline&&(this._index.timeline=this._getTimeline());var t=Ft(this._index,this._manifestBoundsCalculator,this._scaledPeriodEnd);return null===t?null:St(Math.min(t.end,null!==(e=this._scaledPeriodEnd)&&void 0!==e?e:1/0),this._index)},t.getEnd=function(){var e;if(!this._isDynamic||this._isLastPeriod){if(this._refreshTimeline(),null===this._index.timeline&&(this._index.timeline=this._getTimeline()),this._index.timeline.length<=0)return null;var t=this._index.timeline[this._index.timeline.length-1];return St(Math.min(bt(t,null,this._scaledPeriodEnd),null!==(e=this._scaledPeriodEnd)&&void 0!==e?e:1/0),this._index)}},t.awaitSegmentBetween=function(e,t){var n,r;if(Ce(),!this._isDynamic)return!1;this._refreshTimeline(),null===this._index.timeline&&(this._index.timeline=this._getTimeline());var i=this._index,a=i.timescale,o=i.timeline,s=xt(a),u=yt(t,this._index),l=Ft(this._index,this._manifestBoundsCalculator,this._scaledPeriodEnd);if(null!==l&&Math.min(l.end,null!==(n=this._scaledPeriodEnd)&&void 0!==n?n:1/0)+s>=Math.min(u,null!==(r=this._scaledPeriodEnd)&&void 0!==r?r:1/0))return!1;var d=yt(e,this._index);if(o.length>0&&null!==l&&!l.isLastOfTimeline&&d<bt(o[o.length-1],null,this._scaledPeriodEnd)+s+s)return!0;return!!this._isLastPeriod&&(void 0===this._scaledPeriodEnd?u+s>this._scaledPeriodStart&&void 0:d-s<this._scaledPeriodEnd&&u+s>this._scaledPeriodStart)},t.isSegmentStillAvailable=function(e){return!!e.isInit||(this._refreshTimeline(),null===this._index.timeline&&(this._index.timeline=this._getTimeline()),function(e,t,n,r){var i=Ft(t,n,r);if(null===i)return!1;for(var a=0;a<t.timeline.length;a++){if(i.timelineIdx<a)return!1;var o=t.timeline[a],s=(o.start-t.indexTimeOffset)/t.timescale;if(s>e.time)return!1;if(s===e.time)return void 0===o.range?void 0===e.range:!S(e.range)&&o.range[0]===e.range[0]&&o.range[1]===e.range[1];if(o.repeatCount>=0&&void 0!==o.duration){var u=(s-o.start)/o.duration-1;return u%1==0&&u<=i.newRepeatCount}}return!1}(e,this._index,this._manifestBoundsCalculator,this._scaledPeriodEnd))},t.checkDiscontinuity=function(e){this._refreshTimeline();var t=this._index.timeline;return null===t&&(t=this._getTimeline(),this._index.timeline=t),function(e,t,n){var r=e.timeline,i=yt(t,e);if(i<0)return null;var a=function(e,t){for(var n=0,r=e.length;n<r;){var i=n+r>>>1;e[i].start<=t?n=i+1:r=i}return n-1}(r,i);if(a<0||a>=r.length-1)return null;var o=r[a];if(o.duration<=0)return null;var s=r[a+1];if(void 0===s)return null;var u=s.start;return i>=bt(o,s,n)&&i<u?St(u,e):null}({timeline:t,timescale:this._index.timescale,indexTimeOffset:this._index.indexTimeOffset},e,this._scaledPeriodEnd)},t.canBeOutOfSyncError=function(e){return!!this._isDynamic&&(e instanceof Pt&&e.isHttpError(404))},t._replace=function(e){this._parseTimeline=e._parseTimeline,this._index=e._index,this._isDynamic=e._isDynamic,this._scaledPeriodStart=e._scaledPeriodStart,this._scaledPeriodEnd=e._scaledPeriodEnd,this._lastUpdate=e._lastUpdate,this._manifestBoundsCalculator=e._manifestBoundsCalculator,this._isLastPeriod=e._isLastPeriod},t._update=function(e){null===this._index.timeline&&(this._index.timeline=this._getTimeline()),null===e._index.timeline&&(e._index.timeline=e._getTimeline()),function(e,t){if(0===e.length)return e.push.apply(e,t),!0;if(0===t.length)return!1;var n=e.length,r=t[0].start;if(bt(e[n-1],t[0])<r)throw new b(\"MANIFEST_UPDATE_ERROR\",\"Cannot perform partial update: not enough data\");for(var i=n-1;i>=0;i--){var a=e[i].start;if(a===r){var o=n-i;return e.splice.apply(e,[i,o].concat(t)),!1}if(a<r){var s=e[i];if(s.start+s.duration>r)return T.warn(\"RepresentationIndex: Manifest update removed all previous segments\"),e.splice.apply(e,[0,n].concat(t)),!0;if(void 0===s.repeatCount||s.repeatCount<=0)return s.repeatCount<0&&(s.repeatCount=Math.floor((r-s.start)/s.duration)-1),e.splice.apply(e,[i+1,n-(i+1)].concat(t)),!1;if(s.start+s.duration*(s.repeatCount+1)<=r)return e.splice.apply(e,[i+1,n-(i+1)].concat(t)),!1;var u=(r-s.start)/s.duration-1;if(u%1==0&&s.duration===t[0].duration){var l=t[0].repeatCount<0?-1:t[0].repeatCount+u+1;return e.splice.apply(e,[i,n-i].concat(t)),e[i].start=s.start,e[i].repeatCount=l,!1}return T.warn(\"RepresentationIndex: Manifest update removed previous segments\"),e[i].repeatCount=Math.floor(u),e.splice.apply(e,[i+1,n-(i+1)].concat(t)),!1}}var d=e[e.length-1],c=t[t.length-1];return void 0!==d.repeatCount&&d.repeatCount<0?d.start>c.start?(T.warn(\"RepresentationIndex: The new index is older than the previous one\"),!1):(T.warn('RepresentationIndex: The new index is \"bigger\" than the previous one'),e.splice.apply(e,[0,n].concat(t)),!0):d.start+d.duration*(d.repeatCount+1)>=c.start+c.duration*(c.repeatCount+1)?(T.warn(\"RepresentationIndex: The new index is older than the previous one\"),!1):(T.warn('RepresentationIndex: The new index is \"bigger\" than the previous one'),e.splice.apply(e,[0,n].concat(t)),!0)}(this._index.timeline,e._index.timeline)&&(this._index.startNumber=e._index.startNumber),this._index.availabilityTimeOffset=e._index.availabilityTimeOffset,this._index.availabilityTimeComplete=e._index.availabilityTimeComplete,this._index.endNumber=e._index.endNumber,this._isDynamic=e._isDynamic,this._scaledPeriodStart=e._scaledPeriodStart,this._scaledPeriodEnd=e._scaledPeriodEnd,this._lastUpdate=e._lastUpdate,this._isLastPeriod=e._isLastPeriod},t.isStillAwaitingFutureSegments=function(){var e;if(!this._isDynamic)return!1;this._refreshTimeline(),null===this._index.timeline&&(this._index.timeline=this._getTimeline());var t=this._index.timeline;if(0===t.length){if(void 0!==this._scaledPeriodEnd){var n=this._manifestBoundsCalculator.getEstimatedLiveEdge();if(void 0!==n&&yt(n,this._index)>this._scaledPeriodEnd)return!1}return this._isLastPeriod}var r=xt(this._index.timescale),i=Ft(this._index,this._manifestBoundsCalculator,this._scaledPeriodEnd);if(null!==i&&!i.isLastOfTimeline){var a=Math.min(i.end,null!==(e=this._scaledPeriodEnd)&&void 0!==e?e:1/0);return!(void 0!==this._scaledPeriodEnd&&a+r>=this._scaledPeriodEnd)}return!!this._isLastPeriod&&(void 0===this._scaledPeriodEnd||bt(t[t.length-1],null,this._scaledPeriodEnd)+r<this._scaledPeriodEnd)},t.isInitialized=function(){return!0},t.initialize=function(){T.error(\"A `TimelineRepresentationIndex` does not need to be initialized\")},t.addPredictedSegments=function(){T.warn(\"Cannot add predicted segments to a `TimelineRepresentationIndex`\")},e.isTimelineIndexArgument=function(e){return\"function\"==typeof e.timelineParser||Array.isArray(e.timeline)},t._refreshTimeline=function(){if(null===this._index.timeline&&(this._index.timeline=this._getTimeline()),this._isDynamic){var e=this._manifestBoundsCalculator.getEstimatedMinimumSegmentTime();if(!S(e)){var t=yt(e,this._index),n=function(e,t){for(var n=0;e.length>0;){var r=e[0];if(r.start>=t)return n;if(-1===r.repeatCount)return n;if(0===r.repeatCount)e.shift(),n+=1;else{var i=e[1];if(void 0!==i&&i.start<=t)e.shift(),n+=1;else{if(r.duration<=0)return n;for(var a=r.start+r.duration,o=1;a<t&&o<=r.repeatCount;)a+=r.duration,o++;if(!(o>r.repeatCount)){var s=r.repeatCount-o;return r.start=a,r.repeatCount=s,n+o}e.shift(),n=r.repeatCount+1}}}return n}(this._index.timeline,t);void 0!==this._index.startNumber?this._index.startNumber+=n:void 0!==this._index.endNumber&&(this._index.startNumber=n+1)}}},t._getTimeline=function(){if(null===this._parseTimeline)return null!==this._index.timeline?this._index.timeline:(T.error(\"DASH: Timeline already lazily parsed.\"),[]);var e=this._parseTimeline();this._parseTimeline=null;var t,n=s.getCurrent().MIN_DASH_S_ELEMENTS_TO_PARSE_UNSAFELY;return null===this._unsafelyBaseOnPreviousIndex||e.length<n?Lt(Dt(e),this._index.startNumber,this._index.endNumber):(null===this._unsafelyBaseOnPreviousIndex._index.timeline?(t=this._unsafelyBaseOnPreviousIndex._getTimeline(),this._unsafelyBaseOnPreviousIndex._index.timeline=t):t=this._unsafelyBaseOnPreviousIndex._index.timeline,this._unsafelyBaseOnPreviousIndex=null,Lt(Nt(e,t),this._index.startNumber,this._index.endNumber))},e}();function Lt(e,t,n){if(void 0===n)return e;for(var r=null!=t?t:1,i=0;i<e.length;i++){var a=e[i];if((r+=a.repeatCount+1)>n){if(r===n+1)return e.slice(0,i+1);var o=e.slice(0,i),s=Object.assign({},a),u=r-a.repeatCount-1;return s.repeatCount=Math.max(0,n-u),o.push(s),o}}return e}function Ft(e,t,n){if(e.timeline.length<=0)return null;if(e.availabilityTimeOffset===1/0){var r=e.timeline.length-1,i=e.timeline[r];return{isLastOfTimeline:!0,timelineIdx:r,newRepeatCount:i.repeatCount,end:bt(i,null,n)}}var a=t.getEstimatedMaximumPosition(e.availabilityTimeOffset);if(void 0===a){var o=e.timeline.length-1,s=e.timeline[o];return{isLastOfTimeline:!0,timelineIdx:o,newRepeatCount:s.repeatCount,end:bt(s,null,n)}}for(var u=e.timeline.length-1;u>=e.timeline.length;u--){var l=e.timeline[u],d=l.start+l.duration;if(St(d,e)<=a){if(St(bt(l,e.timeline[u+1],n),e)<=a)return{isLastOfTimeline:u===e.timeline.length-1,timelineIdx:u,newRepeatCount:l.repeatCount,end:d};var c=yt(a,e)-l.start,f=Math.floor(c/l.duration);return Ce(),{isLastOfTimeline:!1,timelineIdx:u,newRepeatCount:f-1,end:l.start+f*l.duration}}}return null}var Bt=Ut,zt=function(){function e(e,t){var n,r,i,a=t.availabilityTimeOffset,o=t.manifestBoundsCalculator,s=t.isDynamic,u=t.periodEnd,l=t.periodStart,d=t.representationId,c=t.representationBitrate,f=t.isEMSGWhitelisted,p=null!==(n=e.timescale)&&void 0!==n?n:1;this._availabilityTimeOffset=a,this._manifestBoundsCalculator=o;var h=null!==(r=e.presentationTimeOffset)&&void 0!==r?r:0,v=h-l*p;if(void 0===e.duration)throw new Error(\"Invalid SegmentTemplate: no duration\");var m=void 0===(null===(i=e.initialization)||void 0===i?void 0:i.media)?null:wt(e.initialization.media,d,c),g=void 0===e.media?null:wt(e.media,d,c);this._index={duration:e.duration,timescale:p,indexRange:e.indexRange,indexTimeOffset:v,initialization:S(e.initialization)?void 0:{url:m,range:e.initialization.range},url:g,presentationTimeOffset:h,startNumber:e.startNumber,endNumber:e.endNumber},this._isDynamic=s,this._periodStart=l,this._scaledRelativePeriodEnd=void 0===u?void 0:(u-l)*p,this._isEMSGWhitelisted=f}var t=e.prototype;return t.getInitSegment=function(){return _t(this._index,this._isEMSGWhitelisted)},t.getSegments=function(e,t){var n=this._index,r=n.duration,i=n.startNumber,a=n.endNumber,o=n.timescale,s=n.url,u=this._periodStart*o,l=this._scaledRelativePeriodEnd,d=e*o-u,c=(e+t)*o-u,f=this._getFirstSegmentStart(),p=this._getLastSegmentStart();if(S(f)||S(p))return[];var h=Math.max(f,d),v=Math.min(p,c);if(v+r<=h)return[];for(var m=[],g=null!=i?i:1,b=Math.floor(h/r),y=b*r;y<=v;y+=r){var _=b+g;if(void 0!==a&&_>a)return m;var E=!S(l)&&y+r>l?l-y:r,w=y+u,T=y+this._index.presentationTimeOffset,A=null===s?null:Tt(T,_)(s),I={id:String(_),number:_,time:w/o,end:(w+E)/o,duration:E/o,timescale:1,isInit:!1,scaledDuration:E/o,url:A,timestampOffset:-n.indexTimeOffset/o,complete:!0,privateInfos:{isEMSGWhitelisted:this._isEMSGWhitelisted}};m.push(I),b++}return m},t.getFirstAvailablePosition=function(){var e=this._getFirstSegmentStart();return S(e)?e:e/this._index.timescale+this._periodStart},t.getLastAvailablePosition=function(){var e=this._getLastSegmentStart();if(S(e))return e;var t=this._estimateRelativeScaledEnd();return Math.min(e+this._index.duration,null!=t?t:1/0)/this._index.timescale+this._periodStart},t.getEnd=function(){if(!this._isDynamic)return this.getLastAvailablePosition();var e=this._estimateRelativeScaledEnd();if(void 0!==e){var t=this._index.timescale;return(e+this._periodStart*t)/t}},t.awaitSegmentBetween=function(e,t){if(Ce(),!this._isDynamic)return!1;var n=this._index.timescale,r=xt(n),i=this._periodStart*n,a=e*n-i,o=t*n-i,s=this._getLastSegmentStart();if(S(s)){var u=this._estimateRelativeScaledEnd();return void 0===u?o+r>=0:o+r>=0&&a<u-r}var l=s+this._index.duration,d=this._estimateRelativeScaledEnd();return void 0===d?o>l-r:o>l-r&&a<d-r},t.shouldRefresh=function(){return!1},t.checkDiscontinuity=function(){return null},t.isSegmentStillAvailable=function(e){if(e.isInit)return!0;var t=this.getSegments(e.time,.1);return 0!==t.length&&(t[0].time===e.time&&t[0].end===e.end&&t[0].number===e.number)},t.canBeOutOfSyncError=function(){return!1},t.isStillAwaitingFutureSegments=function(){if(!this._isDynamic)return!1;var e=this._estimateRelativeScaledEnd();if(void 0===e)return!0;var t=this._index.timescale,n=this._getLastSegmentStart();return!!S(n)||n+this._index.duration+xt(t)<e},t.isInitialized=function(){return!0},t.initialize=function(){T.error(\"A `TemplateRepresentationIndex` does not need to be initialized\")},t.addPredictedSegments=function(){T.warn(\"Cannot add predicted segments to a `TemplateRepresentationIndex`\")},t._replace=function(e){this._index=e._index,this._isDynamic=e._isDynamic,this._periodStart=e._periodStart,this._scaledRelativePeriodEnd=e._scaledRelativePeriodEnd,this._manifestBoundsCalculator=e._manifestBoundsCalculator},t._update=function(e){this._replace(e)},t._getFirstSegmentStart=function(){var e;if(!this._isDynamic)return 0;if(0===this._scaledRelativePeriodEnd||void 0===this._scaledRelativePeriodEnd){var t=this._manifestBoundsCalculator.getEstimatedMaximumPosition(null!==(e=this._availabilityTimeOffset)&&void 0!==e?e:0);if(void 0!==t&&t<this._periodStart)return null}var n=this._index,r=n.duration,i=n.timescale,a=this._manifestBoundsCalculator.getEstimatedMinimumSegmentTime();if(void 0!==a){var o=a>this._periodStart?(a-this._periodStart)*i:0;return Math.floor(o/r)*r}},t._getLastSegmentStart=function(){var e,t,n=this._index,r=n.duration,i=n.timescale,a=n.endNumber,o=n.startNumber,u=void 0===o?1:o;if(this._isDynamic){var l=this._manifestBoundsCalculator.getEstimatedLiveEdge();if(void 0!==l&&void 0!==this._scaledRelativePeriodEnd&&this._scaledRelativePeriodEnd<l-this._periodStart*this._index.timescale){var d=Math.ceil(this._scaledRelativePeriodEnd/r);return void 0!==a&&a-u+1<d&&(d=a-u+1),(d-1)*r}var c=this._manifestBoundsCalculator.getEstimatedMaximumPosition(null!==(e=this._availabilityTimeOffset)&&void 0!==e?e:0);if(void 0===c)return;var f=(c-this._periodStart)*i;if(f<0)return null;var p=Math.floor(f/r);return void 0!==a&&a-u+1<p&&(p=a-u+1),p<=0?null:(p-1)*r}var h=null!==(t=this._scaledRelativePeriodEnd)&&void 0!==t?t:0,v=Math.ceil(h/r);void 0!==a&&a-u+1<v&&(v=a-u+1);var m=(v-1)*r,g=s.getCurrent().MINIMUM_SEGMENT_SIZE*i;return void 0!==a||h-m>g||v<2?m:(v-2)*r},t._estimateRelativeScaledEnd=function(){var e,t;if(void 0!==this._index.endNumber){var n=this._index.endNumber-(null!==(e=this._index.startNumber)&&void 0!==e?e:1)+1;return Math.max(Math.min(n*this._index.duration,null!==(t=this._scaledRelativePeriodEnd)&&void 0!==t?t:1/0),0)}if(void 0!==this._scaledRelativePeriodEnd)return Math.max(this._scaledRelativePeriodEnd,0)},e}();function Wt(e,t){var n;if(0===t.length)return e;var r=t.map((function(e){return{url:e.value}}));if(0===e.length)return r;for(var i=[],a=0;a<e.length;a++)for(var o=e[a],s=0;s<r.length;s++){var u=r[s],l=$e(o.url,u.url);i.push({url:l,serviceLocation:null!==(n=u.serviceLocation)&&void 0!==n?n:o.serviceLocation})}return i}function Vt(e,t){var n=\"undefined\"!=typeof Symbol&&e[Symbol.iterator]||e[\"@@iterator\"];if(n)return(n=n.call(e)).next.bind(n);if(Array.isArray(e)||(n=function(e,t){if(!e)return;if(\"string\"==typeof e)return jt(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);\"Object\"===n&&e.constructor&&(n=e.constructor.name);if(\"Map\"===n||\"Set\"===n)return Array.from(e);if(\"Arguments\"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return jt(e,t)}(e))||t&&e&&\"number\"==typeof e.length){n&&(e=n);var r=0;return function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}}}throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\")}function jt(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Gt(e){var t=e.adaptationProfiles,n=e.essentialProperties,r=e.supplementalProperties,i=e.manifestProfiles,a=e.codecs;if(-1!==((null!=t?t:\"\")+(null!=i?i:\"\")).indexOf(\"http://dashif.org/guidelines/dash-if-uhd#hevc-hdr-pq10\")&&(\"hvc1.2.4.L153.B0\"===a||\"hev1.2.4.L153.B0\"===a))return{colorDepth:10,eotf:\"pq\",colorSpace:\"rec2020\"};var o=A([].concat(null!=n?n:[],null!=r?r:[]),(function(e){return\"urn:mpeg:mpegB:cicp:TransferCharacteristics\"===e.schemeIdUri}));if(void 0!==o)switch(o.value){case\"15\":return;case\"16\":return{eotf:\"pq\"};case\"18\":return{eotf:\"hlg\"}}return void 0!==a&&/^vp(08|09|10)/.exec(a)?function(e){var t,n,r,i=e.split(\".\"),a=i[0],o=(i[1],i[2],i[3]),s=(i[4],i[5]),u=i[6],l=i[7];if((\"vp08\"===a||\"vp09\"===a||\"vp10\"===a)&&((void 0!==o&&\"10\"===o||\"12\"===o)&&(t=parseInt(o,10)),void 0!==u&&(\"16\"===u?n=\"pq\":\"18\"===u&&(n=\"hlg\")),void 0!==s&&void 0!==l&&\"09\"===s&&\"09\"===l&&(r=\"rec2020\"),void 0!==t&&void 0!==n))return{colorDepth:t,eotf:n,colorSpace:r}}(a):void 0}function Ht(e,t,n){for(var r,a,o,s,u,l,d=[],c=function(){for(var e=l.value,c=void 0!==e.attributes.id?e.attributes.id:String(e.attributes.bitrate)+(void 0!==e.attributes.height?\"-\"+e.attributes.height:\"\")+(void 0!==e.attributes.width?\"-\"+e.attributes.width:\"\")+(void 0!==e.attributes.mimeType?\"-\"+e.attributes.mimeType:\"\")+(void 0!==e.attributes.codecs?\"-\"+e.attributes.codecs:\"\");d.some((function(e){return e.id===c}));)c+=\"-dup\";var f,p=null!==(a=null===(r=n.unsafelyBaseOnPreviousAdaptation)||void 0===r?void 0:r.getRepresentation(c))&&void 0!==a?a:null,h=function(e,t){var n=[];if(void 0!==e.children.inbandEventStreams&&n.push.apply(n,e.children.inbandEventStreams),void 0!==t.children.inbandEventStreams&&n.push.apply(n,t.children.inbandEventStreams),0!==n.length)return n}(e,t),v=null!==(o=e.attributes.availabilityTimeComplete)&&void 0!==o?o:n.availabilityTimeComplete;void 0===e.attributes.availabilityTimeOffset&&void 0===n.availabilityTimeOffset||(f=(null!==(s=e.attributes.availabilityTimeOffset)&&void 0!==s?s:0)+(null!==(u=n.availabilityTimeOffset)&&void 0!==u?u:0));var m,g=function(e,t){var n,r,a,o=t.availabilityTimeOffset,s=t.manifestBoundsCalculator,u=t.isDynamic,l=t.end,d=t.start,c=t.receivedTime,f=t.unsafelyBaseOnPreviousRepresentation,p=t.inbandEventStreams,h={availabilityTimeComplete:void 0,availabilityTimeOffset:o,unsafelyBaseOnPreviousRepresentation:f,isEMSGWhitelisted:function(e){return void 0!==p&&p.some((function(t){return t.schemeIdUri===e.schemeIdUri}))},isLastPeriod:t.isLastPeriod,manifestBoundsCalculator:s,isDynamic:u,periodEnd:l,periodStart:d,receivedTime:c,representationBitrate:e.attributes.bitrate,representationId:e.attributes.id};if(void 0!==e.children.segmentBase){var v=e.children.segmentBase;a=new kt(v,h)}else if(void 0!==e.children.segmentList){var m=e.children.segmentList;a=new Rt(m,h)}else if(void 0!==e.children.segmentTemplate||t.parentSegmentTemplates.length>0){var g=t.parentSegmentTemplates.slice(),b=e.children.segmentTemplate;void 0!==b&&g.push(b);var y=i.apply(void 0,[{}].concat(g));void 0===y.availabilityTimeOffset&&void 0===t.availabilityTimeOffset||(h.availabilityTimeOffset=(null!==(n=y.availabilityTimeOffset)&&void 0!==n?n:0)+(null!==(r=t.availabilityTimeOffset)&&void 0!==r?r:0)),a=Bt.isTimelineIndexArgument(y)?new Bt(y,h):new zt(y,h)}else{var S=t.adaptation.children;if(void 0!==S.segmentBase){var _=S.segmentBase;a=new kt(_,h)}else if(void 0!==S.segmentList){var E=S.segmentList;a=new Rt(E,h)}else a=new zt({duration:Number.MAX_VALUE,timescale:1,startNumber:0,media:\"\"},h)}return a}(e,i({},n,{availabilityTimeOffset:f,availabilityTimeComplete:v,unsafelyBaseOnPreviousRepresentation:p,adaptation:t,inbandEventStreams:h}));void 0===e.attributes.bitrate?(T.warn(\"DASH: No usable bitrate found in the Representation.\"),m=0):m=e.attributes.bitrate;var b,y,S,_=Wt(n.baseURLs,e.children.baseURLs),E={bitrate:m,cdnMetadata:0===_.length?[{baseUrl:\"\",id:void 0}]:_.map((function(e){return{baseUrl:e.url,id:e.serviceLocation}})),index:g,id:c};void 0!==e.children.supplementalProperties&&A(e.children.supplementalProperties,(function(e){return\"tag:dolby.com,2018:dash:EC3_ExtensionType:2018\"===e.schemeIdUri&&\"JOC\"===e.value}))&&(E.isSpatialAudio=!0),void 0!==e.attributes.codecs?b=e.attributes.codecs:void 0!==t.attributes.codecs&&(b=t.attributes.codecs),void 0!==b&&(b=\"mp4a.40.02\"===b?\"mp4a.40.2\":b,E.codecs=b),void 0!==e.attributes.supplementalCodecs?y=e.attributes.supplementalCodecs:void 0!==t.attributes.supplementalCodecs&&(y=t.attributes.supplementalCodecs),void 0!==y&&(E.supplementalCodecs=Q(S=y)?S.trim().replace(mt,\", \"):\"\"),void 0!==e.attributes.frameRate?E.frameRate=e.attributes.frameRate:void 0!==t.attributes.frameRate&&(E.frameRate=t.attributes.frameRate),void 0!==e.attributes.height?E.height=e.attributes.height:void 0!==t.attributes.height&&(E.height=t.attributes.height),void 0!==e.attributes.mimeType?E.mimeType=e.attributes.mimeType:void 0!==t.attributes.mimeType&&(E.mimeType=t.attributes.mimeType),void 0!==e.attributes.width?E.width=e.attributes.width:void 0!==t.attributes.width&&(E.width=t.attributes.width);var w=void 0!==t.children.contentProtections?t.children.contentProtections:[];if(void 0!==e.children.contentProtections&&w.push.apply(w,e.children.contentProtections),w.length>0){var I=w.reduce((function(e,t){var n;if(void 0!==t.attributes.schemeIdUri&&\"urn:uuid:\"===t.attributes.schemeIdUri.substring(0,9)&&(n=t.attributes.schemeIdUri.substring(9).replace(/-/g,\"\").toLowerCase()),void 0!==t.attributes.keyId&&t.attributes.keyId.length>0){var r={keyId:t.attributes.keyId,systemId:n};void 0===e.keyIds?e.keyIds=[r]:e.keyIds.push(r)}if(void 0!==n){for(var i,a=[],o=Vt(t.children.cencPssh);!(i=o()).done;){var s=i.value;a.push({systemId:n,data:s})}if(a.length>0){var u,l=A(e.initData,(function(e){return\"cenc\"===e.type}));if(void 0===l)e.initData.push({type:\"cenc\",values:a});else(u=l.values).push.apply(u,a)}}return e}),{keyIds:void 0,initData:[]});(Object.keys(I.initData).length>0||void 0!==I.keyIds&&I.keyIds.length>0)&&(E.contentProtections=I)}E.hdrInfo=Gt({adaptationProfiles:t.attributes.profiles,supplementalProperties:t.children.supplementalProperties,essentialProperties:t.children.essentialProperties,manifestProfiles:n.manifestProfiles,codecs:b}),d.push(E)},f=Vt(e);!(l=f()).done;)c();return d}function qt(e,t){var n=\"undefined\"!=typeof Symbol&&e[Symbol.iterator]||e[\"@@iterator\"];if(n)return(n=n.call(e)).next.bind(n);if(Array.isArray(e)||(n=function(e,t){if(!e)return;if(\"string\"==typeof e)return Kt(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);\"Object\"===n&&e.constructor&&(n=e.constructor.name);if(\"Map\"===n||\"Set\"===n)return Array.from(e);if(\"Arguments\"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Kt(e,t)}(e))||t&&e&&\"number\"==typeof e.length){n&&(e=n);var r=0;return function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}}}throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\")}function Kt(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Yt(e){if(void 0===e)return!1;var t=\"urn:tva:metadata:cs:AudioPurposeCS:2007\"===e.schemeIdUri&&\"1\"===e.value,n=\"urn:mpeg:dash:role:2011\"===e.schemeIdUri&&\"description\"===e.value;return t||n}function Qt(e,t){if(void 0!==e&&e.some((function(e){return\"urn:tva:metadata:cs:AudioPurposeCS:2007\"===e.schemeIdUri&&\"2\"===e.value})))return!0;if(void 0!==t&&t.some((function(e){return\"urn:mpeg:dash:role:2011\"===e.schemeIdUri&&\"caption\"===e.value})))return!0;return!1}function Xt(e){return void 0!==e&&(\"urn:mpeg:dash:role:2011\"===e.schemeIdUri&&\"sign\"===e.value)}function $t(e,t){if(Q(e.attributes.id))return e.attributes.id;var n=t.isClosedCaption,r=t.isForcedSubtitle,i=t.isAudioDescription,a=t.isSignInterpreted,o=t.isTrickModeTrack,s=t.type;return Q(e.attributes.language)&&(s+=\"-\"+e.attributes.language),!0===n&&(s+=\"-cc\"),!0===r&&(s+=\"-cc\"),!0===i&&(s+=\"-ad\"),!0===a&&(s+=\"-si\"),o&&(s+=\"-trickMode\"),Q(e.attributes.contentType)&&(s+=\"-\"+e.attributes.contentType),Q(e.attributes.codecs)&&(s+=\"-\"+e.attributes.codecs),Q(e.attributes.mimeType)&&(s+=\"-\"+e.attributes.mimeType),void 0!==e.attributes.frameRate&&(s+=\"-\"+String(e.attributes.frameRate)),s}function Zt(e){if(!S(e.children.supplementalProperties))for(var t,n=qt(e.children.supplementalProperties);!(t=n()).done;){var r=t.value;if(\"urn:mpeg:dash:adaptation-set-switching:2016\"===r.schemeIdUri&&!S(r.value))return r.value.split(\",\").map((function(e){return e.trim()})).filter((function(e){return e}))}return[]}function Jt(e,t){var n=t[1].priority-e[1].priority;return 0!==n?n:e[1].isMainAdaptation!==t[1].isMainAdaptation?e[1].isMainAdaptation?-1:1:e[1].indexInMpd-t[1].indexInMpd}function en(e,t){var n=\"undefined\"!=typeof Symbol&&e[Symbol.iterator]||e[\"@@iterator\"];if(n)return(n=n.call(e)).next.bind(n);if(Array.isArray(e)||(n=function(e,t){if(!e)return;if(\"string\"==typeof e)return tn(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);\"Object\"===n&&e.constructor&&(n=e.constructor.name);if(\"Map\"===n||\"Set\"===n)return Array.from(e);if(\"Arguments\"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return tn(e,t)}(e))||t&&e&&\"number\"==typeof e.length){n&&(e=n);var r=0;return function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}}}throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\")}function tn(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var nn=I();function rn(e,t){var n,r,i,a,o=[],s=function(e,t){var n=[];return e.forEach((function(r,i){var a,o;if(S(r.attributes.start))if(0===i)a=!t.isDynamic||S(t.availabilityStartTime)?0:t.availabilityStartTime;else{var s=n[n.length-1];if(S(s)||S(s.periodEnd))throw new Error(\"Missing start time when parsing periods.\");a=s.periodEnd}else a=r.attributes.start;var u=e[i+1];S(r.attributes.duration)?i===e.length-1?o=t.duration:S(u.attributes.start)||(o=u.attributes.start-a):o=r.attributes.duration;var l=S(o)?void 0:a+o;n.push({periodStart:a,periodDuration:o,periodEnd:l})})),n}(e,t);if(s.length!==e.length)throw new Error(\"MPD parsing error: the time information are incoherent.\");var u=t.isDynamic,l=t.manifestBoundsCalculator;u||S(t.duration)||l.setLastPosition(t.duration);for(var d=function(){var d,f=c===e.length-1,p=e[c],h=t.xlinkInfos.get(p),v=Wt(t.baseURLs,p.children.baseURLs),m=s[c],g=m.periodStart,b=m.periodDuration,y=m.periodEnd;for(S(p.attributes.id)?(T.warn(\"DASH: No usable id found in the Period. Generating one.\"),d=\"gen-dash-period-\"+nn()):d=p.attributes.id;o.some((function(e){return e.id===d}));)d+=\"-dup\";var _=void 0!==h?h.receivedTime:t.receivedTime,E=null!==(r=null===(n=t.unsafelyBaseOnPreviousManifest)||void 0===n?void 0:n.getPeriod(d))&&void 0!==r?r:null,w=p.attributes.availabilityTimeComplete,I=p.attributes.availabilityTimeOffset,R=t.manifestProfiles,P=p.children.segmentTemplate,C={availabilityTimeComplete:w,availabilityTimeOffset:I,baseURLs:v,manifestBoundsCalculator:l,end:y,isDynamic:u,isLastPeriod:f,manifestProfiles:R,receivedTime:_,segmentTemplate:P,start:g,unsafelyBaseOnPreviousPeriod:E},M=function(e,t){for(var n,r,i,a,o,s,u,l={video:[],audio:[],text:[]},d=[],c={},f=[],p=0;p<e.length;p++){var h=e[p],v=h.children,m=v.essentialProperties,g=v.roles,b=v.label,y=Array.isArray(g)&&g.some((function(e){return\"main\"===e.value}))&&g.some((function(e){return\"urn:mpeg:dash:role:2011\"===e.schemeIdUri})),_=h.children.representations,E=null!==(n=h.attributes.availabilityTimeComplete)&&void 0!==n?n:t.availabilityTimeComplete,w=void 0;void 0===h.attributes.availabilityTimeOffset&&void 0===t.availabilityTimeOffset||(w=(null!==(r=h.attributes.availabilityTimeOffset)&&void 0!==r?r:0)+(null!==(i=t.availabilityTimeOffset)&&void 0!==i?i:0));var I=h.attributes.mimeType,R=h.attributes.codecs,P=vt(_,Q(I)?I:null,Q(R)?R:null,S(v.roles)?null:v.roles);if(void 0!==P){var C=null!==(a=h.attributes.selectionPriority)&&void 0!==a?a:1,M=h.attributes.id,O=Zt(h),D=[];void 0!==t.segmentTemplate&&D.push(t.segmentTemplate),void 0!==h.children.segmentTemplate&&D.push(h.children.segmentTemplate);var N={availabilityTimeComplete:E,availabilityTimeOffset:w,baseURLs:Wt(t.baseURLs,v.baseURLs),manifestBoundsCalculator:t.manifestBoundsCalculator,end:t.end,isDynamic:t.isDynamic,isLastPeriod:t.isLastPeriod,manifestProfiles:t.manifestProfiles,parentSegmentTemplates:D,receivedTime:t.receivedTime,start:t.start,unsafelyBaseOnPreviousAdaptation:null},U=Array.isArray(m)?A(m,(function(e){return\"http://dashif.org/guidelines/trickmode\"===e.schemeIdUri})):void 0,L=null===(o=null==U?void 0:U.value)||void 0===o?void 0:o.split(\" \"),F=void 0!==L,B=v.accessibilities,W=void 0;void 0!==g&&g.some((function(e){return\"dub\"===e.value}))&&(W=!0);var V=void 0;V=\"text\"===P&&Qt(B,g);var j=void 0;\"text\"===P&&void 0!==g&&g.some((function(e){return\"forced-subtitle\"===e.value||\"forced_subtitle\"===e.value}))&&(j=!0);var G=void 0;\"audio\"!==P?G=!1:void 0!==B&&(G=B.some(Yt));var H=void 0;\"video\"!==P?H=!1:void 0!==B&&(H=B.some(Xt));for(var q=$t(h,{isAudioDescription:G,isForcedSubtitle:j,isClosedCaption:V,isSignInterpreted:H,isTrickModeTrack:F,type:P});k(f,q);)q+=\"-dup\";var K=q;f.push(q),N.unsafelyBaseOnPreviousAdaptation=null!==(u=null===(s=t.unsafelyBaseOnPreviousPeriod)||void 0===s?void 0:s.getAdaptation(q))&&void 0!==u?u:null;var Y={id:q,representations:Ht(_,h,N),type:P,isTrickModeTrack:F};if(S(h.attributes.language)||(Y.language=h.attributes.language),S(V)||(Y.closedCaption=V),S(G)||(Y.audioDescription=G),!0===W&&(Y.isDub=!0),void 0!==j&&(Y.forcedSubtitles=j),!0===H&&(Y.isSignInterpreted=!0),void 0!==b&&(Y.label=b),void 0!==L)d.push({adaptation:Y,trickModeAttachedAdaptationIds:L});else{for(var X,$=-1,Z=function(){var e=X.value,t=c[e];if(void 0!==t&&t.newID!==K&&k(t.adaptationSetSwitchingIDs,M)){$=x(l[P],(function(t){return t[0].id===e}));var n,r=l[P][$];if(void 0!==r&&r[0].audioDescription===Y.audioDescription&&r[0].closedCaption===Y.closedCaption&&r[0].language===Y.language)return T.info('DASH Parser: merging \"switchable\" AdaptationSets',M,e),(n=r[0].representations).push.apply(n,Y.representations),r[1]={priority:Math.max(C,r[1].priority),isMainAdaptation:y||r[1].isMainAdaptation,indexInMpd:Math.min(p,r[1].indexInMpd)},1}},J=qt(O);!(X=J()).done&&!Z(););$<0&&l[P].push([Y,{priority:C,isMainAdaptation:y,indexInMpd:p}])}!S(M)&&S(c[M])&&(c[M]={newID:K,adaptationSetSwitchingIDs:O})}}var ee=z.reduce((function(e,t){var n=l[t];return n.length>0&&(n.sort(Jt),e[t]=n.map((function(e){return e[0]}))),e}),{});return l.video.sort(Jt),pt(ee,d),ee}(p.children.adaptations,C),O=(null!==(i=t.xmlNamespaces)&&void 0!==i?i:[]).concat(null!==(a=p.attributes.namespaces)&&void 0!==a?a:[]),D=function(e,t,n){for(var r,i,a,o=[],s=en(e);!(a=s()).done;)for(var u,l=a.value,d=l.attributes,c=d.schemeIdUri,f=void 0===c?\"\":c,p=d.timescale,h=void 0===p?1:p,v=n.concat(null!==(r=l.attributes.namespaces)&&void 0!==r?r:[]),m=en(l.children.events);!(u=m()).done;){var g=u.value;if(void 0!==g.eventStreamData){var b=(null!==(i=g.presentationTime)&&void 0!==i?i:0)/h+t,y=void 0===g.duration?void 0:b+g.duration/h,S=void 0,_=void 0;if(!_e&&g.eventStreamData instanceof Element)S=g.eventStreamData;else try{_={namespaces:v,data:\"string\"==typeof g.eventStreamData?g.eventStreamData:ut(new Uint8Array(g.eventStreamData))}}catch(e){T.error(\"DASH: Error while parsing event-stream:\",e instanceof Error?e.message:\"Unknown error\")}o.push({start:b,end:y,id:g.id,data:{type:\"dash-event-stream\",value:{schemeIdUri:f,timescale:h,element:S,xmlData:_}}})}}return o}(p.children.eventStreams,g,O),N={id:d,start:g,end:y,duration:b,adaptations:M,streamEvents:D};if(o.unshift(N),!l.lastPositionIsKnown()){var U=function(e){for(var t,n=null,r=!0,i=en(function(e,t){return\"function\"==typeof Array.prototype.flatMap?e.flatMap(t):e.reduce((function(e,n){var r=t(n);return Array.isArray(r)?(e.push.apply(e,r),e):(e.push(r),e)}),[])}(B(e).filter((function(e){return!S(e)})),(function(e){return e})));!(t=i()).done;)for(var a,o=en(t.value.representations);!(a=o()).done;){var s=a.value.index.getLastAvailablePosition();null!==s&&(r=!1,\"number\"==typeof s&&(n=S(n)?s:Math.max(n,s)))}if(!S(n))return n;if(r)return null;return}(M);if(u)if(\"number\"==typeof U){var F=L()/1e3;l.setLastPosition(U,F)}else{var W=an(t,g);if(void 0!==W){var V=W[0],j=W[1];l.setLastPosition(V,j)}}else\"number\"==typeof U&&l.setLastPosition(U)}},c=e.length-1;c>=0;c--)d();if(t.isDynamic&&!l.lastPositionIsKnown()){var f=an(t,0);if(void 0!==f){var p=f[0],h=f[1];l.setLastPosition(p,h)}}return function(e){if(0===e.length)return[];for(var t=[e[0]],n=1;n<e.length;n++){for(var r=e[n],i=t[t.length-1];(void 0===i.duration||i.start+i.duration>r.start)&&(T.warn(\"DASH: Updating overlapping Periods.\",null==i?void 0:i.start,r.start),i.duration=r.start-i.start,i.end=r.start,!(i.duration>0))&&(t.pop(),0!==t.length);)i=t[t.length-1];t.push(r)}return t}(o)}function an(e,t){if(S(e.clockOffset)){var n=Date.now()/1e3;if(n>=t)return T.warn(\"DASH Parser: no clock synchronization mechanism found. Using the system clock instead.\"),[n-e.availabilityStartTime,L()/1e3]}else{var r=e.clockOffset/1e3-e.availabilityStartTime,i=L()/1e3,a=i+r;if(a>=t)return[a,i]}}function on(e,t){var n=\"undefined\"!=typeof Symbol&&e[Symbol.iterator]||e[\"@@iterator\"];if(n)return(n=n.call(e)).next.bind(n);if(Array.isArray(e)||(n=function(e,t){if(!e)return;if(\"string\"==typeof e)return sn(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);\"Object\"===n&&e.constructor&&(n=e.constructor.name);if(\"Map\"===n||\"Set\"===n)return Array.from(e);if(\"Arguments\"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return sn(e,t)}(e))||t&&e&&\"number\"==typeof e.length){n&&(e=n);var r=0;return function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}}}throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\")}function sn(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var un=function e(t,n,r,i,a){void 0===a&&(a=new WeakMap);var o=t.children,u=t.attributes;if(S(n.externalClockOffset)){var l=\"dynamic\"===u.type,d=A(o.utcTimings,(function(e){return\"urn:mpeg:dash:utc:direct:2014\"===e.schemeIdUri&&!S(e.value)})),c=S(d)||S(d.value)?void 0:Je(d.value),f=S(c)||isNaN(c)?void 0:c;if(S(f)||!0===i){if(l&&!0!==i){var p=function(e){var t=e.children.utcTimings.filter((function(e){return(\"urn:mpeg:dash:utc:http-iso:2014\"===e.schemeIdUri||\"urn:mpeg:dash:utc:http-xsdate:2014\"===e.schemeIdUri)&&void 0!==e.value}));return t.length>0?t[0].value:void 0}(t);if(!S(p)&&p.length>0)return{type:\"needs-clock\",value:{url:p,continue:function(i){return i.success?(n.externalClockOffset=Je(i.data),e(t,n,r,!0)):(r.push(i.error),T.warn(\"DASH Parser: Error on fetching the clock ressource\",i.error),e(t,n,r,!0))}}}}}else n.externalClockOffset=f}for(var h=[],v=0;v<o.periods.length;v++){var m=o.periods[v].attributes,g=m.xlinkHref,b=m.xlinkActuate;S(g)||\"onLoad\"!==b||h.push({index:v,ressource:g})}return 0===h.length?function(e,t,n,r){var i,a,o,u,l,d,c,f=e.children,p=e.attributes,h=\"dynamic\"===p.type,v=void 0!==t.url?[{url:t.url.substring(0,Ze(t.url))}]:[],m=Wt(v,f.baseURLs),g=function(e,t){return\"dynamic\"!==e.type?0:S(e.availabilityStartTime)?null!=t?t:0:e.availabilityStartTime}(p,t.referenceDateTime),b=p.timeShiftBufferDepth,y=t.externalClockOffset,_=t.unsafelyBaseOnPreviousManifest,E=t.externalClockOffset,w=new rt({availabilityStartTime:g,isDynamic:h,timeShiftBufferDepth:b,serverTimestampOffset:E}),A={availabilityStartTime:g,baseURLs:m,clockOffset:y,duration:p.duration,isDynamic:h,manifestBoundsCalculator:w,manifestProfiles:e.attributes.profiles,receivedTime:t.manifestReceivedTime,timeShiftBufferDepth:b,unsafelyBaseOnPreviousManifest:_,xlinkInfos:r,xmlNamespaces:e.attributes.namespaces},I=rn(f.periods,A),k=p.duration,R=null;void 0!==p.minimumUpdatePeriod&&p.minimumUpdatePeriod>=0&&(l=0===p.minimumUpdatePeriod?s.getCurrent().DASH_FALLBACK_LIFETIME_WHEN_MINIMUM_UPDATE_PERIOD_EQUAL_0:p.minimumUpdatePeriod);var P=nt(I),x=P.minimumSafePosition,C=P.maximumSafePosition,M=P.maximumUnsafePosition,O=L();if(h){var D;if(void 0!==C)D=C;else if(void 0===E)T.warn(\"DASH Parser: use system clock to define maximum position\"),D=Date.now()/1e3-g;else D=(L()+E)/1e3-g;var N=w.getEstimatedLiveEdge();void 0===N&&(N=void 0!==M?M:D),c={isLinear:!0,maximumSafePosition:D,livePosition:N,time:O},d=x,null!==(R=null!=b?b:null)&&void 0!==d&&N-d>R&&(R=N-d)}else{void 0===(d=x)&&(d=null!==(a=null===(i=I[0])||void 0===i?void 0:i.start)&&void 0!==a?a:0);var U=null!=k?k:1/0;if(void 0!==I[I.length-1]){var F=I[I.length-1],B=null!==(o=F.end)&&void 0!==o?o:void 0!==F.duration?F.start+F.duration:void 0;void 0!==B&&B<U&&(U=B)}void 0!==C&&C<U&&(U=C),c={isLinear:!1,maximumSafePosition:U,livePosition:void 0,time:O}}var z=!h||void 0===e.attributes.minimumUpdatePeriod&&(void 0!==(null===(u=I[I.length-1])||void 0===u?void 0:u.end)||void 0!==e.attributes.duration),W={availabilityStartTime:g,clockOffset:t.externalClockOffset,isDynamic:h,isLive:h,isLastPeriodKnown:z,periods:I,publishTime:p.publishTime,suggestedPresentationDelay:p.suggestedPresentationDelay,transportType:\"dash\",timeBounds:{minimumSafePosition:d,timeshiftDepth:R,maximumTimeData:c},lifetime:l,uris:S(t.url)?f.locations:[t.url].concat(f.locations)};return{type:\"done\",value:{parsed:W,warnings:n}}}(t,n,r,a):{type:\"needs-xlinks\",value:{xlinksUrls:h.map((function(e){return e.ressource})),continue:function(s){if(s.length!==h.length)throw new Error(\"DASH parser: wrong number of loaded ressources.\");for(var u=s.length-1;u>=0;u--){var l,d=h[u].index,c=s[u],f=c.parsed,p=c.warnings,v=c.receivedTime,m=c.sendingTime,g=c.url;p.length>0&&r.push.apply(r,p);for(var b,y=on(f);!(b=y()).done;){var S=b.value;a.set(S,{receivedTime:v,sendingTime:m,url:g})}(l=o.periods).splice.apply(l,[d,1].concat(f))}return e(t,n,r,i,a)}}}};function ln(e,t,n){if(\"function\"==typeof String.prototype.startsWith)return e.startsWith(t,n);var r=\"number\"==typeof n?Math.max(n,0):0;return e.substring(r,r+t.length)===t}var dn=[255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,62,255,255,255,63,52,53,54,55,56,57,58,59,60,61,255,255,255,0,255,255,255,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,255,255,255,255,255,255,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51];function cn(e){if(e>=dn.length)throw new Error(\"Unable to parse base64 string.\");var t=dn[e];if(255===t)throw new Error(\"Unable to parse base64 string.\");return t}function fn(e){var t=e.length%4,n=e;0!==t&&(T.warn(\"base64ToBytes: base64 given miss padding\"),n+=3===t?\"=\":2===t?\"==\":\"===\");var r=n.indexOf(\"=\");if(-1!==r&&r<n.length-2)throw new Error(\"Unable to parse base64 string.\");for(var i,a=n.endsWith(\"==\")?2:n.endsWith(\"=\")?1:0,o=n.length,s=new Uint8Array(o/4*3),u=0,l=0;u<o;u+=4,l+=3)i=cn(n.charCodeAt(u))<<18|cn(n.charCodeAt(u+1))<<12|cn(n.charCodeAt(u+2))<<6|cn(n.charCodeAt(u+3)),s[l]=i>>16,s[l+1]=i>>8&255,s[l+2]=255&i;return s.subarray(0,s.length-a)}var pn=/^P(([\\d.]*)Y)?(([\\d.]*)M)?(([\\d.]*)D)?T?(([\\d.]*)H)?(([\\d.]*)M)?(([\\d.]*)S)?/,hn=/([0-9]+)-([0-9]+)/;function vn(e,t){return\"true\"===e?[!0,null]:\"false\"===e?[!1,null]:[!1,new In(\"`\"+t+'` property is not a boolean value but \"'+e+'\"')]}function mn(e,t){var n=parseInt(e,10);return isNaN(n)?[null,new In(\"`\"+t+'` property is not an integer value but \"'+e+'\"')]:[n,null]}function gn(e,t){if(\"INF\"===e)return[1/0,null];var n=parseFloat(e);return isNaN(n)?[null,new In(\"`\"+t+'` property is invalid: \"'+e+'\"')]:[n,null]}function bn(e,t){if(\"true\"===e)return[!0,null];if(\"false\"===e)return[!1,null];var n=parseInt(e,10);return isNaN(n)?[null,new In(\"`\"+t+'` property is not a boolean nor an integer but \"'+e+'\"')]:[n,null]}function yn(e,t){var n=Date.parse(e);return isNaN(n)?[null,new In(\"`\"+t+'` is in an invalid date format: \"'+e+'\"')]:[new Date(Date.parse(e)).getTime()/1e3,null]}function Sn(e,t){if(!Q(e))return[0,new In(\"`\"+t+\"` property is empty\")];var n=pn.exec(e);return null===n?[null,new In(\"`\"+t+'` property has an unrecognized format \"'+e+'\"')]:[365*parseFloat(Q(n[2])?n[2]:\"0\")*24*60*60+30*parseFloat(Q(n[4])?n[4]:\"0\")*24*60*60+24*parseFloat(Q(n[6])?n[6]:\"0\")*60*60+60*parseFloat(Q(n[8])?n[8]:\"0\")*60+60*parseFloat(Q(n[10])?n[10]:\"0\")+parseFloat(Q(n[12])?n[12]:\"0\"),null]}function _n(e,t){var n=hn.exec(e);return null===n?[null,new In(\"`\"+t+'` property has an unrecognized format \"'+e+'\"')]:[[+n[1],+n[2]],null]}function En(e,t){try{return[fn(e),null]}catch(n){return[null,new In(\"`\"+t+'` is not a valid base64 string: \"'+e+'\"')]}}function wn(e,t){var n=/^(\\d+)\\/(\\d+)$/.exec(e);return null!==n?[+n[1]/+n[2],null]:gn(e,t)}function Tn(e){for(var t,n,r=0,i=Object.keys(e.attributes);r<i.length;r++){var a=i[r],o=e.attributes[a];if(!S(o))switch(a){case\"schemeIdUri\":t=o;break;case\"value\":n=o}}return{schemeIdUri:t,value:n}}function An(e,t){return function(n,r){var i=r.asKey,a=(0,r.parser)(n,r.dashName),o=a[0],s=a[1];null!==s&&(T.warn(s.message),t.push(s)),null!==o&&(e[i]=o)}}var In=function(e){function t(n){var r;return r=e.call(this)||this,Object.setPrototypeOf(u(r),t.prototype),r.name=\"MPDError\",r.message=n,r}return l(t,e),t}(c(Error));function kn(e){return Ke(e)}function Rn(e){var t=\"string\"==typeof e?e:kn(e.children),n=[];return null===t||0===t.length?[void 0,n]:[{value:t},n]}function Pn(e){for(var t={},n=0,r=Object.keys(e.attributes);n<r.length;n++){var i=r[n],a=e.attributes[i];if(!S(a))switch(i){case\"id\":t.id=a;break;case\"lang\":t.language=a;break;case\"contentType\":t.contentType=a;break;case\"par\":t.par=a}}return t}function xn(e){var t=function(e){for(var t=[],n=[],r=0;r<e.length;r++){var i=e[r];if(\"string\"!=typeof i&&\"cenc:pssh\"===i.tagName){var a=kn(i.children);if(null!==a&&a.length>0){var o=En(a,\"cenc:pssh\"),s=o[0],u=o[1];null!==u&&(T.warn(u.message),t.push(u)),null!==s&&n.push(s)}}}return[{cencPssh:n},t]}(e.children),n=t[0],r=t[1];return[{children:n,attributes:function(e){for(var t={},n=0,r=Object.keys(e.attributes);n<r.length;n++){var i=r[n],a=e.attributes[i];if(!S(a))switch(i){case\"schemeIdUri\":t.schemeIdUri=a;break;case\"value\":t.value=a;break;case\"cenc:default_KID\":t.keyId=lt(a.replace(/-/g,\"\"))}}return t}(e)},r]}function Cn(e){for(var t={},n=[],r=An(t,n),i=0,a=Object.keys(e.attributes);i<a.length;i++){var o=a[i],s=e.attributes[o];if(!S(s))switch(o){case\"range\":r(s,{asKey:\"range\",parser:_n,dashName:\"range\"});break;case\"sourceURL\":t.media=s}}return[t,n]}function Mn(e){for(var t={},n=[],r=An(t,n),i=e.children,a=0;a<i.length;a++){var o=i[a];if(\"string\"!=typeof o&&\"Initialization\"===o.tagName){var s=Cn(o),u=s[0],l=s[1];t.initialization=u,n=n.concat(l)}}for(var d=0,c=Object.keys(e.attributes);d<c.length;d++){var f=c[d],p=e.attributes[f];if(!S(p))switch(f){case\"timescale\":r(p,{asKey:\"timescale\",parser:mn,dashName:\"timescale\"});break;case\"presentationTimeOffset\":r(p,{asKey:\"presentationTimeOffset\",parser:gn,dashName:\"presentationTimeOffset\"});break;case\"indexRange\":r(p,{asKey:\"indexRange\",parser:_n,dashName:\"indexRange\"});break;case\"indexRangeExact\":r(p,{asKey:\"indexRangeExact\",parser:vn,dashName:\"indexRangeExact\"});break;case\"availabilityTimeOffset\":r(p,{asKey:\"availabilityTimeOffset\",parser:gn,dashName:\"availabilityTimeOffset\"});break;case\"availabilityTimeComplete\":r(p,{asKey:\"availabilityTimeComplete\",parser:vn,dashName:\"availabilityTimeComplete\"});break;case\"duration\":r(p,{asKey:\"duration\",parser:mn,dashName:\"duration\"});break;case\"startNumber\":r(p,{asKey:\"startNumber\",parser:mn,dashName:\"startNumber\"});break;case\"endNumber\":r(p,{asKey:\"endNumber\",parser:mn,dashName:\"endNumber\"})}}return[t,n]}function On(e){for(var t={},n=[],r=An(t,n),i=0,a=Object.keys(e.attributes);i<a.length;i++){var o=a[i],s=e.attributes[o];if(!S(s))switch(o){case\"media\":t.media=s;break;case\"indexRange\":r(s,{asKey:\"indexRange\",parser:_n,dashName:\"indexRange\"});break;case\"index\":t.index=s;break;case\"mediaRange\":r(s,{asKey:\"mediaRange\",parser:_n,dashName:\"mediaRange\"})}}return[t,n]}function Dn(e){for(var t=Mn(e),n=t[0],r=t[1],a=[],o=e.children,s=0;s<o.length;s++){var u=o[s];if(\"string\"!=typeof u&&\"SegmentURL\"===u.tagName){var l=On(u),d=l[0],c=l[1];a.push(d),r=r.concat(c)}}return[i(n,{list:a}),r]}function Nn(e){var t=e.children;return function(){for(var e=t.length-1;e>=0;e--){var n=t[e];\"string\"!=typeof n&&\"S\"===n.tagName||t.splice(e,1)}return t}}function Un(e){for(var t,n=Mn(e),r=n[0],a=n[1],o=0;o<e.children.length;o++){var s=e.children[o];\"string\"!=typeof s&&\"SegmentTimeline\"===s.tagName&&(t=Nn(s))}for(var u=i({},r,{duration:r.duration,timelineParser:t}),l=An(u,a),d=0,c=Object.keys(e.attributes);d<c.length;d++){var f=c[d],p=e.attributes[f];if(!S(p))switch(f){case\"initialization\":S(u.initialization)&&(u.initialization={media:p});break;case\"index\":u.index=p;break;case\"availabilityTimeOffset\":l(p,{asKey:\"availabilityTimeOffset\",parser:gn,dashName:\"availabilityTimeOffset\"});break;case\"availabilityTimeComplete\":l(p,{asKey:\"availabilityTimeComplete\",parser:vn,dashName:\"availabilityTimeComplete\"});break;case\"media\":u.media=p;break;case\"bitstreamSwitching\":l(p,{asKey:\"bitstreamSwitching\",parser:vn,dashName:\"bitstreamSwitching\"})}}return[u,a]}function Ln(e){var t=function(e){for(var t={baseURLs:[]},n=[],r=[],i=0;i<e.length;i++){var a=e[i];if(\"string\"!=typeof a)switch(a.tagName){case\"BaseURL\":var o=Rn(a),s=o[0],u=o[1];void 0!==s&&t.baseURLs.push(s),r=r.concat(u);break;case\"InbandEventStream\":void 0===t.inbandEventStreams&&(t.inbandEventStreams=[]),t.inbandEventStreams.push(Tn(a));break;case\"SegmentBase\":var l=Mn(a),d=l[0],c=l[1];t.segmentBase=d,c.length>0&&(r=r.concat(c));break;case\"SegmentList\":var f=Dn(a),p=f[0],h=f[1];r=r.concat(h),t.segmentList=p;break;case\"SegmentTemplate\":var v=Un(a),m=v[0],g=v[1];r=r.concat(g),t.segmentTemplate=m;break;case\"ContentProtection\":var b=xn(a),y=b[0],_=b[1];_.length>0&&(r=r.concat(_)),void 0!==y&&n.push(y);break;case\"SupplementalProperty\":S(t.supplementalProperties)?t.supplementalProperties=[Tn(a)]:t.supplementalProperties.push(Tn(a))}}return n.length>0&&(t.contentProtections=n),[t,r]}(e.children),n=t[0],r=t[1],i=function(e){for(var t={},n=[],r=An(t,n),i=0,a=Object.keys(e.attributes);i<a.length;i++){var o=a[i],s=e.attributes[o];if(!S(s))switch(o){case\"audioSamplingRate\":t.audioSamplingRate=s;break;case\"bandwidth\":r(s,{asKey:\"bitrate\",parser:mn,dashName:\"bandwidth\"});break;case\"codecs\":t.codecs=s;break;case\"codingDependency\":r(s,{asKey:\"codingDependency\",parser:vn,dashName:\"codingDependency\"});break;case\"frameRate\":r(s,{asKey:\"frameRate\",parser:wn,dashName:\"frameRate\"});break;case\"height\":r(s,{asKey:\"height\",parser:mn,dashName:\"height\"});break;case\"id\":t.id=s;break;case\"maxPlayoutRate\":r(s,{asKey:\"maxPlayoutRate\",parser:gn,dashName:\"maxPlayoutRate\"});break;case\"maximumSAPPeriod\":r(s,{asKey:\"maximumSAPPeriod\",parser:gn,dashName:\"maximumSAPPeriod\"});break;case\"mimeType\":t.mimeType=s;break;case\"profiles\":t.profiles=s;break;case\"qualityRanking\":r(s,{asKey:\"qualityRanking\",parser:mn,dashName:\"qualityRanking\"});break;case\"scte214:supplementalCodecs\":t.supplementalCodecs=s;break;case\"segmentProfiles\":t.segmentProfiles=s;break;case\"width\":r(s,{asKey:\"width\",parser:mn,dashName:\"width\"});break;case\"availabilityTimeOffset\":r(s,{asKey:\"availabilityTimeOffset\",parser:gn,dashName:\"availabilityTimeOffset\"});break;case\"availabilityTimeComplete\":r(s,{asKey:\"availabilityTimeComplete\",parser:vn,dashName:\"availabilityTimeComplete\"})}}return void 0===t.bitrate&&n.push(new In(\"No bitrate found on a Representation\")),[t,n]}(e),a=i[0],o=i[1];return[{children:n,attributes:a},r.concat(o)]}function Fn(e){var t=function(e){for(var t={baseURLs:[],representations:[]},n=[],r=[],i=0;i<e.length;i++){var a=e[i];if(\"string\"!=typeof a)switch(a.tagName){case\"Accessibility\":void 0===t.accessibilities?t.accessibilities=[Tn(a)]:t.accessibilities.push(Tn(a));break;case\"BaseURL\":var o=Rn(a),s=o[0],u=o[1];void 0!==s&&t.baseURLs.push(s),u.length>0&&(r=r.concat(u));break;case\"ContentComponent\":t.contentComponent=Pn(a);break;case\"EssentialProperty\":S(t.essentialProperties)?t.essentialProperties=[Tn(a)]:t.essentialProperties.push(Tn(a));break;case\"InbandEventStream\":void 0===t.inbandEventStreams&&(t.inbandEventStreams=[]),t.inbandEventStreams.push(Tn(a));break;case\"Label\":var l=kn(a.children);null!=l&&(t.label=l);break;case\"Representation\":var d=Ln(a),c=d[0],f=d[1];t.representations.push(c),f.length>0&&(r=r.concat(f));break;case\"Role\":S(t.roles)?t.roles=[Tn(a)]:t.roles.push(Tn(a));break;case\"SupplementalProperty\":S(t.supplementalProperties)?t.supplementalProperties=[Tn(a)]:t.supplementalProperties.push(Tn(a));break;case\"SegmentBase\":var p=Mn(a),h=p[0],v=p[1];t.segmentBase=h,v.length>0&&(r=r.concat(v));break;case\"SegmentList\":var m=Dn(a),g=m[0],b=m[1];t.segmentList=g,b.length>0&&(r=r.concat(b));break;case\"SegmentTemplate\":var y=Un(a),_=y[0],E=y[1];t.segmentTemplate=_,E.length>0&&(r=r.concat(E));break;case\"ContentProtection\":var w=xn(a),T=w[0],A=w[1];A.length>0&&(r=r.concat(A)),void 0!==T&&n.push(T)}}return n.length>0&&(t.contentProtections=n),[t,r]}(e.children),n=t[0],r=t[1],i=function(e){for(var t={},n=[],r=An(t,n),i=0,a=Object.keys(e.attributes);i<a.length;i++){var o=a[i],s=e.attributes[o];if(!S(s))switch(o){case\"id\":t.id=s;break;case\"group\":r(s,{asKey:\"group\",parser:mn,dashName:\"group\"});break;case\"lang\":t.language=s;break;case\"contentType\":t.contentType=s;break;case\"par\":t.par=s;break;case\"minBandwidth\":r(s,{asKey:\"minBitrate\",parser:mn,dashName:\"minBandwidth\"});break;case\"maxBandwidth\":r(s,{asKey:\"maxBitrate\",parser:mn,dashName:\"maxBandwidth\"});break;case\"minWidth\":r(s,{asKey:\"minWidth\",parser:mn,dashName:\"minWidth\"});break;case\"maxWidth\":r(s,{asKey:\"maxWidth\",parser:mn,dashName:\"maxWidth\"});break;case\"minHeight\":r(s,{asKey:\"minHeight\",parser:mn,dashName:\"minHeight\"});break;case\"maxHeight\":r(s,{asKey:\"maxHeight\",parser:mn,dashName:\"maxHeight\"});break;case\"minFrameRate\":r(s,{asKey:\"minFrameRate\",parser:wn,dashName:\"minFrameRate\"});break;case\"maxFrameRate\":r(s,{asKey:\"maxFrameRate\",parser:wn,dashName:\"maxFrameRate\"});break;case\"selectionPriority\":r(s,{asKey:\"selectionPriority\",parser:mn,dashName:\"selectionPriority\"});break;case\"segmentAlignment\":r(s,{asKey:\"segmentAlignment\",parser:bn,dashName:\"segmentAlignment\"});break;case\"subsegmentAlignment\":r(s,{asKey:\"subsegmentAlignment\",parser:bn,dashName:\"subsegmentAlignment\"});break;case\"bitstreamSwitching\":r(s,{asKey:\"bitstreamSwitching\",parser:vn,dashName:\"bitstreamSwitching\"});break;case\"audioSamplingRate\":t.audioSamplingRate=s;break;case\"codecs\":t.codecs=s;break;case\"scte214:supplementalCodecs\":t.supplementalCodecs=s;break;case\"codingDependency\":r(s,{asKey:\"codingDependency\",parser:vn,dashName:\"codingDependency\"});break;case\"frameRate\":r(s,{asKey:\"frameRate\",parser:wn,dashName:\"frameRate\"});break;case\"height\":r(s,{asKey:\"height\",parser:mn,dashName:\"height\"});break;case\"maxPlayoutRate\":r(s,{asKey:\"maxPlayoutRate\",parser:gn,dashName:\"maxPlayoutRate\"});break;case\"maximumSAPPeriod\":r(s,{asKey:\"maximumSAPPeriod\",parser:gn,dashName:\"maximumSAPPeriod\"});break;case\"mimeType\":t.mimeType=s;break;case\"profiles\":t.profiles=s;break;case\"segmentProfiles\":t.segmentProfiles=s;break;case\"width\":r(s,{asKey:\"width\",parser:mn,dashName:\"width\"});break;case\"availabilityTimeOffset\":r(s,{asKey:\"availabilityTimeOffset\",parser:gn,dashName:\"availabilityTimeOffset\"});break;case\"availabilityTimeComplete\":r(s,{asKey:\"availabilityTimeComplete\",parser:vn,dashName:\"availabilityTimeComplete\"})}}return[t,n]}(e),a=i[0],o=i[1];return[{children:n,attributes:a},r.concat(o)]}function Bn(e,t){var n=\"undefined\"!=typeof Symbol&&e[Symbol.iterator]||e[\"@@iterator\"];if(n)return(n=n.call(e)).next.bind(n);if(Array.isArray(e)||(n=function(e,t){if(!e)return;if(\"string\"==typeof e)return zn(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);\"Object\"===n&&e.constructor&&(n=e.constructor.name);if(\"Map\"===n||\"Set\"===n)return Array.from(e);if(\"Arguments\"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return zn(e,t)}(e))||t&&e&&\"number\"==typeof e.length){n&&(e=n);var r=0;return function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}}}throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\")}function zn(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Wn(e,t){for(var n,r=function(e){for(var t={},n=[],r=An(t,n),i=0,a=Object.keys(e.attributes);i<a.length;i++){var o=a[i],s=e.attributes[o];if(!S(s))switch(o){case\"schemeIdUri\":t.schemeIdUri=s;break;case\"value\":t.value=s;break;case\"timescale\":r(s,{asKey:\"timescale\",parser:mn,dashName:\"timescale\"});break;default:ln(o,\"xmlns:\")&&(void 0===t.namespaces&&(t.namespaces=[]),t.namespaces.push({key:o.substring(6),value:s}))}}return[t,n]}(e),i=r[0],a=r[1],o=[],s=Bn(e.children);!(n=s()).done;){var u=n.value;if(\"string\"!=typeof u&&\"Event\"===u.tagName){var l={};if(S(u.attributes.id)||(l.id=u.attributes.id),!S(u.attributes.presentationTime)){var d=mn(u.attributes.presentationTime,\"presentationTime\"),c=d[0],f=d[1];null!==f&&a.push(f),null!==c&&(l.presentationTime=c)}if(!S(u.attributes.duration)){var p=mn(u.attributes.duration,\"duration\"),h=p[0],v=p[1];null!==v&&a.push(v),null!==h&&(l.duration=h)}if(u.posStart<u.posEnd){var m=t.substring(u.posStart,u.posEnd);l.eventStreamData=m}o.push(l)}}return[{children:{events:o},attributes:i},a]}function Vn(e,t){var n=function(e,t){for(var n,r=[],i=[],a=[],o=[],s=0;s<e.length;s++){var u=e[s];if(\"string\"!=typeof u)switch(u.tagName){case\"BaseURL\":var l=Rn(u),d=l[0],c=l[1];void 0!==d&&r.push(d),a=a.concat(c);break;case\"AdaptationSet\":var f=Fn(u),p=f[0],h=f[1];i.push(p),a=a.concat(h);break;case\"EventStream\":var v=Wn(u,t),m=v[0],g=v[1];o.push(m),a=a.concat(g);break;case\"SegmentTemplate\":var b=Un(u),y=b[0],S=b[1];n=y,S.length>0&&(a=a.concat(S))}}return[{baseURLs:r,adaptations:i,eventStreams:o,segmentTemplate:n},a]}(e.children,t),r=n[0],i=n[1],a=function(e){for(var t={},n=[],r=An(t,n),i=0,a=Object.keys(e.attributes);i<a.length;i++){var o=a[i],s=e.attributes[o];if(!S(s))switch(o){case\"id\":t.id=s;break;case\"start\":r(s,{asKey:\"start\",parser:Sn,dashName:\"start\"});break;case\"duration\":r(s,{asKey:\"duration\",parser:Sn,dashName:\"duration\"});break;case\"bitstreamSwitching\":r(s,{asKey:\"bitstreamSwitching\",parser:vn,dashName:\"bitstreamSwitching\"});break;case\"xlink:href\":t.xlinkHref=s;break;case\"xlink:actuate\":t.xlinkActuate=s;break;default:ln(o,\"xmlns:\")&&(void 0===t.namespaces&&(t.namespaces=[]),t.namespaces.push({key:o.substring(6),value:s}))}}return[t,n]}(e),o=a[0],s=a[1];return[{children:r,attributes:o},i.concat(s)]}function jn(e,t){var n=function(e,t){for(var n=[],r=[],i=[],a=[],o=[],s=0;s<e.length;s++){var u=e[s];if(\"string\"!=typeof u)switch(u.tagName){case\"BaseURL\":var l=Rn(u),d=l[0],c=l[1];void 0!==d&&n.push(d),o=o.concat(c);break;case\"Location\":r.push(kn(u.children));break;case\"Period\":var f=Vn(u,t),p=f[0],h=f[1];i.push(p),o=o.concat(h);break;case\"UTCTiming\":var v=Tn(u);a.push(v)}}return[{baseURLs:n,locations:r,periods:i,utcTimings:a},o]}(e.children,t),r=n[0],i=n[1],a=function(e){for(var t={},n=[],r=An(t,n),i=0,a=Object.keys(e.attributes);i<a.length;i++){var o=a[i],s=e.attributes[o];if(!S(s))switch(o){case\"id\":t.id=s;break;case\"profiles\":t.profiles=s;break;case\"type\":t.type=s;break;case\"availabilityStartTime\":r(s,{asKey:\"availabilityStartTime\",parser:yn,dashName:\"availabilityStartTime\"});break;case\"availabilityEndTime\":r(s,{asKey:\"availabilityEndTime\",parser:yn,dashName:\"availabilityEndTime\"});break;case\"publishTime\":r(s,{asKey:\"publishTime\",parser:yn,dashName:\"publishTime\"});break;case\"mediaPresentationDuration\":r(s,{asKey:\"duration\",parser:Sn,dashName:\"mediaPresentationDuration\"});break;case\"minimumUpdatePeriod\":r(s,{asKey:\"minimumUpdatePeriod\",parser:Sn,dashName:\"minimumUpdatePeriod\"});break;case\"minBufferTime\":r(s,{asKey:\"minBufferTime\",parser:Sn,dashName:\"minBufferTime\"});break;case\"timeShiftBufferDepth\":r(s,{asKey:\"timeShiftBufferDepth\",parser:Sn,dashName:\"timeShiftBufferDepth\"});break;case\"suggestedPresentationDelay\":r(s,{asKey:\"suggestedPresentationDelay\",parser:Sn,dashName:\"suggestedPresentationDelay\"});break;case\"maxSegmentDuration\":r(s,{asKey:\"maxSegmentDuration\",parser:Sn,dashName:\"maxSegmentDuration\"});break;case\"maxSubsegmentDuration\":r(s,{asKey:\"maxSubsegmentDuration\",parser:Sn,dashName:\"maxSubsegmentDuration\"});break;default:ln(o,\"xmlns:\")&&(void 0===t.namespaces&&(t.namespaces=[]),t.namespaces.push({key:o.substring(6),value:s}))}}return[t,n]}(e),o=a[0],s=a[1];return[{children:r,attributes:o},i.concat(s)]}var Gn=function(e,t){var n=He(e),r=n[n.length-1];if(void 0===r||\"string\"==typeof r||\"MPD\"!==r.tagName)throw new Error(\"DASH Parser: document root should be MPD\");var i=jn(r,e),a=i[0],o=i[1];return function e(t){if(\"done\"===t.type)return t;if(\"needs-clock\"===t.type)return{type:\"needs-resources\",value:{urls:[t.value.url],format:\"string\",continue:function(n){if(1!==n.length)throw new Error(\"DASH parser: wrong number of loaded ressources.\");var r=t.value.continue(n[0].responseData);return e(r)}}};if(\"needs-xlinks\"===t.type)return{type:\"needs-resources\",value:{urls:t.value.xlinksUrls,format:\"string\",continue:function(n){for(var r=[],i=0;i<n.length;i++){var a=n[i],o=a.responseData,s=a.receivedTime,u=a.sendingTime,l=a.url;if(!o.success)throw o.error;var d=\"<root>\"+o.data+\"</root>\",c=He(d),f=c[c.length-1];if(void 0===f||\"string\"==typeof f)throw new Error(\"DASH parser: Invalid external ressources\");for(var p=f.children,h=[],v=[],m=0;m<p.length;m++){var g=p[m];if(\"string\"!=typeof g&&\"Period\"===g.tagName){var b=Vn(g,d),y=b[0],S=b[1];v.push.apply(v,S),h.push(y)}}r.push({url:l,receivedTime:s,sendingTime:u,parsed:h,warnings:v})}var _=t.value.continue(r);return e(_)}}};Me()}(un(a,t,o))};function Hn(e,t,n,r,i,a,o){try{var s=e[a](o),u=s.value}catch(e){return void n(e)}s.done?t(u):Promise.resolve(u).then(r,i)}function qn(e){return function(){var t=this,n=arguments;return new Promise((function(r,i){var a=e.apply(t,n);function o(e){Hn(a,r,i,o,s,\"next\",e)}function s(e){Hn(a,r,i,o,s,\"throw\",e)}o(void 0)}))}}var Kn=n(756),Yn=n.n(Kn),Qn=\"object\"==typeof WebAssembly&&\"function\"==typeof WebAssembly.instantiate;function Xn(e,t,n,r){var i=new Uint8Array(t,n,r);return e.decode(i)}function $n(e){return e===1/0||e!==-1/0&&e}function Zn(e,t){var n=new TextDecoder;return function(r,i,a){64===r&&(e.value=Xn(n,t.buffer,i,a))}}function Jn(e,t){var n=e.attributes,r=e.children,i=new TextDecoder;return function(e,a,o){switch(e){case 16:n.schemeIdUri=Xn(i,t.buffer,a,o);break;case 13:n.value=Xn(i,t.buffer,a,o);break;case 14:var s=Xn(i,t.buffer,a,o);n.keyId=lt(s.replace(/-/g,\"\"));break;case 15:try{var u=Xn(i,t.buffer,a,o);r.cencPssh.push(fn(u))}catch(e){}}}}function er(e,t){var n=new TextDecoder;return function(r,i,a){switch(r){case 16:e.schemeIdUri=Xn(n,t.buffer,i,a);break;case 17:e.value=Xn(n,t.buffer,i,a)}}}function tr(e,t){var n=new TextDecoder;return function(r,i,a){switch(r){case 29:var o=new DataView(t.buffer);void 0===e.initialization&&(e.initialization={}),e.initialization.range=[o.getFloat64(i,!0),o.getFloat64(i+8,!0)];break;case 67:void 0===e.initialization&&(e.initialization={}),e.initialization.media=Xn(n,t.buffer,i,a);break;case 43:var s=new DataView(t.buffer);e.availabilityTimeOffset=s.getFloat64(i,!0);break;case 22:e.availabilityTimeComplete=0===new DataView(t.buffer).getUint8(0);break;case 24:var u=new DataView(t.buffer);e.presentationTimeOffset=u.getFloat64(i,!0);break;case 27:var l=new DataView(t.buffer);e.timescale=l.getFloat64(i,!0);break;case 31:var d=new DataView(t.buffer);e.indexRange=[d.getFloat64(i,!0),d.getFloat64(i+8,!0)];break;case 23:e.indexRangeExact=0===new DataView(t.buffer).getUint8(0);break;case 1:var c=new DataView(t.buffer);e.duration=c.getFloat64(i,!0);break;case 20:var f=new DataView(t.buffer);e.startNumber=f.getFloat64(i,!0);break;case 76:var p=new DataView(t.buffer);e.endNumber=p.getFloat64(i,!0)}}}function nr(e,t,n){return function(r){if(20===r){var i={};void 0===e.list&&(e.list=[]),e.list.push(i);var a=function(e,t){var n=new TextDecoder;return function(r,i,a){switch(r){case 28:e.index=Xn(n,t.buffer,i,a);break;case 31:var o=new DataView(t.buffer);e.indexRange=[o.getFloat64(i,!0),o.getFloat64(i+8,!0)];break;case 30:e.media=Xn(n,t.buffer,i,a);break;case 18:var s=new DataView(t.buffer);e.mediaRange=[s.getFloat64(i,!0),s.getFloat64(i+8,!0)]}}}(i,t);n.pushParsers(r,E,a)}else n.pushParsers(r,E,E)}}function rr(e,t){var n=new TextDecoder;return function(r,i,a){switch(r){case 19:var o=new DataView(t.buffer);e.timeline=[];for(var s=i,u=0;u<a/24;u++)e.timeline.push({start:o.getFloat64(s,!0),duration:o.getFloat64(s+8,!0),repeatCount:o.getFloat64(s+16,!0)}),s+=24;break;case 67:e.initialization={media:Xn(n,t.buffer,i,a)};break;case 28:e.index=Xn(n,t.buffer,i,a);break;case 43:var l=new DataView(t.buffer);e.availabilityTimeOffset=l.getFloat64(i,!0);break;case 22:e.availabilityTimeComplete=0===new DataView(t.buffer).getUint8(0);break;case 24:var d=new DataView(t.buffer);e.presentationTimeOffset=d.getFloat64(i,!0);break;case 27:var c=new DataView(t.buffer);e.timescale=c.getFloat64(i,!0);break;case 31:var f=new DataView(t.buffer);e.indexRange=[f.getFloat64(i,!0),f.getFloat64(i+8,!0)];break;case 23:e.indexRangeExact=0===new DataView(t.buffer).getUint8(0);break;case 30:e.media=Xn(n,t.buffer,i,a);break;case 32:e.bitstreamSwitching=0===new DataView(t.buffer).getUint8(0);break;case 1:var p=new DataView(t.buffer);e.duration=p.getFloat64(i,!0);break;case 20:var h=new DataView(t.buffer);e.startNumber=h.getFloat64(i,!0);break;case 76:var v=new DataView(t.buffer);e.endNumber=v.getFloat64(i,!0)}}}function ir(e,t,n){return function(r){switch(r){case 8:var i={};void 0===e.accessibilities&&(e.accessibilities=[]),e.accessibilities.push(i);var a=er(i,t);n.pushParsers(r,E,a);break;case 15:var o={value:\"\",attributes:{}};e.baseURLs.push(o);var s=Zn(o,t);n.pushParsers(r,E,s);break;case 9:var u={};e.contentComponent=u,n.pushParsers(r,E,function(e,t){var n=new TextDecoder;return function(r,i,a){switch(r){case 0:e.id=Xn(n,t.buffer,i,a);break;case 60:e.language=Xn(n,t.buffer,i,a);break;case 61:e.contentType=Xn(n,t.buffer,i,a);break;case 62:e.par=Xn(n,t.buffer,i,a)}}}(u,t));break;case 10:var l={children:{cencPssh:[]},attributes:{}};void 0===e.contentProtections&&(e.contentProtections=[]),e.contentProtections.push(l);var d=Jn(l,t);n.pushParsers(r,E,d);break;case 11:var c={};void 0===e.essentialProperties&&(e.essentialProperties=[]),e.essentialProperties.push(c);var f=E,p=er(c,t);n.pushParsers(r,f,p);break;case 19:var h={};void 0===e.inbandEventStreams&&(e.inbandEventStreams=[]),e.inbandEventStreams.push(h);var v=E,m=er(h,t);n.pushParsers(r,v,m);break;case 7:var g={children:{baseURLs:[]},attributes:{}};e.representations.push(g);var b=function(e,t,n){return function(r){switch(r){case 15:var i={value:\"\",attributes:{}};e.baseURLs.push(i),n.pushParsers(r,E,Zn(i,t));break;case 10:var a={children:{cencPssh:[]},attributes:{}};void 0===e.contentProtections&&(e.contentProtections=[]),e.contentProtections.push(a);var o=Jn(a,t);n.pushParsers(r,E,o);break;case 19:var s={};void 0===e.inbandEventStreams&&(e.inbandEventStreams=[]),e.inbandEventStreams.push(s),n.pushParsers(r,E,er(s,t));break;case 13:var u={};void 0===e.supplementalProperties&&(e.supplementalProperties=[]),e.supplementalProperties.push(u);var l=er(u,t);n.pushParsers(r,E,l);break;case 17:var d={};e.segmentBase=d;var c=tr(d,t);n.pushParsers(r,E,c);break;case 18:var f={list:[]};e.segmentList=f;var p=nr(f,t,n),h=tr(f,t);n.pushParsers(r,p,h);break;case 16:var v={};e.segmentTemplate=v,n.pushParsers(r,E,rr(v,t));break;default:n.pushParsers(r,E,E)}}}(g.children,t,n),y=function(e,t){var n=new TextDecoder;return function(r,i,a){var o=new DataView(t.buffer);switch(r){case 0:e.id=Xn(n,t.buffer,i,a);break;case 3:e.audioSamplingRate=Xn(n,t.buffer,i,a);break;case 63:e.bitrate=o.getFloat64(i,!0);break;case 4:e.codecs=Xn(n,t.buffer,i,a);break;case 77:e.supplementalCodecs=Xn(n,t.buffer,i,a);break;case 5:e.codingDependency=0===new DataView(t.buffer).getUint8(0);break;case 6:e.frameRate=o.getFloat64(i,!0);break;case 7:e.height=o.getFloat64(i,!0);break;case 8:e.width=o.getFloat64(i,!0);break;case 9:e.maxPlayoutRate=o.getFloat64(i,!0);break;case 10:e.maximumSAPPeriod=o.getFloat64(i,!0);break;case 11:e.mimeType=Xn(n,t.buffer,i,a);break;case 2:e.profiles=Xn(n,t.buffer,i,a);break;case 65:e.qualityRanking=o.getFloat64(i,!0);break;case 12:e.segmentProfiles=Xn(n,t.buffer,i,a);break;case 43:e.availabilityTimeOffset=o.getFloat64(i,!0);break;case 22:e.availabilityTimeComplete=0===o.getUint8(0)}}}(g.attributes,t);n.pushParsers(r,b,y);break;case 12:var S={};void 0===e.roles&&(e.roles=[]),e.roles.push(S);var _=er(S,t);n.pushParsers(r,E,_);break;case 13:var w={};void 0===e.supplementalProperties&&(e.supplementalProperties=[]),e.supplementalProperties.push(w);var T=er(w,t);n.pushParsers(r,E,T);break;case 17:var A={};e.segmentBase=A;var I=tr(A,t);n.pushParsers(r,E,I);break;case 18:var k={list:[]};e.segmentList=k;var R=nr(k,t,n),P=tr(k,t);n.pushParsers(r,R,P);break;case 16:var x={};e.segmentTemplate=x,n.pushParsers(r,E,rr(x,t));break;default:n.pushParsers(r,E,E)}}}function ar(e,t,n,r){return function(i){if(6===i){var a={};e.events.push(a);var o=function(e,t,n){var r=new TextDecoder;return function(i,a,o){var s=new DataView(t.buffer);switch(i){case 25:e.presentationTime=s.getFloat64(a,!0);break;case 1:e.duration=s.getFloat64(a,!0);break;case 0:e.id=Xn(r,t.buffer,a,o);break;case 69:var u=s.getFloat64(a,!0),l=s.getFloat64(a+8,!0);e.eventStreamData=n.slice(u,l)}}}(a,t,r);n.pushParsers(i,E,o)}else n.pushParsers(i,E,E)}}function or(e,t,n,r){return function(i){switch(i){case 4:var a={children:{baseURLs:[],representations:[]},attributes:{}};e.adaptations.push(a);var o=ir(a.children,t,n),s=function(e,t){var n=new TextDecoder;return function(r,i,a){var o=new DataView(t.buffer);switch(r){case 0:e.id=Xn(n,t.buffer,i,a);break;case 48:e.group=o.getFloat64(i,!0);break;case 60:e.language=Xn(n,t.buffer,i,a);break;case 61:e.contentType=Xn(n,t.buffer,i,a);break;case 62:e.par=Xn(n,t.buffer,i,a);break;case 53:e.minBitrate=o.getFloat64(i,!0);break;case 49:e.maxBitrate=o.getFloat64(i,!0);break;case 56:e.minWidth=o.getFloat64(i,!0);break;case 52:e.maxWidth=o.getFloat64(i,!0);break;case 55:e.minHeight=o.getFloat64(i,!0);break;case 51:e.maxHeight=o.getFloat64(i,!0);break;case 54:e.minFrameRate=o.getFloat64(i,!0);break;case 50:e.maxFrameRate=o.getFloat64(i,!0);break;case 57:e.selectionPriority=o.getFloat64(i,!0);break;case 58:e.segmentAlignment=$n(o.getFloat64(i,!0));break;case 59:e.subsegmentAlignment=$n(o.getFloat64(i,!0));break;case 32:e.bitstreamSwitching=0!==o.getFloat64(i,!0);break;case 3:e.audioSamplingRate=Xn(n,t.buffer,i,a);break;case 4:e.codecs=Xn(n,t.buffer,i,a);break;case 77:e.supplementalCodecs=Xn(n,t.buffer,i,a);break;case 2:e.profiles=Xn(n,t.buffer,i,a);break;case 12:e.segmentProfiles=Xn(n,t.buffer,i,a);break;case 11:e.mimeType=Xn(n,t.buffer,i,a);break;case 5:e.codingDependency=0!==o.getFloat64(i,!0);break;case 6:e.frameRate=o.getFloat64(i,!0);break;case 7:e.height=o.getFloat64(i,!0);break;case 8:e.width=o.getFloat64(i,!0);break;case 9:e.maxPlayoutRate=o.getFloat64(i,!0);break;case 10:e.maximumSAPPeriod=o.getFloat64(i,!0);break;case 43:e.availabilityTimeOffset=o.getFloat64(i,!0);break;case 22:e.availabilityTimeComplete=0===o.getUint8(0);break;case 71:var s=Xn(n,t.buffer,i,a);e.label=s}}}(a.attributes,t);n.pushParsers(i,o,s);break;case 15:var u={value:\"\",attributes:{}};e.baseURLs.push(u);var l=E,d=Zn(u,t);n.pushParsers(i,l,d);break;case 5:var c={children:{events:[]},attributes:{}};e.eventStreams.push(c);var f=ar(c.children,t,n,r),p=function(e,t){var n=new TextDecoder;return function(r,i,a){var o=new DataView(t.buffer);switch(r){case 16:e.schemeIdUri=Xn(n,t.buffer,i,a);break;case 17:e.value=Xn(n,t.buffer,i,a);break;case 27:e.timescale=o.getFloat64(i,!0);break;case 70:var s={key:\"\",value:\"\"},u=i,l=o.getUint32(u);u+=4,s.key=Xn(n,t.buffer,u,l),u+=l;var d=o.getUint32(u);u+=4,s.value=Xn(n,t.buffer,u,d),void 0===e.namespaces?e.namespaces=[s]:e.namespaces.push(s)}}}(c.attributes,t);n.pushParsers(i,f,p);break;case 16:var h={};e.segmentTemplate=h,n.pushParsers(i,E,rr(h,t));break;default:n.pushParsers(i,E,E)}}}function sr(e,t){var n=new TextDecoder;return function(r,i,a){switch(r){case 0:e.id=Xn(n,t.buffer,i,a);break;case 45:e.start=new DataView(t.buffer).getFloat64(i,!0);break;case 1:e.duration=new DataView(t.buffer).getFloat64(i,!0);break;case 32:e.bitstreamSwitching=0===new DataView(t.buffer).getUint8(0);break;case 46:e.xlinkHref=Xn(n,t.buffer,i,a);break;case 47:e.xlinkActuate=Xn(n,t.buffer,i,a);break;case 43:e.availabilityTimeOffset=new DataView(t.buffer).getFloat64(i,!0);break;case 22:e.availabilityTimeComplete=0===new DataView(t.buffer).getUint8(0);break;case 70:var o={key:\"\",value:\"\"},s=new DataView(t.buffer),u=i,l=s.getUint32(u);u+=4,o.key=Xn(n,t.buffer,u,l),u+=l;var d=s.getUint32(u);u+=4,o.value=Xn(n,t.buffer,u,d),void 0===e.namespaces?e.namespaces=[o]:e.namespaces.push(o)}}}function ur(e,t,n,r){return function(i){if(1===i){e.mpd={children:{baseURLs:[],locations:[],periods:[],utcTimings:[]},attributes:{}};var a=function(e,t,n,r){return function(i){switch(i){case 15:var a={value:\"\",attributes:{}};e.baseURLs.push(a);var o=E,s=Zn(a,t);n.pushParsers(i,o,s);break;case 2:var u={children:{adaptations:[],baseURLs:[],eventStreams:[]},attributes:{}};e.periods.push(u);var l=or(u.children,t,n,r),d=sr(u.attributes,t);n.pushParsers(i,l,d);break;case 3:var c={};e.utcTimings.push(c);var f=E,p=er(c,t);n.pushParsers(i,f,p);break;default:n.pushParsers(i,E,E)}}}(e.mpd.children,t,n,r),o=function(e,t,n){var r,i=new TextDecoder;return function(a,o,s){switch(a){case 0:t.id=Xn(i,n.buffer,o,s);break;case 2:t.profiles=Xn(i,n.buffer,o,s);break;case 33:t.type=Xn(i,n.buffer,o,s);break;case 34:var u=Xn(i,n.buffer,o,s);t.availabilityStartTime=new Date(u).getTime()/1e3;break;case 35:var l=Xn(i,n.buffer,o,s);t.availabilityEndTime=new Date(l).getTime()/1e3;break;case 36:var d=Xn(i,n.buffer,o,s);t.publishTime=new Date(d).getTime()/1e3;break;case 68:r=new DataView(n.buffer),t.duration=r.getFloat64(o,!0);break;case 37:r=new DataView(n.buffer),t.minimumUpdatePeriod=r.getFloat64(o,!0);break;case 38:r=new DataView(n.buffer),t.minBufferTime=r.getFloat64(o,!0);break;case 39:r=new DataView(n.buffer),t.timeShiftBufferDepth=r.getFloat64(o,!0);break;case 40:r=new DataView(n.buffer),t.suggestedPresentationDelay=r.getFloat64(o,!0);break;case 41:r=new DataView(n.buffer),t.maxSegmentDuration=r.getFloat64(o,!0);break;case 42:r=new DataView(n.buffer),t.maxSubsegmentDuration=r.getFloat64(o,!0);break;case 66:var c=Xn(i,n.buffer,o,s);e.locations.push(c);break;case 70:var f={key:\"\",value:\"\"},p=o,h=(r=new DataView(n.buffer)).getUint32(p);p+=4,f.key=Xn(i,n.buffer,p,h),p+=h;var v=r.getUint32(p);p+=4,f.value=Xn(i,n.buffer,p,v),void 0===t.namespaces?t.namespaces=[f]:t.namespaces.push(f)}}}(e.mpd.children,e.mpd.attributes,t);n.pushParsers(i,a,o)}else n.pushParsers(i,E,E)}}var lr=function(){function e(){this._currentNodeId=null,this.childrenParser=E,this.attributeParser=E,this._stack=[{nodeId:null,children:E,attribute:E}]}var t=e.prototype;return t.pushParsers=function(e,t,n){this._currentNodeId=e,this.childrenParser=t,this.attributeParser=n,this._stack.push({nodeId:e,attribute:n,children:t})},t.popIfCurrent=function(e){if(this._currentNodeId===e){this._stack.pop();var t=this._stack[this._stack.length-1],n=t.nodeId,r=t.children,i=t.attribute;this._currentNodeId=n,this.attributeParser=i,this.childrenParser=r}},t.reset=function(){this.childrenParser=E,this.attributeParser=E,this._stack=[{nodeId:null,children:E,attribute:E}]},e}(),dr=function(){function e(){this._parsersStack=new lr,this._instance=null,this._mpdData=null,this._linearMemory=null,this.status=\"uninitialized\",this._initProm=null,this._warnings=[],this._isParsing=!1}var t=e.prototype;return t.waitForInitialization=function(){var e;return null!==(e=this._initProm)&&void 0!==e?e:Promise.reject(\"No initialization performed yet.\")},t.initialize=function(){var e=qn(Yn().mark((function e(t){var n,r,i,a,o,s,u,l,d,c,f,p,h=this;return Yn().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(p=function(e,t){if(null===i._mpdData)throw new Error(\"DashWasmParser Error: No MPD to read.\");var n=i._linearMemory,r=i._mpdData,a=r.mpd,o=r.cursor,s=Math.min(t,15e3,a.byteLength-o);return new Uint8Array(n.buffer,e,s).set(new Uint8Array(a,o,s)),i._mpdData.cursor+=s,s},f=function(e,t,n){var a=i._linearMemory,o=new Uint8Array(a.buffer,t,n);if(1===e){var s=r.decode(o);T.warn(\"WASM Error Event:\",s),i._warnings.push(new Error(s))}else if(0===e){var u=r.decode(o);T.warn(\"WASM Log Event:\",u)}},c=function(e,t,r){return n.attributeParser(e,t,r)},d=function(e){return n.popIfCurrent(e)},l=function(e){return n.childrenParser(e)},\"uninitialized\"===this.status){e.next=9;break}return e.abrupt(\"return\",Promise.reject(new Error(\"DashWasmParser already initialized.\")));case 9:if(this.isCompatible()){e.next=12;break}return this.status=\"failure\",e.abrupt(\"return\",Promise.reject(new Error(\"Target not compatible with WebAssembly.\")));case 12:return this.status=\"initializing\",n=this._parsersStack,r=new TextDecoder,i=this,a={env:{memoryBase:0,tableBase:0,memory:new WebAssembly.Memory({initial:10}),table:new WebAssembly.Table({initial:1,element:\"anyfunc\"}),onTagOpen:l,onCustomEvent:f,onAttribute:c,readNext:p,onTagClose:d}},o=null,\"string\"==typeof t.wasmUrl?s=fetch(t.wasmUrl):(o=URL.createObjectURL(new Blob([t.wasmUrl],{type:\"application/wasm\"})),s=fetch(o)),u=\"function\"==typeof WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(s,a):Promise.reject(\"`WebAssembly.instantiateStreaming` API not available\"),this._initProm=u.catch(function(){var e=qn(Yn().mark((function e(t){var n,r;return Yn().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return null!==o&&(URL.revokeObjectURL(o),o=null),T.warn(\"Unable to call `instantiateStreaming` on WASM\",t instanceof Error?t:\"\"),e.next=4,s;case 4:if(!((n=e.sent).status<200||n.status>=300)){e.next=7;break}throw new Error(\"WebAssembly request failed. status: \"+String(n.status));case 7:return e.next=9,n.arrayBuffer();case 9:return r=e.sent,e.abrupt(\"return\",WebAssembly.instantiate(r,a));case 11:case\"end\":return e.stop()}}),e)})));return function(t){return e.apply(this,arguments)}}()).then((function(e){null!==o&&(URL.revokeObjectURL(o),o=null),h._instance=e,h._linearMemory=h._instance.instance.exports.memory,h.status=\"initialized\"})).catch((function(e){var t=e instanceof Error?e.toString():\"Unknown error\";throw T.warn(\"DW: Could not create DASH-WASM parser:\",t),h.status=\"failure\",e})),e.abrupt(\"return\",this._initProm);case 22:case\"end\":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),t.runWasmParser=function(e,t){var n=this._parseMpd(e),r=n[0],i=n[1];if(null===r)throw new Error(\"DASH Parser: Unknown error while parsing the MPD\");var a=un(r,t,i);return this._processParserReturnValue(a)},t.isCompatible=function(){return Qn&&\"function\"==typeof we.TextDecoder},t._parseMpd=function(e){var t;if(null===this._instance)throw new Error(\"DashWasmParser not initialized\");if(this._isParsing)throw new Error(\"Parsing operation already pending.\");this._isParsing=!0,this._mpdData={mpd:e,cursor:0};var n={},r=ur(n,this._linearMemory,this._parsersStack,e);this._parsersStack.pushParsers(null,r,E),this._warnings=[];try{this._instance.instance.exports.parse()}catch(e){throw this._parsersStack.reset(),this._warnings=[],this._isParsing=!1,e}var i=null!==(t=n.mpd)&&void 0!==t?t:null,a=this._warnings;return this._parsersStack.reset(),this._warnings=[],this._isParsing=!1,[i,a]},t._parseXlink=function(e){if(null===this._instance)throw new Error(\"DashWasmParser not initialized\");if(this._isParsing)throw new Error(\"Parsing operation already pending.\");this._isParsing=!0,this._mpdData={mpd:e,cursor:0};var t={periods:[]},n=function(e,t,n,r){return function(i){if(2===i){var a={children:{adaptations:[],baseURLs:[],eventStreams:[]},attributes:{}};e.periods.push(a);var o=or(a.children,t,n,r),s=sr(a.attributes,t);n.pushParsers(i,o,s)}else n.pushParsers(i,E,E)}}(t,this._linearMemory,this._parsersStack,e);this._parsersStack.pushParsers(null,n,E),this._warnings=[];try{this._instance.instance.exports.parse()}catch(e){throw this._parsersStack.reset(),this._warnings=[],this._isParsing=!1,e}var r=t.periods,i=this._warnings;return this._parsersStack.reset(),this._warnings=[],this._isParsing=!1,[r,i]},t._processParserReturnValue=function(e){var t=this;if(\"done\"===e.type)return e;if(\"needs-clock\"===e.type){return{type:\"needs-resources\",value:{urls:[e.value.url],format:\"string\",continue:function(n){if(1!==n.length)throw new Error(\"DASH parser: wrong number of loaded ressources.\");var r=e.value.continue(n[0].responseData);return t._processParserReturnValue(r)}}}}if(\"needs-xlinks\"===e.type){return{type:\"needs-resources\",value:{urls:e.value.xlinksUrls,format:\"arraybuffer\",continue:function(n){for(var r=[],i=0;i<n.length;i++){var a=n[i],o=a.responseData,s=a.receivedTime,u=a.sendingTime,l=a.url;if(!o.success)throw o.error;var d=t._parseXlink(o.data),c=d[0],f=d[1];r.push({url:l,receivedTime:s,sendingTime:u,parsed:c,warnings:f})}var p=e.value.continue(r);return t._processParserReturnValue(p)}}}}Me()},e}(),cr=dr,fr=function(){function e(e,t){this._last=e,this._wanted=t}var t=e.prototype;return t.serialize=function(){return[this._last,this._wanted]},t.getPolled=function(){return this._last},t.getWanted=function(){var e;return null!==(e=this._wanted)&&void 0!==e?e:this._last},t.forceWantedPosition=function(e){this._wanted=e},t.isAwaitingFuturePosition=function(){return null!==this._wanted},e}();function pr(e,t,n){var r=t(e.getReference(),n);return{getCurrentTime:function(){return e.getCurrentTime()},getReadyState:function(){return e.getReadyState()},getPlaybackRate:function(){return e.getPlaybackRate()},getIsPaused:function(){return e.getIsPaused()},getReference:function(){return r},listen:function(e,t){var i;n.isCancelled()||!0===(null===(i=null==t?void 0:t.clearSignal)||void 0===i?void 0:i.isCancelled())||r.onUpdate(e,{clearSignal:null==t?void 0:t.clearSignal,emitCurrentValue:null==t?void 0:t.includeLastObservation})},deriveReadOnlyObserver:function(e){return pr(this,e,n)}}}var hr=function(){function e(e,t,n,r){this._src=e,this._contentId=t,this._messageSender=n,this._cancelSignal=r}var t=e.prototype;return t.getCurrentTime=function(){},t.getReadyState=function(){},t.getIsPaused=function(){},t.getReference=function(){return this._src},t.setPlaybackRate=function(e){this._messageSender({type:\"update-playback-rate\",contentId:this._contentId,value:e})},t.getPlaybackRate=function(){},t.listen=function(e,t){var n;this._cancelSignal.isCancelled()||!0===(null===(n=null==t?void 0:t.clearSignal)||void 0===n?void 0:n.isCancelled())||this._src.onUpdate(e,{clearSignal:null==t?void 0:t.clearSignal,emitCurrentValue:null==t?void 0:t.includeLastObservation})},t.deriveReadOnlyObserver=function(e){return pr(this,e,this._cancelSignal)},e}();var vr=function(e){var t={url:e.url,headers:e.headers,responseType:S(e.responseType)?\"json\":e.responseType,timeout:e.timeout,connectionTimeout:e.connectionTimeout};return new Promise((function(n,r){var i,a,o=e.onProgress,s=e.cancelSignal,u=t.url,l=t.headers,d=t.responseType,c=t.timeout,h=t.connectionTimeout,v=new XMLHttpRequest;if(v.open(\"GET\",u,!0),void 0!==c&&(v.timeout=c,i=setTimeout((function(){_(),r(new f(u,v.status,p.TIMEOUT))}),c+3e3)),void 0!==h&&(a=setTimeout((function(){_(),v.readyState!==XMLHttpRequest.DONE&&v.abort(),r(new f(u,v.status,p.TIMEOUT))}),h)),v.responseType=d,\"document\"===v.responseType&&v.overrideMimeType(\"text/xml\"),!S(l)){var m=l;for(var g in m)m.hasOwnProperty(g)&&v.setRequestHeader(g,m[g])}var b=L(),y=null;function _(){void 0!==i&&clearTimeout(i),void 0!==a&&clearTimeout(a),null!==y&&y()}void 0!==s&&(y=s.register((function(e){_(),v.readyState!==XMLHttpRequest.DONE&&v.abort(),r(e)})),s.isCancelled())||(v.onerror=function(){_(),r(new f(u,v.status,p.ERROR_EVENT))},v.ontimeout=function(){_(),r(new f(u,v.status,p.TIMEOUT))},void 0!==h&&(v.onreadystatechange=function(){v.readyState>=XMLHttpRequest.HEADERS_RECEIVED&&clearTimeout(a)}),void 0!==o&&(v.onprogress=function(e){var t=L();o({url:u,duration:t-b,sendingTime:b,currentTime:t,size:e.loaded,totalSize:e.total})}),v.onload=function(e){if(v.readyState===XMLHttpRequest.DONE)if(_(),v.status>=200&&v.status<300){var t,i=L(),a=v.response instanceof ArrayBuffer?v.response.byteLength:e.total,o=v.status,s=v.responseType,l=Q(v.responseURL)?v.responseURL:u;if(S(t=\"json\"===s?\"object\"==typeof v.response?v.response:function(e){try{return JSON.parse(e)}catch(e){return null}}(v.responseText):v.response))return void r(new f(u,v.status,p.PARSE_ERROR));n({status:o,url:l,responseType:s,sendingTime:b,receivedTime:i,requestDuration:i-b,size:a,responseData:t})}else r(new f(u,v.status,p.ERROR_HTTP_CODE))},v.send())}))},mr=function(e){function t(n,r,i){var a;return a=e.call(this)||this,Object.setPrototypeOf(u(a),t.prototype),a.name=\"CustomLoaderError\",a.message=n,a.canRetry=r,a.xhr=i,a}return l(t,e),t}(c(Error));function gr(e,t){var n=e.customManifestLoader,r=function(e){return function(t,n,r){if(void 0===t)throw new Error(\"Cannot perform HTTP(s) request. URL not known\");switch(e){case\"arraybuffer\":return vr({url:t,responseType:\"arraybuffer\",timeout:n.timeout,connectionTimeout:n.connectionTimeout,cancelSignal:r});case\"text\":return vr({url:t,responseType:\"text\",timeout:n.timeout,connectionTimeout:n.connectionTimeout,cancelSignal:r});case\"document\":return vr({url:t,responseType:\"document\",timeout:n.timeout,connectionTimeout:n.connectionTimeout,cancelSignal:r});default:Me()}}}(t);return\"function\"!=typeof n?r:function(e,t){return function(n,r,i){return new Promise((function(a,o){var s=Date.now()-L(),u=!1,l={reject:function(e){var t,n;if(!u&&!i.isCancelled()){u=!0,i.deregister(c);var r=e,a=null!==(t=null==r?void 0:r.message)&&void 0!==t?t:\"Unknown error when fetching the Manifest through a custom manifestLoader.\",s=new mr(a,null!==(n=null==r?void 0:r.canRetry)&&void 0!==n&&n,null==r?void 0:r.xhr);o(s)}},resolve:function(e){if(!u&&!i.isCancelled()){u=!0,i.deregister(c);var t=void 0!==e.receivingTime?e.receivingTime-s:void 0,n=void 0!==e.sendingTime?e.sendingTime-s:void 0;a({responseData:e.data,size:e.size,requestDuration:e.duration,url:e.url,receivedTime:t,sendingTime:n})}},fallback:function(){u||i.isCancelled()||(u=!0,i.deregister(c),t(n,r,i).then(a,o))}},d=e({url:n,timeout:r.timeout},l);function c(e){u||(u=!0,\"function\"==typeof d&&d(),o(e))}i.register(c)}))}}(n,r)}var br=function(e){function t(n,r,i){var a;return a=e.call(this)||this,Object.setPrototypeOf(u(a),t.prototype),a.name=\"EncryptedMediaError\",a.type=v.ENCRYPTED_MEDIA_ERROR,a.code=n,a._originalMessage=r,a.message=m(a.code,r),a.fatal=!1,\"string\"==typeof(null==i?void 0:i.keyStatuses)&&(a.keyStatuses=i.keyStatuses),a}return l(t,e),t.prototype.serialize=function(){return{name:this.name,code:this.code,reason:this._originalMessage,keyStatuses:this.keyStatuses}},t}(c(Error));function yr(e){return(e instanceof br||e instanceof b||e instanceof g||e instanceof Pt)&&Object.keys(v).indexOf(e.type)>=0}function Sr(e,t){var n=t.defaultCode,r=t.defaultReason;if(yr(e))return e;var i=e instanceof Error?e.toString():r;return new g(n,i)}function _r(e){var t=e.referenceDateTime,n=void 0!==e.serverSyncInfos?e.serverSyncInfos.serverTimestamp-e.serverSyncInfos.clientTime:void 0;return function(r,a,o,u,l){var d,c=r.responseData,f=a.externalClockOffset,p=null!==(d=r.url)&&void 0!==d?d:a.originalUrl,h=null!=n?n:f,v={unsafelyBaseOnPreviousManifest:a.unsafeMode?a.previousManifest:null,url:p,referenceDateTime:t,externalClockOffset:h},m=y.dashParsers;if(null===m.wasm||\"uninitialized\"===m.wasm.status||\"failure\"===m.wasm.status)return T.debug(\"DASH: WASM MPD Parser not initialized. Running JS one.\"),b();var g=function(e){if(e instanceof ArrayBuffer)return e;if(\"string\"==typeof e)return ot(e).buffer;if(e instanceof Document)return ot(e.documentElement.innerHTML).buffer;throw new Error(\"DASH Manifest Parser: Unrecognized Manifest format\")}(c);return function(e){var t=new DataView(e);if(61371===t.getUint16(0)&&191===t.getUint8(2))return!0;if(65279===t.getUint16(0)||65534===t.getUint16(0))return!1;return!0}(g)?\"initialized\"===m.wasm.status?(T.debug(\"DASH: Running WASM MPD Parser.\"),S(m.wasm.runWasmParser(g,v))):(T.debug(\"DASH: Awaiting WASM initialization before parsing the MPD.\"),m.wasm.waitForInitialization().catch((function(){})).then((function(){return null===m.wasm||\"initialized\"!==m.wasm.status?(T.warn(\"DASH: WASM MPD parser initialization failed. Running JS parser instead\"),b()):(T.debug(\"DASH: Running WASM MPD Parser.\"),S(m.wasm.runWasmParser(g,v)))}))):(T.info(\"DASH: MPD doesn't seem to be UTF-8-encoded. Running JS parser instead of the WASM one.\"),b());function b(){if(null!==m.fastJs){var e=function(e){if(e instanceof ArrayBuffer)return ut(new Uint8Array(e));if(\"string\"==typeof e)return e;if(e instanceof Document)return e.documentElement.outerHTML;throw new Error(\"DASH Manifest Parser: Unrecognized Manifest format\")}(c);return S(m.fastJs(e,v))}if(null!==m.native){var t=function(e){if(e instanceof ArrayBuffer)return(new DOMParser).parseFromString(ut(new Uint8Array(e)),\"text/xml\");if(\"string\"==typeof e)return(new DOMParser).parseFromString(e,\"text/xml\");if(e instanceof Document)return e;throw new Error(\"DASH Manifest Parser: Unrecognized Manifest format\")}(c);return S(m.native(t,v))}throw new Error(\"No MPD parser is imported\")}function S(t){if(\"done\"===t.type){if(t.value.warnings.length>0&&o(t.value.warnings),u.isCancelled())return Promise.reject(u.cancellationError);var n=[];return{manifest:new Se(t.value.parsed,e,n),url:p,warnings:n}}var r=t.value,a=r.urls.map((function(e){return l((function(){var t=s.getCurrent().DEFAULT_REQUEST_TIMEOUT,n=s.getCurrent().DEFAULT_CONNECTION_TIMEOUT;return\"string\"===r.format?vr({url:e,responseType:\"text\",timeout:t,connectionTimeout:n,cancelSignal:u}):vr({url:e,responseType:\"arraybuffer\",timeout:t,connectionTimeout:n,cancelSignal:u})})).then((function(e){if(\"string\"===r.format){if(\"string\"!=typeof e.responseData)throw new Error(\"External DASH resources should have been a string\");return i(e,{responseData:{success:!0,data:e.responseData}})}if(!(e.responseData instanceof ArrayBuffer))throw new Error(\"External DASH resources should have been ArrayBuffers\");return i(e,{responseData:{success:!0,data:e.responseData}})}),(function(e){var t=Sr(e,{defaultCode:\"PIPELINE_PARSE_ERROR\",defaultReason:\"An unknown error occured when parsing ressources.\"});return i({},{size:void 0,requestDuration:void 0,responseData:{success:!1,error:t}})}))}));return Promise.all(a).then((function(e){return r.format,S(r.continue(e))}))}}}var Er=\"function\"==typeof Headers?Headers:null,wr=\"function\"==typeof AbortController?AbortController:null;function Tr(){return\"function\"==typeof we.fetch&&!S(wr)&&!S(Er)}function Ar(e){var t=e[0],n=e[1];return n===1/0?\"bytes=\"+t+\"-\":\"bytes=\"+t+\"-\"+n}function Ir(e,t){return\"audio\"===e||\"video\"===e?\"video/mp4\"===t||\"audio/mp4\"===t?\"mp4\":\"video/webm\"===t||\"audio/webm\"===t?\"webm\":void 0:\"text\"===e&&\"application/mp4\"===t?\"mp4\":void 0}var kr=function(){function e(){var e,t=(e=E,[function(t){e(t)},function(t){e=t}]),n=t[0],r=t[1];this._isUsed=!1,this._trigger=n,this.signal=new Rr(r)}var t=e.prototype;return t.isUsed=function(){return this._isUsed},t.linkToSignal=function(e){var t=this,n=e.register((function(){t.cancel()}));return this.signal.register(n),n},t.cancel=function(e){if(!this._isUsed){this._isUsed=!0;var t=null!=e?e:new Pr;this._trigger(t)}},e.isCancellationError=function(e){return e instanceof Pr},e}(),Rr=function(){function e(e){var t=this;this._isCancelled=!1,this.cancellationError=null,this._listeners=[],e((function(e){for(t.cancellationError=e,t._isCancelled=!0;t._listeners.length>0;)try{var n=t._listeners.pop();null==n||n(e)}catch(e){T.error(\"Error while calling clean up listener\",e instanceof Error?e.toString():\"Unknown error\")}}))}var t=e.prototype;return t.isCancelled=function(){return this._isCancelled},t.register=function(e){var t=this;return this._isCancelled?(Ce(this.cancellationError),e(this.cancellationError),E):(this._listeners.push(e),function(){return t.deregister(e)})},t.deregister=function(e){for(var t=this._listeners.length-1;t>=0;t--)this._listeners[t]===e&&this._listeners.splice(t,1)},e}(),Pr=function(e){function t(){var n;return n=e.call(this)||this,Object.setPrototypeOf(u(n),t.prototype),n.name=\"CancellationError\",n.message=\"This task was cancelled.\",n}return l(t,e),t}(c(Error));function xr(){for(var e,t=arguments.length,n=-1,r=0;++n<t;)r+=\"number\"==typeof(e=n<0||arguments.length<=n?void 0:arguments[n])?e:e.length;var i=new Uint8Array(r),a=0;for(n=-1;++n<t;)\"number\"==typeof(e=n<0||arguments.length<=n?void 0:arguments[n])?a+=e:e.length>0&&(i.set(e,a),a+=e.length);return i}function Cr(e,t){return(e[t+0]<<8)+(e[t+1]|0)}function Mr(e,t){return 65536*e[t+0]+256*e[t+1]+e[t+2]}function Or(e,t){return 16777216*e[t+0]+65536*e[t+1]+256*e[t+2]+e[t+3]}function Dr(e,t){return 4294967296*(16777216*e[t+0]+65536*e[t+1]+256*e[t+2]+e[t+3])+16777216*e[t+4]+65536*e[t+5]+256*e[t+6]+e[t+7]}function Nr(e){return new Uint8Array([e>>>24&255,e>>>16&255,e>>>8&255,255&e])}function Ur(e){var t=e%4294967296,n=(e-t)/4294967296;return new Uint8Array([n>>>24&255,n>>>16&255,n>>>8&255,255&n,t>>>24&255,t>>>16&255,t>>>8&255,255&t])}function Lr(e,t){for(var n=e.length,r=0;r+8<=n;){var i=Or(e,r);if(0===i)i=n-r;else if(1===i){if(r+16>n)return-1;i=Dr(e,r+8)}if(isNaN(i)||i<=0)return-1;if(Or(e,r+4)===t)return r+i<=n?r:-1;r+=i}return-1}function Fr(e){return function(t,n,r,i,a){return new Promise((function(s,u){var l=new kr,d=l.linkToSignal(i);function c(){l.signal.deregister(u),d()}l.signal.register(u),e(t,n,r,l.signal,Object.assign(Object.assign({},a),{onNewChunk:function(e){try{o(e),a.onNewChunk(e)}catch(e){c(),l.cancel(),u(e)}}})).then((function(e){if(c(),!l.isUsed()){if(\"segment-loaded\"===e.resultType)try{o(e.resultData.responseData)}catch(e){return void u(e)}s(e)}}),(function(e){c(),u(e)}))}));function o(e){(e instanceof ArrayBuffer||e instanceof Uint8Array)&&\"mp4\"===Ir(n.type,n.mimeType)&&function(e,t){if(t){if(Lr(e,1718909296)<0)throw new g(\"INTEGRITY_ERROR\",\"Incomplete `ftyp` box\");if(Lr(e,1836019574)<0)throw new g(\"INTEGRITY_ERROR\",\"Incomplete `moov` box\")}else{if(Lr(e,1836019558)<0)throw new g(\"INTEGRITY_ERROR\",\"Incomplete `moof` box\");if(Lr(e,1835295092)<0)throw new g(\"INTEGRITY_ERROR\",\"Incomplete `mdat` box\")}}(new Uint8Array(e),n.segment.isInit)}}}function Br(e,t){return null===e?null:null===t.url?e.baseUrl:$e(e.baseUrl,t.url)}function zr(e,t,n,r,i){if(void 0===t.range)return vr({url:e,responseType:\"arraybuffer\",timeout:n.timeout,connectionTimeout:n.connectionTimeout,cancelSignal:r,onProgress:i.onProgress}).then((function(e){return{resultType:\"segment-loaded\",resultData:e}}));if(void 0===t.indexRange)return vr({url:e,headers:{Range:Ar(t.range)},responseType:\"arraybuffer\",timeout:n.timeout,connectionTimeout:n.connectionTimeout,cancelSignal:r,onProgress:i.onProgress}).then((function(e){return{resultType:\"segment-loaded\",resultData:e}}));if(t.range[1]+1===t.indexRange[0])return vr({url:e,headers:{Range:Ar([t.range[0],t.indexRange[1]])},responseType:\"arraybuffer\",timeout:n.timeout,connectionTimeout:n.connectionTimeout,cancelSignal:r,onProgress:i.onProgress}).then((function(e){return{resultType:\"segment-loaded\",resultData:e}}));var a=vr({url:e,headers:{Range:Ar(t.range)},responseType:\"arraybuffer\",timeout:n.timeout,connectionTimeout:n.connectionTimeout,cancelSignal:r,onProgress:i.onProgress}),o=vr({url:e,headers:{Range:Ar(t.indexRange)},responseType:\"arraybuffer\",timeout:n.timeout,connectionTimeout:n.connectionTimeout,cancelSignal:r,onProgress:i.onProgress});return Promise.all([a,o]).then((function(t){var n=t[0],r=t[1],i=xr(new Uint8Array(n.responseData),new Uint8Array(r.responseData)),a=Math.min(n.sendingTime,r.sendingTime),o=Math.max(n.receivedTime,r.receivedTime);return{resultType:\"segment-loaded\",resultData:{url:e,responseData:i,size:n.size+r.size,requestDuration:o-a,sendingTime:a,receivedTime:o}}}))}function Wr(e,t,n,r,i){var a=t.segment,o=void 0!==a.range?{Range:Ar(a.range)}:void 0,s=null;return function(e){var t;if(!S(e.headers))if(S(Er))t=e.headers;else{t=new Er;for(var n=Object.keys(e.headers),r=0;r<n.length;r++){var i=n[r];t.append(i,e.headers[i])}}T.debug(\"Fetch: Called with URL\",e.url);var a,o,s=null,u=!1,l=!1,d=L(),c=S(wr)?null:new wr;function h(){S(c)?T.warn(\"Fetch: AbortController API not available.\"):c.abort()}void 0!==e.timeout&&(a=setTimeout((function(){u=!0,void 0!==o&&clearTimeout(o),h()}),e.timeout)),void 0!==e.connectionTimeout&&(o=setTimeout((function(){l=!0,void 0!==a&&clearTimeout(a),h()}),e.connectionTimeout));var v=e.cancelSignal.register((function(e){s=e,h()})),m={method:\"GET\"};return void 0!==t&&(m.headers=t),m.signal=S(c)?null:c.signal,fetch(e.url,m).then((function(t){if(void 0!==o&&clearTimeout(o),t.status>=300)throw T.warn(\"Fetch: Request HTTP Error\",t.status,t.url),new f(t.url,t.status,p.ERROR_HTTP_CODE);if(S(t.body))throw new f(t.url,t.status,p.PARSE_ERROR);var n=t.headers.get(\"Content-Length\"),r=S(n)||isNaN(+n)?void 0:+n,i=t.body.getReader(),s=0;return u();function u(){return l.apply(this,arguments)}function l(){return(l=qn(Yn().mark((function n(){var o,l,c,f,p;return Yn().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,i.read();case 2:if((o=n.sent).done||S(o.value)){n.next=11;break}return s+=o.value.byteLength,l=L(),c={url:t.url,currentTime:l,duration:l-d,sendingTime:d,chunkSize:o.value.byteLength,chunk:o.value.buffer,size:s,totalSize:r},e.onData(c),n.abrupt(\"return\",u());case 11:if(!o.done){n.next=17;break}return void 0!==a&&clearTimeout(a),v(),f=L(),p=f-d,n.abrupt(\"return\",{requestDuration:p,receivedTime:f,sendingTime:d,size:s,status:t.status,url:t.url});case 17:return n.abrupt(\"return\",u());case 18:case\"end\":return n.stop()}}),n)})))).apply(this,arguments)}})).catch((function(t){if(null!==s)throw s;if(v(),u)throw T.warn(\"Fetch: Request timed out.\"),new f(e.url,0,p.TIMEOUT);if(l)throw T.warn(\"Fetch: Request connection timed out.\"),new f(e.url,0,p.TIMEOUT);if(t instanceof f)throw t;throw T.warn(\"Fetch: Request Error\",t instanceof Error?t.toString():\"\"),new f(e.url,0,p.ERROR_EVENT)}))}({url:e,headers:o,onData:function(e){var t=new Uint8Array(e.chunk),n=function(e){for(var t=0,n=[],r=null;t<=e.length;){if(t===e.length){r=null;break}var i=Lr(r=e.subarray(t,1/0),1836019558);if(i<0)break;var a=t+i+Or(e,i+t);if(a>e.length)break;var o=Lr(r,1835295092);if(o<0)break;var s=t+o+Or(e,o+t);if(s>e.length)break;var u=Math.max(a,s),l=e.subarray(t,u);n.push(l),t=u}return 0===n.length?[null,r]:[xr.apply(void 0,n),r]}(null!==s?xr(s,t):t),a=n[0];s=n[1],null!==a&&(r.onNewChunk(a),i.isCancelled())||(r.onProgress({duration:e.duration,size:e.size,totalSize:e.totalSize}),i.isCancelled())},timeout:n.timeout,cancelSignal:i}).then((function(e){return{resultType:\"chunk-complete\",resultData:e}}))}function Vr(e,t,n,r,i,a){if(t.segment.isInit)return zr(e,t.segment,r,a,i);var o=Ir(t.type,t.mimeType);if(n&&(\"mp4\"===o||void 0===o)){if(Tr())return Wr(e,t,r,i,a);P(\"DASH: Your browser does not have the fetch API. You will have a higher chance of rebuffering when playing close to the live edge\")}var s=t.segment;return vr({url:e,responseType:\"arraybuffer\",headers:void 0!==s.range?{Range:Ar(s.range)}:void 0,timeout:r.timeout,connectionTimeout:r.connectionTimeout,cancelSignal:a,onProgress:i.onProgress}).then((function(e){return{resultType:\"segment-loaded\",resultData:e}}))}var jr=\"function\"==typeof Uint8Array.prototype.slice?function(e,t,n){return e.slice(t,n)}:function(e,t,n){return new Uint8Array(Array.prototype.slice.call(e,t,n))};function Gr(e,t){var n=\"undefined\"!=typeof Symbol&&e[Symbol.iterator]||e[\"@@iterator\"];if(n)return(n=n.call(e)).next.bind(n);if(Array.isArray(e)||(n=function(e,t){if(!e)return;if(\"string\"==typeof e)return Hr(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);\"Object\"===n&&e.constructor&&(n=e.constructor.name);if(\"Map\"===n||\"Set\"===n)return Array.from(e);if(\"Arguments\"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Hr(e,t)}(e))||t&&e&&\"number\"==typeof e.length){n&&(e=n);var r=0;return function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}}}throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\")}function Hr(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function qr(e,t){for(var n,r=e,i=Gr(t);!(n=i()).done;){var a=Kr(r,n.value);if(null===a)return null;r=a}return r}function Kr(e,t){var n=Yr(e,t);return null!==n?e.subarray(n[1],n[2]):null}function Yr(e,t){for(var n,r,i=e.length,a=0,o=0;a+8<=i;){if(o=Or(e,r=a),n=Or(e,r+=4),r+=4,0===o)o=i-a;else if(1===o){if(r+8>i)return null;o=Dr(e,r),r+=8}if(o<0)throw new Error(\"ISOBMFF: Size out of range\");if(n===t)return 1970628964===t&&(r+=16),[a,r,a+o];a+=o}return null}function Qr(e,t){if(e[t]>1)T.warn(\"ISOBMFF: un-handled PSSH version\");else{var n=t+4;if(!(n+16>e.length))return function(e,t){void 0===t&&(t=\"\");for(var n=\"\",r=0;r<e.byteLength;r++)n+=(e[r]>>>4).toString(16),n+=(15&e[r]).toString(16),t.length>0&&r<e.byteLength-1&&(n+=t);return n}(jr(e,n,n+16))}}var Xr=Math.pow(2,32)-1;function $r(e){return function(e,t){for(var n=[],r=e;;){var i=Yr(r,t);if(null===i)return n;Ce(0!==i[2]&&r.length),n.push(r.subarray(i[1],i[2])),r=r.subarray(i[2])}}(e,1836019558).reduce((function(e,t){var n=Kr(t,1953653094);return null!==n&&e.push(n),e}),[])}function Zr(e,t){return void 0===t&&(t=0),Kr(e.subarray(t),1701671783)}function Jr(e,t){var n=\"undefined\"!=typeof Symbol&&e[Symbol.iterator]||e[\"@@iterator\"];if(n)return(n=n.call(e)).next.bind(n);if(Array.isArray(e)||(n=function(e,t){if(!e)return;if(\"string\"==typeof e)return ei(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);\"Object\"===n&&e.constructor&&(n=e.constructor.name);if(\"Map\"===n||\"Set\"===n)return Array.from(e);if(\"Arguments\"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ei(e,t)}(e))||t&&e&&\"number\"==typeof e.length){n&&(e=n);var r=0;return function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}}}throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\")}function ei(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var ti=1635148593,ni=1635148595,ri=1633889587,ii=1700998451,ai=1836069985,oi=new Uint8Array([0,0,0,80,115,105,110,102,0,0,0,12,102,114,109,97,0,0,0,0,0,0,0,20,115,99,104,109,0,0,0,0,99,101,110,99,0,1,0,0,0,0,0,40,115,99,104,105,0,0,0,32,116,101,110,99,0,0,0,0,0,0,1,8,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0]);function si(e){for(var t,n=e instanceof Uint8Array?e:e instanceof ArrayBuffer?new Uint8Array(e):new Uint8Array(e.buffer),r=[],i=n,a=0,o=0,s=[1836019574,1953653099,1835297121,1835626086,1937007212,1937011556];o<s.length;o++){var u=Yr(i,s[o]);if(null===u)return n;i=i.subarray(u[1],u[2]),r.push(u.map((function(e){return e+a}))),a+=u[1]}var l=r[r.length-1],d=l[1]+8,c=n.subarray(d,l[2]),f=Kr(c,1701733238),p=Kr(c,1701733217);if(null!==f||null!==p)return n;var h=[{type:\"video\",name:ti,relativeOffsets:Yr(c,ti)},{type:\"video\",name:ni,relativeOffsets:Yr(c,ni)},{type:\"audio\",name:ri,relativeOffsets:Yr(c,ri)},{type:\"audio\",name:ii,relativeOffsets:Yr(c,ii)},{type:\"audio\",name:ai,relativeOffsets:Yr(c,ai)}].filter((function(e){return null!==e.relativeOffsets}));h.sort((function(e,t){return t.relativeOffsets[0]-e.relativeOffsets[0]}));for(var v,m,g=n,b=function(){var e=m.value,i=e.relativeOffsets[2]-e.relativeOffsets[0],a=new Uint8Array(i+oi.length),o=c.subarray(e.relativeOffsets[0],e.relativeOffsets[2]);a.set(o,0);var s=e.relativeOffsets[1]-e.relativeOffsets[0]-4;\"audio\"===e.type?a.set(Nr(1701733217),s):a.set(Nr(1701733238),s),a.set(oi,i);var u=Yr(a,1936289382);if(null===u)return T.warn(\"ISOBMFF: sinf not found, this should not be possible.\"),{v:n};var f=a.subarray(u[1],u[2]),p=null===(t=Yr(f,1718775137))||void 0===t?void 0:t.map((function(e){return e+u[1]}));if(void 0===p)return T.warn(\"ISOBMFF: frma not found in sinf, this should not be possible.\"),{v:n};a.set(Nr(e.name),p[1]),a=fi(a);var h=g;g=new Uint8Array(h.length+a.byteLength);var v=d+e.relativeOffsets[2];g.set(h.subarray(0,v),0),g.set(h.subarray(v),v+a.length),g.set(a,v);for(var b=0,y=r;b<y.length;b++){var S=y[b];fi(g.subarray(S[0],S[2]+a.length))}var _,E=Cr(g,l[1]+6);E+=1,g.set((_=E,new Uint8Array([_>>>8&255,255&_])),l[1]+6)},y=Jr(h);!(m=y()).done;)if(v=b())return v.v;return g}function ui(e,t){var n=Yr(e,1936286840);if(null===n)return null;var r,i=t,a=n[2]-n[0],o=n[1],s=e[o],u=Or(e,o+=8);if(o+=4,0===s)r=Or(e,o),i+=Or(e,o+=4)+a,o+=4;else{if(1!==s)return null;r=Dr(e,o),i+=Dr(e,o+=8)+a,o+=8}var l=[],d=Cr(e,o+=2);for(o+=2;--d>=0;){var c=Or(e,o);o+=4;var f=2147483647&c;if(1===(2147483648&c)>>>31)throw new Error(\"sidx with reference_type `1` not yet implemented\");var p=Or(e,o);o+=4,o+=4,l.push({time:r,duration:p,timescale:u,range:[i,i+f-1]}),r+=p,i+=f}return l}function li(e){var t=function(e){var t=Kr(e,1836019558);return null===t?null:Kr(t,1953653094)}(e);if(null!==t){var n=Kr(t,1952867444);if(null!==n){var r=n[0];return 1===r?Dr(n,4):0===r?Or(n,4):void 0}}}function di(e){var t=Kr(e,1952868452);if(null!==t){var n=1,r=Mr(t,n);if(n+=3,(8&r)>0)return n+=4,(1&r)>0&&(n+=8),(2&r)>0&&(n+=4),Or(t,n)}}function ci(e){var t=function(e){var t=Kr(e,1836019574);if(null===t)return null;var n=Kr(t,1953653099);return null===n?null:Kr(n,1835297121)}(e);if(null!==t){var n=Kr(t,1835296868);if(null!==n){var r=0,i=n[r];return r+=4,1===i?Or(n,r+16):0===i?Or(n,r+8):void 0}}}function fi(e){var t=e.length;if(t<4)throw new Error(\"Cannot update box length: box too short\");var n=Or(e,0);if(0===n){if(t>Xr){var r=new Uint8Array(t+8);return r.set(Nr(1),0),r.set(e.subarray(4,8),4),r.set(Ur(t+8),8),r.set(e.subarray(8,t),16),r}return e.set(Nr(t),0),e}if(1===n){if(t<16)throw new Error(\"Cannot update box length: box too short\");return e.set(Ur(t),8),e}if(t<=Xr)return e.set(Nr(t),0),e;var i=new Uint8Array(t+8);return i.set(Nr(1),0),i.set(e.subarray(4,8),4),i.set(Ur(t+8),8),i.set(e.subarray(8,t),16),i}var pi=408125543,hi=357149030,vi=2807729,mi=17545,gi=475249515,bi=187,yi=179,Si=183,_i=241;function Ei(e,t,n,r){for(var i=r[0],a=r[1],o=i;o<a;){var s=Ii(n,o);if(null===s)return null;var u=s.value,l=o+s.length,d=ki(n,l);if(null===d)return null;var c=l+d.length,f=c+d.value;if(u===e)return[c,f];if(t.length>0)for(var p=0;p<t.length;p++){if(u===t[p])return Ei(e,t.slice(p+1,t.length),n,[c,f])}o=f}return null}function wi(e,t){var n=Ei(vi,[pi,hi],e,[t,e.length]);if(null===n)return null;var r=n[1]-n[0];return 1e9/Ri(e,n[0],r)}function Ti(e,t){var n=Ei(mi,[pi,hi],e,[t,e.length]);if(null===n)return null;var r=n[1]-n[0];return 4===r?function(e,t){return new DataView(e.buffer).getFloat32(t)}(e,n[0]):8===r?function(e,t){return new DataView(e.buffer).getFloat64(t)}(e,n[0]):null}function Ai(e,t){for(var n=1;n<=8;n++)if(e[t]>=Math.pow(2,8-n))return n}function Ii(e,t){var n=Ai(e,t);if(void 0===n)return T.warn(\"webm: unrepresentable length\"),null;if(t+n>e.length)return T.warn(\"webm: impossible length\"),null;for(var r=0,i=0;i<n;i++)r=e[t+i]*Math.pow(2,8*(n-i-1))+r;return{length:n,value:r}}function ki(e,t){var n=Ai(e,t);if(void 0===n)return T.warn(\"webm: unrepresentable length\"),null;if(t+n>e.length)return T.warn(\"webm: impossible length\"),null;for(var r=(e[t]&(1<<8-n)-1)*Math.pow(2,8*(n-1)),i=1;i<n;i++)r=e[t+i]*Math.pow(2,8*(n-i-1))+r;return{length:n,value:r}}function Ri(e,t,n){for(var r=0,i=0;i<n;i++)r=e[t+i]*Math.pow(2,8*(n-i-1))+r;return r}function Pi(e,t,n,r){var i=li(e);if(void 0===i||void 0===r)return null;var a,o=void 0!==n.timestampOffset?i+n.timestampOffset*r:i,s=function(e){var t=$r(e);if(0!==t.length){for(var n,r=0,i=Jr(t);!(n=i()).done;){var a=n.value,o=Kr(a,1953658222);if(null===o)return;var s=0;if(o[s]>1)return;var u=Mr(o,s+=1);s+=3;var l=(256&u)>0,d=0;if(!l&&void 0===(d=di(a)))return;var c=(1&u)>0,f=(4&u)>0,p=(512&u)>0,h=(1024&u)>0,v=(2048&u)>0,m=Or(o,s);s+=4,c&&(s+=4),f&&(s+=4);for(var g=m,b=0;g-- >0;)l?(b+=Or(o,s),s+=4):b+=d,p&&(s+=4),h&&(s+=4),v&&(s+=4);r+=b}return r}}(e);if(o<0&&(void 0!==s&&(s+=o),o=0),t||!n.complete)return void 0===s&&T.warn(\"DASH: Chunked segments should indicate a duration through their trun boxes\"),{time:o/r,duration:void 0!==s?s/r:void 0};var u=n.duration*r,l=Math.min(.9*r,u/4);return void 0!==s&&Math.abs(s-u)<=l&&(a=s),{time:o/r,duration:void 0!==a?a/r:a}}function xi(e,t){if(0!==e.length){var n=e.reduce((function(e,t){return\"urn:mpeg:dash:event:2012\"===t.schemeIdUri&&\"1\"===t.value?(void 0===e.manifestRefreshEventsFromEMSGs&&(e.manifestRefreshEventsFromEMSGs=[]),e.manifestRefreshEventsFromEMSGs.push(t)):(void 0===e.EMSGs&&(e.EMSGs=[]),e.EMSGs.push(t)),e}),{manifestRefreshEventsFromEMSGs:void 0,EMSGs:void 0}),r=n.manifestRefreshEventsFromEMSGs,i=n.EMSGs,a=null==i?void 0:i.map((function(e){return{type:\"emsg\",value:e}})),o=void 0!==t&&void 0!==r&&function(e,t){if(e.length<=0)return!1;for(var n=e.length,r=0;r<n;r++){var i=t,a=ut(e[r].messageData),o=Date.parse(a);if(void 0===i||void 0===o||isNaN(o)||o>=i)return!0}return!1}(r,t);return{inbandEvents:a,needsManifestRefresh:o}}}function Ci(e){var t=e.__priv_patchLastSegmentInSidx;return function(e,n,r){var i,a,o=n.segment,s=n.periodStart,u=n.periodEnd,l=e.data,d=e.isChunked,c=[s,u];if(null===l)return o.isInit?{segmentType:\"init\",initializationData:null,initializationDataSize:0,protectionData:[],initTimescale:void 0}:{segmentType:\"media\",chunkData:null,chunkSize:0,chunkInfos:null,chunkOffset:0,protectionData:[],appendWindow:c};var f=l instanceof Uint8Array?l:new Uint8Array(l),p=Ir(n.type,n.mimeType),h=\"mp4\"===p||void 0===p,v=[];if(h){var m,g=function(e){var t=0,n=Kr(e,1836019574);if(null===n)return[];for(var r=[];t<n.length;){var i=void 0;try{i=Yr(n,1886614376)}catch(e){var a=e instanceof Error?e:\"\";return T.warn(\"Error while removing PSSH from ISOBMFF\",a),r}if(null===i)return r;var o=jr(n,i[0],i[2]),s=Qr(o,i[1]-i[0]);void 0!==s&&r.push({systemId:s,data:o}),n[i[1]-4]=102,n[i[1]-3]=114,n[i[1]-2]=101,n[i[1]-1]=101,t=i[2]}return r}(f);o.isInit&&(m=null!==(i=function(e){var t=qr(e,[1836019574,1953653099,1835297121,1835626086,1937007212,1937011556]);if(null===t)return null;var n=t.subarray(8),r=Kr(n,1701733238),i=0;if(null===r?(i=28,r=Kr(n,1701733217)):i=78,null===r)return null;var a=qr(r.subarray(i),[1936289382,1935894633,1952804451]);return null===a||a.byteLength<24?null:a.subarray(8,24)}(f))&&void 0!==i?i:void 0),(g.length>0||void 0!==m)&&v.push({initDataType:\"cenc\",keyId:m,initData:g})}if(!o.isInit){var b=h?Pi(f,d,o,r):null,y=null!==(a=o.timestampOffset)&&void 0!==a?a:0;if(h){var _=function(e){for(var t=[],n=0;n<e.length;){var r=Zr(e,n);if(null===r)break;var i=r.length;n+=i;var a=r[0];if(0!==a)T.warn(\"ISOBMFF: EMSG version \"+a.toString()+\" not supported.\");else{var o=4,s=dt(r,o),u=s.end,l=s.string,d=dt(r,o=u),c=d.end,f=d.string,p=Or(r,o=c),h=Or(r,o+=4),v=Or(r,o+=4),m=Or(r,o+=4);o+=4;var g={schemeIdUri:l,value:f,timescale:p,presentationTimeDelta:h,eventDuration:v,id:m,messageData:r.subarray(o,i)};t.push(g)}}if(0!==t.length)return t}(f);if(void 0!==_){var E=xi(_.filter((function(e){return void 0!==o.privateInfos&&void 0!==o.privateInfos.isEMSGWhitelisted&&o.privateInfos.isEMSGWhitelisted(e)})),n.manifestPublishTime);if(void 0!==E){var w=E.needsManifestRefresh,A=E.inbandEvents;return{segmentType:\"media\",chunkData:f,chunkSize:f.length,chunkInfos:b,chunkOffset:y,appendWindow:c,inbandEvents:A,protectionData:v,needsManifestRefresh:w}}}}return{segmentType:\"media\",chunkData:f,chunkSize:f.length,chunkInfos:b,chunkOffset:y,protectionData:v,appendWindow:c}}var I,k,R=o.indexRange;if(\"webm\"===p)I=function(e,t){var n=Ei(pi,[],e,[t,e.length]);if(null===n)return null;var r=n[0],i=n[1],a=wi(e,r);if(null===a)return null;var o=Ti(e,r);if(null===o)return null;var s=Ei(gi,[],e,[r,i]);if(null===s)return null;for(var u=[],l=s[0];l<s[1];){var d=Ei(bi,[],e,[l,s[1]]);if(null===d)break;var c=Ei(yi,[],e,[d[0],d[1]]);if(null===c)return null;var f=Ri(e,c[0],c[1]-c[0]),p=Ei(_i,[Si],e,[d[0],d[1]]);if(null===p)return null;var h=Ri(e,p[0],p[1]-p[0])+r;u.push({time:f,rangeStart:h}),l=d[1]}for(var v=[],m=0;m<u.length;m++){var g=u[m];m===u.length-1?v.push({time:g.time,timescale:a,duration:0===m?o:o-g.time,range:[g.rangeStart,1/0]}):v.push({time:g.time,timescale:a,duration:u[m+1].time-g.time,range:[g.rangeStart,u[m+1].rangeStart-1]})}return v}(f,0);else if(h&&(I=ui(f,Array.isArray(R)?R[0]:0),!0===t&&null!==I&&I.length>0)){var P=I[I.length-1];Array.isArray(P.range)&&(P.range[1]=1/0)}h?k=ci(f):\"webm\"===p&&(k=wi(f,0));var x=S(k)?void 0:k;return o.isInit&&(T.warn(\"DASH: !!!!!!!!!!!! FAKE ENCRYPTION\"),f=si(f)),{segmentType:\"init\",initializationData:f,initializationDataSize:f.length,protectionData:v,initTimescale:x,segmentList:null!=I?I:void 0}}}function Mi(e){var t=Kr(e,1835295092);return null===t?\"\":ut(t)}function Oi(e,t,n,r){var i,a,o=e.segment,s=e.language,u=e.codecs;if(o.isInit)return null;null===n?r?(i=o.time,a=o.end):T.warn(\"Transport: Unavailable time data for current text track.\"):(i=n.time,void 0!==n.duration?a=i+n.duration:!r&&o.complete&&(a=i+o.duration));var l=function(e){if(void 0===e)throw new Error(\"Cannot parse subtitles: unknown format\");switch(e.toLowerCase()){case\"stpp\":case\"stpp.ttml.im1t\":return\"ttml\";case\"wvtt\":return\"vtt\"}throw new Error('The codec used for the subtitles \"'+e+'\" is not managed yet.')}(u);return{data:Mi(t),type:l,language:s,start:i,end:a}}function Di(e,t,n){var r,i,a=e.segment;return a.isInit?null:(n?T.warn(\"Transport: Unavailable time data for current text track.\"):(r=a.time,a.complete&&(i=a.time+a.duration)),{data:t,type:function(e,t){switch(t){case\"application/ttml+xml\":return\"ttml\";case\"application/x-sami\":case\"application/smil\":return\"sami\";case\"text/vtt\":return\"vtt\"}if(void 0!==e&&\"srt\"===e.toLowerCase())return\"srt\";throw new Error(\"could not find a text-track parser for the type \"+(null!=t?t:\"\"))}(e.codecs,e.mimeType),language:e.language,start:r,end:i})}function Ni(e){var t=e.__priv_patchLastSegmentInSidx;return function(e,n,r){var i,a=n.periodStart,o=n.periodEnd,s=n.segment,u=e.data,l=e.isChunked;if(null===u)return s.isInit?{segmentType:\"init\",initializationData:null,initializationDataSize:0,protectionData:[],initTimescale:void 0}:{segmentType:\"media\",chunkData:null,chunkSize:0,chunkInfos:null,chunkOffset:null!==(i=s.timestampOffset)&&void 0!==i?i:0,protectionData:[],appendWindow:[a,o]};var d=Ir(n.type,n.mimeType);if(\"webm\"===d)throw new Error(\"Text tracks with a WEBM container are not yet handled.\");return\"mp4\"===d?function(e,t,n,r,i){var a,o,s=n.segment,u=s.isInit,l=s.indexRange;if(o=\"string\"==typeof e?ot(e):e instanceof Uint8Array?e:new Uint8Array(e),u){var d=ui(o,Array.isArray(l)?l[0]:0);if(!0===i&&null!==d&&d.length>0){var c=d[d.length-1];Array.isArray(c.range)&&(c.range[1]=1/0)}return{segmentType:\"init\",initializationData:null,initializationDataSize:0,protectionData:[],initTimescale:ci(o),segmentList:null!=d?d:void 0}}var f=Pi(o,t,s,r),p=Oi(n,o,f,t),h=null!==(a=s.timestampOffset)&&void 0!==a?a:0;return{segmentType:\"media\",chunkData:p,chunkSize:o.length,chunkInfos:f,chunkOffset:h,protectionData:[],appendWindow:[n.periodStart,n.periodEnd]}}(u,l,n,r,t):function(e,t,n){var r,i,a=n.periodStart,o=n.periodEnd,s=n.segment,u=s.timestampOffset,l=void 0===u?0:u;if(s.isInit)return{segmentType:\"init\",initializationData:null,initializationDataSize:0,protectionData:[],initTimescale:void 0};if(\"string\"!=typeof e){var d=e instanceof Uint8Array?e:new Uint8Array(e);r=ut(d),i=d.length}else r=e;return{segmentType:\"media\",chunkData:Di(n,r,t),chunkSize:i,chunkInfos:null,chunkOffset:l,protectionData:[],appendWindow:[a,o]}}(u,l,n)}}var Ui=function(e){var t=gr({customManifestLoader:e.manifestLoader},null===y.dashParsers.wasm||\"initialized\"!==y.dashParsers.wasm.status&&\"initializing\"!==y.dashParsers.wasm.status?\"arraybuffer\":\"text\"),n=_r(e),r=function(e){var t=e.lowLatencyMode,n=e.segmentLoader;return!0!==e.checkMediaSegmentIntegrity?r:Fr(r);function r(e,r,i,a,o){var s=Br(e,r.segment);return null===s?Promise.resolve({resultType:\"segment-created\",resultData:null}):t||void 0===n?Vr(s,r,t,i,o,a):new Promise((function(e,u){var l,d=!1,c={reject:function(e){var t,n;if(!d&&!a.isCancelled()){d=!0,a.deregister(h);var r=e,i=null!==(t=null==r?void 0:r.message)&&void 0!==t?t:\"Unknown error when fetching a DASH segment through a custom segmentLoader.\",o=new mr(i,null!==(n=null==r?void 0:r.canRetry)&&void 0!==n&&n,null==r?void 0:r.xhr);u(o)}},resolve:function(t){d||a.isCancelled()||(d=!0,a.deregister(h),e({resultType:\"segment-loaded\",resultData:{responseData:t.data,size:t.size,requestDuration:t.duration}}))},progress:function(e){d||a.isCancelled()||o.onProgress({duration:e.duration,size:e.size,totalSize:e.totalSize})},fallback:function(){d||a.isCancelled()||(d=!0,a.deregister(h),Vr(s,r,t,i,o,a).then(e,u))}};void 0!==r.segment.range&&(l=[r.segment.range],void 0!==r.segment.indexRange&&l.push(r.segment.indexRange));var f={isInit:r.segment.isInit,timeout:i.timeout,byteRanges:l,trackType:r.type,url:s},p=n(f,c);function h(e){d||(d=!0,\"function\"==typeof p&&p(),u(e))}a.register(h)}))}}(e),i=Ci(e),a=function(e){var t=e.lowLatencyMode;return!0!==e.checkMediaSegmentIntegrity?n:Fr(n);function n(e,n,r,i,a){var o=n.segment,s=o.range,u=Br(e,o);if(null===u)return Promise.resolve({resultType:\"segment-created\",resultData:null});if(o.isInit)return zr(u,o,r,i,a);var l=Ir(n.type,n.mimeType),d=\"mp4\"===l||void 0===l;if(t&&d){if(Tr())return Wr(u,n,r,a,i);P(\"DASH: Your browser does not have the fetch API. You will have a higher chance of rebuffering when playing close to the live edge\")}return d?vr({url:u,responseType:\"arraybuffer\",headers:Array.isArray(s)?{Range:Ar(s)}:null,timeout:r.timeout,connectionTimeout:r.connectionTimeout,onProgress:a.onProgress,cancelSignal:i}).then((function(e){return{resultType:\"segment-loaded\",resultData:e}})):vr({url:u,responseType:\"text\",headers:Array.isArray(s)?{Range:Ar(s)}:null,timeout:r.timeout,connectionTimeout:r.connectionTimeout,onProgress:a.onProgress,cancelSignal:i}).then((function(e){return{resultType:\"segment-loaded\",resultData:e}}))}}(e);return{manifest:{loadManifest:t,parseManifest:n},audio:{loadSegment:r,parseSegment:i},video:{loadSegment:r,parseSegment:i},text:{loadSegment:a,parseSegment:Ni(e)}}},Li=\"function\"==typeof queueMicrotask?queueMicrotask:function(e){Promise.resolve().then(e,(function(){return e()}))},Fi=function(){function e(e){this._array=[],this._sortingFn=e}var t=e.prototype;return t.add=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];t.sort(this._sortingFn);for(var r=0,i=0;i<t.length;i++){for(var a=t[i],o=!1;!o&&r<this._array.length;)this._sortingFn(a,this._array[r])<0?(this._array.splice(r,0,a),o=!0):r++;o||this._array.push(a)}},t.length=function(){return this._array.length},t.get=function(e){if(e<0||e>=this._array.length)throw new Error(\"Invalid index.\");return this._array[e]},t.toArray=function(){return this._array.slice()},t.findFirst=function(e){return A(this._array,e)},t.has=function(e){return k(this._array,e)},t.removeElement=function(e){var t=this._array.indexOf(e);if(t>=0)return this._array.splice(t,1),t},t.head=function(){return this._array[0]},t.last=function(){return this._array[this._array.length-1]},t.shift=function(){return this._array.shift()},t.pop=function(){return this._array.pop()},e}(),Bi=function(){function e(e){this._weakMap=new WeakMap,this._fn=e}var t=e.prototype;return t.get=function(e){var t=this._weakMap.get(e);if(void 0===t){var n=this._fn(e);return this._weakMap.set(e,n),n}return t},t.destroy=function(e){this._weakMap.delete(e)},e}(),zi=1/60;function Wi(e,t){return Math.abs(e-t)<zi}function Vi(e,t){return{start:Math.min(e.start,t.start),end:Math.max(e.end,t.end)}}function ji(e,t){return e.end<=t.start}function Gi(e,t){var n=e.start,r=e.end;return n<=t&&t<r}function Hi(e,t){return Gi(e,t.start)||e.start<t.end&&t.end<e.end||Gi(t,e.start)}function qi(e,t){return Wi(t.start,e.end)||Wi(t.end,e.start)}function Ki(e){for(var t=[],n=0;n<e.length;n++)t.push({start:e.start(n),end:e.end(n)});return t}function Yi(e,t){for(var n=e.length-1;n>=0;n--){if(t>=e[n].start)if(t<e[n].end)return e[n]}return null}function Qi(e,t){for(var n=null,r=[],i=0;i<e.length;i++){var a=e[i].start,o=e[i].end;t<a||t>=o?r.push({start:a,end:o}):n={start:a,end:o}}return{outerRanges:r,innerRange:n}}function Xi(e,t){var n=Yi(e,t);return null!==n?n.end-t:1/0}function $i(e,t){if(t.start===t.end)return e;for(var n=t,r=0;r<e.length;r++){var i=e[r],a=Hi(n,i),o=qi(n,i);if(a||o)n=Vi(n,i),e.splice(r--,1);else if(0===r){if(ji(n,e[0]))break}else if(ji(e[r-1],n)&&ji(n,i))break}return e.splice(r,0,n),function(e){for(var t=1;t<e.length;t++){var n=e[t-1],r=e[t];if(qi(n,r)){var i=Vi(n,r);e.splice(--t,2,i)}}return e}(function(e){for(var t=0;t<e.length;t++){var n=e[t];n.start===n.end&&e.splice(t--,1)}return e}(e))}function Zi(e,t){for(var n=[],r=0;r<t.length;r++)Hi(e,t[r])&&n.push(t[r]);return n}function Ji(e,t){for(var n=[],r=0;r<e.length;r++){var i=e[r],a=[],o=Zi(i,t);if(o.length>0)for(var s=0;s<o.length;s++){var u=o[s];a.push({start:Math.max(i.start,u.start),end:Math.min(i.end,u.end)})}if(0===a.length)n.push(i);else{for(var l=i.start,d=0;d<a.length;d++)a[d].start>l&&n.push({start:l,end:a[d].start}),l=a[d].end;l<i.end&&n.push({start:l,end:i.end})}}return n}function ea(e,t){var n,r=e.segmentSink,i=e.playbackObserver,a=e.maxBufferBehind,o=e.maxBufferAhead,s=[];function u(){null!==s&&function(e,t,n,r,i,a){return ta.apply(this,arguments)}(r,n,s,a.getValue(),o.getValue(),t).catch((function(e){var t=e instanceof Error?e.message:\"Unknown error\";T.error(\"Could not run BufferGarbageCollector:\",t)}))}i.listen((function(e){n=e.position.getWanted(),s=e.buffered[r.bufferType],u()}),{includeLastObservation:!0,clearSignal:t}),a.onUpdate(u,{clearSignal:t}),o.onUpdate(u,{clearSignal:t}),u()}function ta(){return ta=qn(Yn().mark((function e(t,n,r,i,a,o){var s,u,l,d,c,f,p,h;return Yn().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(isFinite(i)||isFinite(a)){e.next=2;break}return e.abrupt(\"return\",Promise.resolve());case 2:s=[],u=Qi(r,n),l=u.innerRange,d=u.outerRanges,c=function(){if(isFinite(a)){for(var e=0;e<d.length;e++){var t=d[e];n+a<=t.start?s.push(t):n<=t.start&&n+a<t.end&&n+a>t.start&&s.push({start:n+a,end:t.end})}S(l)||n+a<l.end&&s.push({start:n+a,end:l.end})}},function(){if(isFinite(i)){for(var e=0;e<d.length;e++){var t=d[e];n-i>=t.end?s.push(t):n>=t.end&&n-i>t.start&&n-i<t.end&&s.push({start:t.start,end:n-i})}S(l)||n-i>l.start&&s.push({start:l.start,end:n-i})}}(),c(),f=0,p=s;case 9:if(!(f<p.length)){e.next=20;break}if(!((h=p[f]).start<h.end)){e.next=17;break}if(T.debug(\"GC: cleaning range from SegmentSink\",h.start,h.end),null===o.cancellationError){e.next=15;break}throw o.cancellationError;case 15:return e.next=17,t.removeBuffer(h.start,h.end);case 17:f++,e.next=9;break;case 20:case\"end\":return e.stop()}}),e)}))),ta.apply(this,arguments)}function na(e,t){var n;return new Promise((function(r,i){if(null!==e.cancellationError)return i(e.cancellationError);var a=!1;function o(e){void 0!==n&&n(),i(e)}n=t((function(t){e.deregister(o),a=!0,r(t)}),(function(t){e.deregister(o),a=!0,i(t)})),a||e.register(o)}))}function ra(e,t){return e.segment.id===t.segment.id&&e.representation.uniqueId===t.representation.uniqueId}function ia(e){if(S(e))return\"\";var t,n=e.period,r=e.adaptation,i=e.representation,a=e.segment;return t=a.isInit?\"init\":a.complete?a.time+\"-\"+a.duration:\"\"+a.time,r.type+\" P: \"+n.id+\" A: \"+r.id+\" R: \"+i.id+\" S: \"+t}function aa(e,t){var n=\"undefined\"!=typeof Symbol&&e[Symbol.iterator]||e[\"@@iterator\"];if(n)return(n=n.call(e)).next.bind(n);if(Array.isArray(e)||(n=function(e,t){if(!e)return;if(\"string\"==typeof e)return oa(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);\"Object\"===n&&e.constructor&&(n=e.constructor.name);if(\"Map\"===n||\"Set\"===n)return Array.from(e);if(\"Arguments\"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return oa(e,t)}(e))||t&&e&&\"number\"==typeof e.length){n&&(e=n);var r=0;return function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}}}throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\")}function oa(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var sa=function(){function e(e,t){this._history=[],this._lifetime=e,this._maxHistoryLength=t}var t=e.prototype;return t.addBufferedSegment=function(e,t){var n=L();this._history.push({date:n,buffered:t,context:e}),this._cleanHistory(n)},t.getHistoryFor=function(e){return this._history.filter((function(t){return ra(t.context,e)}))},t._cleanHistory=function(e){for(var t,n=e-this._lifetime,r=0,i=aa(this._history);!(t=i()).done;){if(!(t.value.date<n))break;r++}if(r>0&&(this._history=this._history.splice(r)),this._history.length>this._maxHistoryLength){var a=this._history.length-this._maxHistoryLength;this._history=this._history.splice(a)}},e}();function ua(e,t){var n=\"undefined\"!=typeof Symbol&&e[Symbol.iterator]||e[\"@@iterator\"];if(n)return(n=n.call(e)).next.bind(n);if(Array.isArray(e)||(n=function(e,t){if(!e)return;if(\"string\"==typeof e)return la(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);\"Object\"===n&&e.constructor&&(n=e.constructor.name);if(\"Map\"===n||\"Set\"===n)return Array.from(e);if(\"Arguments\"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return la(e,t)}(e))||t&&e&&\"number\"==typeof e.length){n&&(e=n);var r=0;return function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}}}throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\")}function la(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var da=function(){function e(){var e=s.getCurrent(),t=e.BUFFERED_HISTORY_RETENTION_TIME,n=e.BUFFERED_HISTORY_MAXIMUM_ENTRIES;this._inventory=[],this._bufferedHistory=new sa(t,n)}var t=e.prototype;return t.reset=function(){this._inventory.length=0},t.synchronizeBuffered=function(e){for(var t,n,r,i,a,o,u,l=this._inventory,d=0,c=l[0],f=s.getCurrent().MINIMUM_SEGMENT_SIZE,p=null==c?void 0:c.infos.adaptation.type,h=e.length,v=0;v<h;v++){if(void 0===c)return;var m=e[v].start,g=e[v].end;if(g-m<f)T.warn(\"SI: skipped range when synchronizing because it was too small\",p,m,g);else{for(var b=d;void 0!==c&&(null!==(t=c.bufferedEnd)&&void 0!==t?t:c.end)-m<f;)c=l[++d];var y=null,_=d-b;if(_>0){var E=l[b+_-1];y={end:null!==(n=E.bufferedEnd)&&void 0!==n?n:E.end,precizeEnd:E.precizeEnd},T.debug(\"SI: \"+_+\" segments GCed.\",p);for(var w,A=ua(l.splice(b,_));!(w=A()).done;){var I=w.value;void 0===I.bufferedStart&&void 0===I.bufferedEnd&&2!==I.status&&this._bufferedHistory.addBufferedSegment(I.infos,null)}d=b}if(void 0===c)return;if(g-(null!==(r=c.bufferedStart)&&void 0!==r?r:c.start)>=f){if(pa(c,m,y,p),d===l.length-1)return void ha(c,g,p);for(var k=null!==(i=(c=l[++d]).bufferedStart)&&void 0!==i?i:c.start,R=null!==(a=c.bufferedEnd)&&void 0!==a?a:c.end,P=v<h-1?e[v+1].start:void 0;void 0!==c&&g-k>=f&&(void 0===P||g-k>=R-P);){var x=l[d-1];void 0===x.bufferedEnd&&(x.bufferedEnd=c.precizeStart?c.start:x.end,T.debug(\"SI: calculating buffered end of contiguous segment\",p,x.bufferedEnd,x.end)),c.bufferedStart=x.bufferedEnd,void 0!==(c=l[++d])&&(k=null!==(o=c.bufferedStart)&&void 0!==o?o:c.start,R=null!==(u=c.bufferedEnd)&&void 0!==u?u:c.end)}}var C=l[d-1];void 0!==C&&ha(C,g,p)}}if(!S(c)){T.debug(\"SI: last segments have been GCed\",p,d,l.length);for(var M,O=ua(l.splice(d,l.length-d));!(M=O()).done;){var D=M.value;void 0===D.bufferedStart&&void 0===D.bufferedEnd&&2!==D.status&&this._bufferedHistory.addBufferedSegment(D.infos,null)}}void 0!==p&&T.hasLevel(\"DEBUG\")&&T.debug(\"SI: current \"+p+\" inventory timeline:\\n\"+function(e){var t=1/60,n={},r=[],i=null,a=null;function o(e){var t=String.fromCharCode(r.length+65);return r.push({letter:t,periodId:e.period.id,representationId:e.representation.id,bitrate:e.representation.bitrate}),t}for(var s=\"\",u=0;u<e.length;u++){var l=e[u];if(void 0!==l.bufferedStart&&void 0!==l.bufferedEnd){var d,c=l.infos.period.id,f=l.infos.representation.id,p=n[c],h=void 0;if(void 0===p)h=o(l.infos),n[c]=((d={})[f]=h,d);else void 0===p[f]?(h=o(l.infos),p[f]=h):h=p[f];null===i?s+=l.bufferedStart.toFixed(2)+\"|\"+h+\"|\":a===h?i.bufferedEnd+t<l.bufferedStart&&(s+=i.bufferedEnd.toFixed(2)+\" ~ \"+l.bufferedStart.toFixed(2)+\"|\"+h+\"|\"):s+=i.bufferedEnd.toFixed(2)+\" ~ \"+l.bufferedStart.toFixed(2)+\"|\"+h+\"|\",i=l,a=h}}null!==i&&(s+=String(i.end.toFixed(2)));return r.forEach((function(e){var t;s+=\"\\n[\"+e.letter+\"] P: \"+e.periodId+\" || R: \"+e.representationId+\"(\"+(null!==(t=e.bitrate)&&void 0!==t?t:\"unknown bitrate\")+\")\"})),s}(this._inventory))},t.insertChunk=function(e,t,n){var r=e.period,i=e.adaptation,a=e.representation,o=e.segment,s=e.chunkSize,u=e.start,l=e.end;if(!o.isInit){var d=i.type;if(u>=l)T.warn(\"SI: Invalid chunked inserted: starts before it ends\",d,u,l);else{for(var c=this._inventory,f={status:t?0:2,insertionTs:n,chunkSize:s,splitted:!1,start:u,end:l,precizeStart:!1,precizeEnd:!1,bufferedStart:void 0,bufferedEnd:void 0,infos:{segment:o,period:r,adaptation:i,representation:a}},p=c.length-1;p>=0;p--){var h=c[p];if(h.start<=u){if(h.end<=u){for(T.debug(\"SI: Pushing segment strictly after previous one.\",d,u,h.end),this._inventory.splice(p+1,0,f),p+=2;p<c.length&&c[p].start<f.end;){if(c[p].end>f.end)return T.debug(\"SI: Segment pushed updates the start of the next one\",d,f.end,c[p].start),c[p].start=f.end,c[p].bufferedStart=void 0,void(c[p].precizeStart=c[p].precizeStart&&f.precizeEnd);T.debug(\"SI: Segment pushed removes the next one\",d,u,l,c[p].start,c[p].end),c.splice(p,1)}return}if(h.start===u){if(h.end<=l){for(T.debug(\"SI: Segment pushed replace another one\",d,u,l,h.end),this._inventory.splice(p,1,f),p+=1;p<c.length&&c[p].start<f.end;){if(c[p].end>f.end)return T.debug(\"SI: Segment pushed updates the start of the next one\",d,f.end,c[p].start),c[p].start=f.end,c[p].bufferedStart=void 0,void(c[p].precizeStart=c[p].precizeStart&&f.precizeEnd);T.debug(\"SI: Segment pushed removes the next one\",d,u,l,c[p].start,c[p].end),c.splice(p,1)}return}return T.debug(\"SI: Segment pushed ends before another with the same start\",d,u,l,h.end),c.splice(p,0,f),h.start=f.end,h.bufferedStart=void 0,void(h.precizeStart=h.precizeStart&&f.precizeEnd)}if(h.end<=f.end){for(T.debug(\"SI: Segment pushed updates end of previous one\",d,u,l,h.start,h.end),this._inventory.splice(p+1,0,f),h.end=f.start,h.bufferedEnd=void 0,h.precizeEnd=h.precizeEnd&&f.precizeStart,p+=2;p<c.length&&c[p].start<f.end;){if(c[p].end>f.end)return T.debug(\"SI: Segment pushed updates the start of the next one\",d,f.end,c[p].start),c[p].start=f.end,c[p].bufferedStart=void 0,void(c[p].precizeStart=c[p].precizeStart&&f.precizeEnd);T.debug(\"SI: Segment pushed removes the next one\",d,u,l,c[p].start,c[p].end),c.splice(p,1)}return}T.warn(\"SI: Segment pushed is contained in a previous one\",d,u,l,h.start,h.end);var v={status:h.status,insertionTs:h.insertionTs,chunkSize:h.chunkSize,splitted:!0,start:f.end,end:h.end,precizeStart:h.precizeStart&&h.precizeEnd&&f.precizeEnd,precizeEnd:h.precizeEnd,bufferedStart:void 0,bufferedEnd:h.end,infos:h.infos};return h.end=f.start,h.splitted=!0,h.bufferedEnd=void 0,h.precizeEnd=h.precizeEnd&&f.precizeStart,c.splice(p+1,0,f),void c.splice(p+2,0,v)}}var m=this._inventory[0];if(void 0===m)return T.debug(\"SI: first segment pushed\",d,u,l),void this._inventory.push(f);if(!(m.start>=l)){if(m.end<=l){for(T.debug(\"SI: Segment pushed starts before and completely recovers the previous first one\",d,u,l,m.start,m.end),this._inventory.splice(0,1,f);c.length>1&&c[1].start<f.end;){if(c[1].end>f.end)return T.debug(\"SI: Segment pushed updates the start of the next one\",d,f.end,c[1].start),c[1].start=f.end,c[1].bufferedStart=void 0,void(c[1].precizeStart=f.precizeEnd);T.debug(\"SI: Segment pushed removes the next one\",d,u,l,c[1].start,c[1].end),c.splice(1,1)}return}return T.debug(\"SI: Segment pushed start of the next one\",d,u,l,m.start,m.end),m.start=l,m.bufferedStart=void 0,m.precizeStart=f.precizeEnd,void this._inventory.splice(0,0,f)}T.debug(\"SI: Segment pushed comes before all previous ones\",d,u,l,m.start),this._inventory.splice(0,0,f)}}},t.completeSegment=function(e){if(!e.segment.isInit){for(var t=this._inventory,n=[],r=0;r<t.length;r++)if(ra(t[r].infos,e)){var i=!1;n.length>0&&(i=!0,1===n.length&&(T.warn(\"SI: Completed Segment is splitted.\",e.segment.id,e.segment.time,e.segment.end),n[0].splitted=!0));var a=r,o=t[r].chunkSize;for(r+=1;r<t.length&&ra(t[r].infos,e);){var s=t[r].chunkSize;void 0!==o&&void 0!==s&&(o+=s),r++}var u=r-1,l=u-a,d=t[u].end,c=t[u].bufferedEnd;l>0&&(this._inventory.splice(a+1,l),r-=l),0===this._inventory[a].status&&(this._inventory[a].status=1),this._inventory[a].chunkSize=o,this._inventory[a].end=d,this._inventory[a].bufferedEnd=c,this._inventory[a].splitted=i,n.push(this._inventory[a])}if(0===n.length)T.warn(\"SI: Completed Segment not found\",e.segment.id,e.segment.time);else for(var f,p=ua(n);!(f=p()).done;){var h=f.value;void 0!==h.bufferedStart&&void 0!==h.bufferedEnd?2!==h.status&&this._bufferedHistory.addBufferedSegment(h.infos,{start:h.bufferedStart,end:h.bufferedEnd}):T.debug(\"SI: buffered range not known after sync. Skipping history.\",h.start,h.end)}}},t.getInventory=function(){return this._inventory},t.getHistoryFor=function(e){return this._bufferedHistory.getHistoryFor(e)},e}();function ca(e){if(void 0===e.bufferedStart||1!==e.status)return!1;var t=e.start,n=e.end-t,r=s.getCurrent(),i=r.MAX_MANIFEST_BUFFERED_START_END_DIFFERENCE,a=r.MAX_MANIFEST_BUFFERED_DURATION_DIFFERENCE;return Math.abs(t-e.bufferedStart)<=i&&(void 0===e.bufferedEnd||e.bufferedEnd>e.bufferedStart&&Math.abs(e.bufferedEnd-e.bufferedStart-n)<=Math.min(a,n/3))}function fa(e){if(void 0===e.bufferedEnd||1!==e.status)return!1;var t=e.start,n=e.end,r=n-t,i=s.getCurrent(),a=i.MAX_MANIFEST_BUFFERED_START_END_DIFFERENCE,o=i.MAX_MANIFEST_BUFFERED_DURATION_DIFFERENCE;return Math.abs(n-e.bufferedEnd)<=a&&void 0!==e.bufferedStart&&e.bufferedEnd>e.bufferedStart&&Math.abs(e.bufferedEnd-e.bufferedStart-r)<=Math.min(o,r/3)}function pa(e,t,n,r){var i=s.getCurrent(),a=i.MAX_MANIFEST_BUFFERED_START_END_DIFFERENCE,o=i.MISSING_DATA_TRIGGER_SYNC_DELAY,u=i.SEGMENT_SYNCHRONIZATION_DELAY;if(void 0!==e.bufferedStart)e.bufferedStart<t&&(T.debug(\"SI: Segment partially GCed at the start\",r,e.bufferedStart,t),e.bufferedStart=t),!e.precizeStart&&ca(e)&&(e.start=e.bufferedStart,e.precizeStart=!0);else if(e.precizeStart)T.debug(\"SI: buffered start is precize start\",r,e.start),e.bufferedStart=e.start;else if(null!==n&&n.end>t&&(n.precizeEnd||e.start-n.end<=a))T.debug(\"SI: buffered start is end of previous segment\",r,t,e.start,n.end),e.bufferedStart=n.end,ca(e)&&(e.start=n.end,e.precizeStart=!0);else if(e.start-t<=a){var l=L();if(e.start-t>=o&&l-e.insertionTs<u)return void T.debug(\"SI: Ignored bufferedStart synchronization\",r,t,e.start,l-e.insertionTs);T.debug(\"SI: found true buffered start\",r,t,e.start),e.bufferedStart=t,ca(e)&&(e.start=t,e.precizeStart=!0)}else if(t<e.start)T.debug(\"SI: range start too far from expected start\",r,t,e.start),e.bufferedStart=e.start;else{var d=L();if(e.start-t>=o&&d-e.insertionTs<u)return void T.debug(\"SI: Ignored bufferedStart synchronization\",r,t,e.start,d-e.insertionTs);T.debug(\"SI: Segment appears immediately garbage collected at the start\",r,t,e.start),e.bufferedStart=t}}function ha(e,t,n){var r=s.getCurrent(),i=r.MAX_MANIFEST_BUFFERED_START_END_DIFFERENCE,a=r.MISSING_DATA_TRIGGER_SYNC_DELAY,o=r.SEGMENT_SYNCHRONIZATION_DELAY;if(void 0!==e.bufferedEnd)e.bufferedEnd>t&&(T.debug(\"SI: Segment partially GCed at the end\",n,e.bufferedEnd,t),e.bufferedEnd=t),!e.precizeEnd&&t-e.end<=i&&fa(e)&&(e.precizeEnd=!0,e.end=t);else if(e.precizeEnd)T.debug(\"SI: buffered end is precize end\",n,e.end),e.bufferedEnd=e.end;else if(t-e.end<=i){var u=L();if(t-e.end>=a&&u-e.insertionTs<o)return void T.debug(\"SI: Ignored bufferedEnd synchronization\",n,t,e.end,u-e.insertionTs);T.debug(\"SI: found true buffered end\",n,t,e.end),e.bufferedEnd=t,fa(e)&&(e.end=t,e.precizeEnd=!0)}else if(t>e.end)T.debug(\"SI: range end too far from expected end\",n,t,e.end),e.bufferedEnd=e.end;else{var l=L();if(t-e.end>=a&&l-e.insertionTs<o)return void T.debug(\"SI: Ignored bufferedEnd synchronization\",n,t,e.end,l-e.insertionTs);T.debug(\"SI: Segment appears immediately garbage collected at the end\",n,e.bufferedEnd,t),e.bufferedEnd=t}}var va,ma=da,ga=function(){function e(){this._segmentInventory=new ma}var t=e.prototype;return t.synchronizeInventory=function(e){this._segmentInventory.synchronizeBuffered(e)},t.getLastKnownInventory=function(){return this._segmentInventory.getInventory()},t.getSegmentHistory=function(e){return this._segmentInventory.getHistoryFor(e)},e}();!function(e){e[e.Push=0]=\"Push\",e[e.Remove=1]=\"Remove\",e[e.SignalSegmentComplete=2]=\"SignalSegmentComplete\"}(va||(va={}));var ba=function(e){function t(t,n,r){var i;i=e.call(this)||this,T.info(\"AVSB: calling `mediaSource.addSourceBuffer`\",n);var a=r.addSourceBuffer(t,n);return i.bufferType=t,i._sourceBuffer=a,i._lastInitSegmentUniqueId=null,i.codec=n,i._initSegmentsMap=new Map,i._pendingOperations=[],i}l(t,e);var n=t.prototype;return n.declareInitSegment=function(e,t){ya(t),this._initSegmentsMap.set(e,t)},n.freeInitSegment=function(e){this._initSegmentsMap.delete(e)},n.pushChunk=function(){var e=qn(Yn().mark((function e(t){var n,r,i,a,o=this;return Yn().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return ya(t.data.chunk),T.debug(\"AVSB: receiving order to push data to the SourceBuffer\",this.bufferType,ia(t.inventoryInfos)),0===(n=this._getActualDataToPush(t.data)).length&&n.push(new Uint8Array),r=Promise.all(n.map((function(e){var n=t.data,r=n.codec,i=n.timestampOffset,a=n.appendWindow;return T.debug(\"AVSB: pushing segment\",o.bufferType,ia(t.inventoryInfos)),o._sourceBuffer.appendBuffer(e,{codec:r,timestampOffset:i,appendWindow:a})}))),this._addToOperationQueue(r,{type:va.Push,value:t}),e.prev=6,e.next=9,r;case 9:i=e.sent,e.next=16;break;case 12:throw e.prev=12,e.t0=e.catch(6),this._segmentInventory.insertChunk(t.inventoryInfos,!1,L()),e.t0;case 16:return null!==t.inventoryInfos&&this._segmentInventory.insertChunk(t.inventoryInfos,!0,L()),a=i[i.length-1],this._segmentInventory.synchronizeBuffered(a),e.abrupt(\"return\",a);case 20:case\"end\":return e.stop()}}),e,this,[[6,12]])})));return function(t){return e.apply(this,arguments)}}(),n.removeBuffer=function(){var e=qn(Yn().mark((function e(t,n){var r,i;return Yn().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return T.debug(\"AVSB: receiving order to remove data from the SourceBuffer\",this.bufferType,t,n),r=this._sourceBuffer.remove(t,n),this._addToOperationQueue(r,{type:va.Remove,value:{start:t,end:n}}),e.next=5,r;case 5:return i=e.sent,this._segmentInventory.synchronizeBuffered(i),e.abrupt(\"return\",i);case 8:case\"end\":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}(),n.signalSegmentComplete=function(){var e=qn(Yn().mark((function e(t){var n;return Yn().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this._pendingOperations.length>0)){e.next=10;break}return n=this._pendingOperations[this._pendingOperations.length-1].promise,this._addToOperationQueue(n,{type:va.SignalSegmentComplete,value:t}),e.prev=3,e.next=6,n;case 6:e.next=10;break;case 8:e.prev=8,e.t0=e.catch(3);case 10:this._segmentInventory.completeSegment(t);case 11:case\"end\":return e.stop()}}),e,this,[[3,8]])})));return function(t){return e.apply(this,arguments)}}(),n.getPendingOperations=function(){return this._pendingOperations.map((function(e){return e.operation}))},n.dispose=function(){try{T.debug(\"AVSB: Calling `dispose` on the SourceBufferInterface\"),this._sourceBuffer.dispose()}catch(e){T.debug(\"AVSB: Failed to dispose a \"+this.bufferType+\" SourceBufferInterface:\",e instanceof Error?e:\"\")}},n._getActualDataToPush=function(e){var t=[];if(null!==e.initSegmentUniqueId&&!this._isLastInitSegment(e.initSegmentUniqueId)){var n=this._initSegmentsMap.get(e.initSegmentUniqueId);if(void 0===n)throw new Error(\"Invalid initialization segment uniqueId\");var r=new ArrayBuffer(n.byteLength),i=new Uint8Array(r);i.set(n instanceof ArrayBuffer?new Uint8Array(n):new Uint8Array(n.buffer)),n=i,t.push(n),this._lastInitSegmentUniqueId=e.initSegmentUniqueId}return null!==e.chunk&&t.push(e.chunk),t},n._isLastInitSegment=function(e){return null!==this._lastInitSegmentUniqueId&&this._lastInitSegmentUniqueId===e},n._addToOperationQueue=function(e,t){var n=this,r={operation:t,promise:e};this._pendingOperations.push(r);var i=function(){var e=n._pendingOperations.indexOf(r);e>=0&&n._pendingOperations.splice(e,1)};e.then(i,i)},t}(ga);function ya(e){}var Sa=ba,_a=function(e){function t(t){var n;return T.debug(\"HTSB: Creating TextSegmentSink\"),(n=e.call(this)||this).bufferType=\"text\",n._sender=t,n._pendingOperations=[],n._sender.reset(),n}l(t,e);var n=t.prototype;return n.declareInitSegment=function(e){T.warn(\"HTSB: Declaring initialization segment for  Text SegmentSink\",e)},n.freeInitSegment=function(e){T.warn(\"HTSB: Freeing initialization segment for  Text SegmentSink\",e)},n.pushChunk=function(){var e=qn(Yn().mark((function e(t){var n,r,i;return Yn().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return Ea((n=t.data).chunk),r=this._sender.pushTextData(Object.assign(Object.assign({},n),{chunk:n.chunk})),this._addToOperationQueue(r,{type:va.Push,value:t}),e.next=6,r;case 6:return i=e.sent,null!==t.inventoryInfos&&this._segmentInventory.insertChunk(t.inventoryInfos,!0,L()),this._segmentInventory.synchronizeBuffered(i),e.abrupt(\"return\",i);case 10:case\"end\":return e.stop()}}),e,this)})));return function(t){return e.apply(this,arguments)}}(),n.removeBuffer=function(){var e=qn(Yn().mark((function e(t,n){var r,i;return Yn().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return r=this._sender.remove(t,n),this._addToOperationQueue(r,{type:va.Remove,value:{start:t,end:n}}),e.next=4,r;case 4:return i=e.sent,this._segmentInventory.synchronizeBuffered(i),e.abrupt(\"return\",i);case 7:case\"end\":return e.stop()}}),e,this)})));return function(t,n){return e.apply(this,arguments)}}(),n.signalSegmentComplete=function(){var e=qn(Yn().mark((function e(t){var n;return Yn().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!(this._pendingOperations.length>0)){e.next=10;break}return n=this._pendingOperations[this._pendingOperations.length-1].promise,this._addToOperationQueue(n,{type:va.SignalSegmentComplete,value:t}),e.prev=3,e.next=6,n;case 6:e.next=10;break;case 8:e.prev=8,e.t0=e.catch(3);case 10:this._segmentInventory.completeSegment(t);case 11:case\"end\":return e.stop()}}),e,this,[[3,8]])})));return function(t){return e.apply(this,arguments)}}(),n.getPendingOperations=function(){return this._pendingOperations.map((function(e){return e.operation}))},n.dispose=function(){T.debug(\"HTSB: Disposing TextSegmentSink\"),this._sender.reset()},n._addToOperationQueue=function(e,t){var n=this,r={operation:t,promise:e};this._pendingOperations.push(r);var i=function(){var e=n._pendingOperations.indexOf(r);e>=0&&n._pendingOperations.splice(e,1)};e.then(i,i)},t}(ga);function Ea(e){}var wa=_a,Ta=[\"audio\",\"video\",\"text\"];function Aa(e){return\"audio\"===e||\"video\"===e}var Ia=function(){function e(e,t,n){this._mediaSource=e,this._textInterface=n,this._hasVideo=t,this._initializedSegmentSinks={},this._onNativeBufferAddedOrDisabled=[]}e.isNative=function(e){return Aa(e)};var t=e.prototype;return t.getBufferTypes=function(){var e=this.getNativeBufferTypes();return null!==this._textInterface&&e.push(\"text\"),e},t.getNativeBufferTypes=function(){return this._hasVideo?[\"video\",\"audio\"]:[\"audio\"]},t.getStatus=function(e){var t=this._initializedSegmentSinks[e];return void 0===t?{type:\"uninitialized\"}:null===t?{type:\"disabled\"}:{type:\"initialized\",value:t}},t.waitForUsableBuffers=function(e){var t=this;return this._areNativeBuffersUsable()?Promise.resolve():na(e,(function(e){var n,r=function(){var e=t._onNativeBufferAddedOrDisabled.indexOf(n);e>=0&&t._onNativeBufferAddedOrDisabled.splice(e,1)};return n=function(){t._areNativeBuffersUsable()&&(r(),e())},t._onNativeBufferAddedOrDisabled.push(n),r}))},t.disableSegmentSink=function(t){var n=this._initializedSegmentSinks[t];if(null!==n){if(void 0!==n)throw new Error(\"Cannot disable an active SegmentSink.\");this._initializedSegmentSinks[t]=null,e.isNative(t)&&this._onNativeBufferAddedOrDisabled.forEach((function(e){return e()}))}else T.warn(\"SBS: The \"+t+\" SegmentSink was already disabled.\")},t.createSegmentSink=function(e,t){var n,r=this._initializedSegmentSinks[e];if(Aa(e)){if(!S(r))return r instanceof Sa&&r.codec!==t?T.warn(\"SB: Reusing native SegmentSink with codec\",r.codec,\"for codec\",t):T.info(\"SB: Reusing native SegmentSink with codec\",t),r;T.info(\"SB: Adding native SegmentSink with codec\",t);var i=new Sa(\"audio\"===e?\"audio\":\"video\",t,this._mediaSource);return this._initializedSegmentSinks[e]=i,this._onNativeBufferAddedOrDisabled.forEach((function(e){return e()})),i}if(!S(r))return T.info(\"SB: Reusing a previous custom SegmentSink for the type\",e),r;if(\"text\"===e){if(T.info(\"SB: Creating a new text SegmentSink\"),null===this._textInterface)throw new Error(\"HTML Text track feature not activated\");return n=new wa(this._textInterface),this._initializedSegmentSinks.text=n,n}throw T.error(\"SB: Unknown buffer type:\",e),new b(\"BUFFER_TYPE_UNKNOWN\",\"The player wants to create a SegmentSink of an unknown type.\")},t.disposeSegmentSink=function(e){var t=this._initializedSegmentSinks[e];S(t)?T.warn(\"SB: Trying to dispose a SegmentSink that does not exist\"):(T.info(\"SB: Aborting SegmentSink\",e),t.dispose(),delete this._initializedSegmentSinks[e])},t.disposeAll=function(){var e=this;Ta.forEach((function(t){\"initialized\"===e.getStatus(t).type&&e.disposeSegmentSink(t)}))},t._areNativeBuffersUsable=function(){var e=this,t=this.getNativeBufferTypes();return!t.some((function(t){return void 0===e._initializedSegmentSinks[t]}))&&!t.every((function(t){return null===e._initializedSegmentSinks[t]}))},e}();function ka(e,t){return na(t,(function(t){var n=setTimeout((function(){return t()}),e);return function(){return clearTimeout(n)}}))}var Ra=function(e){function t(t,n,r,i){var a;return(a=e.call(this)||this)._content=t,a._currentCanceller=null,a._downloadQueue=n,a._initSegmentRequest=null,a._mediaSegmentRequest=null,a._segmentFetcher=r,a._initSegmentInfoRef=new N(void 0),a._mediaSegmentAwaitingInitMetadata=null,i||a._initSegmentInfoRef.setValue(null),a}l(t,e);var n=t.prototype;return n.getRequestedInitSegment=function(){return null===this._initSegmentRequest?null:this._initSegmentRequest.segment},n.getRequestedMediaSegment=function(){return null===this._mediaSegmentRequest?null:this._mediaSegmentRequest.segment},n.start=function(){var e=this;null===this._currentCanceller&&(this._currentCanceller=new kr,this._downloadQueue.onUpdate((function(t){var n=t.segmentQueue;if(!(n.length>0&&n[0].segment.id===e._mediaSegmentAwaitingInitMetadata)){var r=e._mediaSegmentRequest;if(0===n.length){if(null===r)return;return T.debug(\"Stream: no more media segment to request. Cancelling queue.\",e._content.adaptation.type),void e._restartMediaSegmentDownloadingQueue()}if(null===r)return T.debug(\"Stream: Media segments now need to be requested. Starting queue.\",e._content.adaptation.type,n.length),void e._restartMediaSegmentDownloadingQueue();var i=n[0];return r.segment.id!==i.segment.id?(T.debug(\"Stream: Next media segment changed, cancelling previous\",e._content.adaptation.type),void e._restartMediaSegmentDownloadingQueue()):void(r.priority!==i.priority&&(T.debug(\"Stream: Priority of next media segment changed, updating\",e._content.adaptation.type,r.priority,i.priority),e._segmentFetcher.updatePriority(r.request,i.priority)))}}),{emitCurrentValue:!0,clearSignal:this._currentCanceller.signal}),this._downloadQueue.onUpdate((function(t){var n,r=e._initSegmentRequest;null===t.initSegment||null===r?(null===(n=t.initSegment)||void 0===n?void 0:n.segment.id)!==(null==r?void 0:r.segment.id)&&(null===t.initSegment&&T.debug(\"Stream: no more init segment to request. Cancelling queue.\",e._content.adaptation.type),e._restartInitSegmentDownloadingQueue(t.initSegment)):t.initSegment.priority!==r.priority&&e._segmentFetcher.updatePriority(r.request,t.initSegment.priority)}),{emitCurrentValue:!0,clearSignal:this._currentCanceller.signal}))},n.stop=function(){var e;null===(e=this._currentCanceller)||void 0===e||e.cancel(),this._currentCanceller=null},n._restartMediaSegmentDownloadingQueue=function(){var e=this;null!==this._mediaSegmentRequest&&this._mediaSegmentRequest.canceller.cancel();!function t(n){if(null!==e._currentCanceller&&e._currentCanceller.isUsed())e._mediaSegmentRequest=null;else{if(void 0===n)return e._mediaSegmentRequest=null,void e.trigger(\"emptyQueue\",null);var r=new kr,a=null===e._currentCanceller?E:r.linkToSignal(e._currentCanceller.signal),o=n.segment,s=n.priority,u=i({segment:o},e._content),l=!1,d=!1;r.signal.register((function(){e._mediaSegmentRequest=null,l||(e._mediaSegmentAwaitingInitMetadata===o.id&&(e._mediaSegmentAwaitingInitMetadata=null),l=!0,d=!1)}));var c=function(t){Ce(t.segmentType),e.trigger(\"parsedMediaSegment\",i({},t,{segment:o}))},f=function(){var n=e._downloadQueue.getValue().segmentQueue;if(0===n.length)return l=!0,void e.trigger(\"emptyQueue\",null);n[0].segment.id===o.id&&n.shift(),l=!0,t(n[0])},p=e._segmentFetcher.createRequest(u,s,{onRetry:function(t){e.trigger(\"requestRetry\",{segment:o,error:t})},beforeInterrupted:function(){T.info(\"Stream: segment request interrupted temporarly.\",o.id,o.time)},onChunk:function(t){var n=e._initSegmentInfoRef.getValue();void 0!==n?c(t(null!=n?n:void 0)):(d=!0,e._initSegmentInfoRef.waitUntilDefined((function(e){c(t(null!=e?e:void 0))}),{clearSignal:r.signal}))},onAllChunksReceived:function(){d?(e._mediaSegmentAwaitingInitMetadata=o.id,e._initSegmentInfoRef.waitUntilDefined((function(){e._mediaSegmentAwaitingInitMetadata=null,d=!1,e.trigger(\"fullyLoadedSegment\",o)}),{clearSignal:r.signal})):e.trigger(\"fullyLoadedSegment\",o)},beforeEnded:function(){a(),e._mediaSegmentRequest=null,d?e._initSegmentInfoRef.waitUntilDefined(f,{clearSignal:r.signal}):f()}},r.signal);p.catch((function(t){a(),l||(l=!0,e.stop(),e.trigger(\"error\",t))})),e._mediaSegmentRequest={segment:o,priority:s,request:p,canceller:r}}}(this._downloadQueue.getValue().segmentQueue[0])},n._restartInitSegmentDownloadingQueue=function(e){var t=this;if((null===this._currentCanceller||!this._currentCanceller.isUsed())&&(null!==this._initSegmentRequest&&this._initSegmentRequest.canceller.cancel(),null!==e)){var n=new kr,r=null===this._currentCanceller?E:n.linkToSignal(this._currentCanceller.signal),a=e.segment,o=e.priority,s=i({segment:a},this._content),u=!1,l=this._segmentFetcher.createRequest(s,o,{onRetry:function(e){t.trigger(\"requestRetry\",{segment:a,error:e})},beforeInterrupted:function(){T.info(\"Stream: init segment request interrupted temporarly.\",a.id)},beforeEnded:function(){r(),t._initSegmentRequest=null,u=!0},onChunk:function(e){var n,r=e(void 0);Ce(r.segmentType),t.trigger(\"parsedInitSegment\",i({},r,{segment:a})),\"init\"===r.segmentType&&t._initSegmentInfoRef.setValue(null!==(n=r.initTimescale)&&void 0!==n?n:null)},onAllChunksReceived:function(){t.trigger(\"fullyLoadedSegment\",a)}},n.signal);l.catch((function(e){r(),u||(u=!0,t.stop(),t.trigger(\"error\",e))})),n.signal.register((function(){t._initSegmentRequest=null,u||(u=!0)})),this._initSegmentRequest={segment:a,priority:o,request:l,canceller:n}}},t}(_);function Pa(e,t,n,r,i){var a=e.period,o=e.adaptation,s=e.representation,u=function(e,t){for(var n=0;n<e.length;n++){var r=e[n];if(void 0===r.bufferedStart||void 0===r.bufferedEnd||r.bufferedStart>=t.end)return null;if(r.bufferedEnd>t.start)return n}return null}(i,t);if(null===u){if(null===n){if(r&&void 0!==a.end&&t.end>=a.end)return{start:void 0,end:null};var l=s.index.checkDiscontinuity(t.start);if(null!==l)return{start:void 0,end:l}}return null}var d=i[u];if(void 0!==d.bufferedStart&&d.bufferedStart>t.start&&(null===n||d.infos.segment.end<=n)){var c=d.bufferedStart;return r||!1===s.index.awaitSegmentBetween(t.start,c)?(T.debug(\"RS: current discontinuity encountered\",o.type,d.bufferedStart),{start:void 0,end:c}):null}var f=function(e,t,n){if(n<=0)return T.error(\"RS: Asked to check a discontinuity before the first chunk.\"),null;for(var r=n;r<e.length;r++){var i=e[r],a=e[r-1];if(void 0===i.bufferedStart||void 0===a.bufferedEnd||i.bufferedStart>=t.end)return null;if(i.bufferedStart-a.bufferedEnd>0)return r}return null}(i,t,u+1);if(null!==f){var p=i[f-1],h=i[f];if(null===n||h.infos.segment.end<=n){if(!r&&!1!==s.index.awaitSegmentBetween(p.infos.segment.end,h.infos.segment.time))return null;var v=p.bufferedEnd,m=h.bufferedStart;return T.debug(\"RS: future discontinuity encountered\",o.type,v,m),{start:v,end:m}}}if(null===n){if(r&&void 0!==a.end){if(t.end<a.end)return null;var g=function(e,t){for(var n=e.length-1;n>=0;n--){var r=e[n];if(void 0===r.bufferedStart)return null;if(r.bufferedStart<t)return n}return null}(i,a.end);if(null!==g){var b=i[g];if(void 0!==b.bufferedEnd&&b.bufferedEnd<a.end)return T.debug(\"RS: discontinuity encountered at the end of the current period\",o.type,b.bufferedEnd,a.end),{start:b.bufferedEnd,end:null}}}if(void 0!==a.end&&t.end>=a.end)return null;for(var y=i.length-1;y>=0;y--){var S=i[y];if(void 0===S.bufferedStart)break;if(S.bufferedStart<t.end){if(void 0!==S.bufferedEnd&&S.bufferedEnd<t.end){var _=s.index.checkDiscontinuity(t.end);if(null!==_)return{start:S.bufferedEnd,end:_}}return null}}}return null}function xa(e){var t=e.bufferedSegments,n=e.content,r=e.currentPlaybackTime,a=e.fastSwitchThreshold,o=e.getBufferedHistory,u=e.neededRange,l=e.segmentsBeingPushed,d=e.maxBufferSize,c=n.adaptation,f=n.representation,p=function(e,t,n){var r=8e3*n;return r-=t.reduce((function(e,t){return e+t.representation.bitrate*t.segment.duration}),0),e.reduce((function(e,t){return void 0!==t.chunkSize?e-8*t.chunkSize:e}),r)}(t,l,d),h=f.index.getSegments(u.start,u.end-u.start),v=t.filter((function(e){return!Ma(e.infos,n,r,a)})).filter((function(e,t,n){var r=0===t?null:n[t-1],i=t>=n.length-1?null:n[t+1],a=null;if(function(e,t,n){var r=s.getCurrent().MAX_TIME_MISSING_FROM_COMPLETE_SEGMENT;if(void 0===e.bufferedStart)return!1;if(null!==t&&void 0!==t.bufferedEnd&&e.bufferedStart-t.bufferedEnd<.1)return!1;if(n<e.bufferedStart&&e.bufferedStart-e.start>r)return T.info(\"Stream: The start of the wanted segment has been garbage collected\",e.start,e.bufferedStart),!0;return!1}(e,r,u.start)){if(function(e,t){var n,r;if(e.length<2)return!0;var i=e[e.length-1],a=null===(n=i.buffered)||void 0===n?void 0:n.start;if(void 0!==t&&void 0!==a&&t-a>.05)return!0;var o=e[e.length-2],s=null===(r=o.buffered)||void 0===r?void 0:r.start;if(void 0===s||void 0===a)return!0;return Math.abs(s-a)>.01}(a=o(e.infos),e.bufferedStart))return!1;T.debug(\"Stream: skipping segment gc-ed at the start\",e.start,e.bufferedStart)}if(function(e,t,n){var r=s.getCurrent().MAX_TIME_MISSING_FROM_COMPLETE_SEGMENT;if(void 0===e.bufferedEnd)return!1;if(null!==t&&void 0!==t.bufferedStart&&t.bufferedStart-e.bufferedEnd<.1)return!1;if(n>e.bufferedEnd&&e.end-e.bufferedEnd>r)return T.info(\"Stream: The end of the wanted segment has been garbage collected\",e.end,e.bufferedEnd),!0;return!1}(e,i,u.end)){if(function(e,t){var n,r;if(e.length<2)return!0;var i=e[e.length-1],a=null===(n=i.buffered)||void 0===n?void 0:n.end;if(void 0!==t&&void 0!==a&&a-t>.05)return!0;var o=e[e.length-2],s=null===(r=o.buffered)||void 0===r?void 0:r.end;if(void 0===s||void 0===a)return!0;return Math.abs(s-a)>.01}(a=null!=a?a:o(e.infos),e.bufferedEnd))return!1;T.debug(\"Stream: skipping segment gc-ed at the end\",e.end,e.bufferedEnd)}return!0})),m=s.getCurrent(),g=m.MINIMUM_SEGMENT_SIZE,b=m.MIN_BUFFER_AHEAD,y=!1,S=Math.min(1/60,g),_=!1,E=[],w=h.filter((function(e){var t=i({segment:e},n);if(l.length>0&&l.some((function(e){return ra(t,e)})))return!1;var s=e.duration,d=e.time,h=e.end;if(e.isInit)return!0;if(y)return E.push(e),!1;if(e.complete&&s<g)return!1;if(l.length>0&&l.some((function(e){if(e.period.id!==n.period.id||e.adaptation.id!==n.adaptation.id)return!1;var i=e.segment;return!(i.time-S>d)&&(!(i.end+S<h)&&!Ma(e,t,r,a))})))return!1;for(var m=0;m<v.length;m++){var w=v[m];if(w.infos.period.id===n.period.id){var A=w.infos.segment;if(d-A.time>-S&&A.end-h>-S)return!1}}var I=s*n.representation.bitrate;if(p-I<0&&(_=!0,d>u.start+b))return y=!0,E.push(e),!1;var k=o(t);if(k.length>1){var R=k[k.length-1],P=k[k.length-2];if(null===R.buffered&&null===P.buffered)return T.warn(\"Stream: Segment GCed multiple times in a row, ignoring it.\",\"If this happens a lot and lead to unpleasant experience, please  check your device's available memory. If it's low when this message is emitted, you might want to update the RxPlayer's settings (`maxBufferAhead`, `maxVideoBufferSize` etc.) so less memory is used by regular media data buffering.\"+c.type,f.id,e.time),!1}for(var x=0;x<v.length;x++){var C=v[x];if(C.end+S>d){var M=C.start>d+S||Ca(v,x).end<h-S;return M&&(p-=I),M}}return p-=I,!0}));return{segmentsToLoad:w,segmentsOnHold:E,isBufferFull:_}}function Ca(e,t){for(var n=t+1,r=s.getCurrent().MINIMUM_SEGMENT_SIZE,i=Math.min(1/60,r);n<e.length-1&&e[n-1].end+i>e[n].start;)n++;return e[--n]}function Ma(e,t,n,r){var i=s.getCurrent().CONTENT_REPLACEMENT_PADDING;return e.period.id===t.period.id&&(!(e.segment.time<n+i)&&(e.adaptation.id!==t.adaptation.id||function(e,t,n){var r=e.bitrate,i=s.getCurrent().BITRATE_REBUFFERING_RATIO;if(void 0===n){var a=r*i;return t.bitrate>a}return r<n&&t.bitrate>r}(e.representation,t.representation,r)))}function Oa(e,t){for(var n=e-t,r=s.getCurrent().SEGMENT_PRIORITIES_STEPS,i=0;i<r.length;i++)if(n<r[i])return i;return r.length}function Da(e,t,n,r,i,a,o){var u,l,d,c=e.representation,f=null!==(l=null!==(u=n.getIsPaused())&&void 0!==u?u:n.getReference().getValue().paused.pending)&&void 0!==l?l:n.getReference().getValue().paused.last,p=null!==(d=n.getPlaybackRate())&&void 0!==d?d:n.getReference().getValue().speed,h=t;(void 0===f||void 0===p||f||p<=0)&&(h-=.1);var v=function(e,t,n){var r,i,a=e.manifest,o=e.period,s=e.representation,u=s.index.getLastAvailablePosition(),l=s.index;i=!S(u)&&Ia.isNative(e.adaptation.type)&&t>=u&&l.isInitialized()&&!l.isStillAwaitingFutureSegments()&&function(e,t,n){var r,i=e.getPeriodAfter(t);return t.containsTime(n,i)&&e.isLastPeriodKnown&&t.id===(null===(r=e.periods[e.periods.length-1])||void 0===r?void 0:r.id)}(a,o,t)?u-1:t-.1;var d,c=i+n;d=!(!s.index.isInitialized()||s.index.isStillAwaitingFutureSegments()||void 0===o.end)&&(void 0===u?c>=o.end:null===u||c>=u);return{start:Math.max(i,o.start),end:Math.min(c,null!==(r=o.end)&&void 0!==r?r:1/0),hasReachedPeriodEnd:d}}(e,h,i),m=c.index.shouldRefresh(v.start,v.end),g=o.getPendingOperations().filter((function(e){return e.type===va.SignalSegmentComplete})).map((function(e){return e.value})),b=function(e,t){for(var n=s.getCurrent().MINIMUM_SEGMENT_SIZE,r=Math.max(1/60,n),i=e.start+r,a=e.end-r,o=[],u=t.length-1;u>=0;u--){var l=t[u],d=l.infos.representation;if(1===l.status&&!1!==d.decipherable&&!1!==d.isSupported){var c=l.infos.segment,f=c.time/c.timescale;((c.complete?f+c.duration/c.timescale:l.end)>i&&f<a||l.end>i&&l.start<a)&&o.unshift(l)}}return o}({start:Math.max(v.start-.5,0),end:v.end+.5},o.getLastKnownInventory()),y=n.getCurrentTime();void 0===y&&(y=n.getReference().getValue().position.getWanted());var _=xa({content:e,bufferedSegments:b,currentPlaybackTime:y,fastSwitchThreshold:r,getBufferedHistory:o.getSegmentHistory.bind(o),neededRange:v,segmentsBeingPushed:g,maxBufferSize:a}),E=_.segmentsToLoad,w=_.segmentsOnHold,T=_.isBufferFull,A=E.map((function(e){return{priority:Oa(e.time,h),segment:e}})),I=c.index.isInitialized()&&!c.index.isStillAwaitingFutureSegments()&&v.hasReachedPeriodEnd&&0===A.length&&0===w.length,k=null;return g.length>0&&(k=Math.min.apply(Math,g.map((function(e){return e.segment.time})))),w.length>0&&(k=null!==k?Math.min(k,w[0].time):w[0].time),A.length>0&&(k=null!==k?Math.min(k,A[0].segment.time):A[0].segment.time),{imminentDiscontinuity:Pa(e,v,k,I,b),hasFinishedLoading:I,neededSegments:A,isBufferFull:T,shouldRefreshManifest:m}}var Na=function(e){function t(n,r,i){var a;return a=e.call(this)||this,Object.setPrototypeOf(u(a),t.prototype),a.name=\"SourceBufferError\",a.errorName=n,a.message=r,a.isBufferFull=i,a}l(t,e);var n=t.prototype;return n.serialize=function(){return{errorName:this.name,message:this.message,isBufferFull:this.isBufferFull}},n.toString=function(){return this.errorName+\": \"+this.message},t}(c(Error));function Ua(e){return new Promise((function(t){setTimeout(t,e)}))}function La(e,t,n,r,i){return Fa.apply(this,arguments)}function Fa(){return(Fa=qn(Yn().mark((function e(t,n,r,i,a){var o,s,u,l,d,c,f;return Yn().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,n.pushChunk(r);case 3:case 31:return e.abrupt(\"return\",e.sent);case 6:if(e.prev=6,e.t0=e.catch(0),!(a.isCancelled()&&e.t0 instanceof Pr)){e.next=12;break}throw e.t0;case 12:if(e.t0 instanceof Na&&e.t0.isBufferFull){e.next=15;break}throw o=e.t0 instanceof Error?e.t0.toString():\"An unknown error happened when pushing content\",new b(\"BUFFER_APPEND_ERROR\",o,{tracks:[Y(r.inventoryInfos.adaptation)]});case 15:return s=t.getReference().getValue(),u=s.position,l=u.getWanted(),e.prev=17,T.warn(\"Stream: Running garbage collector\"),d=Math.max(l-5,0),c=l+i.getValue()+12,e.next=23,n.removeBuffer(0,d);case 23:return e.next=25,n.removeBuffer(c,Number.MAX_VALUE);case 25:return e.next=27,Ua(200);case 27:if(null===a.cancellationError){e.next=29;break}throw a.cancellationError;case 29:return e.next=31,n.pushChunk(r);case 34:if(e.prev=34,e.t1=e.catch(17),!(e.t1 instanceof Pr)){e.next=38;break}throw e.t1;case 38:throw f=e.t1 instanceof Error?e.t1.toString():\"Could not clean the buffer\",new b(\"BUFFER_FULL_ERROR\",f,{tracks:[Y(r.inventoryInfos.adaptation)]});case 40:case\"end\":return e.stop()}}),e,null,[[0,6],[17,34]])})))).apply(this,arguments)}function Ba(){return Ba=qn(Yn().mark((function e(t,n){var r,a,o,s,u,l,d,c,f,p;return Yn().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.playbackObserver,a=t.content,o=t.initSegmentUniqueId,s=t.segment,u=t.segmentSink,l=t.bufferGoal,null===n.cancellationError){e.next=3;break}throw n.cancellationError;case 3:return d=a.representation.getMimeTypeString(),c={initSegmentUniqueId:o,chunk:null,timestampOffset:0,appendWindow:[void 0,void 0],codec:d},f=i({segment:s,chunkSize:void 0,start:0,end:0},a),e.next=8,La(r,u,{data:c,inventoryInfos:f},l,n);case 8:return p=e.sent,e.abrupt(\"return\",{content:a,segment:s,buffered:p});case 10:case\"end\":return e.stop()}}),e)}))),Ba.apply(this,arguments)}function za(){return za=qn(Yn().mark((function e(t,n){var r,a,o,u,l,d,c,f,p,h,v,m,g,b,y,S,_,E,w,T,A,I,k,R;return Yn().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(r=t.playbackObserver,a=t.bufferGoal,o=t.content,u=t.initSegmentUniqueId,l=t.parsedSegment,d=t.segment,c=t.segmentSink,null!==l.chunkData){e.next=3;break}return e.abrupt(\"return\",null);case 3:if(null===n.cancellationError){e.next=5;break}throw n.cancellationError;case 5:return h=l.chunkData,v=l.chunkInfos,m=l.chunkOffset,g=l.chunkSize,b=l.appendWindow,y=o.representation.getMimeTypeString(),S=s.getCurrent(),_=S.APPEND_WINDOW_SECURITIES,E=[void 0!==b[0]?Math.max(0,b[0]-_.START):void 0,void 0!==b[1]?b[1]+_.END:void 0],w={initSegmentUniqueId:u,chunk:h,timestampOffset:m,appendWindow:E,codec:y},T=null!==(f=null==v?void 0:v.time)&&void 0!==f?f:d.time,A=null!==(p=null==v?void 0:v.duration)&&void 0!==p?p:d.duration,I=T+A,void 0!==E[0]&&(T=Math.max(T,E[0])),void 0!==E[1]&&(I=Math.min(I,E[1])),k=i({segment:d,chunkSize:g,start:T,end:I},o),e.next=18,La(r,c,{data:w,inventoryInfos:k},a,n);case 18:return R=e.sent,e.abrupt(\"return\",{content:o,segment:d,buffered:R});case 20:case\"end\":return e.stop()}}),e)}))),za.apply(this,arguments)}function Wa(e,t){var n=\"undefined\"!=typeof Symbol&&e[Symbol.iterator]||e[\"@@iterator\"];if(n)return(n=n.call(e)).next.bind(n);if(Array.isArray(e)||(n=function(e,t){if(!e)return;if(\"string\"==typeof e)return Va(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);\"Object\"===n&&e.constructor&&(n=e.constructor.name);if(\"Map\"===n||\"Set\"===n)return Array.from(e);if(\"Arguments\"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Va(e,t)}(e))||t&&e&&\"number\"==typeof e.length){n&&(e=n);var r=0;return function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}}}throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\")}function Va(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var ja=function(e,t,n){var r=e.content,a=e.options,o=e.playbackObserver,u=e.segmentSink,l=e.segmentFetcher,d=e.terminate,c=r.period,f=r.adaptation,p=r.representation,h=a.bufferGoal,v=a.maxBufferSize,m=a.drmSystemId,g=a.fastSwitchThreshold,b=f.type,y=new kr;y.linkToSignal(n);var S=new kr;S.linkToSignal(y.signal);var _={segment:p.index.getInitSegment(),uniqueId:null,isLoaded:!1};y.signal.register((function(){null!==_.uniqueId&&u.freeInitSegment(_.uniqueId)}));var E=new N({initSegment:null,segmentQueue:[]},S.signal),w=null!==_.segment;w||(_.isLoaded=!0);var A=!1;if(void 0!==m){var I=p.getEncryptionData(m);if(I.length>0&&I.every((function(e){return void 0!==e.keyIds}))&&(A=!0,t.encryptionDataEncountered(I.map((function(e){return i({content:r},e)}))),y.isUsed()))return}var k=new Ra(r,E,l,w);return k.addEventListener(\"error\",(function(e){S.signal.isCancelled()||(y.cancel(),t.error(e))})),k.addEventListener(\"parsedInitSegment\",P),k.addEventListener(\"parsedMediaSegment\",P),k.addEventListener(\"emptyQueue\",R),k.addEventListener(\"requestRetry\",(function(e){if(t.warning(e.error),!S.signal.isCancelled()){var n=e.segment,r=p.index;!1===r.isSegmentStillAvailable(n)?R():r.canBeOutOfSyncError(e.error,n)&&t.manifestMightBeOufOfSync()}})),k.addEventListener(\"fullyLoadedSegment\",(function(e){u.signalSegmentComplete(i({segment:e},r)).catch(x)})),k.start(),S.signal.register((function(){k.removeEventListener(),k.stop()})),o.listen(R,{includeLastObservation:!1,clearSignal:S.signal}),r.manifest.addEventListener(\"manifestUpdate\",R,S.signal),h.onUpdate(R,{emitCurrentValue:!1,clearSignal:S.signal}),v.onUpdate(R,{emitCurrentValue:!1,clearSignal:S.signal}),d.onUpdate(R,{emitCurrentValue:!1,clearSignal:S.signal}),void R();function R(){if(!S.isUsed()){var e=o.getReference().getValue(),n=e.position.getWanted(),i=Da(r,n,o,g.getValue(),h.getValue(),v.getValue(),u),a=i.neededSegments,l=null;if(p.index.isInitialized()){if(a.length>0&&!_.isLoaded&&null!==_.segment){var f=a[0].priority;l={segment:_.segment,priority:f}}}else if(null===_.segment)T.warn(\"Stream: Uninitialized index without an initialization segment\");else if(_.isLoaded)T.warn(\"Stream: Uninitialized index with an already loaded initialization segment\");else{var m=e.position.getWanted();l={segment:_.segment,priority:Oa(c.start,m)}}var y=d.getValue();if(null===y)E.setValue({initSegment:l,segmentQueue:a});else{if(y.urgent)return T.debug(\"Stream: Urgent switch, terminate now.\",b),E.setValue({initSegment:null,segmentQueue:[]}),E.finish(),S.cancel(),void t.terminating();var w=a[0],A=k.getRequestedInitSegment(),I=k.getRequestedMediaSegment(),R=null===I||void 0===w||I.id!==w.segment.id?[]:[w],P=null===A?null:l;if(E.setValue({initSegment:P,segmentQueue:R}),0===R.length&&null===P)return T.debug(\"Stream: No request left, terminate\",b),E.finish(),S.cancel(),void t.terminating()}if(t.streamStatusUpdate({period:c,position:e.position.getWanted(),bufferType:b,imminentDiscontinuity:i.imminentDiscontinuity,isEmptyStream:!1,hasFinishedLoading:i.hasFinishedLoading,neededSegments:i.neededSegments}),!S.signal.isCancelled()){var C=s.getCurrent().UPTO_CURRENT_POSITION_CLEANUP;if(i.isBufferFull){var M=Math.max(0,n-C);M>0&&u.removeBuffer(0,M).catch(x)}i.shouldRefreshManifest&&t.needsManifestRefresh()}}}function P(e){if(!y.isUsed()){for(var n,a=Wa(e.protectionData);!(n=a()).done;){var s=n.value;p.addProtectionData(s.initDataType,s.keyId,s.initData)}if(!A){var l=p.getAllEncryptionData();if(l.length>0&&(t.encryptionDataEncountered(l.map((function(e){return i({content:r},e)}))),A=!0,y.isUsed()))return}if(\"init\"!==e.segmentType){var d=e.inbandEvents,c=e.predictedSegments,f=e.needsManifestRefresh;if(!(void 0!==c&&p.index.addPredictedSegments(c,e.segment),!0===f&&(t.needsManifestRefresh(),y.isUsed())||void 0!==d&&d.length>0&&(t.inbandEvent(d),y.isUsed()))){var v=_.uniqueId;(function(e,t){return za.apply(this,arguments)})({playbackObserver:o,bufferGoal:h,content:r,initSegmentUniqueId:v,parsedSegment:e,segment:e.segment,segmentSink:u},y.signal).then((function(e){null!==e&&t.addedSegment(e)})).catch(x)}}else{if(p.index.isInitialized()||void 0===e.segmentList||p.index.initialize(e.segmentList),_.isLoaded=!0,null!==e.initializationData){var m=p.uniqueId;_.uniqueId=m,u.declareInitSegment(m,e.initializationData),function(e,t){return Ba.apply(this,arguments)}({playbackObserver:o,bufferGoal:h,content:r,initSegmentUniqueId:m,segment:e.segment,segmentData:e.initializationData,segmentSink:u},y.signal).then((function(e){null!==e&&t.addedSegment(e)})).catch(x)}R()}}}function x(e){y.isUsed()&&e instanceof Pr||(y.cancel(),t.error(e))}};function Ga(e,t){for(var n=0;n<e.length;n++)if(e[n].infos.period.start>=t.start)return n>0?e[n-1]:null;return e.length>0?e[e.length-1]:null}function Ha(e,t){for(var n=0;n<e.length;n++)if(e[n].infos.period.start>t.start)return e[n];return null}function qa(e,t){var n=\"undefined\"!=typeof Symbol&&e[Symbol.iterator]||e[\"@@iterator\"];if(n)return(n=n.call(e)).next.bind(n);if(Array.isArray(e)||(n=function(e,t){if(!e)return;if(\"string\"==typeof e)return Ka(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);\"Object\"===n&&e.constructor&&(n=e.constructor.name);if(\"Map\"===n||\"Set\"===n)return Array.from(e);if(\"Arguments\"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Ka(e,t)}(e))||t&&e&&\"number\"==typeof e.length){n&&(e=n);var r=0;return function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}}}throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\")}function Ka(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Ya(e,t,n,r,i){var a,o,u,l;if(\"lazy\"===n.switchingMode)return{type:\"continue\",value:void 0};for(var d,c=r.getLastKnownInventory(),f=[],p=qa(c);!(d=p()).done;){var h=d.value;h.infos.period.id!==e.id||h.infos.adaptation.id===t.id&&k(n.representationIds,h.infos.representation.id)||$i(f,{start:null!==(a=h.bufferedStart)&&void 0!==a?a:h.start,end:null!==(o=h.bufferedEnd)&&void 0!==o?o:h.end})}for(var v,m=qa(r.getPendingOperations());!(v=m()).done;){var g=v.value;if(g.type===va.Push){var b=g.value.inventoryInfos;if(b.period.id===e.id&&(b.adaptation.id!==t.id||!k(n.representationIds,b.representation.id))){var y=b.segment.time;$i(f,{start:y,end:y+b.segment.duration})}}}if(0===f.length)return{type:\"continue\",value:void 0};if(\"reload\"===n.switchingMode){var S=i.getReadyState();if(void 0===S||S>1)return{type:\"needs-reload\",value:void 0}}var _=\"direct\"===n.switchingMode,E=[],w=Ga(c,e);if(null!==w&&(void 0===w.bufferedEnd||e.start-w.bufferedEnd<1)&&E.push({start:0,end:e.start+1}),!_){var T=s.getCurrent().ADAP_REP_SWITCH_BUFFER_PADDINGS,A=t.type,I=null!==(u=T[A].before)&&void 0!==u?u:0,R=null!==(l=T[A].after)&&void 0!==l?l:0,P=i.getCurrentTime();if(void 0===P)P=i.getReference().getValue().position.getPolled();E.push({start:P-I,end:P+R})}if(void 0!==e.end){var x=Ha(c,e);null!==x&&(void 0===x.bufferedStart||x.bufferedStart-e.end<1)&&E.push({start:e.end-1,end:Number.MAX_VALUE})}var C=Ji(f,E);return 0===C.length?{type:\"continue\",value:void 0}:_?{type:\"flush-buffer\",value:C}:{type:\"clean-buffer\",value:C}}function Qa(e,t){var n=\"undefined\"!=typeof Symbol&&e[Symbol.iterator]||e[\"@@iterator\"];if(n)return(n=n.call(e)).next.bind(n);if(Array.isArray(e)||(n=function(e,t){if(!e)return;if(\"string\"==typeof e)return Xa(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);\"Object\"===n&&e.constructor&&(n=e.constructor.name);if(\"Map\"===n||\"Set\"===n)return Array.from(e);if(\"Arguments\"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Xa(e,t)}(e))||t&&e&&\"number\"==typeof e.length){n&&(e=n);var r=0;return function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}}}throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\")}function Xa(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var $a=function(e,t,n){var r=e.playbackObserver,a=e.content,o=e.options,u=e.representationEstimator,l=e.segmentSink,d=e.segmentFetcherCreator,c=e.wantedBufferAhead,f=e.maxVideoBufferSize,p=a.manifest,h=a.period,v=a.adaptation,m=new kr;m.linkToSignal(n);var g,b,y=new Map,S=new N(null,m.signal),_=a.representations.getValue().representationIds,w=a.adaptation.representations.filter((function(e){return k(_,e.id)&&!1!==e.decipherable&&!1!==e.isSupported})),A=new N(w,m.signal),I=u({manifest:p,period:h,adaptation:v},S,A,r,m.signal),R=I.estimates,P=I.callbacks,x=d.createSegmentFetcher(v.type,{onRequestBegin:P.requestBegin,onRequestEnd:P.requestEnd,onProgress:P.requestProgress,onMetrics:P.metrics}),C=new N(0);return R.onUpdate((function(e){var n=e.bitrate,r=e.knownStableBitrate;o.enableFastSwitching&&C.setValueIfChanged(r),void 0!==n&&n!==g&&(g=n,T.debug(\"Stream: new \"+v.type+\" bitrate estimate\",n),t.bitrateEstimateChange({type:v.type,bitrate:n}))}),{emitCurrentValue:!0,clearSignal:m.signal}),void a.representations.onUpdate((function(e){void 0!==b&&b.cancel();var n=a.representations.getValue().representationIds,r=a.adaptation.representations.filter((function(e){return k(n,e.id)}));A.setValueIfChanged(r),(b=new kr).linkToSignal(m.signal),function(e,t){return M.apply(this,arguments)}(e,b.signal).catch((function(e){!0===(null==b?void 0:b.isUsed())&&kr.isCancellationError(e)||(m.cancel(),t.error(e))}))}),{clearSignal:m.signal,emitCurrentValue:!0});function M(){return(M=qn(Yn().mark((function e(n,i){var a,o,u,d;return Yn().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:a=Ya(h,v,n,l,r),e.t0=a.type,e.next=\"continue\"===e.t0?4:\"needs-reload\"===e.t0?5:\"flush-buffer\"===e.t0||\"clean-buffer\"===e.t0?6:20;break;case 4:return e.abrupt(\"break\",21);case 5:return e.abrupt(\"return\",Li((function(){r.listen((function(){if(!i.isCancelled()){var e=s.getCurrent().DELTA_POSITION_AFTER_RELOAD.bitrateSwitch;return t.waitingMediaSourceReload({bufferType:v.type,period:h,timeOffset:e,stayInPeriod:!0})}}),{includeLastObservation:!0,clearSignal:i})})));case 6:o=Qa(a.value);case 7:if((u=o()).done){e.next=15;break}return d=u.value,e.next=11,l.removeBuffer(d.start,d.end);case 11:if(!i.isCancelled()){e.next=13;break}return e.abrupt(\"return\");case 13:e.next=7;break;case 15:if(\"flush-buffer\"!==a.type){e.next=19;break}if(t.needsBufferFlush(),!i.isCancelled()){e.next=19;break}return e.abrupt(\"return\");case 19:return e.abrupt(\"break\",21);case 20:Me();case 21:O(i);case 22:case\"end\":return e.stop()}}),e)})))).apply(this,arguments)}function O(e){var n=new kr;n.linkToSignal(e);var r=R.getValue().representation;if(null!==r){var i=new N(null,n.signal);R.onUpdate((function(e){if(null!==e.representation&&e.representation.id!==r.id)return e.urgent?(T.info(\"Stream: urgent Representation switch\",v.type),i.setValue({urgent:!0})):(T.info(\"Stream: slow Representation switch\",v.type),i.setValue({urgent:!1}))}),{clearSignal:n.signal,emitCurrentValue:!0});var a={type:v.type,adaptation:v,period:h,representation:r};if(S.setValue(r),!m.isUsed()&&(t.representationChange(a),!m.isUsed())){var o={streamStatusUpdate:t.streamStatusUpdate,encryptionDataEncountered:t.encryptionDataEncountered,manifestMightBeOufOfSync:t.manifestMightBeOufOfSync,needsManifestRefresh:t.needsManifestRefresh,inbandEvent:t.inbandEvent,warning:t.warning,error:function(e){m.cancel(),t.error(e)},addedSegment:function(e){P.addedSegment(e)},terminating:function(){if(!n.isUsed())return n.cancel(),O(e)}};U(r,i,o,e)}}}function U(e,n,a,s){var u=new kr;u.linkToSignal(s);var d=D(c,(function(t){return t*function(e){var t=y.get(e.id),n=void 0!==t?t:1;void 0===t&&y.set(e.id,n);return n}(e)}),u.signal),g=\"video\"===v.type?f:new N(1/0);T.info(\"Stream: changing representation\",v.type,e.id,e.bitrate);var b=i({},a,{error:function(t){var r,i=Sr(t,{defaultCode:\"NONE\",defaultReason:\"Unknown `RepresentationStream` error\"});if(\"BUFFER_FULL_ERROR\"!==i.code)a.error(t);else{var o=c.getValue(),u=.7*(null!==(r=y.get(e.id))&&void 0!==r?r:1);if(u<=.05||o*u<=2)throw i;y.set(e.id,u),ka(4e3,m.signal).then((function(){return U(e,n,a,s)})).catch(E)}},terminating:function(){u.cancel(),a.terminating()}});ja({playbackObserver:r,content:{representation:e,adaptation:v,period:h,manifest:p},segmentSink:l,segmentFetcher:x,terminate:n,options:{bufferGoal:d,maxBufferSize:g,drmSystemId:o.drmSystemId,fastSwitchThreshold:C}},b,s),p.addEventListener(\"manifestUpdate\",(function(n){for(var r,i=Qa(n.updatedPeriods);!(r=i()).done;){var a=r.value;if(a.period.id===h.id)for(var o,u=Qa(a.result.updatedAdaptations);!(o=u()).done;){var l=o.value;if(l.adaptation===v.id)for(var d,c=Qa(l.removedRepresentations);!(d=c()).done;){if(d.value===e.id){if(s.isCancelled())return;return t.waitingMediaSourceReload({bufferType:v.type,period:h,timeOffset:0,stayInPeriod:!0})}}}else if(a.period.start>h.start)break}}),s)}};var Za=function(e,t){var n=e.split(\";\"),r=n[0],i=n.slice(1),a=t.split(\";\"),o=a[0],s=a.slice(1);if(r!==o)return!1;var u=A(i,(function(e){return ln(e,\"codecs=\")})),l=A(s,(function(e){return ln(e,\"codecs=\")}));if(void 0===u||void 0===l)return!1;var d=u.substring(7),c=l.substring(7);return d.split(\".\")[0]===c.split(\".\")[0]};function Ja(e,t){var n=\"undefined\"!=typeof Symbol&&e[Symbol.iterator]||e[\"@@iterator\"];if(n)return(n=n.call(e)).next.bind(n);if(Array.isArray(e)||(n=function(e,t){if(!e)return;if(\"string\"==typeof e)return eo(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);\"Object\"===n&&e.constructor&&(n=e.constructor.name);if(\"Map\"===n||\"Set\"===n)return Array.from(e);if(\"Arguments\"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return eo(e,t)}(e))||t&&e&&\"number\"==typeof e.length){n&&(e=n);var r=0;return function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}}}throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\")}function eo(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function to(e,t,n,r,i,a){var o,u,l,d;if(void 0!==e.codec&&\"reload\"===a.onCodecSwitch&&!function(e,t){return e.representations.some((function(e){return!0===e.isSupported&&!1!==e.decipherable&&Za(e.getMimeTypeString(),t)}))}(n,e.codec))return{type:\"needs-reload\",value:void 0};for(var c,f=e.getLastKnownInventory(),p=[],h=Ja(f);!(c=h()).done;){var v=c.value;v.infos.period.id===t.id&&v.infos.adaptation.id!==n.id&&$i(p,{start:null!==(o=v.bufferedStart)&&void 0!==o?o:v.start,end:null!==(u=v.bufferedEnd)&&void 0!==u?u:v.end})}for(var m,g=Ja(e.getPendingOperations());!(m=g()).done;){var b=m.value;if(b.type===va.Push){var y=b.value.inventoryInfos;if(y.period.id===t.id&&y.adaptation.id!==n.id){var S=y.segment.time;$i(p,{start:S,end:S+y.segment.duration})}}}if(0===p.length)return{type:\"continue\",value:void 0};if(\"reload\"===r){var _=i.getReadyState();if(void 0===_||_>1)return{type:\"needs-reload\",value:void 0}}var E=\"direct\"===r,w=[],T=Ga(f,t);if(null!==T&&(void 0===T.bufferedEnd||t.start-T.bufferedEnd<1)&&w.push({start:0,end:t.start+1}),!E){var A=n.type,I=s.getCurrent().ADAP_REP_SWITCH_BUFFER_PADDINGS,k=null!==(l=I[A].before)&&void 0!==l?l:0,R=null!==(d=I[A].after)&&void 0!==d?d:0,P=i.getCurrentTime();if(void 0===P)P=i.getReference().getValue().position.getPolled();w.push({start:P-k,end:P+R})}if(void 0!==t.end){var x=Ha(f,t);null!==x&&(void 0===x.bufferedStart||x.bufferedStart-t.end<1)&&w.push({start:t.end-1,end:Number.MAX_VALUE})}var C=Ji(p,w);return 0===C.length?{type:\"continue\",value:void 0}:E&&\"text\"!==n.type?{type:\"flush-buffer\",value:C}:{type:\"clean-buffer\",value:C}}function no(e,t){var n=\"undefined\"!=typeof Symbol&&e[Symbol.iterator]||e[\"@@iterator\"];if(n)return(n=n.call(e)).next.bind(n);if(Array.isArray(e)||(n=function(e,t){if(!e)return;if(\"string\"==typeof e)return ro(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);\"Object\"===n&&e.constructor&&(n=e.constructor.name);if(\"Map\"===n||\"Set\"===n)return Array.from(e);if(\"Arguments\"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ro(e,t)}(e))||t&&e&&\"number\"==typeof e.length){n&&(e=n);var r=0;return function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}}}throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\")}function ro(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function io(e,t,n){var r=e.getStatus(t);if(\"initialized\"===r.type)return T.info(\"Stream: Reusing a previous SegmentSink for the type\",t),r.value;var i=function(e){var t=e.representations.filter((function(e){return!0===e.isSupported&&!1!==e.decipherable}));if(0===t.length){throw new b(\"NO_PLAYABLE_REPRESENTATION\",\"No Representation in the chosen \"+e.type+\" Adaptation can be played\",{tracks:[Y(e)]})}return t[0].getMimeTypeString()}(n);return e.createSegmentSink(t,i)}function ao(e,t,n,r,i,a){var o=r.period,s=!1;function u(){var r=e.getReference().getValue(),a=t.getValue(),u=r.position.getWanted();void 0!==o.end&&u+a>=o.end&&(T.debug('Stream: full \"empty\" AdaptationStream',n),s=!0),i.streamStatusUpdate({period:o,bufferType:n,imminentDiscontinuity:null,position:u,isEmptyStream:!0,hasFinishedLoading:s,neededSegments:[]})}t.onUpdate(u,{emitCurrentValue:!1,clearSignal:a}),e.listen(u,{includeLastObservation:!1,clearSignal:a}),u()}var oo=function(e,t,n){var r=e.bufferType,a=e.content,o=e.garbageCollectors,u=e.playbackObserver,l=e.representationEstimator,d=e.segmentFetcherCreator,c=e.segmentSinksStore,f=e.options,p=e.wantedBufferAhead,h=e.maxVideoBufferSize,v=a.manifest,m=a.period,g=new N(void 0,n);if(t.periodStreamReady({type:r,manifest:v,period:m,adaptationRef:g}),!n.isCancelled()){var b,y=!0;g.onUpdate((function(e){qn(Yn().mark((function i(){var a,l,d,h,g,E,w,I,k,R,P,x,C,M,O,D,N,U;return Yn().wrap((function(i){for(;;)switch(i.prev=i.next){case 0:if(void 0!==e){i.next=2;break}return i.abrupt(\"return\");case 2:if((l=new kr).linkToSignal(n),null==b||b.cancel(),b=l,null!==e){i.next=34;break}if(T.info(\"Stream: Set no \"+r+\" Adaptation. P:\",m.start),\"initialized\"!==(d=c.getStatus(r)).type){i.next=26;break}if(T.info(\"Stream: Clearing previous \"+r+\" SegmentSink\"),!Ia.isNative(r)){i.next=15;break}return i.abrupt(\"return\",_(0,!0,l.signal));case 15:if(h=null!==(a=m.end)&&void 0!==a?a:1/0,!(m.start>h)){i.next=20;break}T.warn(\"Stream: Can't free buffer: period's start is after its end\"),i.next=24;break;case 20:return i.next=22,d.value.removeBuffer(m.start,h);case 22:if(!l.isUsed()){i.next=24;break}return i.abrupt(\"return\");case 24:i.next=30;break;case 26:if(\"uninitialized\"!==d.type){i.next=30;break}if(c.disableSegmentSink(r),!l.isUsed()){i.next=30;break}return i.abrupt(\"return\");case 30:if(t.adaptationChange({type:r,adaptation:null,period:m}),!l.isUsed()){i.next=33;break}return i.abrupt(\"return\");case 33:return i.abrupt(\"return\",ao(u,p,r,{period:m},t,l.signal));case 34:if(g=m.adaptations[r],void 0!==(E=A(null!=g?g:[],(function(t){return t.id===e.adaptationId})))){i.next=40;break}return b.cancel(),T.warn(\"Stream: Unfound chosen Adaptation choice\",e.adaptationId),i.abrupt(\"return\");case 40:if(w=s.getCurrent(),I=w.DELTA_POSITION_AFTER_RELOAD,k=!1,!y){i.next=46;break}R=0,i.next=60;break;case 46:if(void 0===e.relativeResumingPosition){i.next=50;break}R=e.relativeResumingPosition,i.next=60;break;case 50:k=!0,i.t0=r,i.next=\"audio\"===i.t0?54:\"video\"===i.t0?56:58;break;case 54:return R=I.trackSwitch.audio,i.abrupt(\"break\",60);case 56:return R=I.trackSwitch.video,i.abrupt(\"break\",60);case 58:return R=I.trackSwitch.other,i.abrupt(\"break\",60);case 60:if(y=!1,!Ia.isNative(r)||\"disabled\"!==c.getStatus(r).type){i.next=63;break}return i.abrupt(\"return\",_(R,!0,l.signal));case 63:if(v.addEventListener(\"manifestUpdate\",(function(e){for(var t,n=no(e.updatedPeriods);!(t=n()).done;){var r=t.value;if(r.period.id===m.id)for(var i,a=no(r.result.removedAdaptations);!(i=a()).done;){if(i.value.id===E.id)return _(R,!0,l.signal)}else if(r.period.start>m.start)break}}),b.signal),P=e.representations,T.info(\"Stream: Updating \"+r+\" adaptation\",\"A: \"+E.id,\"P: \"+m.start),t.adaptationChange({type:r,adaptation:E,period:m}),!l.isUsed()){i.next=69;break}return i.abrupt(\"return\");case 69:if(x=io(c,r,E),\"needs-reload\"!==(C=to(x,m,E,e.switchingMode,u,f)).type){i.next=73;break}return i.abrupt(\"return\",_(R,!0,l.signal));case 73:return i.next=75,c.waitForUsableBuffers(l.signal);case 75:if(!l.isUsed()){i.next=77;break}return i.abrupt(\"return\");case 77:if(\"flush-buffer\"!==C.type&&\"clean-buffer\"!==C.type){i.next=91;break}M=no(C.value);case 79:if((O=M()).done){i.next=87;break}return D=O.value,N=D.start,U=D.end,i.next=83,x.removeBuffer(N,U);case 83:if(!l.isUsed()){i.next=85;break}return i.abrupt(\"return\");case 85:i.next=79;break;case 87:if(\"flush-buffer\"!==C.type){i.next=91;break}if(t.needsBufferFlush({relativeResumingPosition:R,relativePosHasBeenDefaulted:k}),!l.isUsed()){i.next=91;break}return i.abrupt(\"return\");case 91:o.get(x)(l.signal),S(E,P,x,l.signal);case 93:case\"end\":return i.stop()}}),i)})))().catch((function(e){e instanceof Pr||(null==b||b.cancel(),t.error(e))}))}),{clearSignal:n,emitCurrentValue:!0})}function S(e,n,a,o){var s,g,b=(s=u,g=e.type,s.deriveReadOnlyObserver((function(e,t){var n=new N(r(),t);return e.onUpdate(a,{clearSignal:t,emitCurrentValue:!1}),n;function r(){var t=e.getValue(),n=t.buffered[g],r=null!==n?Xi(n,t.position.getWanted()):0;return i({},t,{bufferGap:r,buffered:n})}function a(){n.setValue(r())}})));$a({content:{manifest:v,period:m,adaptation:e,representations:n},options:f,playbackObserver:b,representationEstimator:l,segmentSink:a,segmentFetcherCreator:d,wantedBufferAhead:p,maxVideoBufferSize:h},Object.assign(Object.assign({},t),{error:function(e){if(!Ia.isNative(r)){T.error(\"Stream: \"+r+\" Stream crashed. Aborting it.\",e instanceof Error?e:\"\"),c.disposeSegmentSink(r);var n=Sr(e,{defaultCode:\"NONE\",defaultReason:\"Unknown `AdaptationStream` error\"});if(t.warning(n),o.isCancelled())return;return ao(u,p,r,{period:m},t,o)}T.error(\"Stream: \"+r+\" Stream crashed. Stopping playback.\",e instanceof Error?e:\"\"),t.error(e)}}),o)}function _(e,n,i){Li((function(){u.listen((function(){i.isCancelled()||t.waitingMediaSourceReload({bufferType:r,period:m,timeOffset:e,stayInPeriod:n})}),{includeLastObservation:!0,clearSignal:i})}))}};function so(e,t){if(0===t.length)return[];for(var n,r=[],i=e.getLastKnownInventory(),a=function(){var e=i[o];if(t.some((function(t){return e.infos.period.id===t.period.id&&e.infos.adaptation.id===t.adaptation.id&&e.infos.representation.id===t.representation.id}))){var n=e.bufferedStart,a=e.bufferedEnd;if(void 0===n||void 0===a)return T.warn(\"SO: No buffered start or end found from a segment.\"),{v:[{start:0,end:Number.MAX_VALUE}]};var s=r[r.length-1];void 0!==s&&s.end===n?s.end=a:r.push({start:n,end:a})}},o=0;o<i.length;o++)if(n=a())return n.v;return r}function uo(e,t){var n=\"undefined\"!=typeof Symbol&&e[Symbol.iterator]||e[\"@@iterator\"];if(n)return(n=n.call(e)).next.bind(n);if(Array.isArray(e)||(n=function(e,t){if(!e)return;if(\"string\"==typeof e)return lo(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);\"Object\"===n&&e.constructor&&(n=e.constructor.name);if(\"Map\"===n||\"Set\"===n)return Array.from(e);if(\"Arguments\"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return lo(e,t)}(e))||t&&e&&\"number\"==typeof e.length){n&&(e=n);var r=0;return function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}}}throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\")}function lo(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function co(e,t){if(0===t.length)return!1;var n=e.position.getPolled();return e.speed>=0?t[t.length-1].end>=n-5:t[0].start<=n+5}var fo=function(e,t,n,r,i,a,o,u){for(var l,d=e.manifest,c=e.initialPeriod,f=a.maxBufferAhead,p=a.maxBufferBehind,h=a.wantedBufferAhead,v=a.maxVideoBufferSize,m=s.getCurrent(),g=m.MINIMUM_MAX_BUFFER_AHEAD,y=m.MAXIMUM_MAX_BUFFER_AHEAD,_=m.MAXIMUM_MAX_BUFFER_BEHIND,E=new Bi((function(e){var n,r,i=e.bufferType,a=null!==(n=_[i])&&void 0!==n?n:1/0,o=null!==(r=y[i])&&void 0!==r?r:1/0;return function(n){ea({segmentSink:e,playbackObserver:t,maxBufferBehind:D(p,(function(e){return Math.min(e,a)}),n),maxBufferAhead:D(f,(function(e){var t,n=Math.max(e,null!==(t=g[i])&&void 0!==t?t:0);return Math.min(n,o)}),n)},n)}})),w=uo(r.getBufferTypes());!(l=w()).done;){A(l.value,c)}function A(e,n){var i=new Fi((function(e,t){return e.start-t.start})),a=!1,s=new kr;return s.linkToSignal(u),t.listen((function(t){var n,r=t.position.getWanted();if(a&&function(e){var t=i.head(),n=i.last();if(void 0===t||void 0===n)return!0;return t.start>e||(S(n.end)?1/0:n.end)<e}(r)){for(T.info(\"Stream: Destroying all PeriodStreams due to out of bounds situation\",e,r),a=!1;i.length()>0;){var c=i.get(i.length()-1);i.removeElement(c),o.periodStreamCleared({type:e,manifest:d,period:c})}s.cancel(),(s=new kr).linkToSignal(u);var f=null!==(n=d.getPeriodForTime(r))&&void 0!==n?n:d.getNextPeriod(r);if(void 0===f)return T.warn(\"Stream: The wanted position is not found in the Manifest.\"),void(a=!0);l(f)}}),{clearSignal:u,includeLastObservation:!0}),d.addEventListener(\"decipherabilityUpdate\",(function(e){u.isCancelled()||function(e){return c.apply(this,arguments)}(e).catch((function(e){u.isCancelled()||(s.cancel(),o.error(e))}))}),u),l(n);function l(t){var n=Object.assign(Object.assign({},o),{waitingMediaSourceReload:function(e){var t=i.head();void 0===t||t.id!==e.period.id?o.lockedStream({bufferType:e.bufferType,period:e.period}):o.needsMediaSourceReload({timeOffset:e.timeOffset,minimumPosition:e.stayInPeriod?e.period.start:void 0,maximumPosition:e.stayInPeriod?e.period.end:void 0})},periodStreamReady:function(e){a=!0,i.add(e.period),o.periodStreamReady(e)},periodStreamCleared:function(e){i.removeElement(e.period),o.periodStreamCleared(e)},error:function(e){s.cancel(),o.error(e)}});I(e,t,n,s.signal)}function c(){return c=qn(Yn().mark((function n(c){var f,p,h,v,m,g,y,S,_,E,w,A,I;return Yn().wrap((function(n){for(;;)switch(n.prev=n.next){case 0:if(f=r.getStatus(e),0!==(p=c.filter((function(t){return t.adaptation.type===e}))).length&&\"initialized\"===f.type&&!p.every((function(e){return!0===e.representation.decipherable}))){n.next=4;break}return n.abrupt(\"return\");case 4:for(h=f.value,v=p.filter((function(e){return void 0===e.representation.decipherable})),m=p.filter((function(e){return!1===e.representation.decipherable})),g=so(h,m),y=so(h,v),a=!1,T.info(\"Stream: Destroying all PeriodStreams for decipherability matters\",e);i.length()>0;)S=i.get(i.length()-1),i.removeElement(S),o.periodStreamCleared({type:e,manifest:d,period:S});s.cancel(),(s=new kr).linkToSignal(u),_=0,E=[].concat(g,y);case 16:if(!(_<E.length)){n.next=28;break}if(w=E[_],A=w.start,I=w.end,!u.isCancelled()){n.next=20;break}return n.abrupt(\"return\");case 20:if(!(A<I)){n.next=25;break}if(!u.isCancelled()){n.next=23;break}return n.abrupt(\"return\");case 23:return n.next=25,h.removeBuffer(A,I);case 25:_++,n.next=16;break;case 28:Li((function(){if(!u.isCancelled()){var e=t.getReference().getValue();if(co(e,g)){if(o.needsDecipherabilityFlush(),u.isCancelled())return}else if(co(e,y)&&(o.needsBufferFlush(),u.isCancelled()))return;var n=e.position.getWanted(),r=d.getPeriodForTime(n);void 0!==r?l(r):o.error(new b(\"MEDIA_TIME_NOT_FOUND\",\"The wanted position is not found in the Manifest.\"))}}));case 29:case\"end\":return n.stop()}}),n)}))),c.apply(this,arguments)}}function I(e,s,u,l){T.info(\"Stream: Creating new Stream for\",e,s.start);var c=null,f=new kr;f.linkToSignal(l),t.listen((function(t,n){var r=t.position;if(void 0!==s.end&&r.getWanted()>=s.end){var i=d.getPeriodAfter(s);if(s.containsTime(r.getWanted(),i))return;T.info(\"Stream: Destroying PeriodStream as the current playhead moved above it\",e,s.start,r.getWanted(),s.end),n(),u.periodStreamCleared({type:e,manifest:d,period:s}),f.cancel()}}),{clearSignal:l,includeLastObservation:!0});var p,m={bufferType:e,content:{manifest:d,period:s},garbageCollectors:E,maxVideoBufferSize:v,segmentFetcherCreator:i,segmentSinksStore:r,options:a,playbackObserver:t,representationEstimator:n,wantedBufferAhead:h},g=Object.assign(Object.assign({},u),{streamStatusUpdate:function(t){if(t.hasFinishedLoading){var n=d.getPeriodAfter(s);null!==n&&function(t){if(null!==c){if(c.period.id===t.id)return;T.warn(\"Stream: Creating next `PeriodStream` while one was already created.\",e,t.id,c.period.id),u.periodStreamCleared({type:e,manifest:d,period:c.period}),c.canceller.cancel()}var n=new kr;n.linkToSignal(l),c={canceller:n,period:t},I(e,t,u,c.canceller.signal)}(n)}else null!==c&&(T.info(\"Stream: Destroying next PeriodStream due to current one being active\",e,c.period.start),u.periodStreamCleared({type:e,manifest:d,period:c.period}),c.canceller.cancel(),c=null);u.streamStatusUpdate(t)},error:function(e){null!==c&&(c.canceller.cancel(),c=null),f.cancel(),u.error(e)}});oo(m,g,f.signal),p=f.signal,d.addEventListener(\"manifestUpdate\",(function(t){for(var n,r=uo(t.removedPeriods);!(n=r()).done;){var i=n.value;if(i.id===s.id){if(d.periods.length>0&&d.periods[0].start<=i.start)return Li((function(){if(!p.isCancelled())return o.needsMediaSourceReload({timeOffset:0,minimumPosition:void 0,maximumPosition:void 0})}))}else if(i.start>s.start)break}if(t.addedPeriods.length>0&&null!==c){var a=d.getPeriodAfter(s);null!==a&&c.period.id===a.id||(T.warn(\"Stream: Destroying next PeriodStream due to new one being added\",e,c.period.start),u.periodStreamCleared({type:e,manifest:d,period:c.period}),c.canceller.cancel(),c=null)}}),p)}},po=fo;function ho(e,t){var n=\"undefined\"!=typeof Symbol&&e[Symbol.iterator]||e[\"@@iterator\"];if(n)return(n=n.call(e)).next.bind(n);if(Array.isArray(e)||(n=function(e,t){if(!e)return;if(\"string\"==typeof e)return vo(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);\"Object\"===n&&e.constructor&&(n=e.constructor.name);if(\"Map\"===n||\"Set\"===n)return Array.from(e);if(\"Arguments\"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return vo(e,t)}(e))||t&&e&&\"number\"==typeof e.length){n&&(e=n);var r=0;return function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}}}throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\")}function vo(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var mo=function(e){function t(t,n,r){var i;(i=e.call(this)||this)._canceller=new kr,i._manifest=t,i._activeStreams=new Map,i._allBufferTypes=r,i._lastCurrentPeriodId=null;var a=new go(t);i._maximumPositionCalculator=a;var o=i._canceller.signal;return n.listen((function(e){var n=e.position.getWanted();if(n<t.getMinimumSafePosition()){var r=new b(\"MEDIA_TIME_BEFORE_MANIFEST\",\"The current position is behind the earliest time announced in the Manifest.\");i.trigger(\"warning\",r)}else if(n>a.getMaximumAvailablePosition()){var o=new b(\"MEDIA_TIME_AFTER_MANIFEST\",\"The current position is after the latest time announced in the Manifest.\");i.trigger(\"warning\",o)}}),{includeLastObservation:!0,clearSignal:o}),t.addEventListener(\"manifestUpdate\",(function(){i.trigger(\"endingPositionChange\",i._getManifestEndTime()),o.isCancelled()||i._checkEndOfStream()}),o),i}l(t,e);var n=t.prototype;return n.getCurrentEndingTime=function(){return this._getManifestEndTime()},n.onAdaptationChange=function(e,t,n){if(this._manifest.isLastPeriodKnown){var r=this._manifest.periods[this._manifest.periods.length-1];if(t.id===(null==r?void 0:r.id)&&(\"audio\"===e||\"video\"===e)){\"audio\"===e?this._maximumPositionCalculator.updateLastAudioAdaptation(n):this._maximumPositionCalculator.updateLastVideoAdaptation(n);var i=this._maximumPositionCalculator.getEndingPosition(),a=void 0!==i?{isEnd:!0,endingPosition:i}:{isEnd:!1,endingPosition:this._maximumPositionCalculator.getMaximumAvailablePosition()};this.trigger(\"endingPositionChange\",a)}}this._canceller.isUsed()||null===n&&this._addActivelyLoadedPeriod(t,e)},n.onRepresentationChange=function(e,t){this._addActivelyLoadedPeriod(t,e)},n.onPeriodCleared=function(e,t){this._removeActivelyLoadedPeriod(t,e)},n.onLastSegmentFinishedLoading=function(e){var t=this._lazilyCreateActiveStreamInfo(e);t.hasFinishedLoadingLastPeriod||(t.hasFinishedLoadingLastPeriod=!0,this._checkEndOfStream())},n.onLastSegmentLoadingResume=function(e){var t=this._lazilyCreateActiveStreamInfo(e);t.hasFinishedLoadingLastPeriod&&(t.hasFinishedLoadingLastPeriod=!1,this._checkEndOfStream())},n.dispose=function(){this.removeEventListener(),this._canceller.cancel()},n._addActivelyLoadedPeriod=function(e,t){var n=this._lazilyCreateActiveStreamInfo(t);n.activePeriods.has(e)||(n.activePeriods.add(e),this._checkCurrentPeriod())},n._removeActivelyLoadedPeriod=function(e,t){var n=this._activeStreams.get(t);void 0!==n&&n.activePeriods.has(e)&&(n.activePeriods.removeElement(e),this._checkCurrentPeriod())},n._checkCurrentPeriod=function(){var e=this;if(0!==this._allBufferTypes.length){var t=this._activeStreams.get(this._allBufferTypes[0]);if(void 0!==t)for(var n,r,i=function(){for(var t=r.value,n=!0,i=1;i<e._allBufferTypes.length;i++){var a=e._activeStreams.get(e._allBufferTypes[i]);if(void 0===a)return{v:void 0};if(!a.activePeriods.toArray().some((function(e){return e.id===t.id}))){n=!1;break}}if(n)return e._lastCurrentPeriodId!==t.id&&(e._lastCurrentPeriodId=t.id,e.trigger(\"periodChange\",t)),{v:void 0}},a=ho(t.activePeriods.toArray());!(r=a()).done;)if(n=i())return n.v}},n._getManifestEndTime=function(){var e=this._maximumPositionCalculator.getEndingPosition();return void 0!==e?{isEnd:!0,endingPosition:e}:{isEnd:!1,endingPosition:this._maximumPositionCalculator.getMaximumAvailablePosition()}},n._lazilyCreateActiveStreamInfo=function(e){var t=this._activeStreams.get(e);return void 0===t&&(t={activePeriods:new Fi((function(e,t){return e.start-t.start})),hasFinishedLoadingLastPeriod:!1},this._activeStreams.set(e,t)),t},n._checkEndOfStream=function(){var e=this;this._manifest.isLastPeriodKnown&&(this._allBufferTypes.every((function(t){var n=e._activeStreams.get(t);return void 0!==n&&n.hasFinishedLoadingLastPeriod}))?this.trigger(\"endOfStream\",null):this.trigger(\"resumeStream\",null))},t}(_),go=function(){function e(e){this._manifest=e,this._lastAudioAdaptation=void 0,this._lastVideoAdaptation=void 0}var t=e.prototype;return t.updateLastAudioAdaptation=function(e){this._lastAudioAdaptation=e},t.updateLastVideoAdaptation=function(e){this._lastVideoAdaptation=e},t.getMaximumAvailablePosition=function(){if(this._manifest.isDynamic)return this._manifest.getMaximumSafePosition();if(void 0===this._lastVideoAdaptation||void 0===this._lastAudioAdaptation)return this._manifest.getMaximumSafePosition();if(null===this._lastAudioAdaptation){if(null===this._lastVideoAdaptation)return this._manifest.getMaximumSafePosition();var e=bo(this._lastVideoAdaptation);return\"number\"!=typeof e?this._manifest.getMaximumSafePosition():e}if(null===this._lastVideoAdaptation){var t=bo(this._lastAudioAdaptation);return\"number\"!=typeof t?this._manifest.getMaximumSafePosition():t}var n=bo(this._lastAudioAdaptation),r=bo(this._lastVideoAdaptation);return\"number\"!=typeof n||\"number\"!=typeof r?this._manifest.getMaximumSafePosition():Math.min(n,r)},t.getEndingPosition=function(){var e,t;if(!this._manifest.isDynamic)return this.getMaximumAvailablePosition();if(void 0!==this._lastVideoAdaptation&&void 0!==this._lastAudioAdaptation){if(null===this._lastAudioAdaptation)return null===this._lastVideoAdaptation?void 0:null!==(e=yo(this._lastVideoAdaptation))&&void 0!==e?e:void 0;if(null===this._lastVideoAdaptation)return null!==(t=yo(this._lastAudioAdaptation))&&void 0!==t?t:void 0;var n=yo(this._lastAudioAdaptation),r=yo(this._lastVideoAdaptation);return\"number\"!=typeof n||\"number\"!=typeof r?void 0:Math.min(n,r)}},e}();function bo(e){for(var t,n=e.representations,r=null,i=0;i<n.length;i++)if(n[i].index!==t){t=n[i].index;var a=n[i].index.getLastAvailablePosition();if(void 0===a)return;null!==a&&(r=S(r)?a:Math.min(r,a))}return r}function yo(e){for(var t,n=e.representations,r=null,i=0;i<n.length;i++)if(n[i].index!==t){t=n[i].index;var a=n[i].index.getEnd();if(void 0===a)return;null!==a&&(r=S(r)?a:Math.min(r,a))}return r}var So=[\"\",\"webkit\",\"moz\",\"ms\"];function _o(e,t){return t.filter((function(t){return function(e,t){var n=document.createElement(e.tagName),r=\"on\"+t;return r in n||(n.setAttribute(r,\"return;\"),\"function\"==typeof n[r])}(e,t)}))[0]}function Eo(e,t){var n,r=function(e,t){return e.reduce((function(e,n){return e.concat((void 0===t?So:t).map((function(e){return e+n})))}),[])}(e,t);return function(e,t,i){if(!i.isCancelled()){if(\"undefined\"!=typeof HTMLElement&&e instanceof HTMLElement){if(void 0===n&&(n=_o(e,r)),!Q(n))return void 0;e.addEventListener(n,t),i.register((function(){void 0!==n&&e.removeEventListener(n,t)}))}r.forEach((function(n){var r=!1;\"function\"==typeof e.addEventListener?e.addEventListener(n,t):(r=!0,e[\"on\"+n]=t),i.register((function(){\"function\"==typeof e.removeEventListener&&e.removeEventListener(n,t),r&&delete e[\"on\"+n]}))}))}}}Eo([\"loadedmetadata\"]),Eo([\"timeupdate\"]),Eo([\"addtrack\"]),Eo([\"removetrack\"]);var wo=Eo([\"sourceopen\",\"webkitsourceopen\"]),To=Eo([\"sourceclose\",\"webkitsourceclose\"]),Ao=Eo([\"sourceended\",\"webkitsourceended\"]),Io=Eo([\"update\"]),ko=Eo([\"removesourcebuffer\"]);Eo([\"keymessage\",\"message\"]),Eo([\"keyadded\",\"ready\"]),Eo([\"keyerror\",\"error\"]),Eo([\"keystatuseschange\"]),Eo([\"seeking\"]),Eo([\"seeked\"]),Eo([\"ended\"]);function Ro(e,t){var n=\"undefined\"!=typeof Symbol&&e[Symbol.iterator]||e[\"@@iterator\"];if(n)return(n=n.call(e)).next.bind(n);if(Array.isArray(e)||(n=function(e,t){if(!e)return;if(\"string\"==typeof e)return Po(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);\"Object\"===n&&e.constructor&&(n=e.constructor.name);if(\"Map\"===n||\"Set\"===n)return Array.from(e);if(\"Arguments\"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Po(e,t)}(e))||t&&e&&\"number\"==typeof e.length){n&&(e=n);var r=0;return function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}}}throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\")}function Po(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function xo(e,t){if(T.debug(\"Init: Trying to call endOfStream\"),\"open\"===e.readyState){var n=e.sourceBuffers,r=function(e){for(var t=[],n=0;n<e.length;n++){var r=e[n];r.updating&&t.push(r)}return t}(n);if(0===r.length)return T.info(\"Init: Triggering end of stream\"),void e.endOfStream();T.debug(\"Init: Waiting SourceBuffers to be updated before calling endOfStream.\");var i=new kr;i.linkToSignal(t);for(var a,o=Ro(r);!(a=o()).done;){var s=a.value;Io(s,(function(){i.cancel(),xo(e,t)}),i.signal)}ko(n,(function(){i.cancel(),xo(e,t)}),i.signal)}else T.debug(\"Init: MediaSource not open, cancel endOfStream\")}var Co,Mo,Oo,Do=!1;Ee||(void 0!==we.MSInputMethodContext&&void 0!==document.documentMode?(!0,!0):\"Microsoft Internet Explorer\"===navigator.appName||\"Netscape\"===navigator.appName&&/(Trident|Edge)\\//.test(navigator.userAgent)?!0:-1!==navigator.userAgent.toLowerCase().indexOf(\"edg/\")?!0:-1!==navigator.userAgent.toLowerCase().indexOf(\"firefox\")?!0:\"string\"==typeof navigator.platform&&/iPad|iPhone|iPod/.test(navigator.platform)?!0:(Object.prototype.toString.call(we.HTMLElement).indexOf(\"Constructor\")>=0||\"[object SafariRemoteNotification]\"===(null===(Mo=null===(Co=we.safari)||void 0===Co?void 0:Co.pushNotification)||void 0===Mo?void 0:Mo.toString())||/Safari\\/(\\d+)/.test(navigator.userAgent)&&/Version\\/(\\d+)/.test(navigator.userAgent)&&-1!==(null===(Oo=navigator.vendor)||void 0===Oo?void 0:Oo.indexOf(\"Apple\"))&&!/Chrome\\/(\\d+)/.test(navigator.userAgent)&&!/Chromium\\/(\\d+)/.test(navigator.userAgent))&&!0,/SamsungBrowser/.test(navigator.userAgent)&&!0,-1!==navigator.userAgent.indexOf(\"PlayStation 4\")||(-1!==navigator.userAgent.indexOf(\"PlayStation 5\")?Do=!0:/Tizen/.test(navigator.userAgent)||(/[Ww]eb[O0]S/.test(navigator.userAgent)?(!0,/[Ww]eb[O0]S.TV-2022/.test(navigator.userAgent)||/[Cc]hr[o0]me\\/87/.test(navigator.userAgent)||(/[Ww]eb[O0]S.TV-2021/.test(navigator.userAgent)||/[Cc]hr[o0]me\\/79/.test(navigator.userAgent))):/[Pp]anasonic/.test(navigator.userAgent)||navigator.userAgent.indexOf(\"Xbox\"))));var No=31536e3,Uo=function(){function e(e){this._mediaSource=e,this._currentMediaSourceDurationUpdateCanceller=null}var t=e.prototype;return t.updateDuration=function(e,t){null!==this._currentMediaSourceDurationUpdateCanceller&&this._currentMediaSourceDurationUpdateCanceller.cancel(),this._currentMediaSourceDurationUpdateCanceller=new kr;var n=this._mediaSource,r=this._currentMediaSourceDurationUpdateCanceller.signal,i=function(e,t){var n=new N(\"open\"===e.readyState,t);return wo(e,(function(){T.debug(\"Init: Reacting to MediaSource open in duration updater\"),n.setValueIfChanged(!0)}),t),Ao(e,(function(){T.debug(\"Init: Reacting to MediaSource ended in duration updater\"),n.setValueIfChanged(!1)}),t),To(e,(function(){T.debug(\"Init: Reacting to MediaSource close in duration updater\"),n.setValueIfChanged(!1)}),t),n}(n,r),a=new kr;a.linkToSignal(r),i.onUpdate((function(){if(a.cancel(),!i.getValue())return;(a=new kr).linkToSignal(r);var o=function(e,t){if(0===e.length){var n=new N(!1);return n.finish(),n}var r=new N(!1,t);o();for(var i=function(){var n=e[a];n.addEventListener(\"updatestart\",o),n.addEventListener(\"update\",o),t.register((function(){n.removeEventListener(\"updatestart\",o),n.removeEventListener(\"update\",o)}))},a=0;a<e.length;a++)i();return r;function o(){for(var t=0;t<e.length;t++){if(e[t].updating)return void r.setValueIfChanged(!0)}r.setValueIfChanged(!1)}}(n.sourceBuffers,a.signal),s=new kr;return s.linkToSignal(a.signal),o.onUpdate((function(r){s.cancel(),(s=new kr).linkToSignal(a.signal),r||Fo(n,e,t,s.signal)}),{clearSignal:a.signal,emitCurrentValue:!0})}),{emitCurrentValue:!0,clearSignal:r})},t.stopUpdating=function(){null!==this._currentMediaSourceDurationUpdateCanceller&&(this._currentMediaSourceDurationUpdateCanceller.cancel(),this._currentMediaSourceDurationUpdateCanceller=null)},e}();function Lo(e,t,n){var r=t;n||(r=Do?1/0:Bo(t));for(var i=0,a=0;a<e.sourceBuffers.length;a++){var o=e.sourceBuffers[a],s=o.buffered.length;s>0&&(i=Math.max(o.buffered.end(s-1)))}if(r===e.duration)return\"success\";if(i>r){if(i<e.duration)try{T.info(\"Init: Updating duration to what is currently buffered\",i),e.duration=i}catch(e){return T.warn(\"Duration Updater: Can't update duration on the MediaSource.\",e instanceof Error?e:\"\"),\"failed\"}return\"partial\"}var u=e.duration;try{if(T.info(\"Init: Updating duration\",r),e.duration=r,\"open\"===e.readyState&&!isFinite(r)){var l=Bo(t);T.info(\"Init: calling `mediaSource.setLiveSeekableRange`\",l),e.setLiveSeekableRange(0,l)}}catch(e){return T.warn(\"Duration Updater: Can't update duration on the MediaSource.\",e instanceof Error?e:\"\"),\"failed\"}var d=Math.abs(e.duration-r);return d>=.1?d<Math.abs(e.duration-u)?\"partial\":\"failed\":\"success\"}function Fo(e,t,n,r){if(\"success\"!==Lo(e,t,n))var i=setTimeout((function(){a(),Fo(e,t,n,r)}),2e3),a=r.register((function(){clearTimeout(i)}))}function Bo(e){return Math.max(Math.pow(2,32),e+No)}function zo(e,t){var n=\"undefined\"!=typeof Symbol&&e[Symbol.iterator]||e[\"@@iterator\"];if(n)return(n=n.call(e)).next.bind(n);if(Array.isArray(e)||(n=function(e,t){if(!e)return;if(\"string\"==typeof e)return Wo(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);\"Object\"===n&&e.constructor&&(n=e.constructor.name);if(\"Map\"===n||\"Set\"===n)return Array.from(e);if(\"Arguments\"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Wo(e,t)}(e))||t&&e&&\"number\"==typeof e.length){n&&(e=n);var r=0;return function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}}}throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\")}function Wo(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var Vo=function(e){function t(t){var n;if((n=e.call(this)||this).id=t,n.sourceBuffers=[],n._canceller=new kr,S(Ae))throw new b(\"MEDIA_SOURCE_NOT_SUPPORTED\",\"No MediaSource Object was found in the current browser.\");T.info(\"Init: Creating MediaSource\");var r=new Ae;n.readyState=r.readyState;var i=r.handle;return n.handle=S(i)?{type:\"media-source\",value:r}:{type:\"handle\",value:i},n._mediaSource=r,n._durationUpdater=new Uo(r),n._endOfStreamCanceller=null,wo(r,(function(){n.readyState=r.readyState,n.trigger(\"mediaSourceOpen\",null)}),n._canceller.signal),Ao(r,(function(){n.readyState=r.readyState,n.trigger(\"mediaSourceEnded\",null)}),n._canceller.signal),To(r,(function(){n.readyState=r.readyState,n.trigger(\"mediaSourceClose\",null)}),n._canceller.signal),n}l(t,e);var n=t.prototype;return n.addSourceBuffer=function(e,t){var n=this._mediaSource.addSourceBuffer(t),r=new jo(e,t,n);return this.sourceBuffers.push(r),r},n.setDuration=function(e,t){this._durationUpdater.updateDuration(e,t)},n.interruptDurationSetting=function(){this._durationUpdater.stopUpdating()},n.maintainEndOfStream=function(){var e,t,n;null===this._endOfStreamCanceller&&(this._endOfStreamCanceller=new kr,this._endOfStreamCanceller.linkToSignal(this._canceller.signal),T.debug(\"Init: end-of-stream order received.\"),e=this._mediaSource,t=this._endOfStreamCanceller.signal,(n=new kr).linkToSignal(t),wo(e,(function(){T.debug(\"Init: MediaSource re-opened while end-of-stream is active\"),n.cancel(),(n=new kr).linkToSignal(t),xo(e,n.signal)}),t),xo(e,n.signal))},n.stopEndOfStream=function(){null!==this._endOfStreamCanceller&&(T.debug(\"Init: resume-stream order received.\"),this._endOfStreamCanceller.cancel(),this._endOfStreamCanceller=null)},n.dispose=function(){this.sourceBuffers.forEach((function(e){return e.dispose()})),this._canceller.cancel(),function(e){if(\"closed\"!==e.readyState){for(var t=e.readyState,n=e.sourceBuffers,r=n.length-1;r>=0;r--){var i=n[r];try{if(\"open\"===t){T.info(\"Init: Aborting SourceBuffer before removing\");try{i.abort()}catch(e){}}T.info(\"Init: Removing SourceBuffer from mediaSource\"),e.removeSourceBuffer(i)}catch(e){}}n.length>0&&T.info(\"Init: Not all SourceBuffers could have been removed.\")}}(this._mediaSource)},t}(_),jo=function(){function e(e,t,n){var r=this;this.type=e,this.codec=t,this._canceller=new kr,this._sourceBuffer=n,this._operationQueue=[],this._currentOperations=[];var i=function(e){var t;t=e instanceof Error?e:e.error instanceof Error?e.error:new Error(\"Unknown SourceBuffer Error\");var n=r._currentOperations;if(r._currentOperations=[],0===n.length)T.error(\"SBI: error for an unknown operation\",t);else for(var i,a=new Na(t.name,t.message,\"QuotaExceededError\"===t.name),o=zo(n);!(i=o()).done;){i.value.reject(a)}},a=function(){var e=r._currentOperations;r._currentOperations=[];try{for(var t,n=zo(e);!(t=n()).done;){t.value.resolve(Ki(r._sourceBuffer.buffered))}}catch(t){for(var i,a=zo(e);!(i=a()).done;){var o=i.value;t instanceof Error&&\"InvalidStateError\"===t.name?o.resolve([]):o.reject(t)}}r._performNextOperation()};n.addEventListener(\"error\",i),n.addEventListener(\"updateend\",a),this._canceller.signal.register((function(){n.removeEventListener(\"error\",i),n.removeEventListener(\"updateend\",a)}))}var t=e.prototype;return t.appendBuffer=function(){T.debug(\"SBI: receiving order to push data to the SourceBuffer\",this.type);for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return this._addToQueue({operationName:0,params:t})},t.remove=function(e,t){return T.debug(\"SBI: receiving order to remove data from the SourceBuffer\",this.type,e,t),this._addToQueue({operationName:1,params:[e,t]})},t.getBuffered=function(){try{return Ki(this._sourceBuffer.buffered)}catch(e){return T.error(\"Failed to get buffered time range of SourceBuffer\",this.type,e instanceof Error?e:null),[]}},t.abort=function(){try{this._sourceBuffer.abort()}catch(e){T.debug(\"Init: Failed to abort SourceBuffer:\",e instanceof Error?e:null)}this._emptyCurrentQueue()},t.dispose=function(){try{this._sourceBuffer.abort()}catch(e){}this._emptyCurrentQueue()},t._emptyCurrentQueue=function(){var e=new Pr;this._currentOperations.length>0&&(this._currentOperations.forEach((function(t){t.reject(e)})),this._currentOperations=[]),this._operationQueue.length>0&&(this._operationQueue.forEach((function(t){t.reject(e)})),this._operationQueue=[])},t._addToQueue=function(e){var t=this;return new Promise((function(n,r){var a=0===t._operationQueue.length&&0===t._currentOperations.length,o=i({resolve:n,reject:r},e);t._operationQueue.push(o),a&&t._performNextOperation()}))},t._performNextOperation=function(){var e,t,n,r,i;if(0===this._currentOperations.length&&!this._sourceBuffer.updating){var a=this._operationQueue.shift();if(void 0!==a)if(0===a.operationName){this._currentOperations=[{operationName:0,resolve:a.resolve,reject:a.reject}];var o=a.params[0],s=a.params[1],u=o;if(this._operationQueue.length>0&&0===this._operationQueue[0].operationName){for(var l=[o instanceof ArrayBuffer?new Uint8Array(o):o instanceof Uint8Array?o:new Uint8Array(o.buffer)];0===(null===(e=this._operationQueue[0])||void 0===e?void 0:e.operationName);){var d=this._operationQueue[0],c=null!==(t=s.appendWindow)&&void 0!==t?t:[void 0,void 0],f=null!==(n=d.params[1].appendWindow)&&void 0!==n?n:[void 0,void 0],p=null!==(r=s.timestampOffset)&&void 0!==r?r:0,h=null!==(i=d.params[1].timestampOffset)&&void 0!==i?i:0;if(c[0]!==f[0]||c[1]!==f[1]||s.codec!==d.params[1].codec||p!==h)break;var v=d.params[0],m=void 0;m=v instanceof ArrayBuffer?new Uint8Array(v):v instanceof Uint8Array?v:new Uint8Array(v.buffer),l.push(m),this._operationQueue.splice(0,1),this._currentOperations.push({operationName:0,resolve:d.resolve,reject:d.reject})}l.length>1&&(T.info(\"MMSI: Merging \"+l.length+\" segments together for perf\",this.type),u=xr.apply(void 0,l))}try{this._appendBufferNow(u,s)}catch(e){var g=e instanceof Error?new Na(e.name,e.message,\"QuotaExceededError\"===e.name):new Na(\"Error\",\"Unknown SourceBuffer Error during appendBuffer\",!1);this._currentOperations.forEach((function(e){e.reject(g)})),this._currentOperations=[]}}else{this._currentOperations=[a];var b=a.params,y=b[0],S=b[1];T.debug(\"SBI: removing data from SourceBuffer\",this.type,y,S);try{this._sourceBuffer.remove(y,S)}catch(e){var _=e instanceof Error?new Na(e.name,e.message,!1):new Na(\"Error\",\"Unknown SourceBuffer Error during remove\",!1);a.reject(_),this._currentOperations=[]}}}},t._appendBufferNow=function(e,t){var n=this._sourceBuffer,r=t.codec,i=t.timestampOffset,a=t.appendWindow,o=void 0===a?[]:a;if(void 0!==r&&r!==this.codec){T.debug(\"SBI: updating codec\",r);var s=function(e,t){if(\"function\"==typeof e.changeType){try{e.changeType(t)}catch(e){return T.warn(\"Could not call 'changeType' on the given SourceBuffer:\",e instanceof Error?e:\"\"),!1}return!0}return!1}(n,r);s?this.codec=r:T.debug(\"SBI: could not update codec\",r,this.codec)}if(void 0!==i&&n.timestampOffset!==i){var u=i;T.debug(\"SBI: updating timestampOffset\",r,n.timestampOffset,u),n.timestampOffset=u}if(void 0===o[0])n.appendWindowStart>0&&(T.debug(\"SBI: re-setting `appendWindowStart` to `0`\"),n.appendWindowStart=0);else if(o[0]!==n.appendWindowStart){if(o[0]>=n.appendWindowEnd){var l=o[0]+1;T.debug(\"SBI: pre-updating `appendWindowEnd`\",l),n.appendWindowEnd=l}T.debug(\"SBI: setting `appendWindowStart`\",o[0]),n.appendWindowStart=o[0]}void 0===o[1]?n.appendWindowEnd!==1/0&&(T.debug(\"SBI: re-setting `appendWindowEnd` to `Infinity`\"),n.appendWindowEnd=1/0):o[1]!==n.appendWindowEnd&&(T.debug(\"SBI: setting `appendWindowEnd`\",o[1]),n.appendWindowEnd=o[1]),T.debug(\"SBI: pushing segment\",this.type),n.appendBuffer(e)},e}();function Go(e,t){var n=\"undefined\"!=typeof Symbol&&e[Symbol.iterator]||e[\"@@iterator\"];if(n)return(n=n.call(e)).next.bind(n);if(Array.isArray(e)||(n=function(e,t){if(!e)return;if(\"string\"==typeof e)return Ho(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);\"Object\"===n&&e.constructor&&(n=e.constructor.name);if(\"Map\"===n||\"Set\"===n)return Array.from(e);if(\"Arguments\"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Ho(e,t)}(e))||t&&e&&\"number\"==typeof e.length){n&&(e=n);var r=0;return function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}}}throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\")}function Ho(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var qo=I(),Ko=I(),Yo=1/0,Qo=function(e){function t(t,n,r){var i;(i=e.call(this)||this).id=t,i.sourceBuffers=[],i._canceller=new kr,i.readyState=\"closed\",i._messageSender=r;var a=qo();return i._messageSender({type:\"create-media-source\",contentId:n,mediaSourceId:a}),i}l(t,e);var n=t.prototype;return n.onMediaSourceReadyStateChanged=function(e){switch(e){case\"closed\":this.readyState=\"closed\",this.trigger(\"mediaSourceClose\",null);break;case\"open\":this.readyState=\"open\",this.trigger(\"mediaSourceOpen\",null);break;case\"ended\":this.readyState=\"ended\",this.trigger(\"mediaSourceEnded\",null)}},n.addSourceBuffer=function(e,t){this._messageSender({type:\"add-source-buffer\",mediaSourceId:this.id,value:{sourceBufferType:e,codec:t}});var n=new Xo(e,t,this.id,this._messageSender);return this.sourceBuffers.push(n),n},n.setDuration=function(e,t){this._messageSender({type:\"update-media-source-duration\",mediaSourceId:this.id,value:{duration:e,isRealEndKnown:t}})},n.interruptDurationSetting=function(){this._messageSender({type:\"stop-media-source-duration\",mediaSourceId:this.id,value:null})},n.maintainEndOfStream=function(){this._messageSender({type:\"end-of-stream\",mediaSourceId:this.id,value:null})},n.stopEndOfStream=function(){this._messageSender({type:\"stop-end-of-stream\",mediaSourceId:this.id,value:null})},n.dispose=function(){this.sourceBuffers.forEach((function(e){return e.dispose()})),this._canceller.cancel(),this._messageSender({type:\"dispose-media-source\",mediaSourceId:this.id,value:null})},t}(_),Xo=function(){function e(e,t,n,r){this.type=e,this.codec=t,this._canceller=new kr,this._mediaSourceId=n,this._queuedOperations=[],this._pendingOperations=new Map,this._messageSender=r}var t=e.prototype;return t.onOperationSuccess=function(e,t){var n=this._pendingOperations.get(e);void 0===n?T.warn(\"SBI: unknown SourceBuffer operation succeeded\"):(this._pendingOperations.delete(e),n.resolve(t)),this._performNextQueuedOperationIfItExists()},t.onOperationFailure=function(e,t){var n=\"CancellationError\"===t.errorName?new Pr:new Na(t.errorName,t.message,t.isBufferFull),r=this._pendingOperations.get(e);void 0===r?T.info(\"SBI: unknown SourceBuffer operation failed\",n):(this._pendingOperations.delete(e),r.reject(n));for(var i,a=new Pr,o=Go(this._queuedOperations);!(i=o()).done;){i.value.reject(a)}this._queuedOperations=[]},t.appendBuffer=function(e,t){var n=this;return new Promise((function(r,i){if(n._queuedOperations.length>0||n._pendingOperations.size>=Yo)n._queuedOperations.push({operationName:0,params:[e,t],resolve:r,reject:i});else try{var a;a=e instanceof ArrayBuffer?e:e.byteLength===e.buffer.byteLength?e.buffer:e.buffer.slice(e.byteOffset,e.byteLength+e.byteOffset);var o=Ko();n._messageSender({type:\"source-buffer-append\",mediaSourceId:n._mediaSourceId,sourceBufferType:n.type,operationId:o,value:{data:a,params:t}},[a]),n._addOperationToQueue(o,r,i)}catch(e){i(e)}}))},t.remove=function(e,t){var n=this;return new Promise((function(r,i){if(n._queuedOperations.length>0||n._pendingOperations.size>=Yo)n._queuedOperations.push({operationName:1,params:[e,t],resolve:r,reject:i});else try{var a=Ko();n._messageSender({type:\"source-buffer-remove\",mediaSourceId:n._mediaSourceId,sourceBufferType:n.type,operationId:a,value:{start:e,end:t}}),n._addOperationToQueue(a,r,i)}catch(e){i(e)}}))},t.abort=function(){this._messageSender({type:\"abort-source-buffer\",mediaSourceId:this._mediaSourceId,sourceBufferType:this.type,value:null})},t.dispose=function(){this.abort(),this._canceller.cancel()},t.getBuffered=function(){},t._addOperationToQueue=function(e,t,n){var r=this;this._pendingOperations.set(e,{resolve:function(e){i(),t(e)},reject:function(e){i(),n(e)}});var i=this._canceller.signal.register((function(t){r._pendingOperations.delete(e),n(t)}))},t._performNextQueuedOperationIfItExists=function(){var e=this._queuedOperations.shift();if(void 0!==e)try{if(0===e.operationName){var t,n=e.params,r=n[0],i=n[1];t=r instanceof ArrayBuffer?r:r.byteLength===r.buffer.byteLength?r.buffer:r.buffer.slice(r.byteOffset,r.byteLength+r.byteOffset);var a=Ko();this._messageSender({type:\"source-buffer-append\",mediaSourceId:this._mediaSourceId,sourceBufferType:this.type,operationId:a,value:{data:t,params:i}},[t]),this._addOperationToQueue(a,e.resolve,e.reject)}else{var o=e.params,s=o[0],u=o[1],l=Ko();this._messageSender({type:\"source-buffer-remove\",mediaSourceId:this._mediaSourceId,sourceBufferType:this.type,operationId:l,value:{start:s,end:u}}),this._addOperationToQueue(l,e.resolve,e.reject)}}catch(t){e.reject(t)}},e}();function $o(e){var t=e.map((function(t){return Math.log(t/e[0])})),n=t.map((function(e){return e-t[0]+1})),r=(n[n.length-1]-1)/(2*e.length+10),i=1/r;return e.map((function(e,t){return a(t)}));function a(t){if(0===t)return 0;var o=Math.min(Math.max(1,t),e.length-1);return e[o]===e[o-1]?a(t-1):i*(r+(e[o]*n[o-1]-e[o-1]*n[o])/(e[o]-e[o-1]))+4}}var Zo=function(){function e(e){this._levelsMap=$o(e).map((function(e){return e+4})),this._bitrates=e,this._lastUnsuitableQualityTimestamp=void 0,this._blockRaiseDelay=6e3,T.debug(\"ABR: Steps for buffer based chooser.\",this._levelsMap.map((function(t,n){return\"bufferLevel: \"+t+\", bitrate: \"+e[n]})).join(\" ,\"))}var t=e.prototype;return t.onAddedSegment=function(e){var t=this._levelsMap,n=this._bitrates,r=e.bufferGap,i=e.currentBitrate,a=e.currentScore,o=e.speed;if(S(i))this._currentEstimate=n[0];else{for(var s,u=-1,l=0;l<n.length;l++){var d=n[l];if(d===i)u=l;else if(d>i)break}if(u<0||n.length!==t.length)return T.info(\"ABR: Current Bitrate not found in the calculated levels\"),void(this._currentEstimate=n[0]);void 0!==a&&(s=0===o?a.score:a.score/o);var c=isFinite(r)?r:0,f=L();if(c<t[u]||void 0!==s&&s<1&&1===(null==a?void 0:a.confidenceLevel)){if((void 0===this._lastUnsuitableQualityTimestamp?-1:f-this._lastUnsuitableQualityTimestamp)<this._blockRaiseDelay+9e3){var p=this._blockRaiseDelay+3e3;this._blockRaiseDelay=Math.min(p,15e3),T.debug(\"ABR: Incrementing blocking raise in BufferBasedChooser due to unstable quality\",this._blockRaiseDelay)}else{var h=this._blockRaiseDelay-1e3;this._blockRaiseDelay=Math.max(6e3,h),T.debug(\"ABR: Lowering quality in BufferBasedChooser\",this._blockRaiseDelay)}this._lastUnsuitableQualityTimestamp=f;for(var v=x(n,(function(e){return e===i}))-1;v>=0;v--)if(c>=t[v])return void(this._currentEstimate=n[v]);this._currentEstimate=n[0]}else if(void 0!==this._lastUnsuitableQualityTimestamp&&f-this._lastUnsuitableQualityTimestamp<this._blockRaiseDelay||void 0===s||s<1.15||1!==(null==a?void 0:a.confidenceLevel))this._currentEstimate=i;else{var m=t[u],g=function(){for(var e=u+1;e<t.length;e++)if(t[e]>m)return e}();if(void 0!==g)if(r>=t[g])return T.debug(\"ABR: Raising quality in BufferBasedChooser\",n[g]),void(this._currentEstimate=n[g]);this._currentEstimate=i}}},t.getLastEstimate=function(){return this._currentEstimate},e}(),Jo=function(){function e(e){this._alpha=Math.exp(Math.log(.5)/e),this._lastEstimate=0,this._totalWeight=0}var t=e.prototype;return t.addSample=function(e,t){var n=Math.pow(this._alpha,e),r=t*(1-n)+n*this._lastEstimate;isNaN(r)||(this._lastEstimate=r,this._totalWeight+=e)},t.getEstimate=function(){var e=1-Math.pow(this._alpha,this._totalWeight);return this._lastEstimate/e},e}();function es(e){if(!(e.progress.length<5)){for(var t=new Jo(2),n=e.progress,r=1;r<n.length;r++){var i=n[r].size-n[r-1].size,a=n[r].timestamp-n[r-1].timestamp,o=8*i/(a/1e3);t.addSample(a/1e3,o)}return t.getEstimate()}}function ts(e,t){var n=8*(e.totalSize-e.size);return Math.max(n/t,0)}var ns=function(){function e(e,t){var n=s.getCurrent(),r=n.ABR_STARVATION_GAP,i=n.OUT_OF_STARVATION_GAP,a=n.ABR_STARVATION_FACTOR,o=n.ABR_REGULAR_FACTOR;this._initialBitrate=e,this._inStarvationMode=!1,this._lowLatencyMode=t,this._config=t?{starvationGap:r.LOW_LATENCY,outOfStarvationGap:i.LOW_LATENCY,starvationBitrateFactor:a.LOW_LATENCY,regularBitrateFactor:o.LOW_LATENCY}:{starvationGap:r.DEFAULT,outOfStarvationGap:i.DEFAULT,starvationBitrateFactor:a.DEFAULT,regularBitrateFactor:o.DEFAULT}}var t=e.prototype;return t.getBandwidthEstimate=function(e,t,n,r,i){var a,o,u=this._config,l=e.bufferGap,d=e.position,c=e.duration,f=isFinite(l)?l:0,p=s.getCurrent().ABR_STARVATION_DURATION_DELTA;return isNaN(c)||f+d.getWanted()<c-p?!this._inStarvationMode&&f<=u.starvationGap?(T.info(\"ABR: enter starvation mode.\"),this._inStarvationMode=!0):this._inStarvationMode&&f>=u.outOfStarvationGap&&(T.info(\"ABR: exit starvation mode.\"),this._inStarvationMode=!1):this._inStarvationMode&&(T.info(\"ABR: exit starvation mode.\"),this._inStarvationMode=!1),this._inStarvationMode&&(o=function(e,t,n,r,i){if(!r){var a=t.bufferGap,o=t.speed,s=t.position,u=isFinite(a)?a:0,l=function(e,t){for(var n=-1,r=0;r<e.length;r++){var i=e[r].content.segment;if(!(i.duration<=0)){var a=i.time+i.duration;if(!i.complete&&r===e.length-1&&t-i.time>-1.2){n=r;break}if(a>t&&t-i.time>-1.2){n=r;break}}}if(n<0)return[];for(var o=e[n],s=o.content.segment.time,u=[o],l=n+1;l<e.length&&e[l].content.segment.time===s;l++)u.push(e[l]);return u}(e,s.getWanted()+u);if(1===l.length){var d=l[0],c=L(),f=1.5*d.content.segment.duration;if(f=Math.min(f,3e3),f=Math.max(f,12e3),!(c-d.requestTimestamp<f)){var p=d.progress.length>0?d.progress[d.progress.length-1]:void 0,h=es(d);if(void 0!==p&&void 0!==h){var v=ts(p,h);if((c-p.timestamp)/1e3<=v&&v-u/o>2500)return h}if(d.content.segment.complete){var m=d.content.segment.duration,g=(c-d.requestTimestamp)/1e3,b=g<=(1.5*m+2)/o;if(!S(n)&&!b){var y=m/g,_=n.bitrate*Math.min(.7,y);return void 0===i||_<i?_:void 0}}}}}}(r,e,n,this._lowLatencyMode,i),void 0!==o&&(T.info(\"ABR: starvation mode emergency estimate:\",o),t.reset(),a=S(n)?o:Math.min(o,n.bitrate))),S(a)&&(a=void 0!==(o=t.getEstimate())?o*(this._inStarvationMode?u.starvationBitrateFactor:u.regularBitrateFactor):void 0!==i?i*(this._inStarvationMode?u.starvationBitrateFactor:u.regularBitrateFactor):this._initialBitrate),e.speed>1&&(a/=e.speed),{bandwidthEstimate:o,bitrateChosen:a}},t.isUrgent=function(e,t,n,r){return null===t||!(e>=t.bitrate)&&function(e,t,n){if(n)return!0;var r=isFinite(e.bufferGap)?e.bufferGap:0,i=e.position.getWanted()+r,a=A(t,(function(e){var t=e.content;return t.segment.duration>0&&t.segment.time+t.segment.duration>i}));if(void 0===a)return!0;var o=L(),s=a.progress.length>0?a.progress[a.progress.length-1]:void 0,u=es(a);if(void 0===s||void 0===u)return!0;var l=ts(s,u);return(o-s.timestamp)/1e3>1.2*l||l-r/e.speed>-1.5}(r,n,this._lowLatencyMode)},e}();function rs(e,t){var n=\"undefined\"!=typeof Symbol&&e[Symbol.iterator]||e[\"@@iterator\"];if(n)return(n=n.call(e)).next.bind(n);if(Array.isArray(e)||(n=function(e,t){if(!e)return;if(\"string\"==typeof e)return is(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);\"Object\"===n&&e.constructor&&(n=e.constructor.name);if(\"Map\"===n||\"Set\"===n)return Array.from(e);if(\"Arguments\"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return is(e,t)}(e))||t&&e&&\"number\"==typeof e.length){n&&(e=n);var r=0;return function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}}}throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\")}function is(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var as=function(){function e(e,t){this._scoreCalculator=e,this._lastAbrEstimate=t,this._consecutiveWrongGuesses=0,this._blockGuessesUntil=0,this._lastMaintanableBitrate=null}var t=e.prototype;return t.getGuess=function(e,t,n,r,i){var a=t.bufferGap,o=t.speed,s=this._lastAbrEstimate.representation;if(null===s)return null;if(r>s.bitrate)return 2===this._lastAbrEstimate.algorithmType&&(null!==this._lastAbrEstimate.representation&&(this._lastMaintanableBitrate=this._lastAbrEstimate.representation.bitrate),this._consecutiveWrongGuesses=0),null;var u=this._scoreCalculator.getEstimate(n);if(2!==this._lastAbrEstimate.algorithmType){if(void 0===u)return null;if(this._canGuessHigher(a,o,u)){var l=os(e,n);if(null!==l)return l}return null}if(this._isLastGuessValidated(s,r,u)&&(T.debug(\"ABR: Guessed Representation validated\",s.bitrate),this._lastMaintanableBitrate=s.bitrate,this._consecutiveWrongGuesses=0),n.id!==s.id)return s;if(this._shouldStopGuess(n,u,a,i))return this._consecutiveWrongGuesses++,this._blockGuessesUntil=L()+Math.min(15e3*this._consecutiveWrongGuesses,12e4),function(e,t){var n=x(e,(function(e){return e.id===t.id}));if(n<0)return T.error(\"ABR: Current Representation not found.\"),null;for(;--n>=0;)if(e[n].bitrate<t.bitrate)return e[n];return null}(e,n);if(void 0===u)return n;if(this._canGuessHigher(a,o,u)){var d=os(e,n);if(null!==d)return d}return n},t._canGuessHigher=function(e,t,n){var r=n.score,i=n.confidenceLevel;return isFinite(e)&&e>=2.5&&L()>this._blockGuessesUntil&&1===i&&r/t>1.01},t._shouldStopGuess=function(e,t,n,r){if(void 0!==t&&t.score<1.01)return!0;if((void 0===t||t.score<1.2)&&n<.6)return!0;for(var i,a=r.filter((function(t){return t.content.representation.id===e.id})),o=L(),s=rs(a);!(i=s()).done;){var u=i.value,l=o-u.requestTimestamp;if(u.content.segment.isInit){if(l>1e3)return!0}else{if(l>1e3*u.content.segment.duration+200)return!0;var d=es(u);if(void 0!==d&&d<.8*e.bitrate)return!0}}return!1},t._isLastGuessValidated=function(e,t,n){return void 0!==n&&1===n.confidenceLevel&&n.score>1.5||t>=e.bitrate&&(null===this._lastMaintanableBitrate||this._lastMaintanableBitrate<e.bitrate)},e}();function os(e,t){var n=e.length,r=x(e,(function(e){return e.id===t.id}));if(r<0)return T.error(\"ABR: Current Representation not found.\"),null;for(;++r<n;)if(e[r].bitrate>t.bitrate)return e[r];return null}var ss=function(){function e(){var e=s.getCurrent(),t=e.ABR_FAST_EMA,n=e.ABR_SLOW_EMA;this._fastEWMA=new Jo(t),this._slowEWMA=new Jo(n),this._bytesSampled=0}var t=e.prototype;return t.addSample=function(e,t){if(!(t<s.getCurrent().ABR_MINIMUM_CHUNK_SIZE)){var n=8e3*t/e,r=e/1e3;this._bytesSampled+=t,this._fastEWMA.addSample(r,n),this._slowEWMA.addSample(r,n)}},t.getEstimate=function(){var e=s.getCurrent().ABR_MINIMUM_TOTAL_BYTES;if(!(this._bytesSampled<e))return Math.min(this._fastEWMA.getEstimate(),this._slowEWMA.getEstimate())},t.reset=function(){var e=s.getCurrent(),t=e.ABR_FAST_EMA,n=e.ABR_SLOW_EMA;this._fastEWMA=new Jo(t),this._slowEWMA=new Jo(n),this._bytesSampled=0},e}();var us=function(){function e(){this.bandwidth=void 0,this.representation=null,this.algorithmType=3}return e.prototype.update=function(e,t,n){this.representation=e,this.bandwidth=t,this.algorithmType=n},e}(),ls=function(){function e(){this._currentRequests={}}var t=e.prototype;return t.add=function(e){var t=e.id,n=e.requestTimestamp,r=e.content;this._currentRequests[t]={requestTimestamp:n,progress:[],content:r}},t.addProgress=function(e){var t=this._currentRequests[e.id];S(t)?T.warn(\"ABR: progress for a request not added\"):t.progress.push(e)},t.remove=function(e){S(this._currentRequests[e])&&T.warn(\"ABR: can't remove unknown request\"),delete this._currentRequests[e]},t.getRequests=function(){return B(this._currentRequests).filter((function(e){return!S(e)})).sort((function(e,t){return e.content.segment.time-t.content.segment.time}))},e}(),ds=function(){function e(){this._currentRepresentationData=null,this._lastRepresentationWithGoodScore=null}var t=e.prototype;return t.addSample=function(e,t,n){var r,i=n/t,a=this._currentRepresentationData;null!==a&&a.representation.id===e.id?(r=a.ewma,a.ewma.addSample(t,i),a.loadedDuration+=n,a.loadedSegments++):((r=new Jo(5)).addSample(t,i),this._currentRepresentationData={representation:e,ewma:r,loadedDuration:n,loadedSegments:0}),r.getEstimate()>1&&this._lastRepresentationWithGoodScore!==e&&(T.debug(\"ABR: New last stable representation\",e.bitrate),this._lastRepresentationWithGoodScore=e)},t.getEstimate=function(e){if(null!==this._currentRepresentationData&&this._currentRepresentationData.representation.id===e.id){var t=this._currentRepresentationData,n=t.ewma,r=t.loadedSegments,i=t.loadedDuration;return{score:n.getEstimate(),confidenceLevel:r>=5&&i>=10?1:0}}},t.getLastStableRepresentation=function(){return this._lastRepresentationWithGoodScore},e}();function cs(e,t){var n=x(e,(function(e){return e.bitrate>t}));return-1===n?e[e.length-1]:0===n?e[0]:e[n-1]}var fs=new N(void 0);fs.finish();var ps=new N(1/0);ps.finish();var hs=function(e){var t={},n=e.initialBitrates,r=e.throttlers,i=e.lowLatencyMode;return function(e,a,o,u,l){var d,c,f,p=e.adaptation.type,h=function(e){var n=t[e];if(S(n)){T.debug(\"ABR: Creating new BandwidthEstimator for \",e);var r=new ss;return t[e]=r,r}return n}(p),v=null!==(d=n[p])&&void 0!==d?d:0;return function(e,t){var n=e.bandwidthEstimator,r=e.context,i=e.currentRepresentation,a=e.filters,o=e.initialBitrate,u=e.lowLatencyMode,l=e.playbackObserver,d=e.representations,c=new ds,f=new ns(null!=o?o:0,u),p=new ls,h=E,v={metrics:S,requestBegin:_,requestProgress:w,requestEnd:I,addedSegment:function(e){h(e)}},m=new kr;m.linkToSignal(t);var g=b(d.getValue(),m.signal);return d.onUpdate(y,{clearSignal:t}),{estimates:g,callbacks:v};function b(e,t){if(e.length<=1)return new N({bitrate:void 0,representation:e[0],urgent:!0,knownStableBitrate:void 0});var o=!1,d=e.sort((function(e,t){return e.bitrate-t.bitrate})),v=new Zo(d.map((function(e){return e.bitrate}))),m=new us,g=new as(c,m),b=l.getReference().getValue(),y=new N(_());return l.listen((function(e){b=e,S()}),{includeLastObservation:!1,clearSignal:t}),h=function(e){if(null!==b){var t=b,n=t.position,r=t.speed,i=Xi(e.buffered,n.getWanted()),a=e.content.representation,o=c.getEstimate(a),s={bufferGap:i,currentBitrate:a.bitrate,currentScore:o,speed:r};v.onAddedSegment(s),S()}},t.register((function(){h=E})),a.throttleBitrate.onUpdate(S,{clearSignal:t}),a.limitResolution.onUpdate(S,{clearSignal:t}),y;function S(){y.setValue(_())}function _(){var e=b,t=e.bufferGap,l=e.position,h=e.maximumPosition,y=a.limitResolution.getValue(),S=a.throttleBitrate.getValue(),_=i.getValue(),E=function(e,t,n){var r=e;void 0!==n&&n<1/0&&(r=function(e,t){if(0===e.length)return[];e.sort((function(e,t){return e.bitrate-t.bitrate}));var n=e[0].bitrate,r=Math.max(t,n),i=x(e,(function(e){return e.bitrate>r}));return-1===i?e:e.slice(0,i)}(r,n));void 0!==t&&(r=function(e,t){if(void 0===t.width||void 0===t.height)return e;var n=t.width*t.pixelRatio,r=t.height*t.pixelRatio,i=e.slice().sort((function(e,t){var n,r;return(null!==(n=e.width)&&void 0!==n?n:0)-(null!==(r=t.width)&&void 0!==r?r:0)})),a=A(i,(function(e){return\"number\"==typeof e.width&&e.width>=n&&\"number\"==typeof e.height&&e.height>=r}));if(void 0===a)return e;var o=\"number\"==typeof a.width?a.width:0;return e.filter((function(e){return\"number\"!=typeof e.width||e.width<=o}))}(r,t));return r}(d,y,S),w=p.getRequests(),I=f.getBandwidthEstimate(b,n,_,w,m.bandwidth),k=I.bandwidthEstimate,R=I.bitrateChosen,P=c.getLastStableRepresentation(),C=null===P?void 0:P.bitrate/(b.speed>0?b.speed:1),M=s.getCurrent(),O=M.ABR_ENTER_BUFFER_BASED_ALGO,D=M.ABR_EXIT_BUFFER_BASED_ALGO;o&&t<=D?o=!1:!o&&isFinite(t)&&t>=O&&(o=!0);var N=cs(E,R),U=v.getLastEstimate(),L=N.bitrate,F=null;o&&void 0!==U&&U>L&&(L=(F=cs(E,U)).bitrate);var B=null;return u&&null!==_&&r.manifest.isDynamic&&h-l.getWanted()<40&&(B=g.getGuess(d,b,_,L,w)),null!==B&&B.bitrate>L?(T.debug(\"ABR: Choosing representation with guess-based estimation.\",B.bitrate,B.id),m.update(B,k,2),{bitrate:k,representation:B,urgent:null===_||B.bitrate<_.bitrate,knownStableBitrate:C}):null!==F?(T.debug(\"ABR: Choosing representation with buffer-based estimation.\",F.bitrate,F.id),m.update(F,k,0),{bitrate:k,representation:F,urgent:f.isUrgent(F.bitrate,_,w,b),knownStableBitrate:C}):(T.debug(\"ABR: Choosing representation with bandwidth estimation.\",N.bitrate,N.id),m.update(N,k,1),{bitrate:k,representation:N,urgent:f.isUrgent(N.bitrate,_,w,b),knownStableBitrate:C})}}function y(){var e=d.getValue();m.cancel(),(m=new kr).linkToSignal(t),b(e,m.signal).onUpdate((function(e){g.setValue(e)}),{clearSignal:m.signal,emitCurrentValue:!0})}function S(e){var t=e.requestDuration,r=e.segmentDuration,i=e.size,a=e.content;if(n.addSample(t,i),!a.segment.isInit){var o=a.segment,s=a.representation;if(void 0===r&&!o.complete)return;var u=null!=r?r:o.duration;c.addSample(s,t/1e3,u)}}function _(e){p.add(e)}function w(e){p.addProgress(e)}function I(e){p.remove(e.id)}}({bandwidthEstimator:h,context:e,currentRepresentation:a,filters:{limitResolution:null!==(c=r.limitResolution[p])&&void 0!==c?c:fs,throttleBitrate:null!==(f=r.throttleBitrate[p])&&void 0!==f?f:ps},initialBitrate:v,playbackObserver:u,representations:o,lowLatencyMode:i},l)}};function vs(e){return e instanceof f?new Pt(\"PIPELINE_LOAD_ERROR\",e):Sr(e,{defaultCode:\"PIPELINE_LOAD_ERROR\",defaultReason:\"Unknown error when fetching the Manifest\"})}var ms=.3;function gs(e,t,n,r,i){return bs.apply(this,arguments)}function bs(){return bs=qn(Yn().mark((function e(t,n,r,i,a){var o,s,u,l,d,c,p,v,m,g,b,y,S;return Yn().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(S=function(e){var t;if(0===d.size)return e[0];var n=L();return null===(t=e.filter((function(e){var t;return!0!==(null===(t=d.get(e))||void 0===t?void 0:t.isBlacklisted)})).reduce((function(e,t){var r,i=null===(r=d.get(t))||void 0===r?void 0:r.blockedUntil;return void 0!==i&&i<=n&&(i=void 0),void 0===e?[t,i]:void 0===e[1]?e:void 0===i?[t,void 0]:i<e[1]?[t,i]:e}),void 0))||void 0===t?void 0:t[0]},y=function(e,t){var r=d.get(e);if(void 0===r||void 0===r.blockedUntil)return v(e);var i=L(),o=r.blockedUntil-i;if(o<=0)return v(e);var s=new kr,u=s.linkToSignal(a);return new Promise((function(r,i){function l(e){u(),r(e)}function d(e){u(),i(e)}null==n||n.addEventListener(\"priorityChange\",(function(){var n=p();if(a.isCancelled())throw a.cancellationError;if(void 0===n)return d(t);n!==e&&(s.cancel(),y(n,t).then(l,d))}),s.signal),ka(o,s.signal).then((function(){return v(e).then(l,d)}),E)}))},b=function(){return(b=qn(Yn().mark((function e(t){var n;return Yn().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(n=p(),!a.isCancelled()){e.next=3;break}throw a.cancellationError;case 3:if(void 0!==n){e.next=5;break}throw t;case 5:if(l(t),!a.isCancelled()){e.next=8;break}throw a.cancellationError;case 8:return e.abrupt(\"return\",y(n,t));case 9:case\"end\":return e.stop()}}),e)})))).apply(this,arguments)},g=function(e){return b.apply(this,arguments)},m=function(){return(m=qn(Yn().mark((function e(t){var i,l,c,p,v;return Yn().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,r(t,a);case 3:return i=e.sent,e.abrupt(\"return\",i);case 7:if(e.prev=7,e.t0=e.catch(0),!kr.isCancellationError(e.t0)){e.next=11;break}throw e.t0;case 11:if(null!==t&&null!==n&&n.downgradeCdn(t),void 0===(l=d.get(t))?(l={errorCounter:1,blockedUntil:void 0,isBlacklisted:!1},d.set(t,l)):l.errorCounter++,(m=e.t0)instanceof f?m.type===h.ERROR_HTTP_CODE?m.status>=500||404===m.status||415===m.status||412===m.status:m.type===h.TIMEOUT||m.type===h.ERROR_EVENT:m instanceof mr?\"boolean\"==typeof m.canRetry?m.canRetry:void 0!==m.xhr&&(m.xhr.status>=500||404===m.xhr.status||415===m.xhr.status||412===m.xhr.status):yr(m)&&\"INTEGRITY_ERROR\"===m.code){e.next=18;break}return l.blockedUntil=void 0,l.isBlacklisted=!0,e.abrupt(\"return\",g(e.t0));case 18:return l.errorCounter>u?(l.blockedUntil=void 0,l.isBlacklisted=!0):(c=l.errorCounter,p=Math.min(o*Math.pow(2,c-1),s),v=p*((2*Math.random()-1)*ms+1),l.blockedUntil=L()+v),e.abrupt(\"return\",g(e.t0));case 20:case\"end\":return e.stop()}var m}),e,null,[[0,7]])})))).apply(this,arguments)},v=function(e){return m.apply(this,arguments)},p=function(){if(null===t){var e=d.get(null);if(void 0!==e&&e.isBlacklisted)return;return null}if(null===n)return S(t);var r=n.getCdnPreferenceForResource(t);return S(r)},null===a.cancellationError){e.next=9;break}return e.abrupt(\"return\",Promise.reject(a.cancellationError));case 9:if(o=i.baseDelay,s=i.maxDelay,u=i.maxRetry,l=i.onRetry,null!==t&&0===t.length&&T.warn(\"Fetchers: no CDN given to `scheduleRequestWithCdns`.\"),d=new Map,void 0!==(c=p())){e.next=15;break}throw new Error(\"No CDN to request\");case 15:return e.abrupt(\"return\",v(c));case 16:case\"end\":return e.stop()}}),e)}))),bs.apply(this,arguments)}function ys(e,t,n){return gs(null,null,e,t,n)}function Ss(e,t){var n=\"undefined\"!=typeof Symbol&&e[Symbol.iterator]||e[\"@@iterator\"];if(n)return(n=n.call(e)).next.bind(n);if(Array.isArray(e)||(n=function(e,t){if(!e)return;if(\"string\"==typeof e)return _s(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);\"Object\"===n&&e.constructor&&(n=e.constructor.name);if(\"Map\"===n||\"Set\"===n)return Array.from(e);if(\"Arguments\"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _s(e,t)}(e))||t&&e&&\"number\"==typeof e.length){n&&(e=n);var r=0;return function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}}}throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\")}function _s(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var Es=function(e){function t(t,n,r){var i;return(i=e.call(this)||this).scheduleManualRefresh=E,i._manifestUrls=t,i._pipelines=n.manifest,i._settings=r,i._canceller=new kr,i._isStarted=!1,i._isRefreshPending=!1,i._consecutiveUnsafeMode=0,i._prioritizedContentUrl=null,i}l(t,e);var n=t.prototype;return n.dispose=function(){this._canceller.cancel(),this.removeEventListener()},n.start=function(){var e=this;if(!this._isStarted){this._isStarted=!0;var t=this._settings.initialManifest;(t instanceof Se?Promise.resolve({manifest:t}):void 0!==t?this.parse(t,{previousManifest:null,unsafeMode:!1},void 0):this._fetchManifest(void 0).then((function(e){return e.parse({previousManifest:null,unsafeMode:!1})}))).then((function(t){e.trigger(\"manifestReady\",t.manifest),e._canceller.isUsed()||e._recursivelyRefreshManifest(t.manifest,t)})).catch((function(t){return e._onFatalError(t)}))}},n.updateContentUrls=function(e,t){var n;this._prioritizedContentUrl=null!==(n=null==e?void 0:e[0])&&void 0!==n?n:void 0,t&&this.scheduleManualRefresh({enablePartialRefresh:!1,delay:0,canUseUnsafeMode:!1})},n._fetchManifest=function(){var e=qn(Yn().mark((function e(t){var n,r,i,a,o,u,l,d,c=this;return Yn().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return d=function(e){var t=a.loadManifest,n=void 0===i.requestTimeout?s.getCurrent().DEFAULT_REQUEST_TIMEOUT:i.requestTimeout,o=void 0===i.connectionTimeout?s.getCurrent().DEFAULT_CONNECTION_TIMEOUT:i.connectionTimeout;n<0&&(n=void 0),o<0&&(o=void 0);return ys((function(){return t(e,{timeout:n,connectionTimeout:o},r)}),u,r)},r=this._canceller.signal,i=this._settings,a=this._pipelines,o=null!=t?t:null===(n=this._manifestUrls)||void 0===n?void 0:n[0],u=this._getBackoffSetting((function(e){c.trigger(\"warning\",vs(e))})),e.prev=6,e.next=9,d(o);case 9:return l=e.sent,e.abrupt(\"return\",{parse:function(e){return c._parseLoadedManifest(l,e,o)}});case 13:throw e.prev=13,e.t0=e.catch(6),vs(e.t0);case 16:case\"end\":return e.stop()}}),e,this,[[6,13]])})));return function(t){return e.apply(this,arguments)}}(),n.parse=function(e,t,n){return this._parseLoadedManifest({responseData:e,size:void 0,requestDuration:void 0},t,n)},n._parseLoadedManifest=function(){var e=qn(Yn().mark((function e(t,n,r){var i,a,o,s,u,l,d,c,f,p,h,v,m,g,b,y,S,_=this;return Yn().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(S=function(e,t){y(t);var n=L()-a;return T.info(\"MF: Manifest parsed in \"+n+\"ms\"),{manifest:e,sendingTime:u,receivedTime:l,parsingTime:n}},y=function(e){for(var t,n=Ss(e);!(t=n()).done;){var r=t.value;if(o.isCancelled())return;var i=Sr(r,{defaultCode:\"PIPELINE_PARSE_ERROR\",defaultReason:\"Unknown error when parsing the Manifest\"});s(\"warning\",i)}},b=function(){return(b=qn(Yn().mark((function e(t){var n;return Yn().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,ys(t,d,o);case 3:return n=e.sent,e.abrupt(\"return\",n);case 7:throw e.prev=7,e.t0=e.catch(0),vs(e.t0);case 10:case\"end\":return e.stop()}}),e,null,[[0,7]])})))).apply(this,arguments)},g=function(e){return b.apply(this,arguments)},a=L(),o=this._canceller.signal,s=this.trigger.bind(this),u=t.sendingTime,l=t.receivedTime,d=this._getBackoffSetting((function(e){_.trigger(\"warning\",vs(e))})),c=null!=r?r:null===(i=this._manifestUrls)||void 0===i?void 0:i[0],f={externalClockOffset:n.externalClockOffset,unsafeMode:n.unsafeMode,previousManifest:n.previousManifest,originalUrl:c},e.prev=11,p=this._pipelines.parseManifest(t,f,y,o,g),p instanceof Promise){e.next=17;break}return e.abrupt(\"return\",S(p.manifest,p.warnings));case 17:return e.next=19,p;case 19:return h=e.sent,v=h.manifest,m=h.warnings,e.abrupt(\"return\",S(v,m));case 23:e.next=29;break;case 25:throw e.prev=25,e.t0=e.catch(11),Sr(e.t0,{defaultCode:\"PIPELINE_PARSE_ERROR\",defaultReason:\"Unknown error when parsing the Manifest\"});case 29:case\"end\":return e.stop()}}),e,this,[[11,25]])})));return function(t,n,r){return e.apply(this,arguments)}}(),n._getBackoffSetting=function(e){var t=s.getCurrent(),n=t.DEFAULT_MAX_MANIFEST_REQUEST_RETRY,r=t.INITIAL_BACKOFF_DELAY_BASE,i=t.MAX_BACKOFF_DELAY_BASE,a=this._settings,o=a.lowLatencyMode,u=a.maxRetry;return{onRetry:e,baseDelay:o?r.LOW_LATENCY:r.REGULAR,maxDelay:o?i.LOW_LATENCY:i.REGULAR,maxRetry:null!=u?u:n}},n._recursivelyRefreshManifest=function(e,t){var n=this,r=t.sendingTime,i=t.parsingTime,a=t.updatingTime,o=s.getCurrent(),u=o.MAX_CONSECUTIVE_MANIFEST_PARSING_IN_UNSAFE_MODE,l=o.MIN_MANIFEST_PARSING_TIME_TO_ENTER_UNSAFE_MODE,d=void 0!==i?i+(null!=a?a:0):void 0,c=!1;this._consecutiveUnsafeMode>0?c=this._consecutiveUnsafeMode<u:void 0!==d&&(c=d>=l);var f=void 0===r?0:L()-r,p=Math.max(this._settings.minimumManifestUpdateInterval-f,0),h=new kr;if(h.linkToSignal(this._canceller.signal),this.scheduleManualRefresh=function(t){var i=t.enablePartialRefresh,a=t.delay,o=t.canUseUnsafeMode&&c,s=void 0===r?0:L()-r,u=Math.max(n._settings.minimumManifestUpdateInterval-s,0),l=setTimeout((function(){h.cancel(),n._triggerNextManifestRefresh(e,{enablePartialRefresh:i,unsafeMode:o})}),Math.max((null!=a?a:0)-s,u));h.signal.register((function(){clearTimeout(l)}))},null!==e.expired){var v=setTimeout((function(){var t;null===(t=e.expired)||void 0===t||t.then((function(){h.cancel(),n._triggerNextManifestRefresh(e,{enablePartialRefresh:!1,unsafeMode:c})}),E)}),p);h.signal.register((function(){clearTimeout(v)}))}if(void 0!==e.lifetime&&e.lifetime>=0){var m,g=1e3*e.lifetime-f;void 0===d?m=g:e.lifetime<3&&d>=100?(m=Math.min(Math.max(3e3-f,Math.max(g,0)+d),6*g),T.info(\"MUS: Manifest update rythm is too frequent. Postponing next request.\",g,m)):d>=1e3*e.lifetime/10?(m=Math.min(Math.max(g,0)+d,6*g),T.info(\"MUS: Manifest took too long to parse. Postponing next request\",m,m)):m=g;var b=setTimeout((function(){h.cancel(),n._triggerNextManifestRefresh(e,{enablePartialRefresh:!1,unsafeMode:c})}),Math.max(m,p));h.signal.register((function(){clearTimeout(b)}))}},n._triggerNextManifestRefresh=function(e,t){var n,r,i=this,a=t.enablePartialRefresh,o=t.unsafeMode,u=e.updateUrl;null!==this._prioritizedContentUrl?(n=!0,r=this._prioritizedContentUrl,this._prioritizedContentUrl=null):r=(n=!a||void 0===u)?e.getUrls()[0]:u;var l=e.clockOffset;o?(this._consecutiveUnsafeMode+=1,T.info('Init: Refreshing the Manifest in \"unsafeMode\" for the '+String(this._consecutiveUnsafeMode)+\" consecutive time.\")):this._consecutiveUnsafeMode>0&&(T.info('Init: Not parsing the Manifest in \"unsafeMode\" anymore after '+String(this._consecutiveUnsafeMode)+\" consecutive times.\"),this._consecutiveUnsafeMode=0),this._isRefreshPending||(this._isRefreshPending=!0,this._fetchManifest(r).then((function(t){return t.parse({externalClockOffset:l,previousManifest:e,unsafeMode:o})})).then((function(t){i._isRefreshPending=!1;var r=t.manifest,a=t.sendingTime,o=t.parsingTime,u=L();if(n)e.replace(r);else try{e.update(r)}catch(t){var l=t instanceof Error?t.message:\"unknown error\";T.warn(\"MUS: Attempt to update Manifest failed: \"+l,\"Re-downloading the Manifest fully\");var d=s.getCurrent().FAILED_PARTIAL_UPDATE_MANIFEST_REFRESH_DELAY,c=void 0===a?0:L()-a,f=Math.max(i._settings.minimumManifestUpdateInterval-c,0),p=E,h=setTimeout((function(){p(),i._triggerNextManifestRefresh(e,{enablePartialRefresh:!1,unsafeMode:!1})}),Math.max(d-c,f));return void(p=i._canceller.signal.register((function(){clearTimeout(h)})))}var v=L()-u;i._recursivelyRefreshManifest(e,{sendingTime:a,parsingTime:o,updatingTime:v})})).catch((function(e){i._isRefreshPending=!1,i._onFatalError(e)})))},n._onFatalError=function(e){this._canceller.isUsed()||(this.trigger(\"error\",e),this.dispose())},t}(_);var ws=Es;function Ts(e,t){var n=\"undefined\"!=typeof Symbol&&e[Symbol.iterator]||e[\"@@iterator\"];if(n)return(n=n.call(e)).next.bind(n);if(Array.isArray(e)||(n=function(e,t){if(!e)return;if(\"string\"==typeof e)return As(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);\"Object\"===n&&e.constructor&&(n=e.constructor.name);if(\"Map\"===n||\"Set\"===n)return Array.from(e);if(\"Arguments\"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return As(e,t)}(e))||t&&e&&\"number\"==typeof e.length){n&&(e=n);var r=0;return function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}}}throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\")}function As(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var Is=function(e){function t(t){var n;return(n=e.call(this)||this)._downgradedCdnList={metadata:[],timeouts:[]},t.register((function(){for(var e,t=Ts(n._downgradedCdnList.timeouts);!(e=t()).done;){var r=e.value;clearTimeout(r)}n._downgradedCdnList={metadata:[],timeouts:[]}})),n}l(t,e);var n=t.prototype;return n.getCdnPreferenceForResource=function(e){return e.length<=1?e:this._innerGetCdnPreferenceForResource(e)},n.downgradeCdn=function(e){var t=this,n=ks(this._downgradedCdnList.metadata,e);n>=0&&this._removeIndexFromDowngradeList(n);var r=s.getCurrent().DEFAULT_CDN_DOWNGRADE_TIME;this._downgradedCdnList.metadata.push(e);var i=setTimeout((function(){var n=ks(t._downgradedCdnList.metadata,e);n>=0&&t._removeIndexFromDowngradeList(n),t.trigger(\"priorityChange\",null)}),r);this._downgradedCdnList.timeouts.push(i),this.trigger(\"priorityChange\",null)},n._innerGetCdnPreferenceForResource=function(e){var t=this,n=e.reduce((function(e,n){return t._downgradedCdnList.metadata.some((function(e){return e.id===n.id&&e.baseUrl===n.baseUrl}))?e[1].push(n):e[0].push(n),e}),[[],[]]),r=n[0],i=n[1];return r.concat(i)},n._removeIndexFromDowngradeList=function(e){this._downgradedCdnList.metadata.splice(e,1);var t=this._downgradedCdnList.timeouts.splice(e,1);clearTimeout(t[0])},t}(_);function ks(e,t){return 0===e.length?-1:void 0!==t.id?x(e,(function(e){return e.id===t.id})):x(e,(function(e){return e.baseUrl===t.baseUrl}))}var Rs=function(){function e(){this._cache=new WeakMap}var t=e.prototype;return t.add=function(e,t){var n=e.representation;e.segment.isInit&&this._cache.set(n,t)},t.get=function(e){var t=e.representation;if(e.segment.isInit){var n=this._cache.get(t);if(void 0!==n)return n}return null},e}(),Ps=I();var xs=function(){function e(e){var t=e.prioritySteps;if(this._minPendingPriority=null,this._waitingQueue=[],this._pendingTasks=[],this._prioritySteps=t,this._prioritySteps.high>=this._prioritySteps.low)throw new Error(\"TP: the max high level priority should be given a lowerpriority number than the min low priority.\")}var t=e.prototype;return t.create=function(e,t,n,r){var i,a=this;return na(r,(function(o,s){return i={hasEnded:!1,priority:t,trigger:function(){if(!i.hasEnded){var e=function(){u(),a._endTask(i)},t=new kr,u=t.linkToSignal(r);i.interrupter=t,t.signal.register((function(){i.interrupter=null,r.isCancelled()||n.beforeInterrupted()})),a._minPendingPriority=null===a._minPendingPriority?i.priority:Math.min(a._minPendingPriority,i.priority),a._pendingTasks.push(i),i.taskFn(t.signal).then((function(t){n.beforeEnded(),e(),o(t)})).catch((function(n){!r.isCancelled()&&t.isUsed()&&n instanceof Pr||function(t){e(),s(t)}(n)}))}},taskFn:e,interrupter:null},a._canBeStartedNow(i)?(i.trigger(),a._isRunningHighPriorityTasks()&&a._interruptCancellableTasks()):a._waitingQueue.push(i),function(){return a._endTask(i)}}))},t._endTask=function(e){e.hasEnded=!0;var t=Cs(e.taskFn,this._waitingQueue);if(t>=0)this._waitingQueue.splice(t,1);else{var n=Cs(e.taskFn,this._pendingTasks);if(n<0)return;this._pendingTasks.splice(n,1),this._pendingTasks.length>0?this._minPendingPriority===e.priority&&(this._minPendingPriority=Math.min.apply(Math,this._pendingTasks.map((function(e){return e.priority})))):this._minPendingPriority=null,this._loopThroughWaitingQueue()}},t.updatePriority=function(e,t){var n=Cs(e,this._waitingQueue);if(n>=0){var r=this._waitingQueue[n];if(r.priority===t)return;if(r.priority=t,!this._canBeStartedNow(r))return;return this._findAndRunWaitingQueueTask(n),void(this._isRunningHighPriorityTasks()&&this._interruptCancellableTasks())}var i=Cs(e,this._pendingTasks);if(i<0)T.warn(\"TP: request to update the priority of a non-existent task\");else{var a=this._pendingTasks[i];if(a.priority!==t){var o=a.priority;a.priority=t,null===this._minPendingPriority||t<this._minPendingPriority?this._minPendingPriority=t:this._minPendingPriority===o&&(1===this._pendingTasks.length?this._minPendingPriority=t:this._minPendingPriority=Math.min.apply(Math,this._pendingTasks.map((function(e){return e.priority}))),this._loopThroughWaitingQueue()),this._isRunningHighPriorityTasks()&&this._interruptCancellableTasks()}}},t._loopThroughWaitingQueue=function(){var e=this._waitingQueue.reduce((function(e,t){return null===e||e>t.priority?t.priority:e}),null);if(!(null===e||null!==this._minPendingPriority&&this._minPendingPriority<e))for(var t=0;t<this._waitingQueue.length;t++){var n=null===this._minPendingPriority?e:Math.min(this._minPendingPriority,e);this._waitingQueue[t].priority<=n&&(this._findAndRunWaitingQueueTask(t),t--)}},t._interruptCancellableTasks=function(){for(var e=0;e<this._pendingTasks.length;e++){var t=this._pendingTasks[e];if(t.priority>=this._prioritySteps.low)return this._interruptPendingTask(t),this._interruptCancellableTasks()}},t._findAndRunWaitingQueueTask=function(e){return e>=this._waitingQueue.length||e<0?(T.warn(\"TP : Tried to start a non existing task\"),!1):(this._waitingQueue.splice(e,1)[0].trigger(),!0)},t._interruptPendingTask=function(e){var t,n=Cs(e.taskFn,this._pendingTasks);n<0?T.warn(\"TP: Interrupting a non-existent pending task. Aborting...\"):(this._pendingTasks.splice(n,1),this._waitingQueue.push(e),0===this._pendingTasks.length?this._minPendingPriority=null:this._minPendingPriority===e.priority&&(this._minPendingPriority=Math.min.apply(Math,this._pendingTasks.map((function(e){return e.priority})))),null===(t=e.interrupter)||void 0===t||t.cancel())},t._canBeStartedNow=function(e){return null===this._minPendingPriority||e.priority<=this._minPendingPriority},t._isRunningHighPriorityTasks=function(){return null!==this._minPendingPriority&&this._minPendingPriority<=this._prioritySteps.high},e}();function Cs(e,t){return x(t,(function(t){return t.taskFn===e}))}var Ms=function(){function e(e,t,n){var r=new Is(n),i=s.getCurrent(),a=i.MIN_CANCELABLE_PRIORITY,o=i.MAX_HIGH_PRIORITY_LEVEL;this._transport=e,this._prioritizer=new xs({prioritySteps:{high:o,low:a}}),this._cdnPrioritizer=r,this._backoffOptions=t}return e.prototype.createSegmentFetcher=function(e,t){var n,r,a,o=function(e){var t=e.maxRetry,n=e.lowLatencyMode,r=e.requestTimeout,i=e.connectionTimeout,a=s.getCurrent(),o=a.DEFAULT_MAX_REQUESTS_RETRY_ON_ERROR,u=a.DEFAULT_REQUEST_TIMEOUT,l=a.DEFAULT_CONNECTION_TIMEOUT,d=a.INITIAL_BACKOFF_DELAY_BASE,c=a.MAX_BACKOFF_DELAY_BASE;return{maxRetry:null!=t?t:o,baseDelay:n?d.LOW_LATENCY:d.REGULAR,maxDelay:n?c.LOW_LATENCY:c.REGULAR,requestTimeout:void 0===r?u:r,connectionTimeout:void 0===i?l:i}}(this._backoffOptions),u=function(e,t,n,r,a){var o;o=void 0===a.connectionTimeout||a.connectionTimeout<0?void 0:a.connectionTimeout;var s={timeout:a.requestTimeout<0?void 0:a.requestTimeout,connectionTimeout:o},u=k([\"audio\",\"video\"],e)?new Rs:void 0,l=t.loadSegment,d=t.parseSegment;return function(){var e=qn(Yn().mark((function e(t,o,c){var f,p,h,v,m,g,b,y,_,E,w,A,I,k,R,P,x,C,M,O,D,N,U,F;return Yn().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(F=function(){var e;k||!S(w)&&void 0!==w.size&&void 0!==w.requestDuration&&A.length>0&&A.every((function(e){return e}))&&(k=!0,null===(e=r.onMetrics)||void 0===e||e.call(r,{size:w.size,requestDuration:w.requestDuration,content:t,segmentDuration:I}))},U=function(e){o.onRetry(vs(e))},N=function(e,t){A.push(!1);var n=A.length-1;return function(r){var i={data:e,isChunked:t};try{var a=d(i,R,r);return A[n]||(I=void 0!==I&&\"media\"===a.segmentType&&null!==a.chunkInfos&&void 0!==a.chunkInfos.duration?I+a.chunkInfos.duration:void 0,A[n]=!0,F()),a}catch(e){throw Sr(e,{defaultCode:\"PIPELINE_PARSE_ERROR\",defaultReason:\"Unknown parsing error\"})}}},D=function(e){return l(e,R,s,c,P)},O=function(){var e;void 0===w&&(T.debug(\"SF: Segment request cancelled\",_),w=null,null===(e=r.onRequestEnd)||void 0===e||e.call(r,{id:E}))},v=t.segment,m=t.adaptation,g=t.representation,b=t.manifest,y=t.period,_=ia(t),E=Ps(),A=[],I=0,k=!1,R={segment:v,type:m.type,language:m.language,isLive:b.isLive,periodStart:y.start,periodEnd:y.end,mimeType:g.mimeType,codecs:g.codecs[0],manifestPublishTime:b.publishTime},P={onProgress:function(e){var t;void 0===w&&void 0!==e.totalSize&&e.size<e.totalSize&&(null===(t=r.onProgress)||void 0===t||t.call(r,{duration:e.duration,size:e.size,totalSize:e.totalSize,timestamp:L(),id:E}))},onNewChunk:function(e){o.onChunk(N(e,!0))}},null===(x=void 0!==u?u.get(t):null)){e.next=18;break}return T.debug(\"SF: Found wanted segment in cache\",_),o.onChunk(N(x,!1)),e.abrupt(\"return\",Promise.resolve());case 18:return T.debug(\"SF: Beginning request\",_),null===(f=r.onRequestBegin)||void 0===f||f.call(r,{requestTimestamp:L(),id:E,content:t}),c.register(O),e.prev=21,e.next=24,gs(t.representation.cdnMetadata,n,D,i({onRetry:U},a),c);case 24:\"segment-loaded\"===(C=e.sent).resultType?(M=C.resultData.responseData,void 0!==u&&u.add(t,C.resultData.responseData),o.onChunk(N(M,!1))):\"segment-created\"===C.resultType&&o.onChunk(N(C.resultData,!1)),T.debug(\"SF: Segment request ended with success\",_),o.onAllChunksReceived(),\"segment-created\"!==C.resultType?(w=C.resultData,F()):w=null,c.isCancelled()||null===(p=r.onRequestEnd)||void 0===p||p.call(r,{id:E}),c.deregister(O),e.next=43;break;case 33:if(e.prev=33,e.t0=e.catch(21),c.deregister(O),w=null,!(e.t0 instanceof Pr)){e.next=40;break}throw T.debug(\"SF: Segment request aborted\",_),e.t0;case 40:throw T.debug(\"SF: Segment request failed\",_),null===(h=r.onRequestEnd)||void 0===h||h.call(r,{id:E}),vs(e.t0);case 43:case\"end\":return e.stop()}}),e,null,[[21,33]])})));return function(t,n,r){return e.apply(this,arguments)}}()}(e,this._transport[e],this._cdnPrioritizer,t,o);return n=this._prioritizer,r=u,a=new WeakMap,{createRequest:function(e,t,i,o){var s=function(t){return r(e,i,t)},u=n.create(s,t,i,o);return a.set(u,s),u},updatePriority:function(e,t){var r=a.get(e);void 0!==r?n.updatePriority(r,t):T.warn(\"Fetchers: Cannot update the priority of a request: task not found.\")}}},e}(),Os=Ms;function Ds(e,t){var n=\"undefined\"!=typeof Symbol&&e[Symbol.iterator]||e[\"@@iterator\"];if(n)return(n=n.call(e)).next.bind(n);if(Array.isArray(e)||(n=function(e,t){if(!e)return;if(\"string\"==typeof e)return Ns(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);\"Object\"===n&&e.constructor&&(n=e.constructor.name);if(\"Map\"===n||\"Set\"===n)return Array.from(e);if(\"Arguments\"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Ns(e,t)}(e))||t&&e&&\"number\"==typeof e.length){n&&(e=n);var r=0;return function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}}}throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\")}function Ns(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var Us=function(){function e(e){this._segmentSinksStore=e,this._currentFreezeTimestamp=null}return e.prototype.needToReload=function(e){var t=e.readyState,n=e.rebuffering,r=e.freezing;if((void 0!==e.bufferGap&&isFinite(e.bufferGap)?e.bufferGap:0)<6||null===n&&null===r||t>1)return this._currentFreezeTimestamp=null,!1;var i=L();null===this._currentFreezeTimestamp&&(this._currentFreezeTimestamp=i);var a=null!==n&&i-n.timestamp>4e3,o=null!==r&&i-r.timestamp>4e3;if((a||o)&&L()-this._currentFreezeTimestamp>4e3){for(var s=!0,u=!0,l=0,d=[this._segmentSinksStore.getStatus(\"audio\"),this._segmentSinksStore.getStatus(\"video\")];l<d.length;l++){var c=d[l];if(\"initialized\"===c.type)for(var f,p=Ds(c.value.getLastKnownInventory());!(f=p()).done;){var h=f.value.infos.representation;if(!1===h.decipherable)return T.warn(\"Init: we have undecipherable segments left in the buffer, reloading\"),this._currentFreezeTimestamp=null,!0;void 0!==h.contentProtections&&(u=!1,!0!==h.decipherable&&(s=!1))}}if(!u&&s)return T.warn(\"Init: we are frozen despite only having decipherable segments left in the buffer, reloading\"),this._currentFreezeTimestamp=null,!0}return!1},e}(),Ls=s.getCurrent(),Fs=Ls.DEFAULT_WANTED_BUFFER_AHEAD,Bs=Ls.DEFAULT_MAX_VIDEO_BUFFER_SIZE,zs=Ls.DEFAULT_MAX_BUFFER_AHEAD,Ws=Ls.DEFAULT_MAX_BUFFER_BEHIND,Vs=new N(Fs),js=new N(Bs),Gs=new N(zs),Hs=new N(Ws),qs=new N({height:void 0,width:void 0,pixelRatio:1}),Ks=new N(1/0);function Ys(e,t){T.debug(\"<--- Sending to Main:\",e.type),void 0===t?postMessage(e):postMessage(e,t)}function Qs(e){return Sr(e,{defaultCode:\"NONE\",defaultReason:\"An unknown error stopped content playback.\"}).serialize()}function Xs(e,t){var n=\"undefined\"!=typeof Symbol&&e[Symbol.iterator]||e[\"@@iterator\"];if(n)return(n=n.call(e)).next.bind(n);if(Array.isArray(e)||(n=function(e,t){if(!e)return;if(\"string\"==typeof e)return $s(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);\"Object\"===n&&e.constructor&&(n=e.constructor.name);if(\"Map\"===n||\"Set\"===n)return Array.from(e);if(\"Arguments\"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return $s(e,t)}(e))||t&&e&&\"number\"==typeof e.length){n&&(e=n);var r=0;return function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}}}throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\")}function $s(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var Zs=function(){function e(){this._refs=new Map}var t=e.prototype;return t.reset=function(){for(var e,t,n,r,i,a,o,s,u,l,d,c,f,p=Xs(this._refs.keys());!(f=p()).done;){var h=f.value;null===(t=null===(e=this._refs.get(h))||void 0===e?void 0:e.audio)||void 0===t||t.trackReference.finish(),null===(r=null===(n=this._refs.get(h))||void 0===n?void 0:n.audio)||void 0===r||r.representations.finish(),null===(a=null===(i=this._refs.get(h))||void 0===i?void 0:i.video)||void 0===a||a.trackReference.finish(),null===(s=null===(o=this._refs.get(h))||void 0===o?void 0:o.video)||void 0===s||s.representations.finish(),null===(l=null===(u=this._refs.get(h))||void 0===u?void 0:u.text)||void 0===l||l.trackReference.finish(),null===(c=null===(d=this._refs.get(h))||void 0===d?void 0:d.text)||void 0===c||c.representations.finish()}this._refs=new Map},t.addTrackSetter=function(e,t,n){var r,a,o=this._refs.get(e);void 0===o&&(o={},this._refs.set(e,o)),void 0!==o[t]&&(T.warn(\"WP: Track for periodId already declared\",e,t),null===(r=o[t])||void 0===r||r.trackReference.finish(),null===(a=o[t])||void 0===a||a.representations.finish());var s,u=n.getValue();S(u)?s=new N({representationIds:[],switchingMode:\"lazy\"}):(s=new N(u.representations.getValue()),n.setValue(i({},u,{representations:s}))),o[t]={trackReference:n,representations:s}},t.setTrack=function(e,t,n){var r,i=null===(r=this._refs.get(e))||void 0===r?void 0:r[t];return void 0===i?(T.debug(\"WP: Setting track for inexistent periodId\",e,t),!1):(S(n)?(i.representations=new N({representationIds:[],switchingMode:\"lazy\"}),i.trackReference.setValue(n)):(i.representations=new N(n.initialRepresentations),i.trackReference.setValue({adaptationId:n.adaptationId,switchingMode:n.switchingMode,representations:i.representations,relativeResumingPosition:n.relativeResumingPosition})),!0)},t.updateRepresentations=function(e,t,n,r){var i,a=null===(i=this._refs.get(e))||void 0===i?void 0:i[n];if(void 0===a)return T.debug(\"WP: Setting track for inexistent periodId\",e,n),!1;var o=a.trackReference.getValue();return S(o)||o.adaptationId!==t?(T.debug(\"WP: Desynchronized Adaptation id\",null==o?void 0:o.adaptationId,t),!1):(a.representations.setValue(r),!0)},t.removeTrackSetter=function(e,t){var n=this._refs.get(e),r=null==n?void 0:n[t];return void 0===n||void 0===r?(T.debug(\"WP: Removing track setter for inexistent periodId\",e,t),!1):(r.trackReference.finish(),r.representations.finish(),delete n[t],0===Object.keys(n).length&&this._refs.delete(e),!0)},e}(),Js=function(){function e(e,t){this._contentId=e,this._messageSender=t,this._queues={pushTextData:[],remove:[]}}var t=e.prototype;return t.pushTextData=function(e){var t=this;return new Promise((function(n,r){t._messageSender({type:\"push-text-data\",contentId:t._contentId,value:e}),t._queues.pushTextData.push({resolve:n,reject:r})}))},t.remove=function(e,t){var n=this;return new Promise((function(r,i){n._messageSender({type:\"remove-text-data\",contentId:n._contentId,value:{start:e,end:t}}),n._queues.remove.push({resolve:r,reject:i})}))},t.reset=function(){this._messageSender({type:\"reset-text-displayer\",contentId:this._contentId,value:null}),this._resetCurrentQueue()},t.stop=function(){this._messageSender({type:\"stop-text-displayer\",contentId:this._contentId,value:null}),this._resetCurrentQueue()},t._resetCurrentQueue=function(){var e=new Pr;this._queues.pushTextData.forEach((function(t){t.reject(e)})),this._queues.remove.forEach((function(t){t.reject(e)}))},t.onPushedTrackSuccess=function(e){var t=this._queues.pushTextData.shift();void 0!==t?t.resolve(e):T.error(\"WMS: pushTextData success for inexistant operation\")},t.onPushedTrackError=function(e){var t=this._queues.pushTextData.shift();void 0!==t?t.reject(e):T.error(\"WMS: pushTextData error for inexistant operation\")},t.onRemoveSuccess=function(e){var t=this._queues.remove.shift();void 0!==t?t.resolve(e):T.error(\"WMS: remove success for inexistant operation\")},t.onRemoveError=function(e){var t=this._queues.pushTextData.shift();void 0!==t?t.reject(e):T.error(\"WMS: pushTextData error for inexistant operation\")},e}(),eu=I(),tu=function(){function e(e){var t=e.hasMseInWorker,n=e.hasVideo;this._currentContent=null,this._currentMediaSourceCanceller=new kr,this._hasVideo=n,this._hasMseInWorker=t;var r=new kr;this._contentCanceller=r}var t=e.prototype;return t.initializeNewContent=function(e){var t=this;return new Promise((function(n,r){var a,o;t.disposeCurrentContent();var s=t._contentCanceller,u=new kr;t._currentMediaSourceCanceller=u,u.linkToSignal(s.signal);var l=e.contentId,d=e.url,c=e.hasText,f=e.transportOptions,p=null;Ce(y.transports.dash);var h,v=\"string\"==typeof f.representationFilter?(h=f.representationFilter,new Function(\"return (\"+h+\"(arguments[0], arguments[1]))\")):void 0,m=y.transports.dash(Object.assign(Object.assign({},f),{representationFilter:v})),g=new ws(void 0===d?void 0:[d],m,e.manifestRetryOptions),b=hs({initialBitrates:{audio:null!==(a=e.initialAudioBitrate)&&void 0!==a?a:0,video:null!==(o=e.initialVideoBitrate)&&void 0!==o?o:0},lowLatencyMode:f.lowLatencyMode,throttlers:{limitResolution:{video:qs},throttleBitrate:{video:Ks}}}),S=u.signal.register((function(e){r(e)})),_=new Os(m,e.segmentRetryOptions,s.signal),E=new Zs,w=nu(l,{hasMseInWorker:t._hasMseInWorker,hasVideo:t._hasVideo,hasText:c},u.signal),A=w[0],I=w[1],k=w[2],R=new Us(I);function P(){if(null!==p&&\"closed\"!==A.readyState&&!u.isUsed()){var e=p.getMetadataSnapshot();p.addEventListener(\"manifestUpdate\",(function(e){if(null!==p){var t=i(p.getMetadataSnapshot(),{periods:[]});Ys({type:\"manifest-update\",contentId:l,value:{manifest:t,updates:e}})}}),s.signal),S(),n(e)}}t._currentContent={contentId:l,decipherabilityFreezeDetector:R,mediaSource:A,manifest:null,manifestFetcher:g,representationEstimator:b,segmentSinksStore:I,segmentFetcherCreator:_,workerTextSender:k,trackChoiceSetter:E},A.addEventListener(\"mediaSourceOpen\",(function(){P()}),u.signal),s.signal.register((function(){g.dispose()})),g.addEventListener(\"warning\",(function(e){Ys({type:\"warning\",contentId:l,value:Qs(e)})}),s.signal),g.addEventListener(\"manifestReady\",(function(e){null===p?(p=e,null!==t._currentContent&&(t._currentContent.manifest=p),P()):T.warn(\"WP: Multiple `manifestReady` events, ignoring\")}),u.signal),g.addEventListener(\"error\",(function(e){r(e)}),s.signal),g.start()}))},t.getCurrentContent=function(){return this._currentContent},t.scheduleManifestRefresh=function(e){var t;null===(t=this._currentContent)||void 0===t||t.manifestFetcher.scheduleManualRefresh(e)},t.reloadMediaSource=function(e){var t=this;if(this._currentMediaSourceCanceller.cancel(),null===this._currentContent)return Promise.reject(new Error(\"CP: No content anymore\"));this._currentContent.trackChoiceSetter.reset(),this._currentMediaSourceCanceller=new kr,Ys({type:\"reloading-media-source\",contentId:this._currentContent.contentId,value:e},[]);var n=nu(this._currentContent.contentId,{hasMseInWorker:this._hasMseInWorker,hasVideo:this._hasVideo,hasText:null!==this._currentContent.workerTextSender},this._currentMediaSourceCanceller.signal),r=n[0],i=n[1],a=n[2];return this._currentContent.mediaSource=r,this._currentContent.segmentSinksStore=i,this._currentContent.workerTextSender=a,new Promise((function(e,n){r.addEventListener(\"mediaSourceOpen\",(function(){e()}),t._currentMediaSourceCanceller.signal),r.addEventListener(\"mediaSourceClose\",(function(){n(new Error(\"MediaSource ReadyState changed to close during init.\"))}),t._currentMediaSourceCanceller.signal),t._currentMediaSourceCanceller.signal.register((function(e){n(e)}))}))},t.disposeCurrentContent=function(){this._contentCanceller.cancel(),this._contentCanceller=new kr},e}();function nu(e,t,n){var r;if(t.hasMseInWorker){var i,a=new Vo(eu());r=a;var o=a.handle;if(\"handle\"===o.type)i={type:\"handle\",value:o.value};else{var s=URL.createObjectURL(o.value);i={type:\"url\",value:s},n.register((function(){URL.revokeObjectURL(s)}))}Ys({type:\"attach-media-source\",contentId:e,value:i,mediaSourceId:r.id},[o.value])}else r=new Qo(eu(),e,Ys);var u=t.hasText?new Js(e,Ys):null,l=t.hasVideo,d=new Ia(r,l,u);return n.register((function(){d.disposeAll(),null==u||u.stop(),r.dispose()})),[r,d,u]}function ru(e,t){var n=\"undefined\"!=typeof Symbol&&e[Symbol.iterator]||e[\"@@iterator\"];if(n)return(n=n.call(e)).next.bind(n);if(Array.isArray(e)||(n=function(e,t){if(!e)return;if(\"string\"==typeof e)return iu(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);\"Object\"===n&&e.constructor&&(n=e.constructor.name);if(\"Map\"===n||\"Set\"===n)return Array.from(e);if(\"Arguments\"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return iu(e,t)}(e))||t&&e&&\"number\"==typeof e.length){n&&(e=n);var r=0;return function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}}}throw new TypeError(\"Invalid attempt to iterate non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.\")}function iu(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function au(e,t,n,r){var i,a=new kr;a.linkToSignal(r);var o=new Map,u=t.getCurrentContent();if(null!==u&&null!==u.manifest){var l=u.contentId,d=u.manifest,c=u.mediaSource,f=u.representationEstimator,p=u.segmentSinksStore,h=u.segmentFetcherCreator,v=e.drmSystemId,m=e.enableFastSwitching,y=e.initialTime,S=e.onCodecSwitch;if(n.onUpdate((function(e){u.decipherabilityFreezeDetector.needToReload(e)&&A({timeOffset:0,minimumPosition:0,maximumPosition:1/0}),[\"video\",\"audio\",\"text\"].forEach((function(t){var n,r=p.getStatus(t);\"initialized\"===r.type&&r.value.synchronizeInventory(null!==(n=e.buffered[t])&&void 0!==n?n:[])}))})),void 0!==(null!==(i=d.getPeriodForTime(y))&&void 0!==i?i:d.getNextPeriod(y))){var _=new hr(n,l,Ys,a.signal),E=function(e,t,n,r,i,a){a.register((function(){t.interruptDurationSetting()}));var o=new mo(e,n,r.getBufferTypes());a.register((function(){o.dispose()})),o.addEventListener(\"warning\",(function(e){return i.onWarning(e)})),o.addEventListener(\"periodChange\",(function(e){return i.onPeriodChanged(e)})),o.addEventListener(\"endingPositionChange\",(function(e){t.setDuration(e.endingPosition,e.isEnd)})),o.addEventListener(\"endOfStream\",(function(){T.debug(\"Init: end-of-stream order received.\"),t.maintainEndOfStream()})),o.addEventListener(\"resumeStream\",(function(){t.stopEndOfStream()}));var s=o.getCurrentEndingTime();return t.setDuration(s.endingPosition,s.isEnd),o}(d,c,_,p,{onWarning:function(e){return Ys({type:\"warning\",contentId:l,value:Qs(e)})},onPeriodChanged:function(e){Ys({type:\"active-period-changed\",contentId:l,value:{periodId:e.id}})}},a.signal);po({initialPeriod:d.periods[0],manifest:d},_,f,p,h,{wantedBufferAhead:Vs,maxVideoBufferSize:js,maxBufferAhead:Gs,maxBufferBehind:Hs,drmSystemId:v,enableFastSwitching:m,onCodecSwitch:S},{needsBufferFlush:function(e){Ys({type:\"needs-buffer-flush\",contentId:l,value:e})},streamStatusUpdate:function(e){(function(e){var t=e.imminentDiscontinuity,n=o.get(e.period),r=null==n?void 0:n.get(e.bufferType);if(void 0!==r)if(null===r.discontinuity){if(null===t)return}else if(null!==t&&r.discontinuity.start===t.start&&r.discontinuity.end===t.end)return;void 0===n&&(n=new Map,o.set(e.period,n));var i={periodId:e.period.id,bufferType:e.bufferType,discontinuity:e.imminentDiscontinuity,position:e.position};n.set(e.bufferType,i),Ys({type:\"discontinuity-update\",contentId:l,value:i})})(e),d.isLastPeriodKnown&&e.period.id===d.periods[d.periods.length-1].id&&(e.hasFinishedLoading||e.isEmptyStream?E.onLastSegmentFinishedLoading(e.bufferType):E.onLastSegmentLoadingResume(e.bufferType))},needsManifestRefresh:function(){t.scheduleManifestRefresh({enablePartialRefresh:!0,canUseUnsafeMode:!0})},manifestMightBeOufOfSync:function(){var e=s.getCurrent().OUT_OF_SYNC_MANIFEST_REFRESH_DELAY;t.scheduleManifestRefresh({enablePartialRefresh:!1,canUseUnsafeMode:!1,delay:e})},lockedStream:function(e){Ys({type:\"locked-stream\",contentId:l,value:{periodId:e.period.id,bufferType:e.bufferType}})},adaptationChange:function(e){var t,n;E.onAdaptationChange(e.type,e.period,e.adaptation),a.signal.isCancelled()||Ys({type:\"adaptation-changed\",contentId:l,value:{adaptationId:null!==(n=null===(t=e.adaptation)||void 0===t?void 0:t.id)&&void 0!==n?n:null,periodId:e.period.id,type:e.type}})},representationChange:function(e){var t,n;E.onRepresentationChange(e.type,e.period),a.signal.isCancelled()||Ys({type:\"representation-changed\",contentId:l,value:{adaptationId:e.adaptation.id,representationId:null!==(n=null===(t=e.representation)||void 0===t?void 0:t.id)&&void 0!==n?n:null,periodId:e.period.id,type:e.type}})},inbandEvent:function(e){Ys({type:\"inband-event\",contentId:l,value:e})},warning:function(e){Ys({type:\"warning\",contentId:l,value:Qs(e)})},periodStreamReady:function(e){null!==u&&(u.trackChoiceSetter.addTrackSetter(e.period.id,e.type,e.adaptationRef),Ys({type:\"period-stream-ready\",contentId:l,value:{periodId:e.period.id,bufferType:e.type}}))},periodStreamCleared:function(e){if(null!==u){var t=o.get(e.period);void 0!==t&&(t.delete(e.type),0===t.size&&o.delete(e.period)),u.trackChoiceSetter.removeTrackSetter(e.period.id,e.type),Ys({type:\"period-stream-cleared\",contentId:l,value:{periodId:e.period.id,bufferType:e.type}})}},bitrateEstimateChange:function(e){Ys({type:\"bitrate-estimate-change\",contentId:l,value:{bitrate:e.bitrate,bufferType:e.type}})},needsMediaSourceReload:function(e){A(e)},needsDecipherabilityFlush:function(){Ys({type:\"needs-decipherability-flush\",contentId:l,value:null})},encryptionDataEncountered:function(e){for(var t,n=ru(e);!(t=n()).done;){var r=t.value,i=r.content,a=Object.assign({},i);a.manifest instanceof Se&&(a.manifest=a.manifest.getMetadataSnapshot()),a.period instanceof fe&&(a.period=a.period.getMetadataSnapshot()),a.adaptation instanceof ue&&(a.adaptation=a.adaptation.getMetadataSnapshot()),a.representation instanceof ae&&(a.representation=a.representation.getMetadataSnapshot()),Ys({type:\"encryption-data-encountered\",contentId:l,value:{keyIds:r.keyIds,values:r.values,content:a,type:r.type}})}},error:function(e){Ys({type:\"error\",contentId:l,value:Qs(e)})}},a.signal)}else{var w=new b(\"MEDIA_STARTING_TIME_NOT_FOUND\",\"Wanted starting time not found in the Manifest.\");Ys({type:\"error\",contentId:l,value:Qs(w)})}}else{Ys({type:\"error\",contentId:void 0,value:Qs(new g(\"NONE\",\"Loading content when none is prepared\"))})}function A(i){var o=n.getValue().position.getWanted();null!==a&&a.cancel(),t.reloadMediaSource(i).then((function(){au({initialTime:o,drmSystemId:e.drmSystemId,enableFastSwitching:e.enableFastSwitching,onCodecSwitch:e.onCodecSwitch},t,n,r)}),(function(e){Ys({type:\"error\",contentId:l,value:Qs(e)})}))}}function ou(e,t){t?T.setLevel(e,(function(e,t){var n=t.map((function(e){return e instanceof Error?Qs(e):e}));postMessage({type:\"log\",value:{logLevel:e,logs:n}})})):T.setLevel(e)}var su=function(){var e=new tu({hasMseInWorker:!1,hasVideo:!0}),n=null,r=new cr;y.dashParsers.wasm=r,y.dashParsers.fastJs=Gn,y.transports.dash=Ui;var a=null;onmessage=function(o){var s,u,l;T.debug(\"Worker: received message\",o.data.type);var d,c,f,p=o.data;switch(p.type){case\"init\":Ce(),!0,d=p.value,c=d.date-d.timestamp,f=\"undefined\"!=typeof performance?Date.now()-performance.now():0,U.setValueIfChanged(f-c),ou(p.value.logLevel,p.value.sendBackLogs),void 0!==p.value.dashWasmUrl&&r.isCompatible()&&r.initialize({wasmUrl:p.value.dashWasmUrl}).catch((function(e){var t=e instanceof Error?e.toString():\"Unknown Error\";T.error(\"Worker: Could not initialize DASH_WASM parser\",t)})),p.value.hasVideo&&!p.value.hasMseInWorker||(e.disposeCurrentContent(),e=new tu({hasMseInWorker:p.value.hasMseInWorker,hasVideo:p.value.hasVideo})),y.codecSupportProber=p.value.hasMseInWorker?ke:Pe,Ys({type:\"init-success\",value:null});break;case\"log-level-update\":ou(p.value.logLevel,p.value.sendBackLogs);break;case\"prepare\":!function(e,t){e.initializeNewContent(t).then((function(e){Ys({type:\"manifest-ready\",contentId:t.contentId,value:{manifest:e}})}),(function(e){Ys({type:\"error\",contentId:t.contentId,value:Qs(e)})}))}(e,p.value);break;case\"start\":var h=e.getCurrentContent();if(p.contentId!==(null==h?void 0:h.contentId))return;null!==n&&(n.cancel(),n=null);var v=new kr,m=new N(i(p.value.initialObservation,{position:t(fr,p.value.initialObservation.position)}));a=m,(n=v).signal.register((function(){m.finish()})),au(p.value,e,m,v.signal);break;case\"observation\":var g=e.getCurrentContent();if(p.contentId!==(null==g?void 0:g.contentId))return;var b=p.value,S=b.buffered,_=function(e,t){var n={audio:null,video:null,text:null};if(null!==t&&(n.text=t.getBufferedRanges()),null===e)return n;var r=A(e.sourceBuffers,(function(e){return\"audio\"===e.type})),i=A(e.sourceBuffers,(function(e){return\"video\"===e.type})),a=null==r?void 0:r.getBuffered();void 0!==a&&(n.audio=a);var o=null==i?void 0:i.getBuffered();return void 0!==o&&(n.video=o),n}(g.mediaSource,null);null!==_.audio&&(S.audio=_.audio),null!==_.video&&(S.video=_.video),null==a||a.setValue(i(b,{position:t(fr,p.value.position)}));break;case\"ref-update\":!function(e){switch(e.value.name){case\"wantedBufferAhead\":Vs.setValueIfChanged(e.value.newVal);break;case\"maxVideoBufferSize\":js.setValueIfChanged(e.value.newVal);break;case\"maxBufferBehind\":Hs.setValueIfChanged(e.value.newVal);break;case\"maxBufferAhead\":Gs.setValueIfChanged(e.value.newVal);break;case\"limitVideoResolution\":qs.setValueIfChanged(e.value.newVal);break;case\"throttleVideoBitrate\":Ks.setValueIfChanged(e.value.newVal);break;default:Me(e.value)}}(p);break;case\"stop\":if(p.contentId!==(null===(s=e.getCurrentContent())||void 0===s?void 0:s.contentId))return;e.disposeCurrentContent(),null!==n&&(n.cancel(),n=null);break;case\"sb-success\":var E=e.getCurrentContent();if(p.mediaSourceId!==(null==E?void 0:E.mediaSource.id))return;var w=A(E.mediaSource.sourceBuffers,(function(e){return e.type===p.sourceBufferType}));if(void 0===w)return void T.info(\"WP: Success for an unknown SourceBuffer\",p.sourceBufferType);if(void 0===w.onOperationSuccess)return void T.warn(\"WP: A SourceBufferInterface with MSE performed a cross-thread operation\",p.sourceBufferType);w.onOperationSuccess(p.operationId,p.value.buffered);break;case\"sb-error\":var I=e.getCurrentContent();if(p.mediaSourceId!==(null==I?void 0:I.mediaSource.id))return;var k=A(I.mediaSource.sourceBuffers,(function(e){return e.type===p.sourceBufferType}));if(void 0===k)return void T.info(\"WP: Error for an unknown SourceBuffer\",p.sourceBufferType);if(void 0===k.onOperationFailure)return void T.warn(\"WP: A SourceBufferInterface with MSE performed a cross-thread operation\",p.sourceBufferType);k.onOperationFailure(p.operationId,p.value);break;case\"media-source-ready-state-change\":var R=e.getCurrentContent();if(p.mediaSourceId!==(null==R?void 0:R.mediaSource.id))return;if(void 0===R.mediaSource.onMediaSourceReadyStateChanged)return void T.warn(\"WP: A MediaSourceInterface with MSE performed a cross-thread operation\");R.mediaSource.onMediaSourceReadyStateChanged(p.value);break;case\"decipherability-update\":if(p.contentId!==(null===(u=e.getCurrentContent())||void 0===u?void 0:u.contentId))return;var P=e.getCurrentContent();if(null===P||null===P.manifest)return;var x=p.value;P.manifest.updateRepresentationsDeciperability((function(e){for(var t,n=ru(x);!(t=n()).done;){var r=t.value;if(e.representation.uniqueId===r.representationUniqueId)return r.decipherable}return e.representation.decipherable}));break;case\"codec-support-update\":var C=e.getCurrentContent();if(null===C||null===C.manifest)return;if(\"function\"==typeof(null===(l=y.codecSupportProber)||void 0===l?void 0:l.updateCache))for(var M,O=ru(p.value);!(M=O()).done;){var D=M.value,L=D.mimeType,F=D.codec,B=D.result;y.codecSupportProber.updateCache(L,F,B)}try{var z=C.manifest.refreshCodecSupport(p.value);null!==z&&Ys({type:\"warning\",contentId:C.contentId,value:Qs(z)})}catch(e){Ys({type:\"error\",contentId:C.contentId,value:Qs(e)})}break;case\"urls-update\":var W=e.getCurrentContent();if(null===W||W.contentId!==p.contentId)return;W.manifestFetcher.updateContentUrls(p.value.urls,p.value.refreshNow);break;case\"track-update\":var V=e.getCurrentContent();if(null===V||V.contentId!==p.contentId)return;V.trackChoiceSetter.setTrack(p.value.periodId,p.value.bufferType,p.value.choice);break;case\"rep-update\":var j=e.getCurrentContent();if(null===j||j.contentId!==p.contentId)return;j.trackChoiceSetter.updateRepresentations(p.value.periodId,p.value.adaptationId,p.value.bufferType,p.value.choice);break;case\"add-text-success\":var G=e.getCurrentContent();if(null===G||G.contentId!==p.contentId)return;if(null===G.workerTextSender)return void T.error(\"WP: Added text track but text track aren't enabled\");G.workerTextSender.onPushedTrackSuccess(p.value.ranges);break;case\"push-text-error\":var H=e.getCurrentContent();if(null===H||H.contentId!==p.contentId)return;if(null===H.workerTextSender)return void T.error(\"WP: Added text track but text track aren't enabled\");H.workerTextSender.onPushedTrackError(new Error(p.value.message));break;case\"remove-text-success\":var q=e.getCurrentContent();if(null===q||q.contentId!==p.contentId)return;if(null===q.workerTextSender)return void T.error(\"WP: Removed text track but text track aren't enabled\");q.workerTextSender.onRemoveSuccess(p.value.ranges);break;case\"remove-text-error\":var K=e.getCurrentContent();if(null===K||K.contentId!==p.contentId)return;if(null===K.workerTextSender)return void T.error(\"WP: Removed text track but text track aren't enabled\");K.workerTextSender.onRemoveError(new Error(p.value.message));break;default:Me()}}};su()}()}();" + "})()"], { type: "application/javascript" });
exports.EMBEDDED_WORKER_ES5 = blob;
exports.default = blob;
