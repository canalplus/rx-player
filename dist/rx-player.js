function e(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,i=Array(t);n<t;n++)i[n]=e[n];return i}function t(e){if(Array.isArray(e))return e}function n(e){if(void 0===e)throw ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function i(e,t,n,i,r,a,o){try{var s=e[a](o),u=s.value}catch(e){n(e);return}s.done?t(u):Promise.resolve(u).then(i,r)}function r(e){return function(){var t=this,n=arguments;return new Promise(function(r,a){var o=e.apply(t,n);function s(e){i(o,r,a,s,u,"next",e)}function u(e){i(o,r,a,s,u,"throw",e)}s(void 0)})}}function a(e,t){if(!(e instanceof t))throw TypeError("Cannot call a class as a function")}function o(e,t,n){return(o=T()?Reflect.construct:function(e,t,n){var i=[null];i.push.apply(i,t);var r=new(Function.bind.apply(e,i));return n&&g(r,n.prototype),r}).apply(null,arguments)}function s(e,t){for(var n=0;n<t.length;n++){var i=t[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}function u(e,t,n){return t&&s(e.prototype,t),n&&s(e,n),e}function l(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function d(e,t,n){return(d="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var i=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=c(e)););return e}(e,t);if(i){var r=Object.getOwnPropertyDescriptor(i,t);return r.get?r.get.call(n||e):r.value}})(e,t,n||e)}function c(e){return(c=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function f(e,t){if("function"!=typeof t&&null!==t)throw TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&g(e,t)}function v(e,t){return null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?!!t[Symbol.hasInstance](e):e instanceof t}function h(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}function p(){throw TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function m(e,t){return t&&("object"===b(t)||"function"==typeof t)?t:n(e)}function g(e,t){return(g=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function y(e,n){return t(e)||function(e,t){var n,i,r=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=r){var a=[],o=!0,s=!1;try{for(r=r.call(e);!(o=(n=r.next()).done)&&(a.push(n.value),!t||a.length!==t);o=!0);}catch(e){s=!0,i=e}finally{try{o||null==r.return||r.return()}finally{if(s)throw i}}return a}}(e,n)||E(e,n)||p()}function _(e){return t(e)||h(e)||E(e)||p()}function S(t){return function(t){if(Array.isArray(t))return e(t)}(t)||h(t)||E(t)||function(){throw TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function b(e){return e&&"undefined"!=typeof Symbol&&e.constructor===Symbol?"symbol":typeof e}function E(t,n){if(t){if("string"==typeof t)return e(t,n);var i=Object.prototype.toString.call(t).slice(8,-1);if("Object"===i&&t.constructor&&(i=t.constructor.name),"Map"===i||"Set"===i)return Array.from(i);if("Arguments"===i||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(i))return e(t,n)}}function k(e){var t="function"==typeof Map?new Map:void 0;return(k=function(e){if(null===e||-1===Function.toString.call(e).indexOf("[native code]"))return e;if("function"!=typeof e)throw TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,n)}function n(){return o(e,arguments,c(this).constructor)}return n.prototype=Object.create(e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),g(n,e)})(e)}function T(){if("undefined"==typeof Reflect||!Reflect.construct||Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}function w(e){var t=T();return function(){var n,i=c(e);return n=t?Reflect.construct(i,arguments,c(this).constructor):i.apply(this,arguments),m(this,n)}}function I(e,t){var n,i,r,a,o={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return a={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(a[Symbol.iterator]=function(){return this}),a;function s(a){return function(s){return function(a){if(n)throw TypeError("Generator is already executing.");for(;o;)try{if(n=1,i&&(r=2&a[0]?i.return:a[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,a[1])).done)return r;switch(i=0,r&&(a=[2&a[0],r.value]),a[0]){case 0:case 1:r=a;break;case 4:return o.label++,{value:a[1],done:!1};case 5:o.label++,i=a[1],a=[0];continue;case 7:a=o.ops.pop(),o.trys.pop();continue;default:if(!(r=(r=o.trys).length>0&&r[r.length-1])&&(6===a[0]||2===a[0])){o=0;continue}if(3===a[0]&&(!r||a[1]>r[0]&&a[1]<r[3])){o.label=a[1];break}if(6===a[0]&&o.label<r[1]){o.label=r[1],r=a;break}if(r&&o.label<r[2]){o.label=r[2],o.ops.push(a);break}r[2]&&o.ops.pop(),o.trys.pop();continue}a=t.call(e,o)}catch(e){a=[6,e],i=0}finally{n=r=0}if(5&a[0])throw a[1];return{value:a[0]?a[1]:void 0,done:!0}}([a,s])}}}!function(){var e,t=function(){return"boolean"==typeof __RX_PLAYER_DEBUG_MODE__&&__RX_PLAYER_DEBUG_MODE__},i=function(e){return null==e},o=function(e){return null!=e&&!Array.isArray(e)&&"object"==typeof e},s=function(){},h=function(e,t){return Math.abs(e-t)<uI},p=function(e,t){return{start:Math.min(e.start,t.start),end:Math.max(e.end,t.end)}},g=function(e){for(var t=0;t<e.length;t++){var n=e[t];n.start===n.end&&e.splice(t--,1)}return e},E=function(e){for(var t=1;t<e.length;t++){var n=e[t-1],i=e[t];if(C(n,i)){var r=p(n,i);e.splice(--t,2,r)}}return e},T=function(e,t){return e.end<=t.start},A=function(e,t){var n=e.start,i=e.end;return n<=t&&t<i},R=function(e,t){return A(e,t.start)||e.start<t.end&&t.end<e.end||A(t,e.start)},C=function(e,t){return h(t.start,e.end)||h(t.end,e.start)},M=function(e){for(var t=[],n=0;n<e.length;n++)t.push({start:e.start(n),end:e.end(n)});return t},P=function(e,t){for(var n=e.length-1;n>=0;n--){var i=e.start(n);if(t>=i){var r=e.end(n);if(t<r)return{start:i,end:r}}}return null},D=function(e,t){for(var n=e.length-1;n>=0;n--)if(t>=e[n].start&&t<e[n].end)return e[n];return null},x=function(e,t){for(var n=e.length,i=0;i<n;i++){var r=e.start(i);if(t<r)return r-t}return 1/0},N=function(e,t){for(var n=null,i=[],r=0;r<e.length;r++){var a=e[r].start,o=e[r].end;t<a||t>=o?i.push({start:a,end:o}):n={start:a,end:o}}return{outerRanges:i,innerRange:n}},O=function(e,t){var n=P(e,t);return null!==n?n.end-t:1/0},L=function(e,t){var n=D(e,t);return null!==n?n.end-t:1/0},U=function(e,t){if(t.start===t.end)return e;for(var n=t,i=0;i<e.length;i++){var r=e[i],a=R(n,r),o=C(n,r);if(a||o)n=p(n,r),e.splice(i--,1);else if(0===i){if(T(n,e[0]))break}else if(T(e[i-1],n)&&T(n,r))break}return e.splice(i,0,n),E(g(e))},F=function(e,t){for(var n=[],i=0;i<t.length;i++)R(e,t[i])&&n.push(t[i]);return n},B=function(e,t){for(var n=[],i=0;i<e.length;i++){var r=e[i],a=F(r,t);if(a.length>0)for(var o=0;o<a.length;o++){var s=a[o];n.push({start:Math.max(r.start,s.start),end:Math.min(r.end,s.end)})}}return n},V=function(e,t){for(var n=[],i=0;i<e.length;i++){var r=e[i],a=[],o=F(r,t);if(o.length>0)for(var s=0;s<o.length;s++){var u=o[s];a.push({start:Math.max(r.start,u.start),end:Math.min(r.end,u.end)})}if(0===a.length)n.push(r);else{for(var l=r.start,d=0;d<a.length;d++)a[d].start>l&&n.push({start:l,end:a[d].start}),l=a[d].end;l<r.end&&n.push({start:l,end:r.end})}}return n},z=function(e,t,n){if("function"==typeof Array.prototype.findIndex)return e.findIndex(t,n);for(var i=e.length>>>0,r=0;r<i;r++)if(t.call(n,e[r],r,e))return r;return -1},K=function(e,t,n){var i=new uA(t(e.getValue()),n);return e.onUpdate(function(e){i.setValue(t(e))},{clearSignal:n}),e._onFinished(function(){i.finish()},n),i},W=function(e,t){if(ui.DEV===ui.CURRENT_ENV&&!e)throw new uC(void 0===t?"invalid assertion":t)},G=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"object";for(var r in W(!i(e),"".concat(n," should be an object")),t)t.hasOwnProperty(r)&&W(b(e[r])===t[r],"".concat(n," should have property ").concat(r," as a ").concat(t[r]))},H=function(e){throw new uC("Unreachable path taken")},q=function(){var e=s;return[function(t){e(t)},function(t){e=t}]},Y=function(e){var t=e.map(function(t){return Math.log(t/e[0])}),n=t.map(function(e){return e-t[0]+1}),i=(n[n.length-1]-1)/(2*e.length+10),r=1/i;return e.map(function(t,a){return function t(a){if(0===a)return 0;var o=Math.min(Math.max(1,a),e.length-1);return e[o]===e[o-1]?t(a-1):r*(i+(e[o]*n[o-1]-e[o-1]*n[o])/(e[o]-e[o-1]))+4}(a)})},j=function(e,t,n){if("function"==typeof Array.prototype.find)return e.find(t,n);for(var i=e.length>>>0,r=0;r<i;r++){var a=e[r];if(t.call(n,a,r,e))return a}},Q=function(e,t){for(var n=-1,i=0;i<e.length;i++){var r=e[i].content.segment;if(!(r.duration<=0)){var a=r.time+r.duration;if(!r.complete&&i===e.length-1&&t-r.time>-1.2||a>t&&t-r.time>-1.2){n=i;break}}}if(n<0)return[];for(var o=e[n],s=o.content.segment.time,u=[o],l=n+1;l<e.length&&e[l].content.segment.time===s;l++)u.push(e[l]);return u},X=function(e){if(!(e.progress.length<5)){for(var t=new uO(2),n=e.progress,i=1;i<n.length;i++){var r=n[i].size-n[i-1].size,a=n[i].timestamp-n[i-1].timestamp,o=8*r/(a/1e3);t.addSample(a/1e3,o)}return t.getEstimate()}},$=function(e,t){return Math.max((e.totalSize-e.size)*8/t,0)},Z=function(e,t,n,r,a){if(!r){var o=t.bufferGap,s=t.speed,u=t.position,l=isFinite(o)?o:0,d=Q(e,u.getWanted()+l);if(1===d.length){var c=d[0],f=uN(),v=1.5*c.content.segment.duration;if(v=Math.max(v=Math.min(v,3e3),12e3),!(f-c.requestTimestamp<v)){var h=c.progress.length>0?c.progress[c.progress.length-1]:void 0,p=X(c);if(void 0!==h&&void 0!==p){var m=$(h,p);if((f-h.timestamp)/1e3<=m&&m-l/s>2500)return p}if(c.content.segment.complete){var g=c.content.segment.duration,y=(f-c.requestTimestamp)/1e3;if(!i(n)&&!(y<=(1.5*g+2)/s)){var _=n.bitrate*Math.min(.7,g/y);if(void 0===a||_<a)return _}}}}}},J=function(e,t,n){if(n)return!0;var i=isFinite(e.bufferGap)?e.bufferGap:0,r=e.position.getWanted()+i,a=j(t,function(e){var t=e.content;return t.segment.duration>0&&t.segment.time+t.segment.duration>r});if(void 0===a)return!0;var o=uN(),s=a.progress.length>0?a.progress[a.progress.length-1]:void 0,u=X(a);if(void 0===s||void 0===u)return!0;var l=$(s,u);return(o-s.timestamp)/1e3>1.2*l||l-i/e.speed>-1.5},ee=function(e,t){var n=e.length,i=z(e,function(e){return e.id===t.id});if(i<0)return uw.error("ABR: Current Representation not found."),null;for(;++i<n;)if(e[i].bitrate>t.bitrate)return e[i];return null},et=function(e,t){var n=z(e,function(e){return e.id===t.id});if(n<0)return uw.error("ABR: Current Representation not found."),null;for(;--n>=0;)if(e[n].bitrate<t.bitrate)return e[n];return null},en=function(e,t){if(0===e.length)return[];e.sort(function(e,t){return e.bitrate-t.bitrate});var n=Math.max(t,e[0].bitrate),i=z(e,function(e){return e.bitrate>n});return -1===i?e:e.slice(0,i)},ei=function(e,t){if(void 0===t.width||void 0===t.height)return e;var n=t.width*t.pixelRatio,i=t.height*t.pixelRatio,r=j(e.slice().sort(function(e,t){var n,i;return(null!=(n=e.width)?n:0)-(null!=(i=t.width)?i:0)}),function(e){return"number"==typeof e.width&&e.width>=n&&"number"==typeof e.height&&e.height>=i});if(void 0===r)return e;var a="number"==typeof r.width?r.width:0;return e.filter(function(e){return"number"!=typeof e.width||e.width<=a})},er=function(e){return Object.keys(e).map(function(t){return e[t]})},ea=function(e,t){var n=z(e,function(e){return e.bitrate>t});return -1===n?e[e.length-1]:0===n?e[0]:e[n-1]},eo=function(e,t){var n=e.bandwidthEstimator,i=e.context,r=e.currentRepresentation,a=e.filters,o=e.initialBitrate,u=e.lowLatencyMode,l=e.playbackObserver,d=e.representations,c=new uL,f=new uF(null!=o?o:0,u),v=new uW,h=s,p=new uM;p.linkToSignal(t);var m=g(d.getValue(),p.signal);return d.onUpdate(function(){var e=d.getValue();p.cancel(),(p=new uM).linkToSignal(t),g(e,p.signal).onUpdate(function(e){m.setValue(e)},{clearSignal:p.signal,emitCurrentValue:!0})},{clearSignal:t}),{estimates:m,callbacks:{metrics:function(e){var t=e.requestDuration,i=e.segmentDuration,r=e.size,a=e.content;if(n.addSample(t,r),!a.segment.isInit){var o=a.segment,s=a.representation;if(void 0===i&&!o.complete)return;var u=null!=i?i:o.duration;c.addSample(s,t/1e3,u)}},requestBegin:function(e){v.add(e)},requestProgress:function(e){v.addProgress(e)},requestEnd:function(e){v.remove(e.id)},addedSegment:function(e){h(e)}}};function g(e,t){if(e.length<=1)return new uR({bitrate:void 0,representation:e[0],urgent:!0,knownStableBitrate:void 0});var o=!1,d=e.sort(function(e,t){return e.bitrate-t.bitrate}),p=new uU(d.map(function(e){return e.bitrate})),m=new uB,g=new uV(c,m),y=l.getReference().getValue(),_=new uR(b());return l.listen(function(e){y=e,S()},{includeLastObservation:!1,clearSignal:t}),h=function(e){if(null!==y){var t=y.position,n=y.speed,i=L(e.buffered,t.getWanted()),r=e.content.representation,a=c.getEstimate(r),o=r.bitrate;p.onAddedSegment({bufferGap:i,currentBitrate:o,currentScore:a,speed:n}),S()}},t.register(function(){h=s}),a.throttleBitrate.onUpdate(S,{clearSignal:t}),a.limitResolution.onUpdate(S,{clearSignal:t}),_;function S(){_.setValue(b())}function b(){var e=y.bufferGap,t=y.position,s=y.maximumPosition,l=a.limitResolution.getValue(),h=a.throttleBitrate.getValue(),_=r.getValue(),S=es(d,l,h),b=v.getRequests(),E=f.getBandwidthEstimate(y,n,_,b,m.bandwidth),k=E.bandwidthEstimate,T=E.bitrateChosen,w=c.getLastStableRepresentation(),I=null===w?void 0:w.bitrate/(y.speed>0?y.speed:1),A=uT.getCurrent(),R=A.ABR_ENTER_BUFFER_BASED_ALGO,C=A.ABR_EXIT_BUFFER_BASED_ALGO;o&&e<=C?o=!1:!o&&isFinite(e)&&e>=R&&(o=!0);var M=ea(S,T),P=p.getLastEstimate(),D=M.bitrate,x=null;o&&void 0!==P&&P>D&&(D=(x=ea(S,P)).bitrate);var N=null;return u&&null!==_&&i.manifest.isDynamic&&s-t.getWanted()<40&&(N=g.getGuess(d,y,_,D,b)),null!==N&&N.bitrate>D?(uw.debug("ABR: Choosing representation with guess-based estimation.",N.bitrate,N.id),m.update(N,k,2),{bitrate:k,representation:N,urgent:null===_||N.bitrate<_.bitrate,knownStableBitrate:I}):null!==x?(uw.debug("ABR: Choosing representation with buffer-based estimation.",x.bitrate,x.id),m.update(x,k,0),{bitrate:k,representation:x,urgent:f.isUrgent(x.bitrate,_,b,y),knownStableBitrate:I}):(uw.debug("ABR: Choosing representation with bandwidth estimation.",M.bitrate,M.id),m.update(M,k,1),{bitrate:k,representation:M,urgent:f.isUrgent(M.bitrate,_,b,y),knownStableBitrate:I})}}},es=function(e,t,n){var i=e;return void 0!==n&&n<1/0&&(i=en(i,n)),void 0!==t&&(i=ei(i,t)),i},eu=function(e){if(!i(e.headers)){if(i(uX))t=e.headers;else{t=new uX;for(var t,n,a,o=Object.keys(e.headers),s=0;s<o.length;s++){var u=o[s];t.append(u,e.headers[u])}}}uw.debug("Fetch: Called with URL",e.url);var l=null,d=!1,c=!1,f=uN(),h=i(u$)?null:new u$;function p(){if(i(h)){uw.warn("Fetch: AbortController API not available.");return}h.abort()}void 0!==e.timeout&&(n=setTimeout(function(){d=!0,void 0!==a&&clearTimeout(a),p()},e.timeout)),void 0!==e.connectionTimeout&&(a=setTimeout(function(){c=!0,void 0!==n&&clearTimeout(n),p()},e.connectionTimeout));var m=e.cancelSignal.register(function(e){l=e,p()}),g={method:"GET"};return void 0!==t&&(g.headers=t),g.signal=i(h)?null:h.signal,fetch(e.url,g).then(function(t){var o=function(){return c.apply(this,arguments)};if(void 0!==a&&clearTimeout(a),t.status>=300)throw uw.warn("Fetch: Request HTTP Error",t.status,t.url),new uj(t.url,t.status,uQ.ERROR_HTTP_CODE);if(i(t.body))throw new uj(t.url,t.status,uQ.PARSE_ERROR);var s=t.headers.get("Content-Length"),u=i(s)||isNaN(+s)?void 0:+s,l=t.body.getReader(),d=0;return o();function c(){return(c=r(function(){var r,a,s,c;return I(this,function(v){switch(v.label){case 0:return[4,l.read()];case 1:if(!(r=v.sent()).done&&!i(r.value))return d+=r.value.byteLength,a=uN(),s={url:t.url,currentTime:a,duration:a-f,sendingTime:f,chunkSize:r.value.byteLength,chunk:r.value.buffer,size:d,totalSize:u},[2,(e.onData(s),o())];if(r.done)return void 0!==n&&clearTimeout(n),m(),[2,{requestDuration:(c=uN())-f,receivedTime:c,sendingTime:f,size:d,status:t.status,url:t.url}];return[2,o()]}})})).apply(this,arguments)}}).catch(function(t){throw null!==l?l:(m(),d?(uw.warn("Fetch: Request timed out."),new uj(e.url,0,uQ.TIMEOUT)):c?(uw.warn("Fetch: Request connection timed out."),new uj(e.url,0,uQ.TIMEOUT)):v(t,uj)?t:(uw.warn("Fetch: Request Error",v(t,Error)?t.toString():""),new uj(e.url,0,uQ.ERROR_EVENT)))})},el=function(){return"function"==typeof us.fetch&&!i(u$)&&!i(uX)},ed=function(e){return"string"==typeof e&&e.length>0},ec=function(e){try{return JSON.parse(e)}catch(e){return null}},ef=function(e,t){return"".concat(e,": ").concat(t)},ev=function(e){return(v(e,u1)||v(e,u2)||v(e,u4)||v(e,u5))&&Object.keys(uJ).indexOf(e.type)>=0},eh=function(e,t){var n=t.defaultCode,i=t.defaultReason;return ev(e)?e:new u4(n,v(e,Error)?e.toString():i)},ep=function(e){var t;switch(e.length){case 2:t=u8[e];break;case 3:t=u6[e]}return t},em=function(e){for(var t=0;t<e.length;t++){var n=e[t];if("function"==typeof n)n(u7);else if(i(n)||"function"!=typeof n._addFeature)throw Error("Unrecognized feature");else n._addFeature(u7)}},eg=function(e,t){if(e.length!==t.length)return!1;if(e===t)return!0;for(var n=e.length-1;n>=0;n--)if(e[n]!==t[n])return!1;return!0},ey=function(){var e="",t=-1;return function(){return++t>=Number.MAX_SAFE_INTEGER&&(e+="0",t=0),e+String(t)}},e_=function(e,t,n){if("function"==typeof Array.prototype.includes)return e.includes(t,n);var i,r=e.length>>>0;if(0===r)return!1;for(var a=0|n,o=a>=0?Math.min(a,r-1):Math.max(r+a,0);o<r;){if((i=e[o])===t||"number"==typeof i&&"number"==typeof t&&isNaN(i)&&isNaN(t))return!0;o++}return!1},eS=function(e){e_(lr,e)||(console.warn(e),lr.push(e))},eb=function(e){var t=e.timeBounds;if(null===t.timeshiftDepth)return null!=(n=t.minimumSafePosition)?n:0;var n,i,r,a=t.maximumTimeData;if(t.maximumTimeData.isLinear){var o=uN()-a.time;r=a.maximumSafePosition+o/1e3}else r=a.maximumSafePosition;var s=r-t.timeshiftDepth;return Math.max(null!=(i=t.minimumSafePosition)?i:0,s)},eE=function(e){var t=e.timeBounds.maximumTimeData;if(e.isLive&&void 0!==t.livePosition){if(!t.isLinear)return t.livePosition;var n=uN()-t.time;return t.livePosition+n/1e3}},ek=function(e){var t=e.timeBounds.maximumTimeData;if(!t.isLinear)return t.maximumSafePosition;var n=uN()-t.time;return t.maximumSafePosition+n/1e3},eT=function(e,t){if(void 0===t)return eR(e).filter(function(e){return!0===e.isSupported});var n=e.adaptations[t];return void 0===n?[]:n.filter(function(e){return!0===e.isSupported})},ew=function(e,t){for(var n=null,i=e.periods.length-1;i>=0;i--){var r=e.periods[i];if(eA(r,t,n))return r;n=r}},eI=function(e,t){var n=t.end;if(void 0===n)return null;var i=j(e.periods,function(e){return void 0===e.end||n<e.end});return void 0===i?null:i},eA=function(e,t,n){return t>=e.start&&(void 0===e.end||t<e.end)||t===e.end&&(null===n||n.start>e.end)},eR=function(e){return er(e.adaptations).reduce(function(e,t){return i(t)?e:e.concat(t)},[])},eC=function(e,t){var n,i,r={language:null!=(n=e.language)?n:"",normalized:null!=(i=e.normalizedLanguage)?i:"",audioDescription:!0===e.isAudioDescription,id:e.id,representations:(t?e.representations.filter(function(e){return!0===e.isSupported&&!1!==e.decipherable}):e.representations).map(eD),label:e.label};return!0===e.isDub&&(r.dub=!0),r},eM=function(e){var t,n;return{language:null!=(t=e.language)?t:"",normalized:null!=(n=e.normalizedLanguage)?n:"",closedCaption:!0===e.isClosedCaption,id:e.id,label:e.label,forced:e.isForcedSubtitles}},eP=function(e,t){var n=void 0!==e.trickModeTracks?e.trickModeTracks.map(function(e){var n=(t?e.representations.filter(function(e){return!0===e.isSupported&&!1!==e.decipherable}):e.representations).map(ex),i={id:e.id,representations:n,isTrickModeTrack:!0};return!0===e.isSignInterpreted&&(i.signInterpreted=!0),i}):void 0,i={id:e.id,representations:(t?e.representations.filter(function(e){return!0===e.isSupported&&!1!==e.decipherable}):e.representations).map(ex),label:e.label};return!0===e.isSignInterpreted&&(i.signInterpreted=!0),!0===e.isTrickModeTrack&&(i.isTrickModeTrack=!0),void 0!==n&&(i.trickModeTracks=n),i},eD=function(e){var t=e.id,n=e.bitrate,i=e.codecs,r=e.isSpatialAudio,a=e.isSupported,o=e.decipherable;return{id:t,bitrate:n,codec:null==i?void 0:i[0],isSpatialAudio:r,isCodecSupported:a,decipherable:o}},ex=function(e){var t=e.id,n=e.bitrate,i=e.frameRate,r=e.width,a=e.height,o=e.codecs,s=e.hdrInfo,u=e.isSupported,l=e.decipherable;return{id:t,bitrate:n,frameRate:i,width:r,height:a,codec:null==o?void 0:o[0],hdrInfo:s,isCodecSupported:u,decipherable:l}},eN=function(e){switch(e.type){case"audio":return{type:"audio",track:eC(e,!1)};case"video":return{type:"video",track:eP(e,!1)};case"text":return{type:"text",track:eM(e)}}},eO=function(e,t,n){var i={updatedAdaptations:[],removedAdaptations:[],addedAdaptations:[]};e.start=t.start,e.end=t.end,e.duration=t.duration,e.streamEvents=t.streamEvents;for(var r=e.getAdaptations(),a=t.getAdaptations(),o=0;o<r.length;o++)!function(e){var t=r[e],s=z(a,function(e){return e.id===t.id});if(-1===s){uw.warn('Manifest: Adaptation "'+r[e].id+'" not found when merging.');var u=y(r.splice(e,1),1)[0];e--,i.removedAdaptations.push({id:u.id,trackType:u.type})}else{var l,d=y(a.splice(s,1),1)[0],c=[],f=[],v=[];i.updatedAdaptations.push({adaptation:t.id,trackType:t.type,updatedRepresentations:c,addedRepresentations:f,removedRepresentations:v});for(var h=t.representations,p=d.representations.slice(),m=0;m<h.length;m++)!function(e){var t=h[e],i=z(p,function(e){return e.id===t.id});if(-1===i){uw.warn('Manifest: Representation "'.concat(h[e].id,'" not found when merging.'));var r=y(h.splice(e,1),1)[0];e--,v.push(r.id)}else{var a=y(p.splice(i,1),1)[0];c.push(t.getMetadataSnapshot()),t.cdnMetadata=a.cdnMetadata,0===n?t.index._replace(a.index):t.index._update(a.index)}m=e}(m);p.length>0&&(uw.warn("Manifest: ".concat(p.length," new Representations found when merging.")),(l=t.representations).push.apply(l,S(p)),f.push.apply(f,S(p.map(function(e){return e.getMetadataSnapshot()}))))}o=e}(o);if(a.length>0){uw.warn("Manifest: ".concat(a.length," new Adaptations found when merging."));var s=!0,u=!1,l=void 0;try{for(var d,c=a[Symbol.iterator]();!(s=(d=c.next()).done);s=!0){var f=d.value,v=e.adaptations[f.type];void 0===v?e.adaptations[f.type]=[f]:v.push(f),i.addedAdaptations.push(f.getMetadataSnapshot())}}catch(e){u=!0,l=e}finally{try{s||null==c.return||c.return()}finally{if(u)throw l}}}return i},eL=function(e,t){for(var n={updatedPeriods:[],addedPeriods:[],removedPeriods:[]},i=0,r=0;r<t.length;r++)!function(r){for(var a=t[r],o=i,s=e[o];void 0!==s&&s.id!==a.id;)s=e[++o];if(void 0!==s){var u,l,d=eO(s,a,0);n.updatedPeriods.push({period:{id:s.id,start:s.start,end:s.end,duration:s.duration,streamEvents:s.streamEvents},result:d});var c=t.slice(i,r),f=o-i,v=e.splice.apply(e,[i,f].concat(S(c)));(u=n.removedPeriods).push.apply(u,S(v.map(function(e){return{id:e.id,start:e.start,end:e.end}}))),(l=n.addedPeriods).push.apply(l,S(c.map(function(e){return e.getMetadataSnapshot()}))),i=r+1}}(r);if(i>e.length)return uw.error("Manifest: error when updating Periods"),n;if(i<e.length){var a,o,s=e.splice(i,e.length-i);(o=n.removedPeriods).push.apply(o,S(s.map(function(e){return{id:e.id,start:e.start,end:e.end}})))}var u=t.slice(i,t.length);return u.length>0&&(e.push.apply(e,S(u)),(a=n.addedPeriods).push.apply(a,S(u.map(function(e){return e.getMetadataSnapshot()})))),n},eU=function(e,t){var n={updatedPeriods:[],addedPeriods:[],removedPeriods:[]};if(0===e.length)return e.splice.apply(e,[0,0].concat(S(t))),(u=n.addedPeriods).push.apply(u,S(t.map(function(e){return e.getMetadataSnapshot()}))),n;if(0===t.length)return n;var i=e[e.length-1];if(i.start<t[0].start){if(i.end!==t[0].start)throw new u2("MANIFEST_UPDATE_ERROR","Cannot perform partial update: not enough data");return e.push.apply(e,S(t)),(l=n.addedPeriods).push.apply(l,S(t.map(function(e){return e.getMetadataSnapshot()}))),n}var r=z(e,function(e){return e.id===t[0].id});if(r<0)throw new u2("MANIFEST_UPDATE_ERROR","Cannot perform partial update: incoherent data");var a=eO(e[r],t[0],1);n.updatedPeriods.push({period:uk(e[r].getMetadataSnapshot(),{adaptations:void 0}),result:a});for(var o=r+1,s=1;s<t.length;s++)!function(i){for(var r=t[i],a=-1,s=o;s<e.length;s++)if(r.id===e[s].id){a=s;break}if(a<0){for(var u,l=-1,d=o;d<e.length;d++)if(r.start<e[d].start){l=d;break}var c=l-o,f=e.splice(o,c,r);n.addedPeriods.push(r.getMetadataSnapshot()),(u=n.removedPeriods).push.apply(u,S(f.map(function(e){return{id:e.id,start:e.start,end:e.end}})))}else{if(a>o){uw.warn("Manifest: old Periods not found in new when updating, removing");var v,h=e.splice(o,a-o);(v=n.removedPeriods).push.apply(v,S(h.map(function(e){return{id:e.id,start:e.start,end:e.end}}))),a=o}var p=eO(e[a],r,0);n.updatedPeriods.push({period:uk(e[a].getMetadataSnapshot(),{adaptations:void 0}),result:p})}o++}(s);if(o<e.length){uw.warn("Manifest: Ending Periods not found in new when updating, removing");var u,l,d,c=e.splice(o,e.length-o);(d=n.removedPeriods).push.apply(d,S(c.map(function(e){return{id:e.id,start:e.start,end:e.end}})))}return n},eF=function(e,t){var n=[],i=!0,r=!1,a=void 0,o=!0,s=!1,u=void 0,l=!0,d=!1,c=void 0;try{for(var f,v=e.periods[Symbol.iterator]();!(l=(f=v.next()).done);l=!0){var h=f.value;try{for(var p,m=h.getAdaptations()[Symbol.iterator]();!(o=(p=m.next()).done);o=!0){var g=p.value;try{for(var y,_=g.representations[Symbol.iterator]();!(i=(y=_.next()).done);i=!0){var S=y.value,b={manifest:e,period:h,adaptation:g,representation:S},E=t(b);E!==S.decipherable&&(n.push(b),S.decipherable=E,uw.debug('Decipherability changed for "'.concat(S.id,'"'),"(".concat(S.bitrate,")"),String(S.decipherable)))}}catch(e){r=!0,a=e}finally{try{i||null==_.return||_.return()}finally{if(r)throw a}}}}catch(e){s=!0,u=e}finally{try{o||null==m.return||m.return()}finally{if(s)throw u}}}}catch(e){d=!0,c=e}finally{try{l||null==v.return||v.return()}finally{if(d)throw c}}return n},eB=function(e,t){return e.segment.id===t.segment.id&&e.representation.uniqueId===t.representation.uniqueId},eV=function(e){if(i(e))return"";var t,n=e.period,r=e.adaptation,a=e.representation,o=e.segment;return t=o.isInit?"init":o.complete?"".concat(o.time,"-").concat(o.duration):"".concat(o.time),"".concat(r.type," P: ").concat(n.id," A: ").concat(r.id," R: ").concat(a.id," S: ").concat(t)},ez=function(e){return v(e,uj)?new u5("PIPELINE_LOAD_ERROR",e):eh(e,{defaultCode:"PIPELINE_LOAD_ERROR",defaultReason:"Unknown error when fetching the Manifest"})},eK=function(e,t){var n;return new Promise(function(i,r){var a=function(e){void 0!==n&&n(),r(e)};if(null!==e.cancellationError)return r(e.cancellationError);var o=!1;n=t(function(t){e.deregister(a),o=!0,i(t)},function(t){e.deregister(a),o=!0,r(t)}),o||e.register(a)})},eW=function(e,t){return eK(t,function(t){var n=setTimeout(function(){return t()},e);return function(){return clearTimeout(n)}})},eG=function(e){return e*((2*Math.random()-1)*.3+1)},eH=function(e,t,n,i,r){return ll.apply(this,arguments)},eq=function(e,t,n){return eH(null,null,e,t,n)},eY=function(e,t){var n=new WeakMap;return{createRequest:function(i,r,a,o){var s=function(e){return t(i,a,e)},u=e.create(s,r,a,o);return n.set(u,s),u},updatePriority:function(t,i){var r=n.get(t);if(void 0===r){uw.warn("Fetchers: Cannot update the priority of a request: task not found.");return}e.updatePriority(r,i)}}},ej=function(e,t){return 0===e.length?-1:void 0!==t.id?z(e,function(e){return e.id===t.id}):z(e,function(e){return e.baseUrl===t.baseUrl})},eQ=function(e,t,n,a,o){u=void 0===o.connectionTimeout||o.connectionTimeout<0?void 0:o.connectionTimeout;var s,u,l={timeout:o.requestTimeout<0?void 0:o.requestTimeout,connectionTimeout:u},d=e_(["audio","video"],e)?new lf:void 0,c=t.loadSegment,f=t.parseSegment;return s=r(function(e,t,r){var s,u,h,p,m,g,y,_,S,b,E,k,T,w,A,R,C,M,P,D;function x(){var e;void 0===E&&(uw.debug("SF: Segment request cancelled",S),E=null,null==(e=a.onRequestEnd)||e.call(a,{id:b}))}function N(e){return c(e,A,l,r,R)}function O(e,t){k.push(!1);var n=k.length-1;return function(i){try{var r=f({data:e,isChunked:t},A,i);return k[n]||(T=void 0!==T&&"media"===r.segmentType&&null!==r.chunkInfos&&void 0!==r.chunkInfos.duration?T+r.chunkInfos.duration:void 0,k[n]=!0,U()),r}catch(e){throw eh(e,{defaultCode:"PIPELINE_PARSE_ERROR",defaultReason:"Unknown parsing error"})}}}function L(e){t.onRetry(ez(e))}function U(){var t;w||!i(E)&&void 0!==E.size&&void 0!==E.requestDuration&&k.length>0&&k.every(function(e){return e})&&(w=!0,null==(t=a.onMetrics)||t.call(a,{size:E.size,requestDuration:E.requestDuration,content:e,segmentDuration:T}))}return I(this,function(i){switch(i.label){case 0:if(p=e.segment,m=e.adaptation,g=e.representation,y=e.manifest,_=e.period,S=eV(e),b=lv(),k=[],T=0,w=!1,A={segment:p,type:m.type,language:m.language,isLive:y.isLive,periodStart:_.start,periodEnd:_.end,mimeType:g.mimeType,codecs:g.codecs[0],manifestPublishTime:y.publishTime},R={onProgress:function(e){var t;void 0===E&&void 0!==e.totalSize&&e.size<e.totalSize&&(null==(t=a.onProgress)||t.call(a,{duration:e.duration,size:e.size,totalSize:e.totalSize,timestamp:uN(),id:b}))},onNewChunk:function(e){t.onChunk(O(e,!0))}},null!==(C=void 0!==d?d.get(e):null))return[2,(uw.debug("SF: Found wanted segment in cache",S),t.onChunk(O(C,!1)),Promise.resolve())];uw.debug("SF: Beginning request",S),null==(s=a.onRequestBegin)||s.call(a,{requestTimestamp:uN(),id:b,content:e}),r.register(x),i.label=1;case 1:return i.trys.push([1,3,,4]),[4,eH(e.representation.cdnMetadata,n,N,uk({onRetry:L},o),r)];case 2:return"segment-loaded"===(M=i.sent()).resultType?(P=M.resultData.responseData,void 0!==d&&d.add(e,M.resultData.responseData),t.onChunk(O(P,!1))):"segment-created"===M.resultType&&t.onChunk(O(M.resultData,!1)),uw.debug("SF: Segment request ended with success",S),t.onAllChunksReceived(),"segment-created"!==M.resultType?(E=M.resultData,U()):E=null,r.isCancelled()||null==(u=a.onRequestEnd)||u.call(a,{id:b}),r.deregister(x),[3,4];case 3:throw D=i.sent(),r.deregister(x),E=null,v(D,uD)?(uw.debug("SF: Segment request aborted",S),D):(uw.debug("SF: Segment request failed",S),null==(h=a.onRequestEnd)||h.call(a,{id:b}),ez(D));case 4:return[2]}})}),function(e,t,n){return s.apply(this,arguments)}},eX=function(e){var t=e.maxRetry,n=e.lowLatencyMode,i=e.requestTimeout,r=e.connectionTimeout,a=uT.getCurrent(),o=a.DEFAULT_MAX_REQUESTS_RETRY_ON_ERROR,s=a.DEFAULT_REQUEST_TIMEOUT,u=a.DEFAULT_CONNECTION_TIMEOUT,l=a.INITIAL_BACKOFF_DELAY_BASE,d=a.MAX_BACKOFF_DELAY_BASE;return{maxRetry:null!=t?t:o,baseDelay:n?l.LOW_LATENCY:l.REGULAR,maxDelay:n?d.LOW_LATENCY:d.REGULAR,requestTimeout:void 0===i?s:i,connectionTimeout:void 0===r?u:r}},e$=function(e,t){return z(t,function(t){return t.taskFn===e})},eZ=function(e){for(var t,n=e.representations,r=null,a=0;a<n.length;a++)if(n[a].index!==t){t=n[a].index;var o=n[a].index.getLastAvailablePosition();if(void 0===o)return;null!==o&&(r=i(r)?o:Math.min(r,o))}return r},eJ=function(e){for(var t,n=e.representations,r=null,a=0;a<n.length;a++)if(n[a].index!==t){t=n[a].index;var o=n[a].index.getEnd();if(void 0===o)return;null!==o&&(r=i(r)?o:Math.min(r,o))}return r},e0=function(e,t,n,i,r,a){a.register(function(){t.interruptDurationSetting()});var o=new lg(e,n,i.getBufferTypes());a.register(function(){o.dispose()}),o.addEventListener("warning",function(e){return r.onWarning(e)}),o.addEventListener("periodChange",function(e){return r.onPeriodChanged(e)}),o.addEventListener("endingPositionChange",function(e){t.setDuration(e.endingPosition,e.isEnd)}),o.addEventListener("endOfStream",function(){uw.debug("Init: end-of-stream order received."),t.maintainEndOfStream()}),o.addEventListener("resumeStream",function(){t.stopEndOfStream()});var s=o.getCurrentEndingTime();return t.setDuration(s.endingPosition,s.isEnd),o},e1=function(e,t){var n,i=e.segmentSink,r=e.playbackObserver,a=e.maxBufferBehind,o=e.maxBufferAhead,s=[];function u(){null!==s&&e2(i,n,s,a.getValue(),o.getValue(),t).catch(function(e){var t=v(e,Error)?e.message:"Unknown error";uw.error("Could not run BufferGarbageCollector:",t)})}r.listen(function(e){n=e.position.getWanted(),s=e.buffered[i.bufferType],u()},{includeLastObservation:!0,clearSignal:t}),a.onUpdate(u,{clearSignal:t}),o.onUpdate(u,{clearSignal:t}),u()},e2=function(e,t,n,i,r,a){return lS.apply(this,arguments)},e5=function(e){if(void 0===e.bufferedStart||1!==e.status)return!1;var t=e.start,n=e.end-t,i=uT.getCurrent(),r=i.MAX_MANIFEST_BUFFERED_START_END_DIFFERENCE,a=i.MAX_MANIFEST_BUFFERED_DURATION_DIFFERENCE;return Math.abs(t-e.bufferedStart)<=r&&(void 0===e.bufferedEnd||e.bufferedEnd>e.bufferedStart&&Math.abs(e.bufferedEnd-e.bufferedStart-n)<=Math.min(a,n/3))},e4=function(e){if(void 0===e.bufferedEnd||1!==e.status)return!1;var t=e.start,n=e.end,i=n-t,r=uT.getCurrent(),a=r.MAX_MANIFEST_BUFFERED_START_END_DIFFERENCE,o=r.MAX_MANIFEST_BUFFERED_DURATION_DIFFERENCE;return Math.abs(n-e.bufferedEnd)<=a&&void 0!==e.bufferedStart&&e.bufferedEnd>e.bufferedStart&&Math.abs(e.bufferedEnd-e.bufferedStart-i)<=Math.min(o,i/3)},e3=function(e,t,n,i){var r=uT.getCurrent(),a=r.MAX_MANIFEST_BUFFERED_START_END_DIFFERENCE,o=r.MISSING_DATA_TRIGGER_SYNC_DELAY,s=r.SEGMENT_SYNCHRONIZATION_DELAY;if(void 0!==e.bufferedStart)e.bufferedStart<t&&(uw.debug("SI: Segment partially GCed at the start",i,e.bufferedStart,t),e.bufferedStart=t),!e.precizeStart&&e5(e)&&(e.start=e.bufferedStart,e.precizeStart=!0);else if(e.precizeStart)uw.debug("SI: buffered start is precize start",i,e.start),e.bufferedStart=e.start;else if(null!==n&&n.end>t&&(n.precizeEnd||e.start-n.end<=a))uw.debug("SI: buffered start is end of previous segment",i,t,e.start,n.end),e.bufferedStart=n.end,e5(e)&&(e.start=n.end,e.precizeStart=!0);else if(e.start-t<=a){var u=uN();if(e.start-t>=o&&u-e.insertionTs<s){uw.debug("SI: Ignored bufferedStart synchronization",i,t,e.start,u-e.insertionTs);return}uw.debug("SI: found true buffered start",i,t,e.start),e.bufferedStart=t,e5(e)&&(e.start=t,e.precizeStart=!0)}else if(t<e.start)uw.debug("SI: range start too far from expected start",i,t,e.start),e.bufferedStart=e.start;else{var l=uN();if(e.start-t>=o&&l-e.insertionTs<s){uw.debug("SI: Ignored bufferedStart synchronization",i,t,e.start,l-e.insertionTs);return}uw.debug("SI: Segment appears immediately garbage collected at the start",i,t,e.start),e.bufferedStart=t}},e8=function(e,t,n){var i=uT.getCurrent(),r=i.MAX_MANIFEST_BUFFERED_START_END_DIFFERENCE,a=i.MISSING_DATA_TRIGGER_SYNC_DELAY,o=i.SEGMENT_SYNCHRONIZATION_DELAY;if(void 0!==e.bufferedEnd)e.bufferedEnd>t&&(uw.debug("SI: Segment partially GCed at the end",n,e.bufferedEnd,t),e.bufferedEnd=t),!e.precizeEnd&&t-e.end<=r&&e4(e)&&(e.precizeEnd=!0,e.end=t);else if(e.precizeEnd)uw.debug("SI: buffered end is precize end",n,e.end),e.bufferedEnd=e.end;else if(t-e.end<=r){var s=uN();if(t-e.end>=a&&s-e.insertionTs<o){uw.debug("SI: Ignored bufferedEnd synchronization",n,t,e.end,s-e.insertionTs);return}uw.debug("SI: found true buffered end",n,t,e.end),e.bufferedEnd=t,e4(e)&&(e.end=t,e.precizeEnd=!0)}else if(t>e.end)uw.debug("SI: range end too far from expected end",n,t,e.end),e.bufferedEnd=e.end;else{var u=uN();if(t-e.end>=a&&u-e.insertionTs<o){uw.debug("SI: Ignored bufferedEnd synchronization",n,t,e.end,u-e.insertionTs);return}uw.debug("SI: Segment appears immediately garbage collected at the end",n,e.bufferedEnd,t),e.bufferedEnd=t}},e6=function(e){var t={},n=[],i=null,r=null;function a(e){var t=String.fromCharCode(n.length+65);return n.push({letter:t,periodId:e.period.id,representationId:e.representation.id,bitrate:e.representation.bitrate}),t}for(var o="",s=0;s<e.length;s++){var u=e[s];if(void 0!==u.bufferedStart&&void 0!==u.bufferedEnd){var d=u.infos.period.id,c=u.infos.representation.id,f=t[d],v=void 0;void 0===f?(v=a(u.infos),t[d]=l({},c,v)):void 0===f[c]?(v=a(u.infos),f[c]=v):v=f[c],null===i?o+="".concat(u.bufferedStart.toFixed(2),"|").concat(v,"|"):r===v?i.bufferedEnd+.016666666666666666<u.bufferedStart&&(o+="".concat(i.bufferedEnd.toFixed(2)," ~ ").concat(u.bufferedStart.toFixed(2),"|").concat(v,"|")):o+="".concat(i.bufferedEnd.toFixed(2)," ~ ").concat(u.bufferedStart.toFixed(2),"|").concat(v,"|"),i=u,r=v}}return null!==i&&(o+=String(i.end.toFixed(2))),n.forEach(function(e){var t;o+="\n[".concat(e.letter,"] P: ").concat(e.periodId," || R: ").concat(e.representationId,"(").concat(null!=(t=e.bitrate)?t:"unknown bitrate",")")}),o},e9=function(e,t){for(var n=0;n<e.length;n++)if(e[n].infos.period.start>=t.start)return n>0?e[n-1]:null;return e.length>0?e[e.length-1]:null},e7=function(e,t){for(var n=0;n<e.length;n++)if(e[n].infos.period.start>t.start)return e[n];return null},te=function(e){if(ui.CURRENT_ENV!==ui.PRODUCTION&&("object"!=typeof e||null!==e&&!v(e,ArrayBuffer)&&!v(e.buffer,ArrayBuffer)))throw Error("Invalid data given to the AudioVideoSegmentSink")},tt=function(e){if(ui.CURRENT_ENV!==ui.PRODUCTION&&("object"!=typeof e||null===e||"string"!=typeof e.data||"string"!=typeof e.type||void 0!==e.language&&"string"!=typeof e.language||void 0!==e.start&&"number"!=typeof e.start||void 0!==e.end&&"number"!=typeof e.end))throw Error("Invalid format given to a TextSegmentSink")},tn=function(e){return"audio"===e||"video"===e},ti=function(e,t,n,i,r){var a=e.period,o=e.adaptation,s=e.representation,u=tr(r,t);if(null===u){if(null===n){if(i&&void 0!==a.end&&t.end>=a.end)return{start:void 0,end:null};var l=s.index.checkDiscontinuity(t.start);if(null!==l)return{start:void 0,end:l}}return null}var d=r[u];if(void 0!==d.bufferedStart&&d.bufferedStart>t.start&&(null===n||d.infos.segment.end<=n)){var c=d.bufferedStart;return i||!1===s.index.awaitSegmentBetween(t.start,c)?(uw.debug("RS: current discontinuity encountered",o.type,d.bufferedStart),{start:void 0,end:c}):null}var f=ta(r,t,u+1);if(null!==f){var v=r[f-1],h=r[f];if(null===n||h.infos.segment.end<=n){if(!i&&!1!==s.index.awaitSegmentBetween(v.infos.segment.end,h.infos.segment.time))return null;var p=v.bufferedEnd,m=h.bufferedStart;return uw.debug("RS: future discontinuity encountered",o.type,p,m),{start:p,end:m}}}if(null===n){if(i&&void 0!==a.end){if(t.end<a.end)return null;var g=to(r,a.end);if(null!==g){var y=r[g];if(void 0!==y.bufferedEnd&&y.bufferedEnd<a.end)return uw.debug("RS: discontinuity encountered at the end of the current period",o.type,y.bufferedEnd,a.end),{start:y.bufferedEnd,end:null}}}if(void 0!==a.end&&t.end>=a.end)return null;for(var _=r.length-1;_>=0;_--){var S=r[_];if(void 0===S.bufferedStart)break;if(S.bufferedStart<t.end){if(void 0!==S.bufferedEnd&&S.bufferedEnd<t.end){var b=s.index.checkDiscontinuity(t.end);if(null!==b)return{start:S.bufferedEnd,end:b}}break}}}return null},tr=function(e,t){for(var n=0;n<e.length;n++){var i=e[n];if(void 0===i.bufferedStart||void 0===i.bufferedEnd||i.bufferedStart>=t.end)break;if(i.bufferedEnd>t.start)return n}return null},ta=function(e,t,n){if(n<=0)return uw.error("RS: Asked to check a discontinuity before the first chunk."),null;for(var i=n;i<e.length;i++){var r=e[i],a=e[i-1];if(void 0===r.bufferedStart||void 0===a.bufferedEnd||r.bufferedStart>=t.end)break;if(r.bufferedStart-a.bufferedEnd>0)return i}return null},to=function(e,t){for(var n=e.length-1;n>=0;n--){var i=e[n];if(void 0===i.bufferedStart)break;if(i.bufferedStart<t)return n}return null},ts=function(e){var t=e.bufferedSegments,n=e.content,i=e.currentPlaybackTime,r=e.fastSwitchThreshold,a=e.getBufferedHistory,o=e.neededRange,s=e.segmentsBeingPushed,u=e.maxBufferSize,l=n.adaptation,d=n.representation,c=tu(t,s,u),f=d.index.getSegments(o.start,o.end-o.start),v=t.filter(function(e){return!td(e.infos,n,i,r)}).filter(function(e,t,n){var i=0===t?null:n[t-1],r=t>=n.length-1?null:n[t+1],s=null;if(tf(e,i,o.start)){if(th(s=a(e.infos),e.bufferedStart))return!1;uw.debug("Stream: skipping segment gc-ed at the start",e.start,e.bufferedStart)}if(tv(e,r,o.end)){if(tp(s=null!=s?s:a(e.infos),e.bufferedEnd))return!1;uw.debug("Stream: skipping segment gc-ed at the end",e.end,e.bufferedEnd)}return!0}),h=uT.getCurrent(),p=h.MINIMUM_SEGMENT_SIZE,m=h.MIN_BUFFER_AHEAD,g=!1,y=Math.min(1/60,p),_=!1,S=[];return{segmentsToLoad:f.filter(function(e){var t=uk({segment:e},n);if(s.length>0&&s.some(function(e){return eB(t,e)}))return!1;var u=e.duration,f=e.time,h=e.end;if(e.isInit)return!0;if(g)return S.push(e),!1;if(e.complete&&u<p||s.length>0&&s.some(function(e){if(e.period.id!==n.period.id||e.adaptation.id!==n.adaptation.id)return!1;var a=e.segment;return!(a.time-y>f)&&!(a.end+y<h)&&!td(e,t,i,r)}))return!1;for(var b=0;b<v.length;b++){var E=v[b];if(E.infos.period.id===n.period.id){var k=E.infos.segment;if(f-k.time>-y&&k.end-h>-y)return!1}}var T=u*n.representation.bitrate;if(c-T<0&&(_=!0,f>o.start+m))return g=!0,S.push(e),!1;var w=a(t);if(w.length>1){var I=w[w.length-1],A=w[w.length-2];if(null===I.buffered&&null===A.buffered)return uw.warn("Stream: Segment GCed multiple times in a row, ignoring it.","If this happens a lot and lead to unpleasant experience, please  check your device's available memory. If it's low when this message is emitted, you might want to update the RxPlayer's settings (`maxBufferAhead`, `maxVideoBufferSize` etc.) so less memory is used by regular media data buffering."+l.type,d.id,e.time),!1}for(var R=0;R<v.length;R++){var C=v[R];if(C.end+y>f){var M=C.start>f+y||tl(v,R).end<h-y;return M&&(c-=T),M}}return c-=T,!0}),segmentsOnHold:S,isBufferFull:_}},tu=function(e,t,n){var i=8e3*n;return i-=t.reduce(function(e,t){return e+t.representation.bitrate*t.segment.duration},0),e.reduce(function(e,t){return void 0!==t.chunkSize?e-8*t.chunkSize:e},i)},tl=function(e,t){for(var n=t+1,i=Math.min(1/60,uT.getCurrent().MINIMUM_SEGMENT_SIZE);n<e.length-1&&e[n-1].end+i>e[n].start;)n++;return e[--n]},td=function(e,t,n,i){var r=uT.getCurrent().CONTENT_REPLACEMENT_PADDING;return e.period.id===t.period.id&&!(e.segment.time<n+r)&&(e.adaptation.id!==t.adaptation.id||tc(e.representation,t.representation,i))},tc=function(e,t,n){var i=e.bitrate,r=uT.getCurrent().BITRATE_REBUFFERING_RATIO;return void 0===n?t.bitrate>i*r:i<n&&t.bitrate>i},tf=function(e,t,n){var i=uT.getCurrent().MAX_TIME_MISSING_FROM_COMPLETE_SEGMENT;return void 0!==e.bufferedStart&&(null===t||void 0===t.bufferedEnd||!(e.bufferedStart-t.bufferedEnd<.1))&&n<e.bufferedStart&&e.bufferedStart-e.start>i&&(uw.info("Stream: The start of the wanted segment has been garbage collected",e.start,e.bufferedStart),!0)},tv=function(e,t,n){var i=uT.getCurrent().MAX_TIME_MISSING_FROM_COMPLETE_SEGMENT;return void 0!==e.bufferedEnd&&(null===t||void 0===t.bufferedStart||!(t.bufferedStart-e.bufferedEnd<.1))&&n>e.bufferedEnd&&e.end-e.bufferedEnd>i&&(uw.info("Stream: The end of the wanted segment has been garbage collected",e.end,e.bufferedEnd),!0)},th=function(e,t){if(e.length<2)return!0;var n,i,r=null==(n=e[e.length-1].buffered)?void 0:n.start;if(void 0!==t&&void 0!==r&&t-r>.05)return!0;var a=null==(i=e[e.length-2].buffered)?void 0:i.start;return void 0===a||void 0===r||Math.abs(a-r)>.01},tp=function(e,t){if(e.length<2)return!0;var n,i,r=null==(n=e[e.length-1].buffered)?void 0:n.end;if(void 0!==t&&void 0!==r&&r-t>.05)return!0;var a=null==(i=e[e.length-2].buffered)?void 0:i.end;return void 0===a||void 0===r||Math.abs(a-r)>.01},tm=function(e,t){for(var n=e-t,i=uT.getCurrent().SEGMENT_PRIORITIES_STEPS,r=0;r<i.length;r++)if(n<i[r])return r;return i.length},tg=function(e,t,n,i,r,a,o){var s,u,l,d,c=e.representation,f=null!=(l=null!=(u=n.getIsPaused())?u:n.getReference().getValue().paused.pending)?l:n.getReference().getValue().paused.last,v=null!=(d=n.getPlaybackRate())?d:n.getReference().getValue().speed,h=t;(void 0===f||void 0===v||f||v<=0)&&(h-=.1);var p=ty(e,h,r),m=c.index.shouldRefresh(p.start,p.end),g=o.getPendingOperations().filter(function(e){return 2===e.type}).map(function(e){return e.value}),y=tS({start:Math.max(p.start-.5,0),end:p.end+.5},o.getLastKnownInventory()),_=n.getCurrentTime();void 0===_&&(_=n.getReference().getValue().position.getWanted());var b=ts({content:e,bufferedSegments:y,currentPlaybackTime:_,fastSwitchThreshold:i,getBufferedHistory:o.getSegmentHistory.bind(o),neededRange:p,segmentsBeingPushed:g,maxBufferSize:a}),E=b.segmentsToLoad,k=b.segmentsOnHold,T=b.isBufferFull,w=E.map(function(e){return{priority:tm(e.time,h),segment:e}}),I=c.index.isInitialized()&&!c.index.isStillAwaitingFutureSegments()&&p.hasReachedPeriodEnd&&0===w.length&&0===k.length,A=null;return g.length>0&&(A=(s=Math).min.apply(s,S(g.map(function(e){return e.segment.time})))),k.length>0&&(A=null!==A?Math.min(A,k[0].time):k[0].time),w.length>0&&(A=null!==A?Math.min(A,w[0].segment.time):w[0].segment.time),{imminentDiscontinuity:ti(e,p,A,I,y),hasFinishedLoading:I,neededSegments:w,isBufferFull:T,shouldRefreshManifest:m}},ty=function(e,t,n){var r,a,o,s=e.manifest,u=e.period,l=e.representation,d=l.index.getLastAvailablePosition(),c=l.index,f=(a=!i(d)&&lA.isNative(e.adaptation.type)&&t>=d&&c.isInitialized()&&!c.isStillAwaitingFutureSegments()&&t_(s,u,t)?d-1:t-.1)+n;return o=!(!l.index.isInitialized()||l.index.isStillAwaitingFutureSegments())&&void 0!==u.end&&(void 0===d?f>=u.end:null===d||f>=d),{start:Math.max(a,u.start),end:Math.min(f,null!=(r=u.end)?r:1/0),hasReachedPeriodEnd:o}},t_=function(e,t,n){var i,r=e.getPeriodAfter(t);return t.containsTime(n,r)&&e.isLastPeriodKnown&&t.id===(null==(i=e.periods[e.periods.length-1])?void 0:i.id)},tS=function(e,t){for(var n=Math.max(1/60,uT.getCurrent().MINIMUM_SEGMENT_SIZE),i=e.start+n,r=e.end-n,a=[],o=t.length-1;o>=0;o--){var s=t[o],u=s.infos.representation;if(1===s.status&&!1!==u.decipherable&&!1!==u.isSupported){var l=s.infos.segment,d=l.time/l.timescale;((l.complete?d+l.duration/l.timescale:s.end)>i&&d<r||s.end>i&&s.start<r)&&a.unshift(s)}}return a},tb=function(e){return new Promise(function(t){setTimeout(t,e)})},tE=function(e,t,n,i,r){return lM.apply(this,arguments)},tk=function(e,t,n,i,r){if("lazy"===n.switchingMode)return{type:"continue",value:void 0};var a=i.getLastKnownInventory(),o=[],s=!0,u=!1,l=void 0;try{for(var d,c,f,v,h,p=a[Symbol.iterator]();!(s=(h=p.next()).done);s=!0){var m=h.value;m.infos.period.id!==e.id||m.infos.adaptation.id===t.id&&e_(n.representationIds,m.infos.representation.id)||U(o,{start:null!=(d=m.bufferedStart)?d:m.start,end:null!=(c=m.bufferedEnd)?c:m.end})}}catch(e){u=!0,l=e}finally{try{s||null==p.return||p.return()}finally{if(u)throw l}}var g=i.getPendingOperations(),y=!0,_=!1,S=void 0;try{for(var b,E=g[Symbol.iterator]();!(y=(b=E.next()).done);y=!0){var k=b.value;if(0===k.type){var T=k.value.inventoryInfos;if(T.period.id===e.id&&(T.adaptation.id!==t.id||!e_(n.representationIds,T.representation.id))){var w=T.segment.time,I=w+T.segment.duration;U(o,{start:w,end:I})}}}}catch(e){_=!0,S=e}finally{try{y||null==E.return||E.return()}finally{if(_)throw S}}if(0===o.length)return{type:"continue",value:void 0};if("reload"===n.switchingMode){var A=r.getReadyState();if(void 0===A||A>1)return{type:"needs-reload",value:void 0}}var R="direct"===n.switchingMode,C=[],M=e9(a,e);if(null!==M&&(void 0===M.bufferedEnd||e.start-M.bufferedEnd<1)&&C.push({start:0,end:e.start+1}),!R){var P=uT.getCurrent().ADAP_REP_SWITCH_BUFFER_PADDINGS,D=t.type,x=null!=(f=P[D].before)?f:0,N=null!=(v=P[D].after)?v:0,O=r.getCurrentTime();void 0===O&&(O=r.getReference().getValue().position.getPolled()),C.push({start:O-x,end:O+N})}if(void 0!==e.end){var L=e7(a,e);null!==L&&(void 0===L.bufferedStart||L.bufferedStart-e.end<1)&&C.push({start:e.end-1,end:Number.MAX_VALUE})}var F=V(o,C);return 0===F.length?{type:"continue",value:void 0}:R?{type:"flush-buffer",value:F}:{type:"clean-buffer",value:F}},tT=function(e,t,n){if("function"==typeof String.prototype.startsWith)return e.startsWith(t,n);var i="number"==typeof n?Math.max(n,0):0;return e.substring(i,i+t.length)===t},tw=function(e,t,n,i,r,a){if(void 0!==e.codec&&"reload"===a.onCodecSwitch&&!tI(n,e.codec))return{type:"needs-reload",value:void 0};var o=e.getLastKnownInventory(),s=[],u=!0,l=!1,d=void 0;try{for(var c,f,v,h,p,m=o[Symbol.iterator]();!(u=(p=m.next()).done);u=!0){var g=p.value;g.infos.period.id===t.id&&g.infos.adaptation.id!==n.id&&U(s,{start:null!=(c=g.bufferedStart)?c:g.start,end:null!=(f=g.bufferedEnd)?f:g.end})}}catch(e){l=!0,d=e}finally{try{u||null==m.return||m.return()}finally{if(l)throw d}}var y=e.getPendingOperations(),_=!0,S=!1,b=void 0;try{for(var E,k=y[Symbol.iterator]();!(_=(E=k.next()).done);_=!0){var T=E.value;if(0===T.type){var w=T.value.inventoryInfos;if(w.period.id===t.id&&w.adaptation.id!==n.id){var I=w.segment.time,A=I+w.segment.duration;U(s,{start:I,end:A})}}}}catch(e){S=!0,b=e}finally{try{_||null==k.return||k.return()}finally{if(S)throw b}}if(0===s.length)return{type:"continue",value:void 0};if("reload"===i){var R=r.getReadyState();if(void 0===R||R>1)return{type:"needs-reload",value:void 0}}var C="direct"===i,M=[],P=e9(o,t);if(null!==P&&(void 0===P.bufferedEnd||t.start-P.bufferedEnd<1)&&M.push({start:0,end:t.start+1}),!C){var D=n.type,x=uT.getCurrent().ADAP_REP_SWITCH_BUFFER_PADDINGS,N=null!=(v=x[D].before)?v:0,O=null!=(h=x[D].after)?h:0,L=r.getCurrentTime();void 0===L&&(L=r.getReference().getValue().position.getPolled()),M.push({start:L-N,end:L+O})}if(void 0!==t.end){var F=e7(o,t);null!==F&&(void 0===F.bufferedStart||F.bufferedStart-t.end<1)&&M.push({start:t.end-1,end:Number.MAX_VALUE})}var B=V(s,M);return 0===B.length?{type:"continue",value:void 0}:C&&"text"!==n.type?{type:"flush-buffer",value:B}:{type:"clean-buffer",value:B}},tI=function(e,t){return e.representations.some(function(e){return!0===e.isSupported&&!1!==e.decipherable&&lO(e.getMimeTypeString(),t)})},tA=function(e,t,n){var i=e.getStatus(t);if("initialized"===i.type)return uw.info("Stream: Reusing a previous SegmentSink for the type",t),i.value;var r=tR(n);return e.createSegmentSink(t,r)},tR=function(e){var t=e.representations.filter(function(e){return!0===e.isSupported&&!1!==e.decipherable});if(0===t.length)throw new u2("NO_PLAYABLE_REPRESENTATION","No Representation in the chosen "+e.type+" Adaptation can be played",{tracks:[eN(e)]});return t[0].getMimeTypeString()},tC=function(e,t,n,i,r,a){var o=i.period,s=!1;function u(){var i=e.getReference().getValue(),a=t.getValue(),u=i.position.getWanted();void 0!==o.end&&u+a>=o.end&&(uw.debug('Stream: full "empty" AdaptationStream',n),s=!0),r.streamStatusUpdate({period:o,bufferType:n,imminentDiscontinuity:null,position:u,isEmptyStream:!0,hasFinishedLoading:s,neededSegments:[]})}t.onUpdate(u,{emitCurrentValue:!1,clearSignal:a}),e.listen(u,{includeLastObservation:!1,clearSignal:a}),u()},tM=function(e,t){if(0===t.length)return[];for(var n=[],i=e.getLastKnownInventory(),r=0;r<i.length;r++){var a=function(e){var r=i[e];if(t.some(function(e){return r.infos.period.id===e.period.id&&r.infos.adaptation.id===e.adaptation.id&&r.infos.representation.id===e.representation.id})){var a=r.bufferedStart,o=r.bufferedEnd;if(void 0===a||void 0===o)return{v:(uw.warn("SO: No buffered start or end found from a segment."),[{start:0,end:Number.MAX_VALUE}])};var s=n[n.length-1];void 0!==s&&s.end===a?s.end=o:n.push({start:a,end:o})}}(r);if("object"===b(a))return a.v}return n},tP=function(e,t){if(0===t.length)return!1;var n=e.position.getPolled();return e.speed>=0?t[t.length-1].end>=n-5:t[0].start<=n+5},tD=function(e,t,n){var i=e.setMediaKeys(t,n).then(function(){uw.info("Compat: MediaKeys updated with success")}).catch(function(e){if(null===n){uw.error("Compat: Could not reset MediaKeys",v(e,Error)?e:"Unknown Error");return}throw uw.error("Compat: Could not update MediaKeys",v(e,Error)?e:"Unknown Error"),e});return ug?i:Promise.race([i,tb(1e3)])},tx=function(e){return lz.apply(this,arguments)},tN=function(e){if(uw.info("DRM: Clearing-up DRM session."),ud)return uw.info("DRM: disposing current MediaKeys."),tx(e);var t=lV.getState(e);return null!==t&&!0===t.keySystemOptions.closeSessionsOnStop?(uw.info("DRM: closing all current sessions."),t.loadedSessionsStore.closeAllSessions()):(uw.info("DRM: Nothing to clear. Returning right away. No state =",null===t),Promise.resolve())},tO=function(e){var t=new uM;return Promise.race([e.close().then(function(){t.cancel()}),e.closed.then(function(){t.cancel()}),function(){return n.apply(this,arguments)}()]);function n(){return(n=r(function(){var e,n;return I(this,function(r){switch(r.label){case 0:return r.trys.push([0,3,,4]),[4,eW(1e3,t.signal)];case 1:return r.sent(),[4,function(){return i.apply(this,arguments)}()];case 2:return r.sent(),[3,4];case 3:if(v(e=r.sent(),uD))return[2];return n=v(e,Error)?e.message:"Unknown error made it impossible to close the session",uw.error("DRM: ".concat(n)),[3,4];case 4:return[2]}})})).apply(this,arguments)}function i(){return(i=r(function(){var n;return I(this,function(i){switch(i.label){case 0:return i.trys.push([0,2,,4]),[4,e.update(new Uint8Array(1))];case 1:case 3:return i.sent(),[3,4];case 2:if(n=i.sent(),t.isUsed()||v(n,Error)&&"The session is already closed."===n.message)return[2];return[4,eW(1e3,t.signal)];case 4:if(!t.isUsed())throw Error("Compat: Couldn't know if session is closed");return[2]}})})).apply(this,arguments)}},tL=function(e){try{var t=e();return"object"==typeof t&&null!==t&&"function"==typeof t.then?t:Promise.resolve(t)}catch(e){return Promise.reject(e)}},tU=function(e,t){var n=document.createElement(e.tagName),i="on"+t;return i in n||(n.setAttribute(i,"return;"),"function"==typeof n[i])},tF=function(e,t){var n,i=e.reduce(function(e,n){return e.concat((void 0===t?lW:t).map(function(e){return e+n}))},[]);return function(e,t,r){if(!r.isCancelled()){if("undefined"!=typeof HTMLElement&&v(e,HTMLElement)){if(void 0===n&&(n=i.filter(function(t){return tU(e,t)})[0]),ed(n))e.addEventListener(n,t),r.register(function(){void 0!==n&&e.removeEventListener(n,t)});else{ui.CURRENT_ENV===ui.DEV&&uw.warn("compat: element ".concat(e.tagName," does not support any of these events: ")+i.join(", "));return}}i.forEach(function(n){var i=!1;"function"==typeof e.addEventListener?e.addEventListener(n,t):(i=!0,e["on"+n]=t),r.register(function(){"function"==typeof e.removeEventListener&&e.removeEventListener(n,t),i&&delete e["on"+n]})})}}},tB=function(e){var t,n=document;i(n.hidden)?i(n.mozHidden)?i(n.msHidden)?i(n.webkitHidden)||(t="webkit"):t="ms":t="moz":t="";var r=ed(t)?t+"Hidden":"hidden",a=ed(t)?t+"visibilitychange":"visibilitychange",o=new uR(!document[r],e);return tG(document,a,function(){var e=!document[r];o.setValueIfChanged(e)},e),o},tV=function(e,t){if(!0===e.webkitSupportsPresentationMode&&"function"==typeof e.webkitSetPresentationMode){var n=new uR({isEnabled:"picture-in-picture"===e.webkitPresentationMode,pipWindow:null},t);return tG(e,"webkitpresentationmodechanged",function(){var t="picture-in-picture"===e.webkitPresentationMode;n.setValue({isEnabled:t,pipWindow:null})},t),n}var i=new uR({isEnabled:document.pictureInPictureElement===e,pipWindow:null},t);return tG(e,"enterpictureinpicture",function(e){var t;i.setValue({isEnabled:!0,pipWindow:null!=(t=e.pictureInPictureWindow)?t:null})},t),tG(e,"leavepictureinpicture",function(){i.setValue({isEnabled:!1,pipWindow:null})},t),i},tz=function(e,t){var n,i=tB(t),r=new uR(!0,t);return t.register(function(){clearTimeout(n),n=void 0}),i.onUpdate(a,{clearSignal:t}),e.onUpdate(a,{clearSignal:t}),a(),r;function a(){(clearTimeout(n),n=void 0,e.getValue().isEnabled||i.getValue())?r.setValueIfChanged(!0):n=setTimeout(function(){r.setValueIfChanged(!1)},uT.getCurrent().INACTIVITY_DELAY)}},tK=function(e){var t,n,r=i(us.devicePixelRatio)||0===us.devicePixelRatio?1:us.devicePixelRatio,a=new uR({width:null==(t=us.screen)?void 0:t.width,height:null==(n=us.screen)?void 0:n.height,pixelRatio:r},e),o=setInterval(function(){var e=a.getValue();(e.width!==screen.width||e.height!==screen.height||e.pixelRatio!==r)&&a.setValue({width:screen.width,height:screen.height,pixelRatio:r})},2e4);return e.register(function(){clearInterval(o)}),a},tW=function(e,t,n){var r=i(us.devicePixelRatio)||0===us.devicePixelRatio?1:us.devicePixelRatio,a=new uR({width:e.clientWidth,height:e.clientHeight,pixelRatio:r},n),o=s;t.onUpdate(l,{clearSignal:n}),tG(us,"resize",l,n),tG(e,"enterpictureinpicture",l,n),tG(e,"leavepictureinpicture",l,n);var u=setInterval(l,2e4);return l(),n.register(function(){o(),clearInterval(u)}),a;function l(){o();var n=t.getValue(),u=n.pipWindow;if(n.isEnabled){if(i(u)){var l=a.getValue();(void 0!==l.width||void 0!==l.height||l.pixelRatio!==r)&&a.setValue({width:void 0,height:void 0,pixelRatio:r})}else{var d=function(){f()};u.addEventListener("resize",d),o=function(){u.removeEventListener("resize",d),o=s},f()}}else{var c=a.getValue();(c.width!==e.clientWidth||c.height!==e.clientHeight||c.pixelRatio!==r)&&a.setValue({width:e.clientWidth,height:e.clientHeight,pixelRatio:r})}function f(){var e=a.getValue();(e.width!==(null==u?void 0:u.width)||e.height!==(null==u?void 0:u.height)||e.pixelRatio!==r)&&a.setValue({width:null==u?void 0:u.width,height:null==u?void 0:u.height,pixelRatio:r})}}},tG=function(e,t,n,i){e.addEventListener(t,n),i.register(function(){e.removeEventListener(t,n)})},tH=function(e){if(e>=di.length)throw Error("Unable to parse base64 string.");var t=di[e];if(255===t)throw Error("Unable to parse base64 string.");return t},tq=function(e){var t,n="",i=e.length;for(t=2;t<i;t+=3)n+=dn[e[t-2]>>2]+dn[(3&e[t-2])<<4|e[t-1]>>4]+dn[(15&e[t-1])<<2|e[t]>>6]+dn[63&e[t]];return t===i+1&&(n+=dn[e[t-2]>>2]+dn[(3&e[t-2])<<4]+"=="),t===i&&(n+=dn[e[t-2]>>2]+dn[(3&e[t-2])<<4|e[t-1]>>4]+dn[(15&e[t-1])<<2]+"="),n},tY=function(e){var t=e.length%4,n=e;0!==t&&(uw.warn("base64ToBytes: base64 given miss padding"),n+=3===t?"=":2===t?"==":"===");var i=n.indexOf("=");if(-1!==i&&i<n.length-2)throw Error("Unable to parse base64 string.");for(var r,a=n.endsWith("==")?2:n.endsWith("=")?1:0,o=n.length,s=new Uint8Array(o/4*3),u=0,l=0;u<o;u+=4,l+=3)r=tH(n.charCodeAt(u))<<18|tH(n.charCodeAt(u+1))<<12|tH(n.charCodeAt(u+2))<<6|tH(n.charCodeAt(u+3)),s[l]=r>>16,s[l+1]=r>>8&255,s[l+2]=255&r;return s.subarray(0,s.length-a)},tj=function(e){for(var t=new Uint8Array(new ArrayBuffer(2*e.length)),n=0;n<t.length;n+=2){var i=e.charCodeAt(n/2);t[n]=255&i,t[n+1]=i>>8&255}return t},tQ=function(e){if(dr)try{return new TextDecoder("utf-16le").decode(e)}catch(e){var t=v(e,Error)?e:"";uw.warn("Utils: could not use TextDecoder to parse UTF-16LE, fallbacking to another implementation",t)}for(var n="",i=0;i<e.length;i+=2)n+=String.fromCharCode((e[i+1]<<8)+e[i]);return n},tX=function(e){if(da)try{return new TextEncoder().encode(e)}catch(e){var t=v(e,Error)?e:"";uw.warn("Utils: could not use TextEncoder to encode string into UTF-8, fallbacking to another implementation",t)}var n,i=encodeURIComponent(e);if("function"==typeof unescape)n=unescape(i);else{var r=/[0-9a-fA-F]/,a=i.length;n="";for(var o=0;o<i.length;o++){var s=!1;"%"===i[o]&&(o<=a-6&&"u"===i[o+1]&&r.test(i[o+2])&&r.test(i[o+3])&&r.test(i[o+4])&&r.test(i[o+5])?(n+=String.fromCharCode(parseInt(i.substring(o+1,o+6),16)),s=!0,o+=5):o<=a-3&&r.test(i[o+1])&&r.test(i[o+2])&&(n+=String.fromCharCode(parseInt(i.substring(o+1,o+3),16)),s=!0,o+=2)),s||(n+=i[o])}}for(var u=new Uint8Array(n.length),l=0;l<n.length;l++)u[l]=255&n.charCodeAt(l);return u},t$=function(e){for(var t="",n=0;n<e.length;n+=16e3){var i=e.subarray(n,n+16e3);t+=String.fromCharCode.apply(null,i)}return t},tZ=function(e,t){var n=e.toString(16);return n.length>=t?n:Array(t-n.length+1).join("0")+n},tJ=function(e){if(dr)try{return new TextDecoder().decode(e)}catch(e){var t=v(e,Error)?e:"";uw.warn("Utils: could not use TextDecoder to parse UTF-8, fallbacking to another implementation",t)}var n=e;239===n[0]&&187===n[1]&&191===n[2]&&(n=n.subarray(3));var i,r=t$(n);if("function"==typeof escape)i=escape(r);else{var a=/[A-Za-z0-9*_\+-\.\/]/;i="";for(var o=0;o<r.length;o++)if(a.test(r[o]))i+=r[o];else{var s=r.charCodeAt(o);i+=s>=256?"%u"+tZ(s,4):"%"+tZ(s,2)}}return decodeURIComponent(i)},t0=function(e){for(var t=e.length,n=new Uint8Array(t/2),i=0,r=0;i<t;i+=2,r++)n[r]=255&parseInt(e.substring(i,i+2),16);return n},t1=function(e){for(var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",n="",i=0;i<e.byteLength;i++)n+=(e[i]>>>4).toString(16)+(15&e[i]).toString(16),t.length>0&&i<e.byteLength-1&&(n+=t);return n},t2=function(e){W(16===e.length,"GUID length should be 16");var t=e[0],n=e[1],i=e[2],r=e[3],a=e[4],o=e[5],s=e[6],u=e[7],l=new Uint8Array(16);return l[0]=r,l[1]=i,l[2]=n,l[3]=t,l[4]=o,l[5]=a,l[6]=u,l[7]=s,l.set(e.subarray(8,16),8),l},t5=function(e,t){for(var n=t;n<e.length&&0!==e[n];)n+=1;var i=e.subarray(t,n);return{end:n+1,string:tJ(i)}},t4=function(e){return"function"==typeof(null==e?void 0:e.webkitGenerateKeyRequest)},t3=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];for(var i,r=t.length,a=-1,o=0;++a<r;)o+="number"==typeof(i=t[a])?i:i.length;var s=new Uint8Array(o),u=0;for(a=-1;++a<r;)"number"==typeof(i=t[a])?u+=i:i.length>0&&(s.set(i,u),u+=i.length);return s},t8=function(e,t){return(e[t+0]<<8)+(e[t+1]<<0)},t6=function(e,t){return 65536*e[t+0]+256*e[t+1]+e[t+2]},t9=function(e,t){return 16777216*e[t+0]+65536*e[t+1]+256*e[t+2]+e[t+3]},t7=function(e,t){return(16777216*e[t+0]+65536*e[t+1]+256*e[t+2]+e[t+3])*4294967296+16777216*e[t+4]+65536*e[t+5]+256*e[t+6]+e[t+7]},ne=function(e){return new Uint8Array([e>>>8&255,255&e])},nt=function(e){return new Uint8Array([e>>>24&255,e>>>16&255,e>>>8&255,255&e])},nn=function(e){var t=e%4294967296,n=(e-t)/4294967296;return new Uint8Array([n>>>24&255,n>>>16&255,n>>>8&255,255&n,t>>>24&255,t>>>16&255,t>>>8&255,255&t])},ni=function(e){return new Uint8Array([255&e,e>>>8&255,e>>>16&255,e>>>24&255])},nr=function(e,t){var n=v(e,Uint8Array)?e:new Uint8Array(e),i=v(t,Uint8Array)?t:new Uint8Array(t);if(n[0]+256*n[1]+65536*n[2]+16777216*n[3]+4!==n.length)throw Error("Unsupported WebKit initData.");var r=tQ(n),a=r.indexOf("skd://"),o=tj(a>-1?r.substring(a+6):r),s=0,u=new Uint8Array(n.byteLength+4+o.byteLength+4+i.byteLength);return u.set(n),s+=n.length,u.set(ni(o.byteLength),s),s+=4,u.set(o,s),s+=o.byteLength,u.set(ni(i.byteLength),s),s+=4,u.set(i,s),u},na=function(e,t){return tL(function(){if(void 0===e.webkitSetMediaKeys)throw Error("No webKitMediaKeys API.");e.webkitSetMediaKeys(t)})},no=function(){if(void 0===dt)throw Error("No WebKitMediaKeys API.");return{isTypeSupported:dt.isTypeSupported,createCustomMediaKeys:function(e){return new dc(e)},setMediaKeys:function(e,t){if(null===t)return na(e,t);if(!v(t,dc))throw Error("Custom setMediaKeys is supposed to be called with webkit custom MediaKeys.");return t._setVideo(e)}}},ns=function(e,t){try{var n;return"function"==typeof e.setMediaKeys?n=e.setMediaKeys(t):"function"==typeof e.webkitSetMediaKeys?n=e.webkitSetMediaKeys(t):"function"==typeof e.mozSetMediaKeys?n=e.mozSetMediaKeys(t):"function"==typeof e.msSetMediaKeys&&null!==t&&(n=e.msSetMediaKeys(t)),"object"==typeof n&&null!==n&&"function"==typeof n.then?n:Promise.resolve(n)}catch(e){return Promise.reject(e)}},nu=function(e,t){for(var n=e.length,i=0;i+8<=n;){var r=t9(e,i);if(0===r)r=n-i;else if(1===r){if(i+16>n)return -1;r=t7(e,i+8)}if(isNaN(r)||r<=0)break;if(t9(e,i+4)===t)return i+r<=n?i:-1;i+=r}return -1},nl=function(e){for(var t=0,n=[],i=null;t<=e.length;){if(t===e.length){i=null;break}var r=nu(i=e.subarray(t,1/0),1836019558);if(r<0)break;var a=t9(e,r+t),o=t+r+a;if(o>e.length)break;var s=nu(i,1835295092);if(s<0)break;var u=t9(e,s+t),l=t+s+u;if(l>e.length)break;var d=Math.max(o,l),c=e.subarray(t,d);n.push(c),t=d}return 0===n.length?[null,i]:[t3.apply(void 0,S(n)),i]},nd=function(e,t){var n=e,i=!0,r=!1,a=void 0;try{for(var o,s=t[Symbol.iterator]();!(i=(o=s.next()).done);i=!0){var u=o.value,l=nc(n,u);if(null===l)return null;n=l}}catch(e){r=!0,a=e}finally{try{i||null==s.return||s.return()}finally{if(r)throw a}}return n},nc=function(e,t){var n=nh(e,t);return null!==n?e.subarray(n[1],n[2]):null},nf=function(e,t){for(var n=[],i=e;;){var r=nh(i,t);if(null===r)return n;W(0!==r[2]&&0!==i.length),n.push(i.subarray(r[1],r[2])),i=i.subarray(r[2])}},nv=function(e,t){var n=nh(e,t);return null!==n?e.subarray(n[0],n[2]):null},nh=function(e,t){for(var n,i,r=e.length,a=0,o=0;a+8<=r;){if(o=t9(e,i=a),i+=4,n=t9(e,i),i+=4,0===o)o=r-a;else if(1===o){if(i+8>r)return null;o=t7(e,i),i+=8}if(o<0)throw Error("ISOBMFF: Size out of range");if(n===t)return 1970628964===t&&(i+=16),[a,i,a+o];a+=o}return null},np=function(e,t,n,i,r){for(var a,o=e.length,s=0;s<o;s+=a){var u=s;a=t9(e,u);var l=t9(e,u+=4);if(u+=4,0===a)a=o-s;else if(1===a){if(u+8>o)return;a=t7(e,u),u+=8}if(1970628964===l&&u+16<=o&&t9(e,u)===t&&t9(e,u+4)===n&&t9(e,u+8)===i&&t9(e,u+12)===r)return u+=16,e.subarray(u,s+a)}},nm=function(e){var t=e.length;if(t<8)return uw.warn("ISOBMFF: box inferior to 8 bytes, cannot find offsets"),null;var n=0,i=t9(e,0),r=t9(e,n+=4);if(n+=4,0===i)i=t;else if(1===i){if(n+8>t)return uw.warn("ISOBMFF: box too short, cannot find offsets"),null;i=t7(e,n),n+=8}if(i<0)throw Error("ISOBMFF: Size out of range");return 1970628964===r&&(n+=16),[0,n,i]},ng=function(e){var t=0,n=nc(e,1836019574);if(null===n)return[];for(var i=[];t<n.length;){var r=void 0;try{r=nh(n,1886614376)}catch(e){var a=v(e,Error)?e:"";return uw.warn("Error while removing PSSH from ISOBMFF",a),i}if(null===r)break;var o=dv(n,r[0],r[2]),s=ny(o,r[1]-r[0]);void 0!==s&&i.push({systemId:s,data:o}),n[r[0]+4]=102,n[r[0]+5]=114,n[r[0]+6]=101,n[r[0]+7]=101,t=r[2]}return i},ny=function(e,t){if(e[t]>1){uw.warn("ISOBMFF: un-handled PSSH version");return}var n=t+4;if(!(n+16>e.length))return t1(dv(e,n,n+16))},n_=function(e){if(void 0!==dp[e])return dp[e];var t=tX(e);return dp[e]=t,t},nS=function(e,t){var n=t.length+8;return n<=dh?t3(nt(n),n_(e),t):t3(nt(1),n_(e),nn(n+8),t)},nb=function(e,t){return nS(e,t3.apply(void 0,S(t)))},nE=function(e){var t=nc(e,1836019558);return null===t?null:nc(t,1953653094)},nk=function(e){return nc(e,1835295092)},nT=function(e){var t=nc(e,1836019574);if(null===t)return null;var n=nc(t,1953653099);return null===n?null:nc(n,1835297121)},nw=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return nc(e.subarray(t),1701671783)},nI=function(e){var t=(e[8]<<0)+(e[9]<<8),n=tQ(e.subarray(10,t+10)),i=new DOMParser().parseFromString(n,"application/xml").querySelector("KID");if(null===i)throw Error("Cannot parse PlayReady private data: invalid XML");return t1(t2(tY(null===i.textContent?"":i.textContent))).toLowerCase()},nA=function(e,t){var n,i=nh(e,1936286840);if(null===i)return null;var r=t,a=i[2]-i[0],o=i[1],s=e[o],u=t9(e,o+=8);if(o+=4,0===s)n=t9(e,o),o+=4,r+=t9(e,o)+a,o+=4;else{if(1!==s)return null;n=t7(e,o),o+=8,r+=t7(e,o)+a,o+=8}var l=[],d=t8(e,o+=2);for(o+=2;--d>=0;){var c=t9(e,o);o+=4;var f=(2147483648&c)>>>31,v=2147483647&c;if(1===f)throw Error("sidx with reference_type `1` not yet implemented");var h=t9(e,o);o+=8,l.push({time:n,duration:h,timescale:u,range:[r,r+v-1]}),n+=h,r+=v}return l},nR=function(e){var t=nE(e);if(null!==t){var n=nc(t,1952867444);if(null!==n){var i=n[0];if(1===i)return t7(n,4);if(0===i)return t9(n,4)}}},nC=function(e){var t=nc(e,1952868452);if(null!==t){var n=1,i=t6(t,1);return n+=3,(8&i)>0?(n+=4,(1&i)>0&&(n+=8),(2&i)>0&&(n+=4),t9(t,n)):void 0}},nM=function(e){var t=nf(e,1836019558).reduce(function(e,t){var n=nc(t,1953653094);return null!==n&&e.push(n),e},[]);if(0!==t.length){var n=0,i=!0,r=!1,a=void 0;try{for(var o,s=t[Symbol.iterator]();!(i=(o=s.next()).done);i=!0){var u=o.value,l=nc(u,1953658222);if(null===l)return;var d=0,c=l[0];if(d+=1,c>1)return;var f=t6(l,d);d+=3;var v=(256&f)>0,h=0;if(!v&&(h=nC(u),void 0===h))return;var p=(1&f)>0,m=(4&f)>0,g=(512&f)>0,y=(1024&f)>0,_=(2048&f)>0,S=t9(l,d);d+=4,p&&(d+=4),m&&(d+=4);for(var b=S,E=0;b-- >0;)v?(E+=t9(l,d),d+=4):E+=h,g&&(d+=4),y&&(d+=4),_&&(d+=4);n+=E}}catch(e){r=!0,a=e}finally{try{i||null==s.return||s.return()}finally{if(r)throw a}}return n}},nP=function(e){var t=nT(e);if(null!==t){var n=nc(t,1835296868);if(null!==n){var i=0,r=n[0];if(i+=4,1===r)return t9(n,i+16);if(0===r)return t9(n,i+8)}}},nD=function(e){var t=e.length;if(t<4)throw Error("Cannot update box length: box too short");var n=t9(e,0);if(0===n){if(!(t>dh))return e.set(nt(t),0),e;var i=new Uint8Array(t+8);return i.set(nt(1),0),i.set(e.subarray(4,8),4),i.set(nn(t+8),8),i.set(e.subarray(8,t),16),i}if(1===n){if(t<16)throw Error("Cannot update box length: box too short");return e.set(nn(t),8),e}if(t<=dh)return e.set(nt(t),0),e;var r=new Uint8Array(t+8);return r.set(nt(1),0),r.set(e.subarray(4,8),4),r.set(nn(t+8),8),r.set(e.subarray(8,t),16),r},nx=function(e){for(var t=[],n=0;n<e.length;){var i=nw(e,n);if(null===i)break;var r=i.length;n+=r;var a=i[0];if(0!==a)uw.warn("ISOBMFF: EMSG version "+a.toString()+" not supported.");else{var o=4,s=t5(i,4),u=s.end,l=s.string,d=t5(i,o=u),c=d.end,f=d.string,v=t9(i,o=c),h=t9(i,o+=4),p=t9(i,o+=4),m=t9(i,o+=4);o+=4;var g={schemeIdUri:l,value:f,timescale:v,presentationTimeDelta:h,eventDuration:p,id:m,messageData:i.subarray(o,r)};t.push(g)}}if(0!==t.length)return t},nN=function(e){var t=nd(e,[1836019574,1953653099,1835297121,1835626086,1937007212,1937011556]);if(null===t)return null;var n=t.subarray(8),i=nc(n,1701733238),r=0;if(null===i?(r=28,i=nc(n,1701733217)):r=78,null===i)return null;var a=nd(i.subarray(r),[1936289382,1935894633,1952804451]);return null===a||a.byteLength<24?null:a.subarray(8,24)},nO=function(e){uw.info("Compat: Trying to move CENC PSSH from init data at the end of it.");for(var t=!1,n=new Uint8Array,i=new Uint8Array,r=0;r<e.length;){if(e.length<r+8||t9(e,r+4)!==dm)throw uw.warn("Compat: unrecognized initialization data. Cannot patch it."),Error("Compat: unrecognized initialization data. Cannot patch it.");var a=t9(new Uint8Array(e),r);if(r+a>e.length)throw uw.warn("Compat: unrecognized initialization data. Cannot patch it."),Error("Compat: unrecognized initialization data. Cannot patch it.");var o=e.subarray(r,r+a);if(16===e[r+12]&&119===e[r+13]&&239===e[r+14]&&236===e[r+15]&&192===e[r+16]&&178===e[r+17]&&77===e[r+18]&&2===e[r+19]&&172===e[r+20]&&227===e[r+21]&&60===e[r+22]&&30===e[r+23]&&82===e[r+24]&&226===e[r+25]&&251===e[r+26]&&75===e[r+27]){var s=nm(o),u=null===s?void 0:o[s[1]];uw.info("Compat: CENC PSSH found with version",u),void 0===u?uw.warn("Compat: could not read version of CENC PSSH"):t===(1===u)?n=t3(n,o):1===u?(uw.warn("Compat: cenc version 1 encountered, removing every other cenc pssh box."),n=o,t=!0):uw.warn("Compat: filtering out cenc pssh box with wrong version",u)}else i=t3(i,o);r+=a}if(r!==e.length)throw uw.warn("Compat: unrecognized initialization data. Cannot patch it."),Error("Compat: unrecognized initialization data. Cannot patch it.");return t3(i,n)},nL=function(e,t,n){uw.debug("Compat: Calling generateRequest on the MediaKeySession");try{i=nO(n)}catch(e){i=n}var i,r=null!=t?t:"";return e.generateRequest(r,i).catch(function(t){if(""!==r||!v(t,TypeError))throw t;return uw.warn('Compat: error while calling `generateRequest` with an empty initialization data type. Retrying with a default "cenc" value.',t),e.generateRequest("cenc",i)})},nU=function(e){for(var t=[],n=0;n<e.length;){if(e.length<n+8||t9(e,n+4)!==dm)return uw.warn("Compat: Unrecognized initialization data. Use as is."),[{systemId:void 0,data:e}];var i=t9(new Uint8Array(e),n);if(n+i>e.length)return uw.warn("Compat: Unrecognized initialization data. Use as is."),[{systemId:void 0,data:e}];var r=e.subarray(n,n+i),a={systemId:ny(r,8),data:r};nF(t,a)?uw.warn("Compat: Duplicated PSSH found in initialization data, removing it."):t.push(a),n+=i}return n!==e.length?(uw.warn("Compat: Unrecognized initialization data. Use as is."),[{systemId:void 0,data:e}]):t},nF=function(e,t){for(var n=0;n<e.length;n++){var i=e[n];if((void 0===t.systemId||void 0===i.systemId||t.systemId===i.systemId)&&eg(t.data,i.data))return!0}return!1},nB=function(e){var t=e.initData,n=e.initDataType;return i(t)?(uw.warn("Compat: No init data found on media encrypted event."),null):{type:n,values:nU(new Uint8Array(t))}},nV=function(e,t){return dg.apply(this,arguments)},nz=function(e){var t,n=lV.getState(e);return lV.setState(e,null),tD(null!=(t=null==n?void 0:n.emeImplementation)?t:dy,e,null)},nK=function(e){if(""===e.sessionId)return!1;var t=e.keyStatuses,n=[];return t.forEach(function(e){n.push(e)}),n.length<=0?(uw.debug("DRM: isSessionUsable: MediaKeySession given has an empty keyStatuses",e.sessionId),!1):e_(n,"expired")?(uw.debug("DRM: isSessionUsable: MediaKeySession given has an expired key",e.sessionId),!1):e_(n,"internal-error")?(uw.debug("DRM: isSessionUsable: MediaKeySession given has a key with an internal-error",e.sessionId),!1):(uw.debug("DRM: isSessionUsable: MediaKeySession is usable",e.sessionId),!0)},nW=function(e,t,n,i){var r=e.loadedSessionsStore,a=e.persistentSessionsStore;return"temporary"===n?nG(r,t):null===a?(uw.warn("DRM: Cannot create persistent MediaKeySession, PersistentSessionsStore not created."),nG(r,t)):nH(r,a,t,i)},nG=function(e,t){return uw.info("DRM: Creating a new temporary session"),Promise.resolve({type:"created-session",value:e.createSession(t,"temporary")})},nH=function(e,t,n,i){return dS.apply(this,arguments)},nq=function(e,t){return"function"==typeof Array.prototype.flatMap?e.flatMap(t):e.reduce(function(e,n){var i=t(n);return Array.isArray(i)?e.push.apply(e,S(i)):e.push(i),e},[])},nY=function(e,t,n){var r=t.getConfiguration();if(ud||i(r))return null;var a=e.filter(function(e){return!(e.type!==n.type||(!i(e.persistentLicenseConfig)||"required"===e.persistentState)&&"required"!==r.persistentState||"required"===e.distinctiveIdentifier&&"required"!==r.distinctiveIdentifier)})[0];return void 0!==a?{keySystemOptions:a,keySystemAccess:t}:null},nj=function(e){var t=uT.getCurrent().EME_KEY_SYSTEMS,n=!0,i=!1,r=void 0;try{for(var a,o=Object.keys(t)[Symbol.iterator]();!(n=(a=o.next()).done);n=!0){var s=a.value;if(e_(t[s],e))return s}}catch(e){i=!0,r=e}finally{try{n||null==o.return||o.return()}finally{if(i)throw r}}},nQ=function(e){var t=e.keyName,n=e.keyType,r=e.keySystemOptions,a=["temporary"],o="optional",s="optional";i(r.persistentLicenseConfig)||(o="required",a.push("persistent-license")),i(r.persistentState)||(o=r.persistentState),i(r.distinctiveIdentifier)||(s=r.distinctiveIdentifier);var u,l,d=uT.getCurrent(),c=d.EME_DEFAULT_AUDIO_CODECS,f=d.EME_DEFAULT_VIDEO_CODECS,v=d.EME_DEFAULT_WIDEVINE_ROBUSTNESSES,h=d.EME_DEFAULT_PLAYREADY_RECOMMENDATION_ROBUSTNESSES,p=r.audioCapabilitiesConfig,m=r.videoCapabilitiesConfig;if((null==p?void 0:p.type)==="full")u=p.value;else{0===(g=(null==p?void 0:p.type)==="robustness"?p.value:"widevine"===t?v:"com.microsoft.playready.recommendation"===n?h:[]).length&&g.push(void 0);var g,y=(null==p?void 0:p.type)==="contentType"?p.value:c;u=nq(g,function(e){return y.map(function(t){return void 0!==e?{contentType:t,robustness:e}:{contentType:t}})})}if((null==m?void 0:m.type)==="full")l=m.value;else{0===(_=(null==m?void 0:m.type)==="robustness"?m.value:"widevine"===t?v:"com.microsoft.playready.recommendation"===n?h:[]).length&&_.push(void 0);var _,S=(null==m?void 0:m.type)==="contentType"?m.value:f;l=nq(_,function(e){return S.map(function(t){return void 0!==e?{contentType:t,robustness:e}:{contentType:t}})})}var b={initDataTypes:["cenc"],videoCapabilities:l,audioCapabilities:u,distinctiveIdentifier:s,persistentState:o,sessionTypes:a};return[b,un(ut({},b),{audioCapabilities:void 0,videoCapabilities:void 0})]},nX=function(e,t,n){uw.info("DRM: Searching for compatible MediaKeySystemAccess");var a=lV.getState(e);if(null!==a&&dy.implementation===a.emeImplementation.implementation){var o=nY(t,a.mediaKeySystemAccess,a.keySystemOptions);if(null!==o)return uw.info("DRM: Found cached compatible keySystem"),Promise.resolve({type:"reuse-media-key-system-access",value:{mediaKeySystemAccess:o.keySystemAccess,options:o.keySystemOptions}})}var s=t.reduce(function(e,t){var n,r=uT.getCurrent().EME_KEY_SYSTEMS[t.type];return n=i(r)?[{keyName:nj(t.type),keyType:t.type,keySystemOptions:t}]:r.map(function(e){return{keyName:t.type,keyType:e,keySystemOptions:t}}),e.concat(n)},[]);return u(0);function u(e){return l.apply(this,arguments)}function l(){return(l=r(function(e){var t,r,a,o,l;return I(this,function(d){switch(d.label){case 0:if(e>=s.length)throw new u1("INCOMPATIBLE_KEYSYSTEMS","No key system compatible with your wanted configuration has been found in the current browser.");if(i(dy.requestMediaKeySystemAccess))throw Error("requestMediaKeySystemAccess is not implemented in your browser.");r=(t=s[e]).keyType,a=t.keySystemOptions,o=nQ(t),uw.debug("DRM: Request keysystem access ".concat(r,",").concat(e+1," of ").concat(s.length)),d.label=1;case 1:return d.trys.push([1,3,,4]),[4,dy.requestMediaKeySystemAccess(r,o)];case 2:return l=d.sent(),[2,(uw.info("DRM: Found compatible keysystem",r,e+1),{type:"create-media-key-system-access",value:{options:a,mediaKeySystemAccess:l}})];case 3:if(d.sent(),uw.debug("DRM: Rejected access to keysystem",r,e+1),null!==n.cancellationError)throw n.cancellationError;return[2,u(e+1)];case 4:return[2]}})})).apply(this,arguments)}},n$=function(e,t){var n=!0,i=!1,r=void 0;try{for(var a,o=e[Symbol.iterator]();!(n=(a=o.next()).done);n=!0){var s=function(){var e=a.value;if(!t.some(function(t){return eg(t,e)}))return{v:!1}}();if("object"===b(s))return s.v}}catch(e){i=!0,r=e}finally{try{n||null==o.return||o.return()}finally{if(i)throw r}}return!0},nZ=function(e,t){var n=!0,i=!1,r=void 0;try{for(var a,o=e[Symbol.iterator]();!(n=(a=o.next()).done);n=!0){var s=function(){var e=a.value;if(t.some(function(t){return eg(t,e)}))return{v:!0}}();if("object"===b(s))return s.v}}catch(e){i=!0,r=e}finally{try{n||null==o.return||o.return()}finally{if(i)throw r}}return!1},nJ=function(e){for(var t=0,n=0;n<e.length;n++)t=(t<<5)-t+e[n],t&=t;return t},n0=function(e,t){var n,i;return null!=(i=null!=(n=n1(e,t))?n:n1(t,e))&&i},n1=function(e,t){if(0===e.length)return!1;if(t.length<e.length)return null;for(var n=e[0],i=0,r=0;r<t.length;r++){var a=t[r];if(a.systemId===n.systemId){if(a.hash!==n.hash)return!1;var o=void 0;v(n.data,Uint8Array)?o=n.data:o="string"==typeof n.data?dI.decode(n.data):n.data.initData;var s=void 0;if(v(a.data,Uint8Array)?s=a.data:s="string"==typeof a.data?dI.decode(a.data):a.data.initData,!eg(o,s))return!1;if(t.length-r<e.length)return null;for(i=1;i<e.length;i++){var u=e[i];for(r+=1;r<t.length;r++){var l=t[r];if(u.systemId===l.systemId){if(u.hash!==l.hash)return!1;var d=void 0;v(u.data,Uint8Array)?d=u.data:d="string"==typeof u.data?dI.decode(u.data):u.data.initData;var c=void 0;if(v(l.data,Uint8Array)?c=l.data:c="string"==typeof l.data?dI.decode(l.data):l.data.initData,!eg(d,c))return!1;break}}if(i===t.length)return null}return!0}}return null},n2=function(e){G(e,{save:"function",load:"function"},"persistentLicenseConfig")},n5=function(e){var t=e.persistentLicenseConfig;return i(t)?null:(uw.debug("DRM: Set the given license storage"),new dA(t))},n4=function(e,t,n){var a=t.baseDelay,o=t.maxDelay,s=t.totalRetry,u=t.shouldRetry,l=t.onRetry,d=0;return c();function c(){return f.apply(this,arguments)}function f(){return(f=r(function(){var t;return I(this,function(r){switch(r.label){case 0:if(null!==n.cancellationError)throw n.cancellationError;r.label=1;case 1:return r.trys.push([1,3,,5]),[4,e()];case 2:return[2,r.sent()];case 3:if(t=r.sent(),null!==n.cancellationError)throw n.cancellationError;if(!i(u)&&!u(t)||d++>=s)throw t;return"function"==typeof l&&l(t,d),[4,tb(n3(a,d,o))];case 4:return[2,(r.sent(),c())];case 5:return[2]}})})).apply(this,arguments)}},n3=function(e,t,n){return Math.min(eG(e*Math.pow(2,t-1)),n)},n8=function(e,t,n){var i,r=t.onKeyInternalError,a=t.onKeyOutputRestricted,o=t.onKeyExpiration,s=[],u=[],l=[];return e.keyStatuses.forEach(function(e,t){var i,d=y("string"==typeof e?[e,t]:[t,e],2),c=d[0],f=(i=new Uint8Array(d[1]),-1!==n.indexOf("playready")&&(uc||ul)?t2(i):i),v={keyId:f.buffer,keyStatus:c};switch(uw.hasLevel("DEBUG")&&uw.debug("DRM: key status update (".concat(t1(f),"): ").concat(c)),c){case dN.EXPIRED:var h=new u1("KEY_STATUS_CHANGE_ERROR","A decryption key expired (".concat(t1(f),")"),{keyStatuses:[v].concat(S(l))});if("error"===o||void 0===o)throw h;switch(o){case"close-session":throw new dx(h);case"fallback":s.push(f);break;default:"continue"===o||void 0===o?u.push(f):H(o)}l.push(v);break;case dN.INTERNAL_ERROR:var p=new u1("KEY_STATUS_CHANGE_ERROR",'A "'.concat(c,'" status has been encountered (').concat(t1(f),")"),{keyStatuses:[v].concat(S(l))});switch(r){case void 0:case"error":throw p;case"close-session":throw new dx(p);case"fallback":s.push(f);break;case"continue":u.push(f);break;default:if(void 0!==r)H(r);else throw p}l.push(v);break;case dN.OUTPUT_RESTRICTED:var m=new u1("KEY_STATUS_CHANGE_ERROR",'A "'.concat(c,'" status has been encountered (').concat(t1(f),")"),{keyStatuses:[v].concat(S(l))});switch(a){case void 0:case"error":throw m;case"fallback":s.push(f);break;case"continue":u.push(f);break;default:if(void 0!==a)H(a);else throw m}l.push(v);break;default:u.push(f)}}),l.length>0&&(i=new u1("KEY_STATUS_CHANGE_ERROR","One or several problematic key statuses have been encountered",{keyStatuses:l})),{warning:i,blacklistedKeyIds:s,whitelistedKeyIds:u}},n6=function(e,t,n,r,a){uw.info("DRM: Binding session events",e.sessionId);var o=t.getLicenseConfig,s=void 0===o?{}:o,u=new uM;function l(){if(!u.isUsed()&&0!==e.keyStatuses.size){var i=n8(e,t,n),a=i.warning,o=i.blacklistedKeyIds,s=i.whitelistedKeyIds;void 0!==a&&(r.onWarning(a),u.isUsed())||r.onKeyUpdate({whitelistedKeyIds:s,blacklistedKeyIds:o})}}u.linkToSignal(a),i(e.closed)||e.closed.then(function(){return u.cancel()}).catch(function(e){a.isCancelled()||(u.cancel(),r.onError(e))}),l1(e,function(e){u.cancel(),r.onError(new u1("KEY_ERROR",e.type))},u.signal),l2(e,function(){uw.info("DRM: keystatuseschange event received",e.sessionId);try{l()}catch(e){if(a.isCancelled()||u.isUsed()&&v(e,uP))return;u.cancel(),r.onError(e)}},u.signal),lJ(e,function(n){var a,o=new Uint8Array(n.message),l=ed(n.messageType)?n.messageType:"license-request";uw.info("DRM: Received message event, type ".concat(l),e.sessionId),n4(function(){var e;return new Promise(function(n,r){var a=function(t){void 0!==e&&clearTimeout(e),r(t)};try{uw.debug("DRM: Calling `getLicense`",l);var u=t.getLicense(o,l),d=i(s.timeout)?1e4:s.timeout;d>=0&&(e=setTimeout(function(){r(new dU('"getLicense" timeout exceeded ('.concat(d," ms)")))},d)),Promise.resolve(u).then(function(t){void 0!==e&&clearTimeout(e),n(t)},a)}catch(e){a(e)}})},{totalRetry:null!=(a=s.retry)?a:2,baseDelay:200,maxDelay:3e3,shouldRetry:function(e){return v(e,dU)||i(e)||!0!==e.noRetry},onRetry:function(e){return r.onWarning(n9(e))}},u.signal).then(function(t){if(u.isUsed())return Promise.resolve();if(i(t))uw.info("DRM: No license given, skipping session.update");else try{return n7(e,t)}catch(e){u.cancel(),r.onError(e)}}).catch(function(e){if(!u.isUsed()){u.cancel();var t=n9(e);if(!i(e)&&!0===e.fallbackOnLastTry){uw.warn("DRM: Last `getLicense` attempt failed. Blacklisting the current session."),r.onError(new dL(t));return}r.onError(t)}})},u.signal),uw.info("DRM: transmitting current keystatuses",e.sessionId),l()},n9=function(e){if(v(e,dU))return new u1("KEY_LOAD_TIMEOUT","The license server took too much time to respond.");var t=new u1("KEY_LOAD_ERROR","An error occured when calling `getLicense`.");return!i(e)&&ed(e.message)&&(t.message=e.message),t},n7=function(e,t){return dO.apply(this,arguments)},ie=function(e,t){if(!(isNaN(t)||t<0||t>=e.getLength())){var n=e.getLength(),i=n-t;uw.info("DRM: Too many stored persistent sessions, removing some.",n,i),e.deleteOldSessions(i)}},it=function(e){var t=e.getConfiguration().sessionTypes;return void 0!==t&&e_(t,"persistent-license")},ii=function(e,t){return e.filter(function(e){return!t.some(function(t){return eg(t,e)})})},ir=function(e,t){var n=ii(e.getAssociatedKeyIds(),t);return n.length>0&&uw.hasLevel("DEBUG")&&uw.debug("DRM: KeySessionRecord's keys missing in the license, blacklisting them",n.map(function(e){return t1(e)}).join(", ")),n},ia=function(e,t){var n=[],i=e.keyIds;return void 0!==i&&(n=ii(i,t)),n.length>0&&uw.hasLevel("DEBUG")&&uw.debug("DRM: init data keys missing in the license, blacklisting them",n.map(function(e){return t1(e)}).join(", ")),n},io=function(e,t,n,i,r,a){var o=S(r).concat(S(a)),s=ir(t,o),u=o.concat(s);if(void 0!==n&&"init-data"!==n){var l=ia(e,u);u.push.apply(u,S(l));var d=e.content;if(i&&void 0!==d){if("content"===n){var c=new Set,f=d.manifest,v=!0,h=!1,p=void 0;try{for(var m,g,y=f.periods[Symbol.iterator]();!(v=(g=y.next()).done);v=!0){var _=g.value;iu(c,_)}}catch(e){h=!0,p=e}finally{try{v||null==y.return||y.return()}finally{if(h)throw p}}is(c,u)}else if("periods"===n){var b=d.manifest,E=!0,k=!1,T=void 0;try{for(var w,I=b.periods[Symbol.iterator]();!(E=(w=I.next()).done);E=!0)!function(){var t=w.value,n=new Set;if(iu(n,t),(null==(m=e.content)?void 0:m.period.id)===t.id)is(n,u);else{var i=Array.from(n),r=!0,a=!1,o=void 0;try{for(var s,l=i[Symbol.iterator]();!(r=(s=l.next()).done);r=!0){var d=function(){var e=s.value;if(u.some(function(t){return eg(t,e)}))return is(n,u),"break"}();if("break"===d)break}}catch(e){a=!0,o=e}finally{try{r||null==l.return||l.return()}finally{if(a)throw o}}}}()}catch(e){k=!0,T=e}finally{try{E||null==I.return||I.return()}finally{if(k)throw T}}}}}return{whitelisted:r,blacklisted:u.slice(r.length)}},is=function(e,t){var n=Array.from(e.values()),i=!0,r=!1,a=void 0;try{for(var o,s=n[Symbol.iterator]();!(i=(o=s.next()).done);i=!0)!function(){var e=o.value;t.some(function(t){return eg(t,e)})||t.push(e)}()}catch(e){r=!0,a=e}finally{try{i||null==s.return||s.return()}finally{if(r)throw a}}},iu=function(e,t){var n=er(t.adaptations).reduce(function(e,t){return i(t)?e:e.concat(t)},[]),r=!0,a=!1,o=void 0,s=!0,u=!1,l=void 0,d=!0,c=!1,f=void 0;try{for(var v,h=n[Symbol.iterator]();!(d=(v=h.next()).done);d=!0){var p=v.value;try{for(var m,g=p.representations[Symbol.iterator]();!(s=(m=g.next()).done);s=!0){var y=m.value;if(void 0!==y.contentProtections&&void 0!==y.contentProtections.keyIds)try{for(var _,S=y.contentProtections.keyIds[Symbol.iterator]();!(r=(_=S.next()).done);r=!0){var b=_.value;e.add(b.keyId)}}catch(e){a=!0,o=e}finally{try{r||null==S.return||S.return()}finally{if(a)throw o}}}}catch(e){u=!0,l=e}finally{try{s||null==g.return||g.return()}finally{if(u)throw l}}}}catch(e){c=!0,f=e}finally{try{d||null==h.return||h.return()}finally{if(c)throw f}}},il=function(e){var t=lV.getState(e);return null===t?null:[t.mediaKeySystemAccess.keySystem,t.mediaKeySystemAccess.getConfiguration()]},id=function(e,t){var n={audio:null,video:null,text:null};if(null!==t&&(n.text=t.getBufferedRanges()),null===e)return n;var i=j(e.sourceBuffers,function(e){return"audio"===e.type}),r=j(e.sourceBuffers,function(e){return"video"===e.type}),a=null==i?void 0:i.getBuffered();void 0!==a&&(n.audio=a);var o=null==r?void 0:r.getBuffered();return void 0!==o&&(n.video=o),n},ic=function(e,t,n){var i=t.autoPlay,r=t.initialPlayPerformed,a=t.manifest,o=t.mediaSource,s=t.speed,u=t.textDisplayer;return e.deriveReadOnlyObserver(function(e,t){var l=new uM;l.linkToSignal(t),l.linkToSignal(n);var d=new uR(c(),l.signal);return s.onUpdate(f,{clearSignal:l.signal,emitCurrentValue:!1}),e.onUpdate(f,{clearSignal:l.signal,emitCurrentValue:!1}),d;function c(){var t=e.getValue(),n=s.getValue();return iv(t,a),{maximumPosition:ek(a),bufferGap:t.bufferGap,position:t.position,buffered:id(o,u),duration:t.duration,rebuffering:t.rebuffering,freezing:t.freezing,paused:{last:t.paused,pending:ih(r,i)},readyState:t.readyState,speed:n}}function f(){d.setValue(c())}})},iv=function(e,t){if(!t.isDynamic||t.isLastPeriodKnown){var n=t.periods[t.periods.length-1];if(void 0!==n&&void 0!==n.end){var i=e.position.getWanted();if(i>=n.start&&i>=n.end-1){var r=e.buffered;(0===r.length||r.end(r.length-1)<e.duration-1)&&e.position.forceWantedPosition(n.end-1)}}}},ih=function(e,t){return e.getValue()?void 0:!t},ip=function(e){var t=e.textTracks;if(!i(t)){for(var n=0;n<t.length;n++)t[n].mode="disabled";if(e.hasChildNodes()){for(var r=e.childNodes,a=r.length-1;a>=0;a--)if("track"===r[a].nodeName)try{e.removeChild(r[a])}catch(e){uw.warn("Compat: Could not remove text track child from element.")}}}e.src="",e.removeAttribute("src")},im=function(e,t){if("function"==typeof e.changeType){try{e.changeType(t)}catch(e){return uw.warn("Could not call 'changeType' on the given SourceBuffer:",v(e,Error)?e:""),!1}return!0}return!1},ig=function(e){for(var t=[],n=0;n<e.length;n++){var i=e[n];i.updating&&t.push(i)}return t},iy=function(e,t){var n=new uM;n.linkToSignal(t),lj(e,function(){uw.debug("Init: MediaSource re-opened while end-of-stream is active"),n.cancel(),(n=new uM).linkToSignal(t),dG(e,n.signal)},t),dG(e,n.signal)},i_=function(e,t,n){var i=t;n||(i=uS?1/0:iE(t));for(var r=0,a=0;a<e.sourceBuffers.length;a++){var o=e.sourceBuffers[a],s=o.buffered.length;s>0&&(r=Math.max(o.buffered.end(s-1)))}if(i===e.duration)return"success";if(r>i){if(r<e.duration)try{uw.info("Init: Updating duration to what is currently buffered",r),e.duration=r}catch(e){return uw.warn("Duration Updater: Can't update duration on the MediaSource.",v(e,Error)?e:""),"failed"}return"partial"}var u=e.duration;try{if(uw.info("Init: Updating duration",i),e.duration=i,"open"===e.readyState&&!isFinite(i)){var l=iE(t);uw.info("Init: calling `mediaSource.setLiveSeekableRange`",l),e.setLiveSeekableRange(0,l)}}catch(e){return uw.warn("Duration Updater: Can't update duration on the MediaSource.",v(e,Error)?e:""),"failed"}var d=Math.abs(e.duration-i);return d>=.1?d<Math.abs(e.duration-u)?"partial":"failed":"success"},iS=function(e,t){if(0===e.length){var n=new uR(!1);return n.finish(),n}var i=new uR(!1,t);a();for(var r=0;r<e.length;r++)!function(n){var i=e[n];i.addEventListener("updatestart",a),i.addEventListener("update",a),t.register(function(){i.removeEventListener("updatestart",a),i.removeEventListener("update",a)})}(r);return i;function a(){for(var t=0;t<e.length;t++)if(e[t].updating){i.setValueIfChanged(!0);return}i.setValueIfChanged(!1)}},ib=function(e,t){var n=new uR("open"===e.readyState,t);return lj(e,function(){uw.debug("Init: Reacting to MediaSource open in duration updater"),n.setValueIfChanged(!0)},t),lX(e,function(){uw.debug("Init: Reacting to MediaSource ended in duration updater"),n.setValueIfChanged(!1)},t),lQ(e,function(){uw.debug("Init: Reacting to MediaSource close in duration updater"),n.setValueIfChanged(!1)},t),n},iE=function(e){return Math.max(4294967296,e+dH)},ik=function(e){if("closed"!==e.readyState){for(var t=e.readyState,n=e.sourceBuffers,i=n.length-1;i>=0;i--){var r=n[i];try{if("open"===t){uw.info("Init: Aborting SourceBuffer before removing");try{r.abort()}catch(e){}}uw.info("Init: Removing SourceBuffer from mediaSource"),e.removeSourceBuffer(r)}catch(e){}}n.length>0&&uw.info("Init: Not all SourceBuffers could have been removed.")}},iT=function(e,t){if(null!==t&&e.src===t&&(uw.info("Init: Clearing HTMLMediaElement's src"),ip(e)),null!==t)try{uw.debug("Init: Revoking previous URL"),URL.revokeObjectURL(t)}catch(e){uw.warn("Init: Error while revoking the media source URL",v(e,Error)?e:"")}},iw=function(e,t){var n=ed(e.src)?e.src:null;iT(e,n);var i=new dY(dQ());return t.register(function(){i.dispose()}),i},iI=function(e,t){return eK(t,function(n){var i=iw(e,t);if(i.addEventListener("mediaSourceOpen",function(){uw.info("Init: MediaSource opened"),n(i)},t),uw.info("MTCI: Attaching MediaSource URL to the media element"),"handle"===i.handle.type)e.srcObject=i.handle.value,t.register(function(){iT(e,null)});else{var r=URL.createObjectURL(i.handle.value);e.src=r,t.register(function(){iT(e,r)})}})},iA=function(e,t,n){if(!i(n)){var r=eb(e),a=ek(e);if(!i(n.position))return uw.debug("Init: using startAt.minimumPosition"),Math.max(Math.min(n.position,a),r);if(i(n.wallClockTime)){if(i(n.fromFirstPosition)){if(i(n.fromLastPosition)){if(i(n.fromLivePosition)){if(!i(n.percentage)){uw.debug("Init: using startAt.percentage");var o=n.percentage;return o>100?a:o<0?r:r+ +o/100*(a-r)}}else{uw.debug("Init: using startAt.fromLivePosition");var s=null!=(v=eE(e))?v:a,u=n.fromLivePosition;return u>=0?s:Math.max(r,s+u)}}else{uw.debug("Init: using startAt.fromLastPosition");var l=n.fromLastPosition;return l>=0?a:Math.max(r,a+l)}}else{uw.debug("Init: using startAt.fromFirstPosition");var d=n.fromFirstPosition;return d<=0?r:Math.min(a,r+d)}}else{uw.debug("Init: using startAt.wallClockTime");var c=void 0===e.availabilityStartTime?0:e.availabilityStartTime;return Math.max(Math.min(n.wallClockTime-c,a),r)}}var f=eb(e);if(e.isLive){var v,h,p=e.suggestedPresentationDelay,m=e.clockOffset,g=ek(e),y=uT.getCurrent().DEFAULT_LIVE_GAP;if(void 0===m)uw.info("Init: no clock offset found for a live content, starting close to maximum available position"),h=g;else{uw.info("Init: clock offset found for a live content, checking if we can start close to it");var _=void 0===e.availabilityStartTime?0:e.availabilityStartTime;h=Math.min(g,(uN()+m)/1e3-_)}var S=null!=p?p:t?y.LOW_LATENCY:y.DEFAULT;return uw.debug("Init: ".concat(h," defined as the live time, applying a live gap of ").concat(S)),Math.max(h-S,f)}return uw.info("Init: starting at the minimum available position:",f),f},iR=function(){return up},iC=function(e,t,n,i){var r=new uM;r.linkToSignal(i);var a=new uR(!1,r.signal);return e.listen(function(e){if(null===e.rebuffering&&null===e.freezing&&0!==e.readyState){if(n&&uh){if(isNaN(t.duration))return;if(t.duration>0){a.setValue(!0),r.cancel();return}}var i=uS?4:3;if(e.readyState>=i&&(null!==e.currentRange||e.ended)&&(!iR()||t.duration>0)){a.setValue(!0),r.cancel();return}}},{includeLastObservation:!0,clearSignal:r.signal}),a},iM=function(e,t){var n=e.mediaElement,i=e.playbackObserver,r=e.startTime,a=e.mustAutoPlay,o=e.isDirectfile,s=e.onWarning,u=new uR(!1,t);return{autoPlayResult:new Promise(function(e,l){var d=function(){var e=!1;i.listen(function(i,r){e||0===i.seeking&&"seeking"!==i.event&&"internal-seeking"!==i.event||(e=!0),!(p&&!e||0===i.readyState)&&(r(),iR()&&0===n.duration&&s(new u2("MEDIA_ERR_NOT_LOADED_METADATA","Cannot load automatically: your browser falsely announced having loaded the content.")),t.isCancelled()||c())},{includeLastObservation:!0,clearSignal:t})},c=function(){i.listen(function(e,t){0===e.seeking&&null===e.rebuffering&&e.readyState>=1&&(t(),f())},{includeLastObservation:!0,clearSignal:t})},f=function(){var i,r;if(uw.info("Init: Can begin to play content"),!a)return n.autoplay&&uw.warn("Init: autoplay is enabled on HTML media element. Media will play as soon as possible."),u.setValue(!0),u.finish(),h(),e({type:"skipped"});if(n.ended)return uw.warn("Init: autoplay is enabled but the video is ended. Skipping autoplay to prevent video to start again"),u.setValue(!0),u.finish(),h(),e({type:"skipped"});try{r=null!=(i=n.play())?i:Promise.resolve()}catch(e){return h(),l(e)}r.then(function(){if(!t.isCancelled())return u.setValue(!0),u.finish(),h(),e({type:"autoplay"})}).catch(function(n){if(h(),!t.isCancelled()){if(v(n,Error)&&"NotAllowedError"===n.name)return uw.warn("Init: Media element can't play. It may be due to browser auto-play policies."),s(new u2("MEDIA_ERR_BLOCKED_AUTOPLAY","Cannot trigger auto-play automatically: your browser does not allow it.")),t.isCancelled()?void 0:e({type:"autoplay-blocked"});l(n)}})},h=t.register(function(e){l(e)});if(!t.isCancelled()){var p=!1,m=function(e){i.setCurrentTime(e),p=!0};if(o&&"number"!=typeof r)i.listen(function(e,t){if(e.readyState>=1){t();var n="number"==typeof r?r:r();0!==n&&(dX?m(n):setTimeout(function(){m(n)},0)),d()}},{includeLastObservation:!0,clearSignal:t});else{var g="number"==typeof r?r:r();0!==g&&m(g),d()}}}),initialPlayPerformed:u}},iP=function(e,t,n,i,r){if(0===t.length)return l("No `keySystems` option given.");if(null===le.decrypt)return l("EME feature not activated.");var a=new uM;a.linkToSignal(r);var o=new uR({initializationState:{type:"uninitialized",value:null},drmSystemId:void 0},r),s=le.decrypt;if(!s.hasEmeApis())return l("EME API not available on the current page.");uw.debug("Init: Creating ContentDecryptor");var u=new s(e,t);return u.addEventListener("stateChange",function(e){if(1===e){var t=new uR(!1);t.onUpdate(function(t,n){t&&(n(),1===e&&u.attach())},{clearSignal:a.signal}),o.setValue({initializationState:{type:"awaiting-media-link",value:{isMediaLinked:t}},drmSystemId:u.systemId})}else 2===e&&(o.setValue({initializationState:{type:"initialized",value:null},drmSystemId:u.systemId}),u.removeEventListener("stateChange"))}),u.addEventListener("error",function(e){a.cancel(),i.onError(e)}),u.addEventListener("warning",function(e){i.onWarning(e)}),u.addEventListener("blackListProtectionData",function(e){i.onBlackListProtectionData(e)}),u.addEventListener("keyIdsCompatibilityUpdate",function(e){i.onKeyIdsCompatibilityUpdate(e)}),n.onUpdate(function(e){null!==e&&u.onInitializationData(e)},{clearSignal:a.signal}),a.signal.register(function(){u.dispose()}),o;function l(e){n.onUpdate(function(t,n){if(null!==t){n();var r=new u1("MEDIA_IS_ENCRYPTED_ERROR",e);i.onError(r)}},{clearSignal:r});var t=new uR({initializationState:{type:"initialized",value:null},drmSystemId:void 0});return t.finish(),t}},iD=function(e,t,n){if(0===e.length)return null;for(var i=null,r=0;r<e.length;r++){var a=e[r].period;if(a.start>n)break;var o=void 0;if(void 0===a.end||a.end>n){var s=e[r],u=s.discontinuity,l=s.position,d=u.start,c=u.end;if(n>=(null!=d?d:l)-dJ){if(null===c){var f=eI(t,a);null!==f?o=f.start+dJ:uw.warn("Init: discontinuity at Period's end but no next Period")}else n<c+dJ&&(o=c+dJ)}void 0!==o&&(uw.info("Init: discontinuity found",n,o),i=null!==i&&i>o?i:o)}}return i},ix=function(e){return null!==e.discontinuity},iN=function(e,t,n){for(var i=Math.min(n.position.getPolled(),n.position.getWanted());e.length>0&&void 0!==e[0].period.end&&e[0].period.end+10<i;)e.shift();var r=t.period,a=t.bufferType;if(!("audio"!==a&&"video"!==a)){for(var o=0;o<e.length;o++)if(e[o].period.id===r.id){if(e[o].bufferType===a){ix(t)?e[o]=t:e.splice(o,1);return}}else if(e[o].period.start>r.start){ix(t)&&e.splice(o,0,t);return}ix(t)&&e.push(t)}},iO=function(e,t){return new u2("DISCONTINUITY_ENCOUNTERED","A discontinuity has been encountered at position "+String(e)+", seeked at position "+String(t))},iL=function(e){return void 0!==e.end},iU=function(e,t,n){n.isCancelled()||(e.addEventListener("error",r),n.register(function(){e.removeEventListener("error",r)}));function r(){var n,r,a=e.error;switch(i(a)||(n=a.code,r=a.message),n){case 1:return t(new u2("MEDIA_ERR_ABORTED",r=null!=r?r:"The fetching of the associated resource was aborted by the user's request."));case 2:return t(new u2("MEDIA_ERR_NETWORK",r=null!=r?r:"A network error occurred which prevented the media from being successfully fetched"));case 3:return t(new u2("MEDIA_ERR_DECODE",r=null!=r?r:"An error occurred while trying to decode the media resource"));case 4:return t(new u2("MEDIA_ERR_SRC_NOT_SUPPORTED",r=null!=r?r:"The media resource has been found to be unsuitable."));default:return t(new u2("MEDIA_ERR_UNKNOWN",r=null!=r?r:"The HTMLMediaElement errored due to an unknown reason."))}}},iF=function(e,t,n,i){e.updateRepresentationsDeciperability(function(e){var r=e.representation;if(void 0===r.contentProtections)return r.decipherable;var a=r.contentProtections.keyIds,o=!0,s=!1,u=void 0;if(void 0!==a)try{for(var l,d=a[Symbol.iterator]();!(o=(l=d.next()).done);o=!0){var c=l.value,f=!0,v=!1,h=void 0;try{for(var p,m=n[Symbol.iterator]();!(f=(p=m.next()).done);f=!0){var g=p.value;if(eg(g,c.keyId))return!1}}catch(e){v=!0,h=e}finally{try{f||null==m.return||m.return()}finally{if(v)throw h}}var y=!0,_=!1,S=void 0;try{for(var b,E=t[Symbol.iterator]();!(y=(b=E.next()).done);y=!0){var k=b.value;if(eg(k,c.keyId))return!0}}catch(e){_=!0,S=e}finally{try{y||null==E.return||E.return()}finally{if(_)throw S}}var T=!0,w=!1,I=void 0;try{for(var A,R=i[Symbol.iterator]();!(T=(A=R.next()).done);T=!0){var C=A.value;if(eg(C,c.keyId))return}}catch(e){w=!0,I=e}finally{try{T||null==R.return||R.return()}finally{if(w)throw I}}}}catch(e){s=!0,u=e}finally{try{o||null==d.return||d.return()}finally{if(s)throw u}}return r.decipherable})},iB=function(e,t){e.updateRepresentationsDeciperability(function(e){var n=e.representation;if(!1===n.decipherable)return!1;var i=null!=(u=null==(s=n.contentProtections)?void 0:s.initData)?u:[],r=!0,a=!1,o=void 0;try{for(var s,u,l,d=i[Symbol.iterator]();!(r=(l=d.next()).done);r=!0){var c=function(){var e=l.value;if((void 0===t.type||e.type===t.type)&&t.values.getFormattedValues().every(function(t){return e.values.some(function(e){return(void 0===t.systemId||e.systemId===t.systemId)&&eg(e.data,t.data)})}))return{v:!1}}();if("object"===b(c))return c.v}}catch(e){a=!0,o=e}finally{try{r||null==d.return||d.return()}finally{if(a)throw o}}return n.decipherable})},iV=function(e){if(i(dW))return ua&&uw.error("Compat: Cannot request codec support in a worker without MSE."),!1;if("function"==typeof dW.isTypeSupported){var t=d8.get(e);if(void 0!==t)return t;var n=dW.isTypeSupported(e);return d8.size>=d3&&d8.clear(),d8.set(e,n),n}return!0},iz=function(e,t,n){var r=e.repeatCount;return r>=0?r:Math.ceil(((i(t)?void 0!==n?n:Number.MAX_VALUE:t.start)-e.start)/e.duration)-1},iK=function(e,t,n){var i=e.start,r=e.duration;return r<=0?i:i+(iz(e,t,n)+1)*r},iW=function(e,t){var n;return e*t.timescale+(null!=(n=t.indexTimeOffset)?n:0)},iG=function(e,t){var n;return(e-(null!=(n=t.indexTimeOffset)?n:0))/t.timescale},iH=function(e,t){for(var n=0,i=e.length;n<i;){var r=n+i>>>1;e[r].start<=t?n=r+1:i=r}return n-1},iq=function(e,t,n){var i=e.timeline,r=iW(t,e);if(r<0)return null;var a=iH(i,r);if(a<0||a>=i.length-1)return null;var o=i[a];if(o.duration<=0)return null;var s=i[a+1];if(void 0===s)return null;var u=s.start;return r>=iK(o,s,n)&&r<u?iG(u,e):null},iY=function(e,t){var n,r=e.initialization,a={};return void 0!==t&&(a.isEMSGWhitelisted=t),{id:"init",isInit:!0,time:0,end:0,duration:0,timescale:1,range:i(r)?void 0:r.range,indexRange:e.indexRange,url:null!=(n=null==r?void 0:r.url)?n:null,complete:!0,privateInfos:a,timestampOffset:-(e.indexTimeOffset/e.timescale)}},ij=function(e,t){var n=e.toString();return n.length>=t?n:(Array(t+1).join("0")+n).slice(-t)},iQ=function(e){return function(t,n,i){var r=ed(i)?parseInt(i,10):1;return ij(String(e),r)}},iX=function(e,t,n){return i$(e,t,n)},i$=function(e,t,n){return -1===e.indexOf("$")?e:e.replace(/\$\$/g,"$").replace(/\$RepresentationID\$/g,String(t)).replace(/\$Bandwidth(\%0(\d+)d)?\$/g,iQ(void 0===n?0:n))},iZ=function(e,t){return function(n){return -1===n.indexOf("$")?n:n.replace(/\$\$/g,"$").replace(/\$Number(\%0(\d+)d)?\$/g,function(e,n,i){if(void 0===t)throw Error("Segment number not defined in a $Number$ scheme");return iQ(t)(e,n,i)}).replace(/\$Time(\%0(\d+)d)?\$/g,function(t,n,i){if(void 0===e)throw Error("Segment time not defined in a $Time$ scheme");return iQ(e)(t,n,i)})}},iJ=function(e,t,n){var i=n-e;return i>0?Math.floor(i/t):0},i0=function(e,t,n,i,r,a){for(var o,s=i.getEstimatedMaximumPosition(null!=(o=e.availabilityTimeOffset)?o:0),u=iW(t,e),l=iW(Math.min(t+n,null!=s?s:1/0),e),d=e.timeline,c=e.timescale,f=e.segmentUrlTemplate,v=e.startNumber,h=e.endNumber,p=null!=v?v:1,m=[],g=d.length,y=0;y<g;y++){var _=d[y],S=_.duration,b=_.start,E=_.range,k=void 0;k=void 0===s?r:Math.min(s*c,null!=r?r:1/0);for(var T=iz(_,d[y+1],k),w=!1!==e.availabilityTimeComplete||y!==g-1&&0!==T,I=iJ(b,S,u),A=b+I*S;A<l&&I<=T;){var R=p+I;if(void 0!==h&&R>h)break;var C=null===f?null:iZ(A,R)(f),M=A-e.indexTimeOffset,P=S;M<0&&(P=S+M,M=0);var D={id:String(A),time:M/c,end:(M+P)/c,duration:P/c,isInit:!1,range:E,timescale:1,url:C,number:R,timestampOffset:-(e.indexTimeOffset/c),complete:w,privateInfos:{isEMSGWhitelisted:a}};m.push(D),A=b+ ++I*S}if(A>=l||(p+=T+1,void 0!==h&&p>h))break}return m},i1=function(e,t){if(t.timescale!==e.timescale){var n=e.timescale;e.timeline.push({start:t.time/t.timescale*n,duration:t.duration/t.timescale*n,repeatCount:void 0===t.count?0:t.count,range:t.range})}else e.timeline.push({start:t.time,duration:t.duration,repeatCount:void 0===t.count?0:t.count,range:t.range});return!0},i2=function(e){return uT.getCurrent().DEFAULT_MAXIMUM_TIME_ROUNDING_ERROR*e},i5=function(e,t){for(var n=0;e.length>0;){var i=e[0];if(i.start>=t||-1===i.repeatCount)break;if(0===i.repeatCount)e.shift(),n+=1;else{var r=e[1];if(void 0!==r&&r.start<=t)e.shift(),n+=1;else{if(i.duration<=0)return n;for(var a=i.start+i.duration,o=1;a<t&&o<=i.repeatCount;)a+=i.duration,o++;if(o>i.repeatCount)e.shift(),n=i.repeatCount+1;else{var s=i.repeatCount-o;return i.start=a,i.repeatCount=s,n+=o}}}}return n},i4=function(e,t){if(0===e.length)return e.push.apply(e,S(t)),!0;if(0===t.length)return!1;var n=e.length,i=t[0].start;if(iK(e[n-1],t[0])<i)throw new u2("MANIFEST_UPDATE_ERROR","Cannot perform partial update: not enough data");for(var r=n-1;r>=0;r--){var a=e[r].start;if(a===i){var o=n-r;return e.splice.apply(e,[r,o].concat(S(t))),!1}if(a<i){var s=e[r];if(s.start+s.duration>i)return uw.warn("RepresentationIndex: Manifest update removed all previous segments"),e.splice.apply(e,[0,n].concat(S(t))),!0;if(void 0===s.repeatCount||s.repeatCount<=0)return s.repeatCount<0&&(s.repeatCount=Math.floor((i-s.start)/s.duration)-1),e.splice.apply(e,[r+1,n-(r+1)].concat(S(t))),!1;if(s.start+s.duration*(s.repeatCount+1)<=i)return e.splice.apply(e,[r+1,n-(r+1)].concat(S(t))),!1;var u=(i-s.start)/s.duration-1;if(u%1==0&&s.duration===t[0].duration){var l=t[0].repeatCount<0?-1:t[0].repeatCount+u+1;return e.splice.apply(e,[r,n-r].concat(S(t))),e[r].start=s.start,e[r].repeatCount=l,!1}return uw.warn("RepresentationIndex: Manifest update removed previous segments"),e[r].repeatCount=Math.floor(u),e.splice.apply(e,[r+1,n-(r+1)].concat(S(t))),!1}}var d=e[e.length-1],c=t[t.length-1];return void 0!==d.repeatCount&&d.repeatCount<0?d.start>c.start?(uw.warn("RepresentationIndex: The new index is older than the previous one"),!1):(uw.warn('RepresentationIndex: The new index is "bigger" than the previous one'),e.splice.apply(e,[0,n].concat(S(t))),!0):d.start+d.duration*(d.repeatCount+1)>=c.start+c.duration*(c.repeatCount+1)?(uw.warn("RepresentationIndex: The new index is older than the previous one"),!1):(uw.warn('RepresentationIndex: The new index is "bigger" than the previous one'),e.splice.apply(e,[0,n].concat(S(t))),!0)},i3=function(e,t,n){var r=e.start,a=e.duration,o=e.repeatCount;return void 0===r&&(null===t?r=0:i(t.duration)||(r=t.start+t.duration*(t.repeatCount+1))),(void 0===a||isNaN(a))&&null!==n&&void 0!==n.start&&!isNaN(n.start)&&void 0!==r&&!isNaN(r)&&(a=n.start-r),void 0===r||isNaN(r)||void 0===a||isNaN(a)||void 0!==o&&isNaN(o)?(uw.warn('DASH: A "S" Element could not have been parsed.'),null):{start:r,duration:a,repeatCount:void 0===o?0:o}},i8=function(e){var t={},n=!0,r=!1,a=void 0;try{for(var o,s=Object.keys(e.attributes)[Symbol.iterator]();!(n=(o=s.next()).done);n=!0){var u=o.value,l=e.attributes[u];if(!i(l))switch(u){case"t":var d=parseInt(l,10);isNaN(d)?uw.warn('DASH: invalid t ("'.concat(l,'")')):t.start=d;break;case"d":var c=parseInt(l,10);isNaN(c)?uw.warn('DASH: invalid d ("'.concat(l,'")')):t.duration=c;break;case"r":var f=parseInt(l,10);isNaN(f)?uw.warn('DASH: invalid r ("'.concat(l,'")')):t.repeatCount=f}}}catch(e){r=!0,a=e}finally{try{n||null==s.return||s.return()}finally{if(r)throw a}}return t},i6=function(e){for(var t={},n=0;n<e.attributes.length;n++){var i=e.attributes[n];switch(i.name){case"t":var r=parseInt(i.value,10);isNaN(r)?uw.warn('DASH: invalid t ("'.concat(i.value,'")')):t.start=r;break;case"d":var a=parseInt(i.value,10);isNaN(a)?uw.warn('DASH: invalid d ("'.concat(i.value,'")')):t.duration=a;break;case"r":var o=parseInt(i.value,10);isNaN(o)?uw.warn('DASH: invalid r ("'.concat(i.value,'")')):t.repeatCount=o}}return t},i9=function(e){var t=[];if(Array.isArray(e))for(var n=0;n<e.length;n++)t.push(i8(e[n]));else for(var i=0;i<e.length;i++)t.push(i6(e[i]));for(var r=[],a=0;a<t.length;a++){var o=i3(t[a],void 0===r[r.length-1]?null:r[r.length-1],void 0===t[a+1]?null:t[a+1]);null!==o&&r.push(o)}return r},i7=function(e,t){if(0===e.length||0===t.length)return null;var n=e[0].start,r=Array.isArray(t)?t[0].attributes.t:t[0].getAttribute("t"),a=i(r)?null:parseInt(r,10);if(null===a||Number.isNaN(a))return null;if(n===a)return{prevSegmentsIdx:0,newElementsIdx:0,repeatNumberInPrevSegments:0,repeatNumberInNewElements:0};if(n<a)for(var o=e[0],s=0;;){if(o.repeatCount>0){var u=a-o.start;if(u%o.duration==0&&u/o.duration<=o.repeatCount)return{repeatNumberInPrevSegments:u/o.duration,prevSegmentsIdx:s,newElementsIdx:0,repeatNumberInNewElements:0}}if(++s>=e.length)return null;if((o=e[s]).start===a)return{prevSegmentsIdx:s,newElementsIdx:0,repeatNumberInPrevSegments:0,repeatNumberInNewElements:0};if(o.start>a)return null}else for(var l=0,d=Array.isArray(t)?t[0]:null,c=Array.isArray(t)?null:t[0],f=a;;){var v=null!==d?d.attributes.d:null==c?void 0:c.getAttribute("d"),h=i(v)?null:parseInt(v,10);if(null===h||Number.isNaN(h))return null;var p=null!==d?d.attributes.r:null==c?void 0:c.getAttribute("r"),m=i(p)?null:parseInt(p,10);if(null!==m){if(Number.isNaN(m)||m<0)return null;if(m>0){var g=n-f;if(g%h==0&&g/h<=m)return{repeatNumberInPrevSegments:0,repeatNumberInNewElements:g/h,prevSegmentsIdx:0,newElementsIdx:l}}f+=h*(m+1)}else f+=h;if(++l>=t.length)return null;Array.isArray(t)?d=t[l]:c=t[l];var y=null!==d?d.attributes.t:null==c?void 0:c.getAttribute("t"),_=i(y)?null:parseInt(y,10);if(null!==_){if(Number.isNaN(_))return null;f=_}if(f===n)return{newElementsIdx:l,prevSegmentsIdx:0,repeatNumberInPrevSegments:0,repeatNumberInNewElements:0};if(f>a)return null}},re=function(e,t){var n,i=i7(t,e);if(null===i)return uw.warn('DASH: Cannot perform "based" update. Common segment not found.'),i9(e);var r=i.prevSegmentsIdx,a=i.newElementsIdx,o=i.repeatNumberInPrevSegments,s=i.repeatNumberInNewElements,u=t.length-r+a-1;if(u>=e.length)return uw.info('DASH: Cannot perform "based" update. New timeline too short'),i9(e);var l=t.slice(r);if(o>0){var d=l[0];d.start+=d.duration*o,l[0].repeatCount-=o}if(s>0&&0!==a)return uw.info('DASH: Cannot perform "based" update. The new timeline has a different form.'),i9(e);var c=l[l.length-1],f=Array.isArray(e)?i8(e[u]):i6(e[u]),v=(null!=(n=f.repeatCount)?n:0)-s;if(f.duration!==c.duration||c.repeatCount>v)return uw.info('DASH: Cannot perform "based" update. The new timeline has a different form at the beginning.'),i9(e);void 0!==f.repeatCount&&f.repeatCount>c.repeatCount&&(c.repeatCount=f.repeatCount);var h=[],p=[];if(Array.isArray(e))for(var m=u+1;m<e.length;m++)p.push(i8(e[m]));else for(var g=u+1;g<e.length;g++)p.push(i6(e[g]));for(var y=0;y<p.length;y++){var _=i3(p[y],void 0===h[h.length-1]?c:h[h.length-1],void 0===p[y+1]?null:p[y+1]);null!==_&&h.push(_)}return l.concat(h)},rt=function(e,t,n){if(void 0===n)return e;for(var i=null!=t?t:1,r=0;r<e.length;r++){var a=e[r];if((i+=a.repeatCount+1)>n){if(i===n+1)return e.slice(0,r+1);var o=e.slice(0,r),s=ut({},a),u=i-a.repeatCount-1;return s.repeatCount=Math.max(0,n-u),o.push(s),o}}return e},rn=function(e,t,n,r){var a=ri(t,n,r);if(null===a)return!1;for(var o=0;o<t.timeline.length&&!(a.timelineIdx<o);o++){var s=t.timeline[o],u=(s.start-t.indexTimeOffset)/t.timescale;if(u>e.time)break;if(u===e.time)return void 0===s.range?void 0===e.range:!i(e.range)&&s.range[0]===e.range[0]&&s.range[1]===e.range[1];if(s.repeatCount>=0&&void 0!==s.duration){var l=(u-s.start)/s.duration-1;return l%1==0&&l<=a.newRepeatCount}}return!1},ri=function(e,t,n){if(e.timeline.length<=0)return null;if(e.availabilityTimeOffset===1/0){var i=e.timeline.length-1,r=e.timeline[i];return{isLastOfTimeline:!0,timelineIdx:i,newRepeatCount:r.repeatCount,end:iK(r,null,n)}}var a=t.getEstimatedMaximumPosition(e.availabilityTimeOffset);if(void 0===a){var o=e.timeline.length-1,s=e.timeline[o];return{isLastOfTimeline:!0,timelineIdx:o,newRepeatCount:s.repeatCount,end:iK(s,null,n)}}for(var u=e.timeline.length-1;u>=e.timeline.length;u--){var l=e.timeline[u],d=l.start+l.duration;if(iG(d,e)<=a){if(iG(iK(l,e.timeline[u+1],n),e)<=a)return{isLastOfTimeline:u===e.timeline.length-1,timelineIdx:u,newRepeatCount:l.repeatCount,end:d};var c=Math.floor((iW(a,e)-l.start)/l.duration);return W(c>=1),{isLastOfTimeline:!1,timelineIdx:u,newRepeatCount:c-1,end:l.start+c*l.duration}}}return null},rr=function(e){if(!ci.test(e))return e;for(var t=[],n=e.split("/"),i=0,r=n.length;i<r;i++)if(".."===n[i])t.pop();else{if("."===n[i])continue;t.push(n[i])}return t.join("/")},ra=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];var i=t.length;if(0===i)return"";for(var r="",a=0;a<i;a++){var o=t[a];"string"!=typeof o||""===o||(cn.test(o)?r=o:("/"===o[0]&&(o=o.substring(1)),"/"===r[r.length-1]&&(r=r.substring(0,r.length-1)),r=r+"/"+o))}return rr(r)},ro=function(e){var t=Date.parse(e)-uN();if(isNaN(t)){uw.warn("DASH Parser: Invalid clock received: ",e);return}return t},rs=function(e){var t=e.children.utcTimings.filter(function(e){return("urn:mpeg:dash:utc:http-iso:2014"===e.schemeIdUri||"urn:mpeg:dash:utc:http-xsdate:2014"===e.schemeIdUri)&&void 0!==e.value});return t.length>0?t[0].value:void 0},ru=function(e){for(var t=e.representations,n=null,i=0;i<t.length;i++){var r=t[i].index.getLastAvailablePosition();if(void 0===r)return;null!==r&&(n=null===n?r:Math.min(n,r))}return null===n?null:n},rl=function(e){for(var t=e.length-1;t>=0;t--){var n=e[t].adaptations,i=void 0===n.audio?void 0:n.audio[0],r=void 0===n.video?void 0:n.video[0];if(void 0!==i||void 0!==r){var a=null,o=null;if(void 0!==i){var s=ru(i);if(void 0===s)return{safe:void 0,unsafe:void 0};a=s}if(void 0!==r){var u=ru(r);if(void 0===u)return{safe:void 0,unsafe:void 0};o=u}if(void 0!==i&&null===a||void 0!==r&&null===o)return uw.info("Parser utils: found Period with no segment. ","Going to previous one to calculate last position"),{safe:void 0,unsafe:void 0};if(null!==o)return null!==a?{safe:Math.min(a,o),unsafe:Math.max(a,o)}:{safe:o,unsafe:o};if(null!==a)return{safe:a,unsafe:a}}}return{safe:void 0,unsafe:void 0}},rd=function(e){for(var t=e.representations,n=null,i=0;i<t.length;i++){var r=t[i].index.getFirstAvailablePosition();if(void 0===r)return;null!==r&&(n=null===n?r:Math.max(n,r))}return null===n?null:n},rc=function(e){for(var t=0;t<=e.length-1;t++){var n=e[t].adaptations,i=void 0===n.audio?void 0:n.audio[0],r=void 0===n.video?void 0:n.video[0];if(void 0!==i||void 0!==r){var a=null,o=null;if(void 0!==i){var s=rd(i);if(void 0===s)return;a=s}if(void 0!==r){var u=rd(r);if(void 0===u)return;o=u}if(void 0!==i&&null===a||void 0!==r&&null===o){uw.info("Parser utils: found Period with no segment. ","Going to next one to calculate first position");return}if(null!==o)return null!==a?Math.max(a,o):o;if(null!==a)return a}}},rf=function(e){if(0===e.length)throw Error("DASH Parser: no period available for a dynamic content");var t=rc(e),n=rl(e);return{minimumSafePosition:t,maximumSafePosition:n.safe,maximumUnsafePosition:n.unsafe}},rv=function(e){if(0===e.length)return[];for(var t=[e[0]],n=1;n<e.length;n++){for(var i=e[n],r=t[t.length-1];(void 0===r.duration||r.start+r.duration>i.start)&&(uw.warn("DASH: Updating overlapping Periods.",null==r?void 0:r.start,i.start),r.duration=i.start-r.start,r.end=i.start,!(r.duration>0))&&(t.pop(),0!==t.length);)r=t[t.length-1];t.push(i)}return t},rh=function(e,t){var n=[];return e.forEach(function(r,a){if(i(r.attributes.start)){if(0===a)s=!t.isDynamic||i(t.availabilityStartTime)?0:t.availabilityStartTime;else{var o=n[n.length-1];if(i(o)||i(o.periodEnd))throw Error("Missing start time when parsing periods.");s=o.periodEnd}}else s=r.attributes.start;var s,u,l=e[a+1];i(r.attributes.duration)?a===e.length-1?u=t.duration:i(l.attributes.start)||(u=l.attributes.start-s):u=r.attributes.duration;var d=i(u)?void 0:s+u;n.push({periodStart:s,periodDuration:u,periodEnd:d})}),n},rp=function(e,t,n,i){function r(e,t){var n=e.split("/")[0];return e_(la,n)?n:"application/ttml+xml"===e?"text":"application/mp4"===e&&null!==t&&void 0!==j(t,function(e){return"urn:mpeg:dash:role:2011"===e.schemeIdUri&&e_(cs,e.value)})?"text":void 0}function a(e){switch(e.substring(0,3)){case"avc":case"hev":case"hvc":case"vp8":case"vp9":case"av1":return"video";case"vtt":return"text"}switch(e.substring(0,4)){case"mp4a":return"audio";case"wvtt":case"stpp":return"text"}}if(null!==t){var o=r(t,i);if(void 0!==o)return o}if(null!==n){var s=a(n);if(void 0!==s)return s}for(var u=0;u<e.length;u++){var l=e[u].attributes,d=l.mimeType,c=l.codecs;if(void 0!==d){var f=r(d,i);if(void 0!==f)return f}if(void 0!==c){var v=a(c);if(void 0!==v)return v}}},rm=function(e){var t,n,i,r=y(e.split("."),8),a=r[0],o=(r[1],r[2],r[3]),s=(r[4],r[5]),u=r[6],l=r[7];if(("vp08"===a||"vp09"===a||"vp10"===a)&&((void 0!==o&&"10"===o||"12"===o)&&(t=parseInt(o,10)),void 0!==u&&("16"===u?n="pq":"18"===u&&(n="hlg")),void 0!==s&&void 0!==l&&"09"===s&&"09"===l&&(i="rec2020"),!(void 0===t||void 0===n)))return{colorDepth:t,eotf:n,colorSpace:i}},rg=function(e,t){var n,i,r,a=t.availabilityTimeOffset,o=t.manifestBoundsCalculator,s=t.isDynamic,u=t.end,l=t.start,d=t.receivedTime,c=t.unsafelyBaseOnPreviousRepresentation,f=t.inbandEventStreams,v={availabilityTimeComplete:void 0,availabilityTimeOffset:a,unsafelyBaseOnPreviousRepresentation:c,isEMSGWhitelisted:function(e){return void 0!==f&&f.some(function(t){return t.schemeIdUri===e.schemeIdUri})},isLastPeriod:t.isLastPeriod,manifestBoundsCalculator:o,isDynamic:s,periodEnd:u,periodStart:l,receivedTime:d,representationBitrate:e.attributes.bitrate,representationId:e.attributes.id};if(void 0!==e.children.segmentBase)r=new d9(e.children.segmentBase,v);else if(void 0!==e.children.segmentList)r=new d7(e.children.segmentList,v);else if(void 0!==e.children.segmentTemplate||t.parentSegmentTemplates.length>0){var h=t.parentSegmentTemplates.slice(),p=e.children.segmentTemplate;void 0!==p&&h.push(p);var m=uk.apply(void 0,[{}].concat(S(h)));(void 0!==m.availabilityTimeOffset||void 0!==t.availabilityTimeOffset)&&(v.availabilityTimeOffset=(null!=(n=m.availabilityTimeOffset)?n:0)+(null!=(i=t.availabilityTimeOffset)?i:0)),r=ct.isTimelineIndexArgument(m)?new ct(m,v):new ce(m,v)}else{var g=t.adaptation.children;r=void 0!==g.segmentBase?new d9(g.segmentBase,v):void 0!==g.segmentList?new d7(g.segmentList,v):new ce({duration:Number.MAX_VALUE,timescale:1,startNumber:0,media:""},v)}return r},ry=function(e,t){if(0===t.length)return e;var n,i=t.map(function(e){return{url:e.value}});if(0===e.length)return i;for(var r=[],a=0;a<e.length;a++)for(var o=e[a],s=0;s<i.length;s++){var u=i[s],l=ra(o.url,u.url);r.push({url:l,serviceLocation:null!=(n=u.serviceLocation)?n:o.serviceLocation})}return r},r_=function(e,t){var n=[];if(void 0!==e.children.inbandEventStreams&&n.push.apply(n,S(e.children.inbandEventStreams)),void 0!==t.children.inbandEventStreams&&n.push.apply(n,S(t.children.inbandEventStreams)),0!==n.length)return n},rS=function(e){var t=e.adaptationProfiles,n=e.essentialProperties,i=e.supplementalProperties,r=e.manifestProfiles,a=e.codecs;if(-1!==((null!=t?t:"")+(null!=r?r:"")).indexOf("http://dashif.org/guidelines/dash-if-uhd#hevc-hdr-pq10")&&("hvc1.2.4.L153.B0"===a||"hev1.2.4.L153.B0"===a))return{colorDepth:10,eotf:"pq",colorSpace:"rec2020"};var o=j(S(null!=n?n:[]).concat(S(null!=i?i:[])),function(e){return"urn:mpeg:mpegB:cicp:TransferCharacteristics"===e.schemeIdUri});if(void 0!==o)switch(o.value){case"15":return;case"16":return{eotf:"pq"};case"18":return{eotf:"hlg"}}if(void 0!==a&&/^vp(08|09|10)/.exec(a))return rm(a)},rb=function(e,t,n){var i=[],r=!0,a=!1,o=void 0;try{for(var s,u,l,d,c,f,v=e[Symbol.iterator]();!(r=(f=v.next()).done);r=!0)!function(){for(var e,r=f.value,a=void 0!==r.attributes.id?r.attributes.id:String(r.attributes.bitrate)+(void 0!==r.attributes.height?"-".concat(r.attributes.height):"")+(void 0!==r.attributes.width?"-".concat(r.attributes.width):"")+(void 0!==r.attributes.mimeType?"-".concat(r.attributes.mimeType):"")+(void 0!==r.attributes.codecs?"-".concat(r.attributes.codecs):"");i.some(function(e){return e.id===a});)a+="-dup";var o=null!=(u=null==(s=n.unsafelyBaseOnPreviousAdaptation)?void 0:s.getRepresentation(a))?u:null,v=r_(r,t),h=null!=(l=r.attributes.availabilityTimeComplete)?l:n.availabilityTimeComplete,p=void 0;(void 0!==r.attributes.availabilityTimeOffset||void 0!==n.availabilityTimeOffset)&&(p=(null!=(d=r.attributes.availabilityTimeOffset)?d:0)+(null!=(c=n.availabilityTimeOffset)?c:0));var m=uk({},n,{availabilityTimeOffset:p,availabilityTimeComplete:h,unsafelyBaseOnPreviousRepresentation:o,adaptation:t,inbandEventStreams:v}),g=rg(r,m),y=void 0;void 0===r.attributes.bitrate?(uw.warn("DASH: No usable bitrate found in the Representation."),y=0):y=r.attributes.bitrate;var _=ry(n.baseURLs,r.children.baseURLs),b=0===_.length?[{baseUrl:"",id:void 0}]:_.map(function(e){return{baseUrl:e.url,id:e.serviceLocation}}),E={bitrate:y,cdnMetadata:b,index:g,id:a};void 0!==r.children.supplementalProperties&&j(r.children.supplementalProperties,function(e){return"tag:dolby.com,2018:dash:EC3_ExtensionType:2018"===e.schemeIdUri&&"JOC"===e.value})&&(E.isSpatialAudio=!0);var k=void 0;void 0!==r.attributes.codecs?k=r.attributes.codecs:void 0!==t.attributes.codecs&&(k=t.attributes.codecs),void 0!==k&&(k="mp4a.40.02"===k?"mp4a.40.2":k,E.codecs=k);var T=void 0;void 0!==r.attributes.supplementalCodecs?T=r.attributes.supplementalCodecs:void 0!==t.attributes.supplementalCodecs&&(T=t.attributes.supplementalCodecs),void 0!==T&&(E.supplementalCodecs=(e=T,ed(e)?e.trim().replace(cu,", "):"")),void 0!==r.attributes.frameRate?E.frameRate=r.attributes.frameRate:void 0!==t.attributes.frameRate&&(E.frameRate=t.attributes.frameRate),void 0!==r.attributes.height?E.height=r.attributes.height:void 0!==t.attributes.height&&(E.height=t.attributes.height),void 0!==r.attributes.mimeType?E.mimeType=r.attributes.mimeType:void 0!==t.attributes.mimeType&&(E.mimeType=t.attributes.mimeType),void 0!==r.attributes.width?E.width=r.attributes.width:void 0!==t.attributes.width&&(E.width=t.attributes.width);var w=void 0!==t.children.contentProtections?t.children.contentProtections:[];if(void 0!==r.children.contentProtections&&w.push.apply(w,S(r.children.contentProtections)),w.length>0){var I=w.reduce(function(e,t){var n;if(void 0!==t.attributes.schemeIdUri&&"urn:uuid:"===t.attributes.schemeIdUri.substring(0,9)&&(n=t.attributes.schemeIdUri.substring(9).replace(/-/g,"").toLowerCase()),void 0!==t.attributes.keyId&&t.attributes.keyId.length>0){var i={keyId:t.attributes.keyId,systemId:n};void 0===e.keyIds?e.keyIds=[i]:e.keyIds.push(i)}if(void 0!==n){var r=t.children.cencPssh,a=[],o=!0,s=!1,u=void 0;try{for(var l,d=r[Symbol.iterator]();!(o=(l=d.next()).done);o=!0){var c=l.value;a.push({systemId:n,data:c})}}catch(e){s=!0,u=e}finally{try{o||null==d.return||d.return()}finally{if(s)throw u}}if(a.length>0){var f,v=j(e.initData,function(e){return"cenc"===e.type});void 0===v?e.initData.push({type:"cenc",values:a}):(f=v.values).push.apply(f,S(a))}}return e},{keyIds:void 0,initData:[]});(Object.keys(I.initData).length>0||void 0!==I.keyIds&&I.keyIds.length>0)&&(E.contentProtections=I)}E.hdrInfo=rS({adaptationProfiles:t.attributes.profiles,supplementalProperties:t.children.supplementalProperties,essentialProperties:t.children.essentialProperties,manifestProfiles:n.manifestProfiles,codecs:k}),i.push(E)}()}catch(e){a=!0,o=e}finally{try{r||null==v.return||v.return()}finally{if(a)throw o}}return i},rE=function(e){if(void 0===e)return!1;var t="urn:tva:metadata:cs:AudioPurposeCS:2007"===e.schemeIdUri&&"1"===e.value,n="urn:mpeg:dash:role:2011"===e.schemeIdUri&&"description"===e.value;return t||n},rk=function(e){return void 0!==e&&"urn:mpeg:dash:role:2011"===e.schemeIdUri&&"sign"===e.value},rT=function(e,t){if(ed(e.attributes.id))return e.attributes.id;var n=t.isClosedCaption,i=t.isForcedSubtitle,r=t.isAudioDescription,a=t.isSignInterpreted,o=t.isTrickModeTrack,s=t.type;return ed(e.attributes.language)&&(s+="-".concat(e.attributes.language)),!0===n&&(s+="-cc"),!0===i&&(s+="-cc"),!0===r&&(s+="-ad"),!0===a&&(s+="-si"),o&&(s+="-trickMode"),ed(e.attributes.contentType)&&(s+="-".concat(e.attributes.contentType)),ed(e.attributes.codecs)&&(s+="-".concat(e.attributes.codecs)),ed(e.attributes.mimeType)&&(s+="-".concat(e.attributes.mimeType)),void 0!==e.attributes.frameRate&&(s+="-".concat(String(e.attributes.frameRate))),s},rw=function(e){if(!i(e.children.supplementalProperties)){var t=e.children.supplementalProperties,n=!0,r=!1,a=void 0;try{for(var o,s=t[Symbol.iterator]();!(n=(o=s.next()).done);n=!0){var u=o.value;if("urn:mpeg:dash:adaptation-set-switching:2016"===u.schemeIdUri&&!i(u.value))return u.value.split(",").map(function(e){return e.trim()}).filter(function(e){return e})}}catch(e){r=!0,a=e}finally{try{n||null==s.return||s.return()}finally{if(r)throw a}}}return[]},rI=function(e,t){for(var n,r,a,o,s,u,l,d=function(d){var p=e[d],m=p.children,g=m.essentialProperties,y=m.roles,_=m.label,b=Array.isArray(y)&&y.some(function(e){return"main"===e.value})&&y.some(function(e){return"urn:mpeg:dash:role:2011"===e.schemeIdUri}),E=p.children.representations,k=null!=(n=p.attributes.availabilityTimeComplete)?n:t.availabilityTimeComplete,T=void 0;(void 0!==p.attributes.availabilityTimeOffset||void 0!==t.availabilityTimeOffset)&&(T=(null!=(r=p.attributes.availabilityTimeOffset)?r:0)+(null!=(a=t.availabilityTimeOffset)?a:0));var w=p.attributes.mimeType,I=p.attributes.codecs,A=rp(E,ed(w)?w:null,ed(I)?I:null,i(m.roles)?null:m.roles);if(void 0===A)return"continue";var R=null!=(o=p.attributes.selectionPriority)?o:1,C=p.attributes.id,M=rw(p),P=[];void 0!==t.segmentTemplate&&P.push(t.segmentTemplate),void 0!==p.children.segmentTemplate&&P.push(p.children.segmentTemplate);var D={availabilityTimeComplete:k,availabilityTimeOffset:T,baseURLs:ry(t.baseURLs,m.baseURLs),manifestBoundsCalculator:t.manifestBoundsCalculator,end:t.end,isDynamic:t.isDynamic,isLastPeriod:t.isLastPeriod,manifestProfiles:t.manifestProfiles,parentSegmentTemplates:P,receivedTime:t.receivedTime,start:t.start,unsafelyBaseOnPreviousAdaptation:null},x=Array.isArray(g)?j(g,function(e){return"http://dashif.org/guidelines/trickmode"===e.schemeIdUri}):void 0,N=null==(s=null==x?void 0:x.value)?void 0:s.split(" "),O=void 0!==N,L=m.accessibilities,U=void 0;void 0!==y&&y.some(function(e){return"dub"===e.value})&&(U=!0);var F=void 0;F="text"===A&&!!(void 0!==L&&L.some(function(e){return"urn:tva:metadata:cs:AudioPurposeCS:2007"===e.schemeIdUri&&"2"===e.value})||void 0!==y&&y.some(function(e){return"urn:mpeg:dash:role:2011"===e.schemeIdUri&&"caption"===e.value}));var B=void 0;"text"===A&&void 0!==y&&y.some(function(e){return"forced-subtitle"===e.value||"forced_subtitle"===e.value})&&(B=!0);var V=void 0;"audio"!==A?V=!1:void 0!==L&&(V=L.some(rE));var K=void 0;"video"!==A?K=!1:void 0!==L&&(K=L.some(rk));for(var W=rT(p,{isAudioDescription:V,isForcedSubtitle:B,isClosedCaption:F,isSignInterpreted:K,isTrickModeTrack:O,type:A});e_(h,W);)W+="-dup";var G=W;h.push(W),D.unsafelyBaseOnPreviousAdaptation=null!=(l=null==(u=t.unsafelyBaseOnPreviousPeriod)?void 0:u.getAdaptation(W))?l:null;var H={id:W,representations:rb(E,p,D),type:A,isTrickModeTrack:O};if(i(p.attributes.language)||(H.language=p.attributes.language),i(F)||(H.closedCaption=F),i(V)||(H.audioDescription=V),!0===U&&(H.isDub=!0),void 0!==B&&(H.forcedSubtitles=B),!0===K&&(H.isSignInterpreted=!0),void 0!==_&&(H.label=_),void 0!==N)f.push({adaptation:H,trickModeAttachedAdaptationIds:N});else{var q=-1,Y=!0,Q=!1,X=void 0;try{for(var $,Z=M[Symbol.iterator]();!(Y=($=Z.next()).done);Y=!0){var J=function(){var e=$.value,t=v[e];if(void 0!==t&&t.newID!==G&&e_(t.adaptationSetSwitchingIDs,C)){q=z(c[A],function(t){return t[0].id===e});var n,i=c[A][q];if(void 0!==i&&i[0].audioDescription===H.audioDescription&&i[0].closedCaption===H.closedCaption&&i[0].language===H.language)return uw.info('DASH Parser: merging "switchable" AdaptationSets',C,e),(n=i[0].representations).push.apply(n,S(H.representations)),i[1]={priority:Math.max(R,i[1].priority),isMainAdaptation:b||i[1].isMainAdaptation,indexInMpd:Math.min(d,i[1].indexInMpd)},"break"}}();if("break"===J)break}}catch(e){Q=!0,X=e}finally{try{Y||null==Z.return||Z.return()}finally{if(Q)throw X}}q<0&&c[A].push([H,{priority:R,isMainAdaptation:b,indexInMpd:d}])}!i(C)&&i(v[C])&&(v[C]={newID:G,adaptationSetSwitchingIDs:M})},c={video:[],audio:[],text:[]},f=[],v={},h=[],p=0;p<e.length;p++)d(p);var m=la.reduce(function(e,t){var n=c[t];return n.length>0&&(n.sort(rA),e[t]=n.map(function(e){return y(e,1)[0]})),e},{});return c.video.sort(rA),co(m,f),m},rA=function(e,t){var n=t[1].priority-e[1].priority;return 0!==n?n:e[1].isMainAdaptation!==t[1].isMainAdaptation?e[1].isMainAdaptation?-1:1:e[1].indexInMpd-t[1].indexInMpd},rR=function(e,t){var n,r,a,o,s=[],u=rh(e,t);if(u.length!==e.length)throw Error("MPD parsing error: the time information are incoherent.");var l=t.isDynamic,d=t.manifestBoundsCalculator;l||i(t.duration)||d.setLastPosition(t.duration);for(var c=e.length-1;c>=0;c--){var f=c===e.length-1,v=e[c],h=t.xlinkInfos.get(v),p=ry(t.baseURLs,v.children.baseURLs),m=u[c],g=m.periodStart,_=m.periodDuration,S=m.periodEnd,b=void 0;for(i(v.attributes.id)?(uw.warn("DASH: No usable id found in the Period. Generating one."),b="gen-dash-period-"+cl()):b=v.attributes.id;s.some(function(e){return e.id===b});)b+="-dup";var E=void 0!==h?h.receivedTime:t.receivedTime,k=null!=(r=null==(n=t.unsafelyBaseOnPreviousManifest)?void 0:n.getPeriod(b))?r:null,T={availabilityTimeComplete:v.attributes.availabilityTimeComplete,availabilityTimeOffset:v.attributes.availabilityTimeOffset,baseURLs:p,manifestBoundsCalculator:d,end:S,isDynamic:l,isLastPeriod:f,manifestProfiles:t.manifestProfiles,receivedTime:E,segmentTemplate:v.children.segmentTemplate,start:g,unsafelyBaseOnPreviousPeriod:k},w=rI(v.children.adaptations,T),I=(null!=(a=t.xmlNamespaces)?a:[]).concat(null!=(o=v.attributes.namespaces)?o:[]),A=rP(v.children.eventStreams,g,I),R={id:b,start:g,end:S,duration:_,adaptations:w,streamEvents:A};if(s.unshift(R),!d.lastPositionIsKnown()){var C=rM(w);if(l){if("number"==typeof C){var M=uN()/1e3;d.setLastPosition(C,M)}else{var P=rC(t,g);if(void 0!==P){var D=y(P,2),x=D[0],N=D[1];d.setLastPosition(x,N)}}}else"number"==typeof C&&d.setLastPosition(C)}}if(t.isDynamic&&!d.lastPositionIsKnown()){var O=rC(t,0);if(void 0!==O){var L=y(O,2),U=L[0],F=L[1];d.setLastPosition(U,F)}}return rv(s)},rC=function(e,t){if(i(e.clockOffset)){var n=Date.now()/1e3;if(n>=t)return uw.warn("DASH Parser: no clock synchronization mechanism found. Using the system clock instead."),[n-e.availabilityStartTime,uN()/1e3]}else{var r=e.clockOffset/1e3-e.availabilityStartTime,a=uN()/1e3,o=a+r;if(o>=t)return[o,a]}},rM=function(e){var t=null,n=!0,r=nq(uK(e).filter(function(e){return!i(e)}),function(e){return e}),a=!0,o=!1,s=void 0;try{for(var u,l=r[Symbol.iterator]();!(a=(u=l.next()).done);a=!0){var d=u.value.representations,c=!0,f=!1,v=void 0;try{for(var h,p=d[Symbol.iterator]();!(c=(h=p.next()).done);c=!0){var m=h.value.index.getLastAvailablePosition();null!==m&&(n=!1,"number"==typeof m&&(t=i(t)?m:Math.max(t,m)))}}catch(e){f=!0,v=e}finally{try{c||null==p.return||p.return()}finally{if(f)throw v}}}}catch(e){o=!0,s=e}finally{try{a||null==l.return||l.return()}finally{if(o)throw s}}return i(t)?n?null:void 0:t},rP=function(e,t,n){var i=[],r=!0,a=!1,o=void 0;try{for(var s,u,l,d=e[Symbol.iterator]();!(r=(l=d.next()).done);r=!0){var c=l.value,f=c.attributes,h=f.schemeIdUri,p=void 0===h?"":h,m=f.timescale,g=void 0===m?1:m,y=n.concat(null!=(s=c.attributes.namespaces)?s:[]),_=!0,S=!1,b=void 0;try{for(var E,k=c.children.events[Symbol.iterator]();!(_=(E=k.next()).done);_=!0){var T=E.value;if(void 0!==T.eventStreamData){var w=(null!=(u=T.presentationTime)?u:0)/g+t,I=void 0===T.duration?void 0:w+T.duration/g,A=void 0,R=void 0;if(!ua&&v(T.eventStreamData,Element))A=T.eventStreamData;else try{R={namespaces:y,data:"string"==typeof T.eventStreamData?T.eventStreamData:tJ(new Uint8Array(T.eventStreamData))}}catch(e){uw.error("DASH: Error while parsing event-stream:",v(e,Error)?e.message:"Unknown error")}i.push({start:w,end:I,id:T.id,data:{type:"dash-event-stream",value:{schemeIdUri:p,timescale:g,element:A,xmlData:R}}})}}}catch(e){S=!0,b=e}finally{try{_||null==k.return||k.return()}finally{if(S)throw b}}}}catch(e){a=!0,o=e}finally{try{r||null==d.return||d.return()}finally{if(a)throw o}}return i},rD=function(e,t,n,r){var a,o,s,u,l,d,c,f,v=e.children,h=e.attributes,p="dynamic"===h.type,m=ry(void 0!==t.url?[{url:t.url.substring(0,cr(t.url))}]:[],v.baseURLs),g=(a=t.referenceDateTime,"dynamic"!==h.type?0:i(h.availabilityStartTime)?null!=a?a:0:h.availabilityStartTime),y=h.timeShiftBufferDepth,_=t.externalClockOffset,b=t.unsafelyBaseOnPreviousManifest,E=t.externalClockOffset,k=new ca({availabilityStartTime:g,isDynamic:p,timeShiftBufferDepth:y,serverTimestampOffset:E}),T={availabilityStartTime:g,baseURLs:m,clockOffset:_,duration:h.duration,isDynamic:p,manifestBoundsCalculator:k,manifestProfiles:e.attributes.profiles,receivedTime:t.manifestReceivedTime,timeShiftBufferDepth:y,unsafelyBaseOnPreviousManifest:b,xlinkInfos:r,xmlNamespaces:e.attributes.namespaces},w=rR(v.periods,T),I=h.duration,A=null;void 0!==h.minimumUpdatePeriod&&h.minimumUpdatePeriod>=0&&(d=0===h.minimumUpdatePeriod?uT.getCurrent().DASH_FALLBACK_LIFETIME_WHEN_MINIMUM_UPDATE_PERIOD_EQUAL_0:h.minimumUpdatePeriod);var R=rf(w),C=R.minimumSafePosition,M=R.maximumSafePosition,P=R.maximumUnsafePosition,D=uN();if(p){void 0!==M?x=M:void 0===E?(uw.warn("DASH Parser: use system clock to define maximum position"),x=Date.now()/1e3-g):x=(uN()+E)/1e3-g;var x,N=k.getEstimatedLiveEdge();void 0===N&&(N=void 0!==P?P:x),f={isLinear:!0,maximumSafePosition:x,livePosition:N,time:D},c=C,null!==(A=null!=y?y:null)&&void 0!==c&&N-c>A&&(A=N-c)}else{void 0===(c=C)&&(c=null!=(s=null==(o=w[0])?void 0:o.start)?s:0);var O=null!=I?I:1/0;if(void 0!==w[w.length-1]){var L=w[w.length-1],U=null!=(u=L.end)?u:void 0!==L.duration?L.start+L.duration:void 0;void 0!==U&&U<O&&(O=U)}void 0!==M&&M<O&&(O=M),f={isLinear:!1,maximumSafePosition:O,livePosition:void 0,time:D}}var F=!p||void 0===e.attributes.minimumUpdatePeriod&&((null==(l=w[w.length-1])?void 0:l.end)!==void 0||void 0!==e.attributes.duration);return{type:"done",value:{parsed:{availabilityStartTime:g,clockOffset:t.externalClockOffset,isDynamic:p,isLive:p,isLastPeriodKnown:F,periods:w,publishTime:h.publishTime,suggestedPresentationDelay:h.suggestedPresentationDelay,transportType:"dash",timeBounds:{minimumSafePosition:c,timeshiftDepth:A,maximumTimeData:f},lifetime:d,uris:i(t.url)?v.locations:[t.url].concat(S(v.locations))},warnings:n}}},rx=function(e){var t=e.textContent,n=[];return null===t||0===t.length?[void 0,n]:[{value:t},n]},rN=function(e){for(var t={},n=0;n<e.attributes.length;n++){var i=e.attributes[n];switch(i.name){case"id":t.id=i.value;break;case"lang":t.language=i.value;break;case"contentType":t.contentType=i.value;break;case"par":t.par=i.value}}return t},rO=function(e,t){return"true"===e?[!0,null]:"false"===e?[!1,null]:[!1,new cv("`".concat(t,'` property is not a boolean value but "').concat(e,'"'))]},rL=function(e,t){var n=parseInt(e,10);return isNaN(n)?[null,new cv("`".concat(t,'` property is not an integer value but "').concat(e,'"'))]:[n,null]},rU=function(e,t){if("INF"===e)return[1/0,null];var n=parseFloat(e);return isNaN(n)?[null,new cv("`".concat(t,'` property is invalid: "').concat(e,'"'))]:[n,null]},rF=function(e,t){if("true"===e)return[!0,null];if("false"===e)return[!1,null];var n=parseInt(e,10);return isNaN(n)?[null,new cv("`".concat(t,'` property is not a boolean nor an integer but "').concat(e,'"'))]:[n,null]},rB=function(e,t){return isNaN(Date.parse(e))?[null,new cv("`".concat(t,'` is in an invalid date format: "').concat(e,'"'))]:[new Date(Date.parse(e)).getTime()/1e3,null]},rV=function(e,t){if(!ed(e))return[0,new cv("`".concat(t,"` property is empty"))];var n=cc.exec(e);return null===n?[null,new cv("`".concat(t,'` property has an unrecognized format "').concat(e,'"'))]:[31536e3*parseFloat(ed(n[2])?n[2]:"0")+2592e3*parseFloat(ed(n[4])?n[4]:"0")+86400*parseFloat(ed(n[6])?n[6]:"0")+3600*parseFloat(ed(n[8])?n[8]:"0")+60*parseFloat(ed(n[10])?n[10]:"0")+parseFloat(ed(n[12])?n[12]:"0"),null]},rz=function(e,t){var n=cf.exec(e);return null===n?[null,new cv("`".concat(t,'` property has an unrecognized format "').concat(e,'"'))]:[[+n[1],+n[2]],null]},rK=function(e,t){try{return[tY(e),null]}catch(n){return[null,new cv("`".concat(t,'` is not a valid base64 string: "').concat(e,'"'))]}},rW=function(e,t){var n=/^(\d+)\/(\d+)$/.exec(e);return null!==n?[+n[1]/+n[2],null]:rU(e,t)},rG=function(e){for(var t,n,i=0;i<e.attributes.length;i++){var r=e.attributes[i];switch(r.name){case"schemeIdUri":t=r.value;break;case"value":n=r.value}}return{schemeIdUri:t,value:n}},rH=function(e,t){return function(n,i){var r=i.asKey,a=y((0,i.parser)(n,i.dashName),2),o=a[0],s=a[1];null!==s&&(uw.warn(s.message),t.push(s)),null!==o&&(e[r]=o)}},rq=function(e){for(var t=[],n=[],i=0;i<e.length;i++)if(e[i].nodeType===Node.ELEMENT_NODE){var r=e[i];if("cenc:pssh"===r.nodeName){var a=r.textContent;if(null!==a&&a.length>0){var o=y(rK(a,"cenc:pssh"),2),s=o[0],u=o[1];null!==u&&(uw.warn(u.message),t.push(u)),null!==s&&n.push(s)}}}return[{cencPssh:n},t]},rY=function(e){for(var t={},n=0;n<e.attributes.length;n++){var i=e.attributes[n];switch(i.name){case"schemeIdUri":t.schemeIdUri=i.value;break;case"value":t.value=i.value;break;case"cenc:default_KID":t.keyId=t0(i.value.replace(/-/g,""))}}return t},rj=function(e){var t=y(rq(e.childNodes),2),n=t[0],i=t[1];return[{children:n,attributes:rY(e)},i]},rQ=function(e){for(var t={},n=[],i=rH(t,n),r=0;r<e.attributes.length;r++){var a=e.attributes[r];switch(a.name){case"range":i(a.value,{asKey:"range",parser:rz,dashName:"range"});break;case"sourceURL":t.media=a.value}}return[t,n]},rX=function(e){for(var t={},n=[],i=rH(t,n),r=e.childNodes,a=0;a<r.length;a++)if(r[a].nodeType===Node.ELEMENT_NODE){var o=r[a];if("Initialization"===o.nodeName){var s=y(rQ(o),2),u=s[0],l=s[1];t.initialization=u,n=n.concat(l)}}for(var d=0;d<e.attributes.length;d++){var c=e.attributes[d];switch(c.name){case"timescale":i(c.value,{asKey:"timescale",parser:rL,dashName:"timescale"});break;case"presentationTimeOffset":i(c.value,{asKey:"presentationTimeOffset",parser:rU,dashName:"presentationTimeOffset"});break;case"indexRange":i(c.value,{asKey:"indexRange",parser:rz,dashName:"indexRange"});break;case"indexRangeExact":i(c.value,{asKey:"indexRangeExact",parser:rO,dashName:"indexRangeExact"});break;case"availabilityTimeOffset":i(c.value,{asKey:"availabilityTimeOffset",parser:rU,dashName:"availabilityTimeOffset"});break;case"availabilityTimeComplete":i(c.value,{asKey:"availabilityTimeComplete",parser:rO,dashName:"availabilityTimeComplete"});break;case"duration":i(c.value,{asKey:"duration",parser:rL,dashName:"duration"});break;case"startNumber":i(c.value,{asKey:"startNumber",parser:rL,dashName:"startNumber"});break;case"endNumber":i(c.value,{asKey:"endNumber",parser:rL,dashName:"endNumber"})}}return[t,n]},r$=function(e){for(var t={},n=[],i=rH(t,n),r=0;r<e.attributes.length;r++){var a=e.attributes[r];switch(a.name){case"media":t.media=a.value;break;case"indexRange":i(a.value,{asKey:"indexRange",parser:rz,dashName:"indexRange"});break;case"index":t.index=a.value;break;case"mediaRange":i(a.value,{asKey:"mediaRange",parser:rz,dashName:"mediaRange"})}}return[t,n]},rZ=function(e){for(var t=y(rX(e),2),n=t[0],i=t[1],r=[],a=e.childNodes,o=0;o<a.length;o++)if(a[o].nodeType===Node.ELEMENT_NODE){var s=a[o];if("SegmentURL"===s.nodeName){var u=y(r$(s),2),l=u[0],d=u[1];r.push(l),i=i.concat(d)}}return[uk(n,{list:r}),i]},rJ=function(e){var t=null;return function(){if(null===t){var n=e.getElementsByTagName("S");return t=n,n}return t}},r0=function(e){for(var t,n=y(rX(e),2),r=n[0],a=n[1],o=0;o<e.childNodes.length;o++)if(e.childNodes[o].nodeType===Node.ELEMENT_NODE){var s=e.childNodes[o];"SegmentTimeline"===s.nodeName&&(t=rJ(s))}for(var u=uk({},r,{duration:r.duration,timelineParser:t}),l=rH(u,a),d=0;d<e.attributes.length;d++){var c=e.attributes[d];switch(c.nodeName){case"initialization":i(u.initialization)&&(u.initialization={media:c.value});break;case"index":u.index=c.value;break;case"availabilityTimeOffset":l(c.value,{asKey:"availabilityTimeOffset",parser:rU,dashName:"availabilityTimeOffset"});break;case"availabilityTimeComplete":l(c.value,{asKey:"availabilityTimeComplete",parser:rO,dashName:"availabilityTimeComplete"});break;case"media":u.media=c.value;break;case"bitstreamSwitching":l(c.value,{asKey:"bitstreamSwitching",parser:rO,dashName:"bitstreamSwitching"})}}return[u,a]},r1=function(e){for(var t={baseURLs:[]},n=[],r=[],a=0;a<e.length;a++)if(e[a].nodeType===Node.ELEMENT_NODE){var o=e[a];switch(o.nodeName){case"BaseURL":var s=y(rx(o),2),u=s[0],l=s[1];void 0!==u&&t.baseURLs.push(u),r=r.concat(l);break;case"InbandEventStream":void 0===t.inbandEventStreams&&(t.inbandEventStreams=[]),t.inbandEventStreams.push(rG(o));break;case"SegmentBase":var d=y(rX(o),2),c=d[0],f=d[1];t.segmentBase=c,f.length>0&&(r=r.concat(f));break;case"SegmentList":var v=y(rZ(o),2),h=v[0],p=v[1];r=r.concat(p),t.segmentList=h;break;case"SegmentTemplate":var m=y(r0(o),2),g=m[0],_=m[1];r=r.concat(_),t.segmentTemplate=g;break;case"ContentProtection":var S=y(rj(o),2),b=S[0],E=S[1];E.length>0&&(r=r.concat(E)),void 0!==b&&n.push(b);break;case"SupplementalProperty":i(t.supplementalProperties)?t.supplementalProperties=[rG(o)]:t.supplementalProperties.push(rG(o))}}return n.length>0&&(t.contentProtections=n),[t,r]},r2=function(e){for(var t={},n=[],i=rH(t,n),r=0;r<e.attributes.length;r++){var a=e.attributes[r];switch(a.name){case"audioSamplingRate":t.audioSamplingRate=a.value;break;case"bandwidth":i(a.value,{asKey:"bitrate",parser:rL,dashName:"bandwidth"});break;case"codecs":t.codecs=a.value;break;case"codingDependency":i(a.value,{asKey:"codingDependency",parser:rO,dashName:"codingDependency"});break;case"frameRate":i(a.value,{asKey:"frameRate",parser:rW,dashName:"frameRate"});break;case"height":i(a.value,{asKey:"height",parser:rL,dashName:"height"});break;case"id":t.id=a.value;break;case"maxPlayoutRate":i(a.value,{asKey:"maxPlayoutRate",parser:rU,dashName:"maxPlayoutRate"});break;case"maximumSAPPeriod":i(a.value,{asKey:"maximumSAPPeriod",parser:rU,dashName:"maximumSAPPeriod"});break;case"mimeType":t.mimeType=a.value;break;case"profiles":t.profiles=a.value;break;case"qualityRanking":i(a.value,{asKey:"qualityRanking",parser:rL,dashName:"qualityRanking"});break;case"scte214:supplementalCodecs":t.supplementalCodecs=a.value;break;case"segmentProfiles":t.segmentProfiles=a.value;break;case"width":i(a.value,{asKey:"width",parser:rL,dashName:"width"});break;case"availabilityTimeOffset":i(a.value,{asKey:"availabilityTimeOffset",parser:rU,dashName:"availabilityTimeOffset"});break;case"availabilityTimeComplete":i(a.value,{asKey:"availabilityTimeComplete",parser:rO,dashName:"availabilityTimeComplete"})}}return void 0===t.bitrate&&n.push(new cv("No bitrate found on a Representation")),[t,n]},r5=function(e){var t=y(r1(e.childNodes),2),n=t[0],i=t[1],r=y(r2(e),2),a=r[0],o=r[1];return[{children:n,attributes:a},i.concat(o)]},r4=function(e){for(var t={baseURLs:[],representations:[]},n=[],r=[],a=0;a<e.length;a++)if(e[a].nodeType===Node.ELEMENT_NODE){var o=e[a];switch(o.nodeName){case"Accessibility":void 0===t.accessibilities?t.accessibilities=[rG(o)]:t.accessibilities.push(rG(o));break;case"BaseURL":var s=y(rx(o),2),u=s[0],l=s[1];void 0!==u&&t.baseURLs.push(u),l.length>0&&(r=r.concat(l));break;case"ContentComponent":t.contentComponent=rN(o);break;case"EssentialProperty":i(t.essentialProperties)?t.essentialProperties=[rG(o)]:t.essentialProperties.push(rG(o));break;case"InbandEventStream":void 0===t.inbandEventStreams&&(t.inbandEventStreams=[]),t.inbandEventStreams.push(rG(o));break;case"Label":var d=o.textContent;null!=d&&(t.label=d);break;case"Representation":var c=y(r5(o),2),f=c[0],v=c[1];t.representations.push(f),v.length>0&&(r=r.concat(v));break;case"Role":i(t.roles)?t.roles=[rG(o)]:t.roles.push(rG(o));break;case"SupplementalProperty":i(t.supplementalProperties)?t.supplementalProperties=[rG(o)]:t.supplementalProperties.push(rG(o));break;case"SegmentBase":var h=y(rX(o),2),p=h[0],m=h[1];t.segmentBase=p,m.length>0&&(r=r.concat(m));break;case"SegmentList":var g=y(rZ(o),2),_=g[0],S=g[1];t.segmentList=_,S.length>0&&(r=r.concat(S));break;case"SegmentTemplate":var b=y(r0(o),2),E=b[0],k=b[1];t.segmentTemplate=E,k.length>0&&(r=r.concat(k));break;case"ContentProtection":var T=y(rj(o),2),w=T[0],I=T[1];I.length>0&&(r=r.concat(I)),void 0!==w&&n.push(w)}}return n.length>0&&(t.contentProtections=n),[t,r]},r3=function(e){for(var t={},n=[],i=rH(t,n),r=0;r<e.attributes.length;r++){var a=e.attributes[r];switch(a.name){case"id":t.id=a.value;break;case"group":i(a.value,{asKey:"group",parser:rL,dashName:"group"});break;case"lang":t.language=a.value;break;case"contentType":t.contentType=a.value;break;case"par":t.par=a.value;break;case"minBandwidth":i(a.value,{asKey:"minBitrate",parser:rL,dashName:"minBandwidth"});break;case"maxBandwidth":i(a.value,{asKey:"maxBitrate",parser:rL,dashName:"maxBandwidth"});break;case"minWidth":i(a.value,{asKey:"minWidth",parser:rL,dashName:"minWidth"});break;case"maxWidth":i(a.value,{asKey:"maxWidth",parser:rL,dashName:"maxWidth"});break;case"minHeight":i(a.value,{asKey:"minHeight",parser:rL,dashName:"minHeight"});break;case"maxHeight":i(a.value,{asKey:"maxHeight",parser:rL,dashName:"maxHeight"});break;case"minFrameRate":i(a.value,{asKey:"minFrameRate",parser:rW,dashName:"minFrameRate"});break;case"maxFrameRate":i(a.value,{asKey:"maxFrameRate",parser:rW,dashName:"maxFrameRate"});break;case"selectionPriority":i(a.value,{asKey:"selectionPriority",parser:rL,dashName:"selectionPriority"});break;case"segmentAlignment":i(a.value,{asKey:"segmentAlignment",parser:rF,dashName:"segmentAlignment"});break;case"subsegmentAlignment":i(a.value,{asKey:"subsegmentAlignment",parser:rF,dashName:"subsegmentAlignment"});break;case"bitstreamSwitching":i(a.value,{asKey:"bitstreamSwitching",parser:rO,dashName:"bitstreamSwitching"});break;case"audioSamplingRate":t.audioSamplingRate=a.value;break;case"codecs":t.codecs=a.value;break;case"scte214:supplementalCodecs":t.supplementalCodecs=a.value;break;case"codingDependency":i(a.value,{asKey:"codingDependency",parser:rO,dashName:"codingDependency"});break;case"frameRate":i(a.value,{asKey:"frameRate",parser:rW,dashName:"frameRate"});break;case"height":i(a.value,{asKey:"height",parser:rL,dashName:"height"});break;case"maxPlayoutRate":i(a.value,{asKey:"maxPlayoutRate",parser:rU,dashName:"maxPlayoutRate"});break;case"maximumSAPPeriod":i(a.value,{asKey:"maximumSAPPeriod",parser:rU,dashName:"maximumSAPPeriod"});break;case"mimeType":t.mimeType=a.value;break;case"profiles":t.profiles=a.value;break;case"segmentProfiles":t.segmentProfiles=a.value;break;case"width":i(a.value,{asKey:"width",parser:rL,dashName:"width"});break;case"availabilityTimeOffset":i(a.value,{asKey:"availabilityTimeOffset",parser:rU,dashName:"availabilityTimeOffset"});break;case"availabilityTimeComplete":i(a.value,{asKey:"availabilityTimeComplete",parser:rO,dashName:"availabilityTimeComplete"})}}return[t,n]},r8=function(e){var t=y(r4(e.childNodes),2),n=t[0],i=t[1],r=y(r3(e),2),a=r[0],o=r[1];return[{children:n,attributes:a},i.concat(o)]},r6=function(e){for(var t={children:{events:[]},attributes:{}},n=[],i=rH(t.attributes,n),r=0;r<e.attributes.length;r++){var a=e.attributes[r];switch(a.name){case"schemeIdUri":t.attributes.schemeIdUri=a.value;break;case"timescale":i(a.value,{asKey:"timescale",parser:rL,dashName:"timescale"});break;case"value":t.attributes.value=a.value}}for(var o=0;o<e.childNodes.length;o++)if(e.childNodes[o].nodeType===Node.ELEMENT_NODE){var s=e.childNodes[o];if("Event"===s.nodeName){var u=y(r9(s),2),l=u[0],d=u[1];t.children.events.push(l),d.length>0&&(n=n.concat(d))}}return[t,n]},r9=function(e){for(var t={eventStreamData:e},n=[],i=rH(t,n),r=0;r<e.attributes.length;r++){var a=e.attributes[r];switch(a.name){case"presentationTime":i(a.value,{asKey:"presentationTime",parser:rL,dashName:"presentationTime"});break;case"duration":i(a.value,{asKey:"duration",parser:rL,dashName:"duration"});break;case"id":t.id=a.value}}return[t,n]},r7=function(e){for(var t,n=[],i=[],r=[],a=[],o=0;o<e.length;o++)if(e[o].nodeType===Node.ELEMENT_NODE){var s=e[o];switch(s.nodeName){case"BaseURL":var u=y(rx(s),2),l=u[0],d=u[1];void 0!==l&&n.push(l),r=r.concat(d);break;case"AdaptationSet":var c=y(r8(s),2),f=c[0],v=c[1];i.push(f),r=r.concat(v);break;case"EventStream":var h=y(r6(s),2),p=h[0],m=h[1];a.push(p),r=r.concat(m);break;case"SegmentTemplate":var g=y(r0(s),2),_=g[0],S=g[1];t=_,S.length>0&&(r=r.concat(S))}}return[{baseURLs:n,adaptations:i,eventStreams:a,segmentTemplate:t},r]},ae=function(e){for(var t={},n=[],i=rH(t,n),r=0;r<e.attributes.length;r++){var a=e.attributes[r];switch(a.name){case"id":t.id=a.value;break;case"start":i(a.value,{asKey:"start",parser:rV,dashName:"start"});break;case"duration":i(a.value,{asKey:"duration",parser:rV,dashName:"duration"});break;case"bitstreamSwitching":i(a.value,{asKey:"bitstreamSwitching",parser:rO,dashName:"bitstreamSwitching"});break;case"xlink:href":t.xlinkHref=a.value;break;case"xlink:actuate":t.xlinkActuate=a.value}}return[t,n]},at=function(e){var t=y(r7(e.childNodes),2),n=t[0],i=t[1],r=y(ae(e),2),a=r[0],o=r[1];return[{children:n,attributes:a},i.concat(o)]},an=function(e){for(var t=[],n=[],i=[],r=[],a=[],o=0;o<e.length;o++)if(e[o].nodeType===Node.ELEMENT_NODE){var s=e[o];switch(s.nodeName){case"BaseURL":var u=y(rx(s),2),l=u[0],d=u[1];void 0!==l&&t.push(l),a=a.concat(d);break;case"Location":n.push(null===s.textContent?"":s.textContent);break;case"Period":var c=y(at(s),2),f=c[0],v=c[1];i.push(f),a=a.concat(v);break;case"UTCTiming":var h=rG(s);r.push(h)}}return[{baseURLs:t,locations:n,periods:i,utcTimings:r},a]},ai=function(e){for(var t={},n=[],i=rH(t,n),r=0;r<e.attributes.length;r++){var a=e.attributes[r];switch(a.name){case"id":t.id=a.value;break;case"profiles":t.profiles=a.value;break;case"type":t.type=a.value;break;case"availabilityStartTime":i(a.value,{asKey:"availabilityStartTime",parser:rB,dashName:"availabilityStartTime"});break;case"availabilityEndTime":i(a.value,{asKey:"availabilityEndTime",parser:rB,dashName:"availabilityEndTime"});break;case"publishTime":i(a.value,{asKey:"publishTime",parser:rB,dashName:"publishTime"});break;case"mediaPresentationDuration":i(a.value,{asKey:"duration",parser:rV,dashName:"mediaPresentationDuration"});break;case"minimumUpdatePeriod":i(a.value,{asKey:"minimumUpdatePeriod",parser:rV,dashName:"minimumUpdatePeriod"});break;case"minBufferTime":i(a.value,{asKey:"minBufferTime",parser:rV,dashName:"minBufferTime"});break;case"timeShiftBufferDepth":i(a.value,{asKey:"timeShiftBufferDepth",parser:rV,dashName:"timeShiftBufferDepth"});break;case"suggestedPresentationDelay":i(a.value,{asKey:"suggestedPresentationDelay",parser:rV,dashName:"suggestedPresentationDelay"});break;case"maxSegmentDuration":i(a.value,{asKey:"maxSegmentDuration",parser:rV,dashName:"maxSegmentDuration"});break;case"maxSubsegmentDuration":i(a.value,{asKey:"maxSubsegmentDuration",parser:rV,dashName:"maxSubsegmentDuration"})}}return[t,n]},ar=function(e){var t=y(an(e.childNodes),2),n=t[0],i=t[1],r=y(ai(e),2),a=r[0],o=r[1];return[{children:n,attributes:a},i.concat(o)]},aa=function(e,t){var n=e.customManifestLoader,i=function(e,n,i){if(void 0===e)throw Error("Cannot perform HTTP(s) request. URL not known");switch(t){case"arraybuffer":return uZ({url:e,responseType:"arraybuffer",timeout:n.timeout,connectionTimeout:n.connectionTimeout,cancelSignal:i});case"text":return uZ({url:e,responseType:"text",timeout:n.timeout,connectionTimeout:n.connectionTimeout,cancelSignal:i});case"document":return uZ({url:e,responseType:"document",timeout:n.timeout,connectionTimeout:n.connectionTimeout,cancelSignal:i});default:H(t)}};return"function"!=typeof n?i:function(e,t,r){return new Promise(function(a,o){var s=function(e){l||(l=!0,"function"==typeof d&&d(),o(e))},u=Date.now()-uN(),l=!1,d=n({url:e,timeout:t.timeout},{reject:function(e){if(!(l||r.isCancelled())){var t,n;l=!0,r.deregister(s),o(new uY(null!=(t=null==e?void 0:e.message)?t:"Unknown error when fetching the Manifest through a custom manifestLoader.",null!=(n=null==e?void 0:e.canRetry)&&n,null==e?void 0:e.xhr))}},resolve:function(e){if(!(l||r.isCancelled())){l=!0,r.deregister(s);var t=void 0!==e.receivingTime?e.receivingTime-u:void 0,n=void 0!==e.sendingTime?e.sendingTime-u:void 0;a({responseData:e.data,size:e.size,requestDuration:e.duration,url:e.url,receivedTime:t,sendingTime:n})}},fallback:function(){l||r.isCancelled()||(l=!0,r.deregister(s),i(e,t,r).then(a,o))}});r.register(s)})}},ao=function(e){var t=e.referenceDateTime,n=void 0!==e.serverSyncInfos?e.serverSyncInfos.serverTimestamp-e.serverSyncInfos.clientTime:void 0;return function(i,r,a,o,s){var u,l=i.responseData,d=r.externalClockOffset,c=null!=(u=i.url)?u:r.originalUrl,f={unsafelyBaseOnPreviousManifest:r.unsafeMode?r.previousManifest:null,url:c,referenceDateTime:t,externalClockOffset:null!=n?n:d},h=le.dashParsers;if(null===h.wasm||"uninitialized"===h.wasm.status||"failure"===h.wasm.status)return uw.debug("DASH: WASM MPD Parser not initialized. Running JS one."),m();var p=ac(l);if(!af(p))return uw.info("DASH: MPD doesn't seem to be UTF-8-encoded. Running JS parser instead of the WASM one."),m();if("initialized"===h.wasm.status)return uw.debug("DASH: Running WASM MPD Parser."),g(h.wasm.runWasmParser(p,f));return uw.debug("DASH: Awaiting WASM initialization before parsing the MPD."),h.wasm.waitForInitialization().catch(function(){}).then(function(){return null===h.wasm||"initialized"!==h.wasm.status?(uw.warn("DASH: WASM MPD parser initialization failed. Running JS parser instead"),m()):(uw.debug("DASH: Running WASM MPD Parser."),g(h.wasm.runWasmParser(p,f)))});function m(){if(null!==h.fastJs){var e=al(l);return g(h.fastJs(e,f))}if(null!==h.native){var t=ad(l);return g(h.native(t,f))}throw Error("No MPD parser is imported")}function g(t){if("done"===t.type){if(t.value.warnings.length>0&&a(t.value.warnings),o.isCancelled())return Promise.reject(o.cancellationError);var n=[];return{manifest:new lu(t.value.parsed,e,n),url:c,warnings:n}}var i=t.value;return Promise.all(i.urls.map(function(e){return s(function(){var t=uT.getCurrent().DEFAULT_REQUEST_TIMEOUT,n=uT.getCurrent().DEFAULT_CONNECTION_TIMEOUT;return"string"===i.format?uZ({url:e,responseType:"text",timeout:t,connectionTimeout:n,cancelSignal:o}):uZ({url:e,responseType:"arraybuffer",timeout:t,connectionTimeout:n,cancelSignal:o})}).then(function(e){if("string"===i.format){if("string"!=typeof e.responseData)throw Error("External DASH resources should have been a string");return uk(e,{responseData:{success:!0,data:e.responseData}})}if(!v(e.responseData,ArrayBuffer))throw Error("External DASH resources should have been ArrayBuffers");return uk(e,{responseData:{success:!0,data:e.responseData}})},function(e){return uk({},{size:void 0,requestDuration:void 0,responseData:{success:!1,error:eh(e,{defaultCode:"PIPELINE_PARSE_ERROR",defaultReason:"An unknown error occured when parsing ressources."})}})})})).then(function(e){return"string"===i.format?as(e):au(e),g(i.continue(e))})}}},as=function(e){ui.CURRENT_ENV!==ui.PRODUCTION&&e.forEach(function(e){var t=e.responseData;if(!(t.success&&"string"==typeof t.data)&&t.success)throw Error("Invalid data given to the LoadedRessource")})},au=function(e){ui.CURRENT_ENV!==ui.PRODUCTION&&e.forEach(function(e){var t=e.responseData;if(!(t.success&&v(t.data,ArrayBuffer))&&t.success)throw Error("Invalid data given to the LoadedRessource")})},al=function(e){if(v(e,ArrayBuffer))return tJ(new Uint8Array(e));if("string"==typeof e)return e;if(v(e,Document))return e.documentElement.outerHTML;throw Error("DASH Manifest Parser: Unrecognized Manifest format")},ad=function(e){if(v(e,ArrayBuffer))return new DOMParser().parseFromString(tJ(new Uint8Array(e)),"text/xml");if("string"==typeof e)return new DOMParser().parseFromString(e,"text/xml");if(v(e,Document))return e;throw Error("DASH Manifest Parser: Unrecognized Manifest format")},ac=function(e){if(v(e,ArrayBuffer))return e;if("string"==typeof e)return tX(e).buffer;if(v(e,Document))return tX(e.documentElement.innerHTML).buffer;throw Error("DASH Manifest Parser: Unrecognized Manifest format")},af=function(e){var t=new DataView(e);return 61371===t.getUint16(0)&&191===t.getUint8(2)||!(65279===t.getUint16(0)||65534===t.getUint16(0))},av=function(e){var t=y(e,2),n=t[0],i=t[1];return i===1/0?"bytes=".concat(n,"-"):"bytes=".concat(n,"-").concat(i)},ah=function(e,t){return"audio"===e||"video"===e?"video/mp4"===t||"audio/mp4"===t?"mp4":"video/webm"===t||"audio/webm"===t?"webm":void 0:"text"===e&&"application/mp4"===t?"mp4":void 0},ap=function(e,t){if(t){if(0>nu(e,1718909296))throw new u4("INTEGRITY_ERROR","Incomplete `ftyp` box");if(0>nu(e,1836019574))throw new u4("INTEGRITY_ERROR","Incomplete `moov` box")}else{if(0>nu(e,1836019558))throw new u4("INTEGRITY_ERROR","Incomplete `moof` box");if(0>nu(e,1835295092))throw new u4("INTEGRITY_ERROR","Incomplete `mdat` box")}},am=function(e){return function(t,n,i,r,a){var o=function(e){(v(e,ArrayBuffer)||v(e,Uint8Array))&&"mp4"===ah(n.type,n.mimeType)&&ap(new Uint8Array(e),n.segment.isInit)};return new Promise(function(s,u){var l=function(){d.signal.deregister(u),c()},d=new uM,c=d.linkToSignal(r);d.signal.register(u),e(t,n,i,d.signal,un(ut({},a),{onNewChunk:function(e){try{o(e),a.onNewChunk(e)}catch(e){l(),d.cancel(),u(e)}}})).then(function(e){if(l(),!d.isUsed()){if("segment-loaded"===e.resultType)try{o(e.resultData.responseData)}catch(e){u(e);return}s(e)}},function(e){l(),u(e)})})}},ag=function(e,t){return null===e?null:null===t.url?e.baseUrl:ra(e.baseUrl,t.url)},ay=function(e,t,n,i,r){return void 0===t.range?uZ({url:e,responseType:"arraybuffer",timeout:n.timeout,connectionTimeout:n.connectionTimeout,cancelSignal:i,onProgress:r.onProgress}).then(function(e){return{resultType:"segment-loaded",resultData:e}}):void 0===t.indexRange?uZ({url:e,headers:{Range:av(t.range)},responseType:"arraybuffer",timeout:n.timeout,connectionTimeout:n.connectionTimeout,cancelSignal:i,onProgress:r.onProgress}).then(function(e){return{resultType:"segment-loaded",resultData:e}}):t.range[1]+1===t.indexRange[0]?uZ({url:e,headers:{Range:av([t.range[0],t.indexRange[1]])},responseType:"arraybuffer",timeout:n.timeout,connectionTimeout:n.connectionTimeout,cancelSignal:i,onProgress:r.onProgress}).then(function(e){return{resultType:"segment-loaded",resultData:e}}):Promise.all([uZ({url:e,headers:{Range:av(t.range)},responseType:"arraybuffer",timeout:n.timeout,connectionTimeout:n.connectionTimeout,cancelSignal:i,onProgress:r.onProgress}),uZ({url:e,headers:{Range:av(t.indexRange)},responseType:"arraybuffer",timeout:n.timeout,connectionTimeout:n.connectionTimeout,cancelSignal:i,onProgress:r.onProgress})]).then(function(t){var n=y(t,2),i=n[0],r=n[1],a=t3(new Uint8Array(i.responseData),new Uint8Array(r.responseData)),o=Math.min(i.sendingTime,r.sendingTime),s=Math.max(i.receivedTime,r.receivedTime);return{resultType:"segment-loaded",resultData:{url:e,responseData:a,size:i.size+r.size,requestDuration:s-o,sendingTime:o,receivedTime:s}}})},a_=function(e,t,n,i,r){var a=t.segment,o=void 0!==a.range?{Range:av(a.range)}:void 0,s=null;return eu({url:e,headers:o,onData:function(e){var t=new Uint8Array(e.chunk),n=nl(null!==s?t3(s,t):t),a=n[0];s=n[1],null!==a&&(i.onNewChunk(a),r.isCancelled())||(i.onProgress({duration:e.duration,size:e.size,totalSize:e.totalSize}),r.isCancelled())},timeout:n.timeout,cancelSignal:r}).then(function(e){return{resultType:"chunk-complete",resultData:e}})},aS=function(e,t,n,i,r,a){if(t.segment.isInit)return ay(e,t.segment,i,a,r);var o=ah(t.type,t.mimeType);if(n&&("mp4"===o||void 0===o)){if(el())return a_(e,t,i,r,a);eS("DASH: Your browser does not have the fetch API. You will have a higher chance of rebuffering when playing close to the live edge")}var s=t.segment;return uZ({url:e,responseType:"arraybuffer",headers:void 0!==s.range?{Range:av(s.range)}:void 0,timeout:i.timeout,connectionTimeout:i.connectionTimeout,cancelSignal:a,onProgress:r.onProgress}).then(function(e){return{resultType:"segment-loaded",resultData:e}})},ab=function(e){var t=e.lowLatencyMode,n=e.segmentLoader;return!0!==e.checkMediaSegmentIntegrity?i:am(i);function i(e,i,r,a,o){var s=ag(e,i.segment);return null===s?Promise.resolve({resultType:"segment-created",resultData:null}):t||void 0===n?aS(s,i,t,r,o,a):new Promise(function(e,u){var l,d=function(e){c||(c=!0,"function"==typeof f&&f(),u(e))},c=!1;void 0!==i.segment.range&&(l=[i.segment.range],void 0!==i.segment.indexRange&&l.push(i.segment.indexRange));var f=n({isInit:i.segment.isInit,timeout:r.timeout,byteRanges:l,trackType:i.type,url:s},{reject:function(e){if(!(c||a.isCancelled())){var t,n;c=!0,a.deregister(d),u(new uY(null!=(t=null==e?void 0:e.message)?t:"Unknown error when fetching a DASH segment through a custom segmentLoader.",null!=(n=null==e?void 0:e.canRetry)&&n,null==e?void 0:e.xhr))}},resolve:function(t){c||a.isCancelled()||(c=!0,a.deregister(d),e({resultType:"segment-loaded",resultData:{responseData:t.data,size:t.size,requestDuration:t.duration}}))},progress:function(e){c||a.isCancelled()||o.onProgress({duration:e.duration,size:e.size,totalSize:e.totalSize})},fallback:function(){c||a.isCancelled()||(c=!0,a.deregister(d),aS(s,i,t,r,o,a).then(e,u))}});a.register(d)})}},aE=function(e,t){var n=cT(cg,[cp,cm],e,[t,e.length]);if(null===n)return null;var i=n[1]-n[0];return 1e9/aM(e,n[0],i)},ak=function(e,t){var n=cT(cy,[cp,cm],e,[t,e.length]);if(null===n)return null;var i=n[1]-n[0];return 4===i?aR(e,n[0]):8===i?aC(e,n[0]):null},aT=function(e,t){var n=cT(cp,[],e,[t,e.length]);if(null===n)return null;var i=y(n,2),r=i[0],a=i[1],o=aE(e,r);if(null===o)return null;var s=ak(e,r);if(null===s)return null;var u=cT(c_,[],e,[r,a]);if(null===u)return null;for(var l=[],d=u[0];d<u[1];){var c=cT(cS,[],e,[d,u[1]]);if(null===c)break;var f=cT(cb,[],e,[c[0],c[1]]);if(null===f)return null;var v=aM(e,f[0],f[1]-f[0]),h=cT(ck,[cE],e,[c[0],c[1]]);if(null===h)return null;var p=aM(e,h[0],h[1]-h[0])+r;l.push({time:v,rangeStart:p}),d=c[1]}for(var m=[],g=0;g<l.length;g++){var _=l[g];g===l.length-1?m.push({time:_.time,timescale:o,duration:0===g?s:s-_.time,range:[_.rangeStart,1/0]}):m.push({time:_.time,timescale:o,duration:l[g+1].time-_.time,range:[_.rangeStart,l[g+1].rangeStart-1]})}return m},aw=function(e,t){for(var n=1;n<=8;n++)if(e[t]>=Math.pow(2,8-n))return n},aI=function(e,t){var n=aw(e,t);if(void 0===n)return uw.warn("webm: unrepresentable length"),null;if(t+n>e.length)return uw.warn("webm: impossible length"),null;for(var i=0,r=0;r<n;r++)i=e[t+r]*Math.pow(2,(n-r-1)*8)+i;return{length:n,value:i}},aA=function(e,t){var n=aw(e,t);if(void 0===n)return uw.warn("webm: unrepresentable length"),null;if(t+n>e.length)return uw.warn("webm: impossible length"),null;for(var i=(e[t]&(1<<8-n)-1)*Math.pow(2,(n-1)*8),r=1;r<n;r++)i=e[t+r]*Math.pow(2,(n-r-1)*8)+i;return{length:n,value:i}},aR=function(e,t){return new DataView(e.buffer).getFloat32(t)},aC=function(e,t){return new DataView(e.buffer).getFloat64(t)},aM=function(e,t,n){for(var i=0,r=0;r<n;r++)i=e[t+r]*Math.pow(2,(n-r-1)*8)+i;return i},aP=function(e,t,n,i){var r=nR(e);if(void 0===r||void 0===i)return null;var a=void 0!==n.timestampOffset?r+n.timestampOffset*i:r,o=nM(e);if(a<0&&(void 0!==o&&(o+=a),a=0),t||!n.complete)return void 0===o&&uw.warn("DASH: Chunked segments should indicate a duration through their trun boxes"),{time:a/i,duration:void 0!==o?o/i:void 0};var s,u=n.duration*i;return void 0!==o&&Math.abs(o-u)<=Math.min(.9*i,u/4)&&(s=o),{time:a/i,duration:void 0!==s?s/i:s}},aD=function(e,t){if(e.length<=0)return!1;for(var n=e.length,i=0;i<n;i++){var r=Date.parse(tJ(e[i].messageData));if(void 0===t||void 0===r||isNaN(r)||r>=t)return!0}return!1},ax=function(e,t){if(0!==e.length){var n=e.reduce(function(e,t){return"urn:mpeg:dash:event:2012"===t.schemeIdUri&&"1"===t.value?(void 0===e.manifestRefreshEventsFromEMSGs&&(e.manifestRefreshEventsFromEMSGs=[]),e.manifestRefreshEventsFromEMSGs.push(t)):(void 0===e.EMSGs&&(e.EMSGs=[]),e.EMSGs.push(t)),e},{manifestRefreshEventsFromEMSGs:void 0,EMSGs:void 0}),i=n.manifestRefreshEventsFromEMSGs,r=n.EMSGs;return{inbandEvents:null==r?void 0:r.map(function(e){return{type:"emsg",value:e}}),needsManifestRefresh:void 0!==t&&void 0!==i&&aD(i,t)}}},aN=function(e){var t=e.__priv_patchLastSegmentInSidx;return function(e,n,r){var a,o=n.segment,s=n.periodStart,u=n.periodEnd,l=e.data,d=e.isChunked,c=[s,u];if(null===l)return o.isInit?{segmentType:"init",initializationData:null,initializationDataSize:0,protectionData:[],initTimescale:void 0}:{segmentType:"media",chunkData:null,chunkSize:0,chunkInfos:null,chunkOffset:0,protectionData:[],appendWindow:c};var f=v(l,Uint8Array)?l:new Uint8Array(l),h=ah(n.type,n.mimeType),p="mp4"===h||void 0===h,m=[];if(p){var g,y,_,S=ng(f);o.isInit&&(_=null!=(g=nN(f))?g:void 0),(S.length>0||void 0!==_)&&m.push({initDataType:"cenc",keyId:_,initData:S})}if(!o.isInit){var b=p?aP(f,d,o,r):null,E=null!=(y=o.timestampOffset)?y:0;if(p){var k=nx(f);if(void 0!==k){var T=ax(k.filter(function(e){return void 0!==o.privateInfos&&void 0!==o.privateInfos.isEMSGWhitelisted&&o.privateInfos.isEMSGWhitelisted(e)}),n.manifestPublishTime);if(void 0!==T){var w=T.needsManifestRefresh,I=T.inbandEvents;return{segmentType:"media",chunkData:f,chunkSize:f.length,chunkInfos:b,chunkOffset:E,appendWindow:c,inbandEvents:I,protectionData:m,needsManifestRefresh:w}}}}return{segmentType:"media",chunkData:f,chunkSize:f.length,chunkInfos:b,chunkOffset:E,protectionData:m,appendWindow:c}}var A,R=o.indexRange;if("webm"===h)A=aT(f,0);else if(p&&(A=nA(f,Array.isArray(R)?R[0]:0),!0===t&&null!==A&&A.length>0)){var C=A[A.length-1];Array.isArray(C.range)&&(C.range[1]=1/0)}p?a=nP(f):"webm"===h&&(a=aE(f,0));var M=i(a)?void 0:a;return{segmentType:"init",initializationData:f,initializationDataSize:f.length,protectionData:m,initTimescale:M,segmentList:null!=A?A:void 0}}},aO=function(e){var t=e.lowLatencyMode;return!0!==e.checkMediaSegmentIntegrity?n:am(n);function n(e,n,i,r,a){var o=n.segment,s=o.range,u=ag(e,o);if(null===u)return Promise.resolve({resultType:"segment-created",resultData:null});if(o.isInit)return ay(u,o,i,r,a);var l=ah(n.type,n.mimeType),d="mp4"===l||void 0===l;if(t&&d){if(el())return a_(u,n,i,a,r);eS("DASH: Your browser does not have the fetch API. You will have a higher chance of rebuffering when playing close to the live edge")}return d?uZ({url:u,responseType:"arraybuffer",headers:Array.isArray(s)?{Range:av(s)}:null,timeout:i.timeout,connectionTimeout:i.connectionTimeout,onProgress:a.onProgress,cancelSignal:r}).then(function(e){return{resultType:"segment-loaded",resultData:e}}):uZ({url:u,responseType:"text",headers:Array.isArray(s)?{Range:av(s)}:null,timeout:i.timeout,connectionTimeout:i.connectionTimeout,onProgress:a.onProgress,cancelSignal:r}).then(function(e){return{resultType:"segment-loaded",resultData:e}})}},aL=function(e){var t=nk(e);return null===t?"":tJ(t)},aU=function(e){if(void 0===e)throw Error("Cannot parse subtitles: unknown format");switch(e.toLowerCase()){case"stpp":case"stpp.ttml.im1t":return"ttml";case"wvtt":return"vtt"}throw Error('The codec used for the subtitles "'.concat(e,'" is not managed yet.'))},aF=function(e,t){switch(t){case"application/ttml+xml":return"ttml";case"application/x-sami":case"application/smil":return"sami";case"text/vtt":return"vtt"}if(void 0!==e&&"srt"===e.toLowerCase())return"srt";throw Error("could not find a text-track parser for the type ".concat(null!=t?t:""))},aB=function(e,t,n,i){var r,a,o=e.segment,s=e.language,u=e.codecs;if(o.isInit)return null;null===n?i?(r=o.time,a=o.end):uw.warn("Transport: Unavailable time data for current text track."):(r=n.time,void 0!==n.duration?a=r+n.duration:!i&&o.complete&&(a=r+o.duration));var l=aU(u);return{data:aL(t),type:l,language:s,start:r,end:a}},aV=function(e,t,n){var i,r,a=e.segment;return a.isInit?null:(n?uw.warn("Transport: Unavailable time data for current text track."):(i=a.time,a.complete&&(r=a.time+a.duration)),{data:t,type:aF(e.codecs,e.mimeType),language:e.language,start:i,end:r})},az=function(e,t,n,i,r){var a,o,s=n.segment,u=s.isInit,l=s.indexRange;if("string"==typeof e?o=tX(e):v(e,Uint8Array)?o=e:o=new Uint8Array(e),u){var d=nA(o,Array.isArray(l)?l[0]:0);if(!0===r&&null!==d&&d.length>0){var c=d[d.length-1];Array.isArray(c.range)&&(c.range[1]=1/0)}return{segmentType:"init",initializationData:null,initializationDataSize:0,protectionData:[],initTimescale:nP(o),segmentList:null!=d?d:void 0}}var f=aP(o,t,s,i),h=aB(n,o,f,t),p=null!=(a=s.timestampOffset)?a:0;return{segmentType:"media",chunkData:h,chunkSize:o.length,chunkInfos:f,chunkOffset:p,protectionData:[],appendWindow:[n.periodStart,n.periodEnd]}},aK=function(e,t,n){var i,r,a=n.periodStart,o=n.periodEnd,s=n.segment,u=s.timestampOffset;if(s.isInit)return{segmentType:"init",initializationData:null,initializationDataSize:0,protectionData:[],initTimescale:void 0};if("string"!=typeof e){var l=v(e,Uint8Array)?e:new Uint8Array(e);i=tJ(l),r=l.length}else i=e;return{segmentType:"media",chunkData:aV(n,i,t),chunkSize:r,chunkInfos:null,chunkOffset:void 0===u?0:u,protectionData:[],appendWindow:[a,o]}},aW=function(e){var t=e.__priv_patchLastSegmentInSidx;return function(e,n,i){var r,a=n.periodStart,o=n.periodEnd,s=n.segment,u=e.data,l=e.isChunked;if(null===u)return s.isInit?{segmentType:"init",initializationData:null,initializationDataSize:0,protectionData:[],initTimescale:void 0}:{segmentType:"media",chunkData:null,chunkSize:0,chunkInfos:null,chunkOffset:null!=(r=s.timestampOffset)?r:0,protectionData:[],appendWindow:[a,o]};var d=ah(n.type,n.mimeType);if("webm"===d)throw Error("Text tracks with a WEBM container are not yet handled.");return"mp4"===d?az(u,l,n,i,t):aK(u,l,n)}},aG=function(e,t){if(i(t))return 0;if(!i(t.position))return t.position;if(!i(t.wallClockTime))return t.wallClockTime;if(!i(t.fromFirstPosition))return t.fromFirstPosition;var n=e.duration;if("number"==typeof t.fromLastPosition)return i(n)||!isFinite(n)?(uw.warn("startAt.fromLastPosition set but no known duration, beginning at 0."),0):Math.max(0,n+t.fromLastPosition);if("number"==typeof t.fromLivePosition){var r=e.seekable.length>0?e.seekable.end(0):n;return i(r)?(uw.warn("startAt.fromLivePosition set but no known live position, beginning at 0."),0):Math.max(0,r+t.fromLivePosition)}if(!i(t.percentage)){if(i(n)||!isFinite(n))return uw.warn("startAt.percentage set but no known duration, beginning at 0."),0;var a=t.percentage;return a>=100?n:a<=0?0:+a/100*n}return 0},aH=function(e,t){for(var n=0;n<e.length;n++)um&&n===t||(e[n].enabled=!1);return!(t<0)&&!(t>=e.length)&&(e[t].enabled=!0,!0)},aq=function(e,t){var n;if(t.length!==e.length)return!0;for(var i=0;i<t.length;i++)if(t[i].nativeTrack!==(null==(n=e[i])?void 0:n.nativeTrack))return!0;return!1},aY=function(e){for(var t,n=[],i={},r=0;r<e.length;r++){var a=e[r],o=""===a.language?"nolang":a.language,s=null!=(t=i[o])?t:1,u="gen_audio_"+o+"_"+s.toString();i[o]=s+1;var l={language:a.language,id:u,normalized:u9(a.language),audioDescription:"descriptions"===a.kind||"description"===a.kind,representations:[]};n.push({track:l,nativeTrack:a})}return n},aj=function(e){for(var t,n=[],i={},r=0;r<e.length;r++){var a=e[r],o=""===a.language?"nolang":a.language,s=null!=(t=i[o])?t:1,u="gen_text_"+o+"_"+s.toString();i[o]=s+1;var l="forced"===a.kind||void 0,d={language:a.language,forced:l,label:a.label,id:u,normalized:u9(a.language),closedCaption:"captions"===a.kind};n.push({track:d,nativeTrack:a})}return n},aQ=function(e){for(var t,n=[],i={},r=0;r<e.length;r++){var a=e[r],o=""===a.language?"nolang":a.language,s=null!=(t=i[o])?t:1,u="gen_video_"+o+"_"+s.toString();i[o]=s+1,n.push({track:{id:u,representations:[]},nativeTrack:a})}return n},aX=function(e){for(var t=0;t<e.length;t++)e[t].nativeTrack.mode="disabled"},a$=function(e,t){for(var n=0;n<e.length;n++){var i=e[n].nativeTrack;i!==t&&("showing"===i.mode||"hidden"===i.mode)&&(i.mode="disabled")}},aZ=function(e){for(var t=0;t<e.length;t++)e[t].nativeTrack.selected=!1},aJ=function(e,t,n){var i=e.getBoundingClientRect(),r=i.height,a=i.width,o=new uR({height:r,width:a},n),s=r,u=a;if(void 0!==cC){var l=new cC(function(e){if(0===e.length){uw.error("Compat: Resized but no observed element.");return}var t=e[0].contentRect,n=t.height,i=t.width;(n!==s||i!==u)&&(s=n,u=i,o.setValue({height:n,width:i}))});l.observe(e),n.register(function(){l.disconnect()})}else{var d=setInterval(function(){var t=e.getBoundingClientRect(),n=t.height,i=t.width;(n!==s||i!==u)&&(s=n,u=i,o.setValue({height:n,width:i}))},t);n.register(function(){clearInterval(d)})}return o},a0=function(e,t,n,i){uw.debug("HTSB: Finding parser for html text tracks:",e);var r=le.htmlTextTracksParsers[e];if("function"!=typeof r)throw Error("no parser found for the given text track");uw.debug("HTSB: Parser found, parsing...");var a=r(t,n,i);return uw.debug("HTTB: Parsed successfully!",a.length),a},a1=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:.2;return Math.abs(e-t)<=Math.min(n,.2)},a2=function(e,t){for(var n=e.length-1;n>=0;n--)if(e[n].start<t)return e.slice(0,n+1);return[]},a5=function(e,t){for(var n=0;n<e.length;n++)if(e[n].end>t)return e.slice(n,e.length);return[]},a4=function(e,t,n){var i=Math.max(e.start,t),r=a2(e.cues,t),a={start:e.start,end:i,cues:r},o=Math.min(n,e.end),s=a5(e.cues,n);return[a,{start:o,end:e.end,cues:s}]},a3=function(e,t,n,i){for(var r=[t/n.columns,e/n.rows],a=i.getElementsByClassName("proportional-style"),o=0;o<a.length;o++){var s=a[o];if(v(s,HTMLElement)){var u=s.getAttribute("data-proportional-font-size");null===u||isNaN(+u)||(s.style.fontSize=String(+u*r[1])+"px");var l=s.getAttribute("data-proportional-width");null===l||isNaN(+l)||(s.style.width=String(+l*r[0])+"px");var d=s.getAttribute("data-proportional-height");null===d||isNaN(+d)||(s.style.height=String(+d*r[1])+"px");var c=s.getAttribute("data-proportional-line-height");null===c||isNaN(+c)||(s.style.lineHeight=String(+c*r[1])+"px");var f=s.getAttribute("data-proportional-left");null===f||isNaN(+f)||(s.style.left=String(+f*r[0])+"px");var h=s.getAttribute("data-proportional-top");null===h||isNaN(+h)||(s.style.top=String(+h*r[1])+"px");var p=s.getAttribute("data-proportional-padding-top");null===p||isNaN(+p)||(s.style.paddingTop=String(+p*r[1])+"px");var m=s.getAttribute("data-proportional-padding-bottom");null===m||isNaN(+m)||(s.style.paddingBottom=String(+m*r[1])+"px");var g=s.getAttribute("data-proportional-padding-left");null===g||isNaN(+g)||(s.style.paddingLeft=String(+g*r[0])+"px");var y=s.getAttribute("data-proportional-padding-right");null===y||isNaN(+y)||(s.style.paddingRight=String(+y*r[0])+"px")}}return a.length>0},a8=function(e,t){try{e.removeChild(t)}catch(e){uw.warn("HTD: Can't remove text track: not in the element.")}},a6=function(e){var t=e.getAttribute("data-resolution-rows"),n=e.getAttribute("data-resolution-columns");if(null===t||null===n)return null;var i=parseInt(t,10),r=parseInt(n,10);return null===i||null===r?null:{rows:i,columns:r}},a9=function(e){for(var t=/\.(\S+)\s*{([^}]*)}/gi,n={},r=t.exec(e);null!==r;){var a=r[1],o=oe(r[2],"lang");i(a)||i(o)||(n[o]=a),r=t.exec(e)}return n},a7=function(e){var t=/p\s*{([^}]*)}/gi.exec(e);return null===t?"":t[1]},oe=function(e,t){var n=RegExp("\\s*"+t+":\\s*(\\S+);","i").exec(e);return Array.isArray(n)?n[1]:null},ot=function(e,t){for(var n=t+1;ed(e[n]);)n++;return n},on=function(e){for(var t=[],n=0;n<e.length;n++)if(ed(e[n])){var i=ot(e,n),r=e.slice(n,i);r.length>0&&(1===r.length?r[0].indexOf("-->")>=0&&t.push(r):(r[1].indexOf("-->")>=0||r[0].indexOf("-->")>=0)&&t.push(r)),n=i}return t},oi=function(e){var t=e.split(":");if(ed(t[2])){var n=parseInt(t[0],10),i=parseInt(t[1],10),r=parseFloat(t[2].replace(",","."));return isNaN(n)||isNaN(i)||isNaN(r)?void 0:3600*n+60*i+r}},or=function(e,t){if(0===e.length)return null;var n,i,r,a,o=[];if(ed(e[1])&&-1!==e[1].indexOf("-->")&&(r=(n=y(e[1].split("-->").map(function(e){return e.trim()}),2))[0],a=n[1],o=e.slice(2,e.length)),ed(r)&&ed(a)||(r=(i=y(e[0].split("-->").map(function(e){return e.trim()}),2))[0],a=i[1],o=e.slice(1,e.length)),!ed(r)||!ed(a))return null;var s=oi(r),u=oi(a);return void 0===s||void 0===u?null:{start:s+t,end:u+t,payload:o}},oa=function(e,t){for(var n=on(e.split(/\r\n|\n|\r/)),i=[],r=0;r<n.length;r++){var a=or(n[r],t);if(null!==a){var o=oo(a);null!==o&&i.push(o)}}return i},oo=function(e){var t=e.start,n=e.end,i=e.payload,r=document.createElement("div");r.className="rxp-texttrack-p",r.style.fontSize="28px",r.style.position="absolute",r.style.bottom="5%",r.style.width="100%",r.style.textAlign="center",r.style.color="#fff",r.style.textShadow="-1px -1px 2px #000,1px -1px 2px #000,-1px 1px 2px #000,1px 1px 2px #000";for(var a=0;a<i.length;a++){0!==a&&r.appendChild(document.createElement("br"));var o=os(i[a]);r.appendChild(o)}return{start:t,end:n,element:r}},os=function(e){var t=document.createElement("div");t.innerHTML=e;var n=function(e){var t=e.childNodes,i=document.createElement("span");i.className="rxp-texttrack-span";for(var r=0;r<t.length;r++){var a=t[r];if("#text"===a.nodeName){for(var o=a.wholeText.split("\n"),s=0;s<o.length;s++)if(0!==s&&i.appendChild(document.createElement("br")),o[s].length>0){var u=document.createTextNode(o[s]);i.appendChild(u)}}else if("B"===a.nodeName){var l=n(a);l.style.fontWeight="bold",i.appendChild(l)}else if("I"===a.nodeName){var d=n(a);d.style.fontStyle="italic",i.appendChild(d)}else if("U"===a.nodeName){var c=n(a);c.style.textDecoration="underline",i.appendChild(c)}else if(ou(a)&&"string"==typeof a.color){var f=n(a);f.style.color=a.color,i.appendChild(f)}else{var v=n(a);i.appendChild(v)}}return i};return n(t)},ou=function(e){return"FONT"===e.nodeName&&"color"in e},ol=function(e){var t=e.getAttribute("ttp:frameRate"),n=e.getAttribute("ttp:subFramRate"),i=e.getAttribute("ttp:tickRate"),r=e.getAttribute("ttp:frameRateMultiplier"),a=e.getAttribute("xml:space"),o=e.getAttribute("ttp:cellResolution"),s={columns:32,rows:15};if(null!==o){var u=cB.exec(o);if(null===u||u.length<3)uw.warn("TTML Parser: Invalid cellResolution");else{var l=parseInt(u[1],10),d=parseInt(u[2],10);isNaN(l)||isNaN(d)?uw.warn("TTML Parser: Invalid cellResolution"):s={columns:l,rows:d}}}if(ed(a)&&"default"!==a&&"preserve"!==a)throw Error("Invalid spacing style");var c=Number(t);(isNaN(c)||c<=0)&&(c=30);var f=Number(n);(isNaN(f)||f<=0)&&(f=1);var v=Number(i);(isNaN(v)||v<=0)&&(v=void 0);var h=c,p=null!=f?f:1,m=null!=a?a:"default",g=null!=v?v:c*f;if(null!==r){var y=/^(\d+) (\d+)$/g.exec(r);null!==y&&(h=Number(y[1])/Number(y[2])*c)}return{cellResolution:s,tickRate:g,frameRate:h,subFrameRate:p,spaceStyle:m}},od=function(e,t,n,i){for(var r={},a=e.slice(),o=0;o<=t.length-1;o++){var s=function(e){var o=t[e];if(void 0!==o){var s=void 0,u=void 0;if(o.nodeType===Node.ELEMENT_NODE)for(var l=0;l<=o.attributes.length-1;l++){var d=o.attributes[l],c=d.name;if("style"===c)s=d.value;else if("region"===c)u=d.value;else{var f=c.substring(4);if(e_(a,f)&&(r[f]=d.value,a.splice(l,1),0===a.length))return{v:r}}}if(ed(s)){var v=j(n,function(e){return e.id===s});if(void 0!==v)for(var h=0;h<=a.length-1;h++){var p=a[h];if(!ed(r[p])&&ed(v.style[p])){if(r[p]=v.style[p],a.splice(h,1),0===a.length)return{v:r};h--}}}if(ed(u)){var m=j(i,function(e){return e.id===u});if(void 0!==m)for(var g=0;g<=a.length-1;g++){var y=a[g];if(!ed(r[y])&&ed(m.style[y])){if(r[y]=m.style[y],a.splice(g,1),0===a.length)return{v:r};g--}}}}}(o);if("object"===b(s))return s.v}return r},oc=function(e){if(e.nodeType!==Node.ELEMENT_NODE)return{};for(var t={},n=0;n<=e.attributes.length-1;n++){var i=e.attributes[n];tT(i.name,"tts")&&(t[i.name.substring(4)]=i.value)}return t},of=function(e){for(var t=[],n=0;n<e.length;n++)(function n(i,r){t.push(r);for(var a=0;a<i.extendsStyles.length;a++)!function(r){var a=i.extendsStyles[r],o=z(e,function(e){return e.id===a});if(o<0)uw.warn("TTML Parser: unknown style inheritance: "+a);else{var s=e[o];e_(t,o)?uw.warn("TTML Parser: infinite style inheritance loop avoided"):n(s,o),i.style=uk({},s.style,i.style)}}(a);i.extendsStyles.length=0})(e[n],n),t.length=0},ov=function(e,t){return v(e.parentNode,Element)?function e(n){var i=[];n.tagName.toLowerCase()===t.toLowerCase()&&i.push(n);var r=n.parentNode;return v(r,Element)&&i.push.apply(i,S(e(r))),i}(e.parentNode):[]},oh=function(e){var t=ov(e,"div");if(0===t.length){var n=ov(e,"tt:div");n.length>0&&(t=n)}return t},op=function(e){var t=e.getElementsByTagName("body");if(t.length>0)return t[0];var n=e.getElementsByTagName("tt:body");return n.length>0?n[0]:null},om=function(e){var t=e.getElementsByTagName("style");if(t.length>0)return t;var n=e.getElementsByTagName("tt:style");return n.length>0?n:t},og=function(e){var t=e.getElementsByTagName("region");if(t.length>0)return t;var n=e.getElementsByTagName("tt:region");return n.length>0?n:t},oy=function(e){var t=e.getElementsByTagName("p");if(t.length>0)return t;var n=e.getElementsByTagName("tt:p");return n.length>0?n:t},o_=function(e){return"br"===e.nodeName||"tt:br"===e.nodeName},oS=function(e){return"span"===e.nodeName||"tt:span"===e.nodeName},ob=function(e,t){var n=[],i=new DOMParser().parseFromString(e,"text/xml");if(null!=i){var r=i.getElementsByTagName("tt")[0];if(void 0===r&&void 0===(r=i.getElementsByTagNameNS("*","tt")[0]))throw Error("invalid XML");for(var a=op(r),o=om(r),s=og(r),u=oy(r),l=ol(r),d=[],c=0;c<=o.length-1;c++){var f=o[c];if(v(f,Element)){var h=f.getAttribute("xml:id");if(null!==h){var p=f.getAttribute("style"),m=null===p?[]:p.split(" ");d.push({id:h,style:oc(f),extendsStyles:m})}}}of(d);for(var g=[],y=0;y<=s.length-1;y++)!function(e){var t=s[e];if(v(t,Element)){var n=t.getAttribute("xml:id");if(null!==n){var i=oc(t),r=t.getAttribute("style");if(ed(r)){var a=j(d,function(e){return e.id===r});void 0!==a&&(i=uk({},a.style,i))}g.push({id:n,style:i,extendsStyles:[]})}}}(y);for(var _=od(cV,null!==a?[a]:[],d,g),b=(null!==a?a.getAttribute("xml:space"):void 0)==="default"||"default"===l.spaceStyle,E=0;E<u.length;E++){var k=u[E];if(v(k,Element)){var T=oh(k),w=uk({},_,od(cV,[k].concat(S(T)),d,g)),I=k.getAttribute("xml:space"),A={paragraph:k,timeOffset:t,idStyles:d,regionStyles:g,body:a,paragraphStyle:w,ttParams:l,shouldTrimWhiteSpace:ed(I)?"default"===I:b};null!==A&&n.push(A)}}}return n},oE=function(e){e.extent="70% 20%",e.fontSize="1c",e.origin="15% 80%",e.displayAlign="before",e.textAlign="center"},ok=function(e,t){var n=cz.exec(t),i=Number(n[1]),r=Number(n[2]),a=Number(n[3]),o=Number(n[4]),s=Number(n[5]);return isNaN(s)&&(s=0),o+=s/e.subFrameRate,(a+=o/e.frameRate)+60*r+3600*i},oT=function(e,t){var n=e.exec(t);if(null===n||""===n[0])return null;var i=Number(n[1]);isNaN(i)&&(i=0);var r=Number(n[2]);isNaN(r)&&(r=0);var a=Number(n[3]);isNaN(a)&&(a=0);var o=Number(n[4]);return isNaN(o)&&(o=0),o/1e3+a+60*r+3600*i},ow=function(e,t){var n=e.getAttribute("begin"),r=e.getAttribute("dur"),a=e.getAttribute("end"),o=ed(n)?cJ(n,t):null,s=ed(r)?cJ(r,t):null,u=ed(a)?cJ(a,t):null;if(i(o)||i(u)&&i(s))throw Error("Invalid text cue");var l=i(u)?o+s:u;return{start:o,end:l}},oI=function(t,n){void 0===e&&(e=void 0!==t.classList&&"function"==typeof t.classList.add),e?t.classList.add(n):0>(" "+t.className+" ").indexOf(" "+n+" ")&&(t.className+=" "+n)},oA=function(e,t){var n=t.trim();if("auto"!==n){var i=n.split(" ");if(2===i.length){var r=cj.exec(i[0]),a=cj.exec(i[1]);null!==r&&null!==a&&("px"===r[2]||"%"===r[2]||"em"===r[2]?e.style.width=r[1]+r[2]:"c"===r[2]?(oI(e,"proportional-style"),e.setAttribute("data-proportional-width",r[1])):uw.warn("TTML Parser: unhandled extent unit:",r[2]),"px"===a[2]||"%"===a[2]||"em"===a[2]?e.style.height=a[1]+a[2]:"c"===a[2]?(oI(e,"proportional-style"),e.setAttribute("data-proportional-height",a[1])):uw.warn("TTML Parser: unhandled extent unit:",a[2]))}}},oR=function(e,t){var n=t.trim().split(" ");if(0!==n.length){var i=cj.exec(n[0]);if(null!==i){if("px"===i[2]||"em"===i[2])e.style.fontSize=i[1]+i[2];else if("c"===i[2])e.style.position="relative",oI(e,"proportional-style"),e.setAttribute("data-proportional-font-size",i[1]);else if("%"===i[2]){var r=Number(i[1]);isNaN(r)?uw.warn('TTML Parser: could not parse fontSize value "'+i[1]+'" into a number'):(e.style.position="relative",oI(e,"proportional-style"),e.setAttribute("data-proportional-font-size",String(r/100)))}else uw.warn("TTML Parser: unhandled fontSize unit:",i[2])}}},oC=function(e,t){var n=t.trim(),i=n.split(" ");if("auto"!==n){var r=cj.exec(i[0]);null!==r&&("px"===r[2]||"%"===r[2]||"em"===r[2]?e.style.lineHeight=r[1]+r[2]:"c"===r[2]?(oI(e,"proportional-style"),e.setAttribute("data-proportional-line-height",r[1])):uw.warn("TTML Parser: unhandled lineHeight unit:",r[2]))}},oM=function(e,t){var n=t.trim();if("auto"!==n){var i=n.split(" ");if(2===i.length){var r=cj.exec(i[0]),a=cj.exec(i[1]);null!==r&&null!==a&&("px"===r[2]||"%"===r[2]||"em"===r[2]?e.style.left=r[1]+r[2]:"c"===r[2]?(oI(e,"proportional-style"),e.setAttribute("data-proportional-left",r[1])):uw.warn("TTML Parser: unhandled origin unit:",r[2]),"px"===a[2]||"%"===a[2]||"em"===a[2]?e.style.top=a[1]+a[2]:"c"===a[2]?(oI(e,"proportional-style"),e.setAttribute("data-proportional-top",a[1])):uw.warn("TTML Parser: unhandled origin unit:",a[2]))}}},oP=function(e,t){var n=t.trim().split(" ");if(n.length<1)return;var i=cj.exec(n[0]);if(null!==i){if("px"===i[2]||"%"===i[2]||"em"===i[2]){var r=i[1]+i[2];1===n.length?e.style.padding=r:2===n.length?(e.style.paddingTop=r,e.style.paddingBottom=r):e.style.paddingTop=r}else"c"===i[2]?(oI(e,"proportional-style"),1===n.length?(e.setAttribute("data-proportional-padding-top",i[1]),e.setAttribute("data-proportional-padding-bottom",i[1]),e.setAttribute("data-proportional-padding-left",i[1]),e.setAttribute("data-proportional-padding-right",i[1])):2===n.length?(e.setAttribute("data-proportional-padding-top",i[1]),e.setAttribute("data-proportional-padding-bottom",i[1])):e.setAttribute("data-proportional-padding-top",i[1])):uw.warn("TTML Parser: unhandled padding unit:",i[2]);if(1!==n.length){var a=cj.exec(n[1]);if(null!==a){if("px"===a[2]||"%"===a[2]||"em"===a[2]){var o=a[1]+a[2];n.length<4&&(e.style.paddingLeft=o),e.style.paddingRight=o}else"c"===a[2]?(oI(e,"proportional-style"),n.length<4&&e.setAttribute("data-proportional-padding-left",a[1]),e.setAttribute("data-proportional-padding-right",a[1])):uw.warn("TTML Parser: unhandled padding unit:",a[2]);if(2!==n.length){var s=cj.exec(n[2]);if(null!==s){if("px"===s[2]||"%"===s[2]||"em"===s[2]){var u=s[1]+s[2];e.style.paddingBottom=u}else"c"===s[2]?(oI(e,"proportional-style"),e.setAttribute("data-proportional-padding-bottom",s[1])):uw.warn("TTML Parser: unhandled padding unit:",s[2]);if(3!==n.length){var l=cj.exec(n[3]);if(null!==l){if("px"===l[2]||"%"===l[2]||"em"===l[2]){var d=l[1]+l[2];e.style.paddingLeft=d}else"c"===l[2]?(oI(e,"proportional-style"),e.setAttribute("data-proportional-padding-left",l[1])):uw.warn("TTML Parser: unhandled padding unit:",l[2])}}}}}}}},oD=function(e,t){var n=t;return ed(t)&&t.trim().endsWith("%")&&(n=(parseInt(n=t.trim().slice(0,-1),10)/100).toString()+"em"),"-1px -1px ".concat(n," ").concat(e,",1px -1px ").concat(n," ").concat(e,",-1px 1px ").concat(n," ").concat(e,",1px 1px ").concat(n," ").concat(e)},ox=function(e){var t;return i(t=cQ.exec(e))?i(t=cX.exec(e))?i(t=c$.exec(e))?i(t=cZ.exec(e))?e:"rgba("+String(+t[1])+","+String(+t[2])+","+String(+t[3])+","+String(+t[4]/255)+")":"rgb("+String(+t[1])+","+String(+t[2])+","+String(+t[3])+")":"rgba("+String(parseInt(t[1]+t[1],16))+","+String(parseInt(t[2]+t[2],16))+","+String(parseInt(t[3]+t[3],16))+","+String(parseInt(t[4]+t[4],16)/255)+")":"rgba("+String(parseInt(t[1],16))+","+String(parseInt(t[2],16))+","+String(parseInt(t[3],16))+","+String(parseInt(t[4],16)/255)+")"},oN=function(e,t,n){var i=t.color;ed(i)&&(e.style.color=ox(i));var r=t.backgroundColor;ed(r)&&(e.style.backgroundColor=ox(r));var a=t.textOutline;if(ed(a)){var o=a.trim().replace(/\s+/g," ").split(" "),s=o.length;if(3===s){var u=ox(o[0]),l=o[1];e.style.textShadow=oD(u,l)}else if(ed(i)&&1===s){var d=o[0];e.style.textShadow=oD(i,d)}else if(2===s){var c=/^[#A-Z]/i.test(o[0]);if(c!==/^[0-9]/.test(o[0])){if(c){var f=ox(o[0]),v=o[1];e.style.textShadow=oD(f,v)}else if(ed(i)){var h=o[0];e.style.textShadow=oD(i,h)}}}}var p=t.textDecoration;if(ed(p))switch(p){case"noUnderline":case"noLineThrough":case"noOverline":e.style.textDecoration="none";break;case"lineThrough":e.style.textDecoration="line-through";break;default:e.style.textDecoration=p}var m=t.fontFamily;if(ed(m))switch(m){case"proportionalSansSerif":e.style.fontFamily="Arial, Helvetica, Liberation Sans, sans-serif";break;case"monospaceSansSerif":case"sansSerif":e.style.fontFamily="sans-serif";break;case"monospaceSerif":case"default":e.style.fontFamily="Courier New, Liberation Mono, monospace";break;case"proportionalSerif":e.style.fontFamily="serif";break;default:e.style.fontFamily=m}var g=t.fontStyle;ed(g)&&(e.style.fontStyle=g);var y=t.fontWeight;ed(y)&&(e.style.fontWeight=y);var _=t.fontSize;ed(_)?oR(e,_):(oI(e,"proportional-style"),e.setAttribute("data-proportional-font-size","1"));var S=t.direction;ed(S)&&(e.style.direction=S);var b=t.unicodeBidi;if(ed(b))switch(b){case"bidiOverride":e.style.unicodeBidi="bidi-override";break;case"embed":e.style.unicodeBidi="embed";break;default:e.style.unicodeBidi="normal"}var E=t.visibility;ed(E)&&(e.style.visibility=E),"none"===t.display&&(e.style.display="none"),"noWrap"===t.wrapOption?n?e.style.whiteSpace="nowrap":e.style.whiteSpace="pre":n?e.style.whiteSpace="normal":e.style.whiteSpace="pre-wrap"},oO=function(e,t){e.style.color="white",e.style.position="absolute";var n=t.extent;ed(n)&&oA(e,n),ed(t.writingMode);var i=t.overflow;e.style.overflow=ed(i)?i:"hidden";var r=t.padding;ed(r)&&oP(e,r);var a=t.origin;ed(a)&&oM(e,a);var o=t.displayAlign;if(ed(o))switch(e.style.display="flex",e.style.flexDirection="column",o){case"before":e.style.justifyContent="flex-start";break;case"center":e.style.justifyContent="center";break;case"after":e.style.justifyContent="flex-end"}var s=t.opacity;ed(s)&&(e.style.opacity=s);var u=t.visibility;ed(u)&&(e.style.visibility=u),"none"===t.display&&(e.style.display="none")},oL=function(e,t){e.style.margin="0px",oI(e,"proportional-style"),e.setAttribute("data-proportional-font-size","1");var n=t.backgroundColor;ed(n)&&(e.style.backgroundColor=ox(n));var i=t.lineHeight;ed(i)&&oC(e,i);var r=t.textAlign;if(ed(r))switch(r){case"center":e.style.textAlign="center";break;case"left":case"start":e.style.textAlign="left";break;case"right":case"end":e.style.textAlign="right"}},oU=function(e,t,n){var i=document.createElement("span"),r=null===e.textContent?"":e.textContent;if(n){var a=r.trim();r=a=a.replace(/\s+/g," ")}var o=document.createTextNode(r);return i.appendChild(o),i.className="rxp-texttrack-span",oN(i,t,n),i},oF=function(e,t,n,i,r,a){var o=a.cellResolution,s=a.shouldTrimWhiteSpace,u=oh(e),l=document.createElement("DIV");if(l.className="rxp-texttrack-region",l.setAttribute("data-resolution-columns",String(o.columns)),l.setAttribute("data-resolution-rows",String(o.rows)),oO(l,r),null!==t){var d=od(["backgroundColor"],S(u).concat([t]),i,n).bodyBackgroundColor;ed(d)&&(l.style.backgroundColor=ox(d))}var c=document.createElement("p");c.className="rxp-texttrack-p",oL(c,r);for(var f=function e(t,r,a,o){for(var s=t.childNodes,u=[],l=0;l<s.length;l++){var d=s[l];if("#text"===d.nodeName){var c=od(["backgroundColor"],a,i,n).backgroundColor;ed(c)?r.backgroundColor=c:delete r.backgroundColor;var f=oU(d,r,o);u.push(f)}else if(o_(d)){var v=document.createElement("BR");u.push(v)}else if(oS(d)&&d.nodeType===Node.ELEMENT_NODE&&d.childNodes.length>0){var h=d.getAttribute("xml:space"),p=ed(h)?"default"===h:o,m=uk({},r,od(c0,[d],i,n));u.push.apply(u,S(e(d,m,[d].concat(S(a)),p)))}}return u}(e,uk({},r),[],s),v=0;v<f.length;v++)c.appendChild(f[v]);return l.appendChild(c),l},oB=function(e){var t=e.paragraph,n=e.ttParams,i=e.body,r=e.regionStyles,a=e.idStyles,o=e.paragraphStyle,s=e.timeOffset,u=e.shouldTrimWhiteSpace;if(!t.hasAttribute("begin")&&!t.hasAttribute("end")&&/^\s*$/.test(null===t.textContent?"":t.textContent))return null;var l=n.cellResolution,d=ow(t,n);return{start:d.start+s,end:d.end+s,element:oF(t,i,r,a,o,{cellResolution:l,shouldTrimWhiteSpace:u})}},oV=function(e){for(var t=0;t<e.length;){if(""===e[t])return t+1;t++}return t},oz=function(e,t){return"string"==typeof e[t]&&/^STYLE( .*)?$/g.test(e[t])&&(void 0===e[t+1]||0>e[t+1].indexOf("-->"))},oK=function(e,t){var n=e[t];if(void 0===n||""===n||oz(e,t)||"string"==typeof e[t]&&/^REGION( .*)?$/g.test(e[t])&&(void 0===e[t+1]||0>e[t+1].indexOf("-->"))||"string"==typeof e[t]&&/^NOTE( .*)?$/g.test(e[t])&&(void 0===e[t+1]||0>e[t+1].indexOf("-->")))return!1;if(n.indexOf("-->")>=0)return!0;var i=e[t+1];return void 0!==i&&i.indexOf("-->")>=0},oW=function(e,t){for(var n=t+1;ed(e[n]);)n++;return n},oG=function(e,t){for(var n=[],i=t;i<e.length;i++)if(oK(e,i)){var r=oW(e,i);n.push(e.slice(i,r)),i=r}else if(ed(e[i]))for(;ed(e[i]);)i++;return n},oH=function(e,t){for(var n=[],i=t;i<e.length;i++)if(oz(e,i)){var r=i;for(i++;ed(e[i]);)i++;var a=e.slice(r,i);n.push(a)}else if(ed(e[i]))for(;ed(e[i]);)i++;return n},oq=function(e){var t=e.split(":").reverse();if(ed(t[2])||ed(t[1])){var n=ed(t[2])?parseInt(t[2],10):0,i=parseInt(t[1],10),r=parseFloat(t[0].replace(",","."));return isNaN(n)||isNaN(i)||isNaN(r)?void 0:3600*n+60*i+r}},oY=function(e){var t=/^([\d:.]+)[ |\t]+-->[ |\t]+([\d:.]+)[ |\t]*(.*)$/.exec(e);if(null===t)return null;var n=oq(t[1]),i=oq(t[2]);return void 0===n||void 0===i?null:{start:n,end:i,settings:t[3].split(/ |\t/).reduce(function(e,t){var n=t.split(":");return 2===n.length&&(e[n[0]]=n[1]),e},{})}},oj=function(e,t){var n,i,r,a=/-->/;if(a.test(e[0]))n=e[0],i=e.slice(1,e.length);else{if(!a.test(e[1]))return null;r=e[0],n=e[1],i=e.slice(2,e.length)}var o=oY(n);return null===o?null:{start:o.start+t,end:o.end+t,settings:o.settings,payload:i,header:r}},oQ=function(e){var t=Object.keys(c2).reduce(function(e,t){return e[t]="color: ".concat(c2[t],";"),e["bg_".concat(t)]="background-color: ".concat(c2[t],";"),e},{}),n="";return e.forEach(function(e){if(e.length>=2)for(var i=1;i<e.length;i++)(function(r){var a=e[r];if(Array.isArray(/::cue {/.exec(a)))for(a=e[++r];ed(a)&&!(Array.isArray(/}/.exec(a))||0===a.length);)n+=a,a=e[++r];else{for(var o=[],s=/::cue\(\.?(.*?)\)(?:,| {)/.exec(a);ed(a)&&Array.isArray(s);)o.push(s[1]),a=e[++r],s=/::cue\(\.?(.*?)\)(?:,| {)/.exec(a);for(var u="";ed(a)&&!(Array.isArray(/}/.exec(a))||0===a.length);)u+=a,a=e[++r];o.forEach(function(e){void 0===t[e]?t[e]=u:t[e]+=u})}i=r})(i)}),{classes:t,global:n}},oX=function(e,t){for(var n=e.replace(/<[0-9]{2}:[0-9]{2}.[0-9]{3}>/,"").replace(/<([u,i,b,c])(\..*?)?(?: .*?)?>(.*?)<\/\1>/g,"<$1$2>$3</$1$2>"),i=new DOMParser().parseFromString(n,"text/html").body.childNodes,r=[],a=0;a<i.length;a++)r.push(function e(t,n){var i,r=["u","i","b"],a=t.nodeName.toLowerCase().split(".")[0];if(e_(["u","i","b","c","#text"],a)){if("#text"===a){var o=t.wholeText.split("\n");i=document.createElement("span");for(var s=0;s<o.length;s++)if(s>0&&i.appendChild(document.createElement("br")),o[s].length>0){var u=document.createTextNode(o[s]);i.appendChild(u)}}else{var l=t.nodeName.toLowerCase().split("."),d=[];if(l.forEach(function(e){ed(n[e])&&d.push(n[e])}),0!==d.length){var c=document.createAttribute("style");d.forEach(function(e){c.value+=e});var f=e_(r,a)?a:"span";(i=document.createElement(f)).setAttributeNode(c)}else{var v=e_(r,a)?a:"span";i=document.createElement(v)}for(var h=0;h<t.childNodes.length;h++){var p=e(t.childNodes[h],n);i.appendChild(p)}}}else{i=document.createElement("span");for(var m=0;m<t.childNodes.length;m++){var g=e(t.childNodes[m],n);i.appendChild(g)}}return i}(i[a],t));return r},o$=function(e){var t=document.createAttribute("style");return t.value=c5(e),t},oZ=function(e,t){var n=e.start,i=e.end,r=e.settings,a=e.header,o=e.payload,s=document.createElement("div"),u=document.createAttribute("style");u.value="width:100%;height:100%;display:flex;flex-direction:column;justify-content:flex-end;align-items:center;",s.setAttributeNode(u);var l=document.createElement("p"),d=o$(r);l.setAttributeNode(d);var c=document.createElement("span"),f=document.createAttribute("style");f.value="background-color:rgba(0,0,0,0.8);color:white;",c.setAttributeNode(f);var v=t.global,h=t.classes,p=[v,ed(a)?h[a]:void 0].filter(function(e){return void 0!==e}).join("");return f.value+=p,c.setAttributeNode(f),oX(o.join("\n"),h).forEach(function(e){c.appendChild(e)}),s.appendChild(l),l.appendChild(c),{start:n,end:i,element:s}},oJ=function(e){var t,n,i,r="subtitles";if(uc){var a=e.textTracks.length;(n=a>0?e.textTracks[a-1]:e.addTextTrack(r)).mode=null!=(t=n.SHOWING)?t:"showing"}else i=document.createElement("track"),e.appendChild(i),n=i.track,i.kind=r,n.mode="showing";return{track:n,trackElement:i}},o0=function(e,t){var n=e.activeCues;if(null===n)return!1;for(var i=0;i<n.length;i++)if(n[i]===t)return!0;return!1},o1=function(e,t){if(uf&&o0(e,t)){var n=e.mode;e.mode="hidden";try{e.removeCue(t)}catch(e){uw.warn("Compat: Could not remove cue from text track.")}e.mode=n;return}try{e.removeCue(t)}catch(e){uw.warn("Compat: Could not remove cue from text track.")}},o2=function(e,t,n,i){uw.debug("NTSB: Finding parser for native text tracks:",e);var r=le.nativeTextTracksParsers[e];if("function"!=typeof r)throw Error("no parser found for the given text track");uw.debug("NTSB: Parser found, parsing...");var a=r(t,n,i);return uw.debug("NTSB: Parsed successfully!",a.length),a},o5=function(e,t,n){if(e>=t)return uw.warn("Compat: Invalid cue times: ".concat(e," - ").concat(t)),null;if(!i(us.VTTCue))return new VTTCue(e,t,n);if(i(us.TextTrackCue))throw Error("VTT cues not supported in your target");return new TextTrackCue(e,t,n)},o4=function(e){for(var t=[],n=0;n<e.length;n++){var r=e[n],a=r.start,o=r.end,s=r.text;if(ed(s)&&!i(o)){var u=o5(a,o,s);null!==u&&t.push(u)}}return t},o3=function(e){for(var t=/\.(\S+)\s*{([^}]*)}/gi,n={},r=t.exec(e);Array.isArray(r);){var a=r[1],o=o8(r[2],"lang");i(a)||i(o)||(n[o]=a),r=t.exec(e)}return n},o8=function(e,t){var n=RegExp("\\s*"+t+":\\s*(\\S+);","i").exec(e);return Array.isArray(n)?n[1]:null},o6=function(e,t){for(var n=on(e.split(/\r\n|\n|\r/)),i=[],r=0;r<n.length;r++){var a=or(n[r],t);if(null!==a){var o=o9(a);null!==o&&i.push(o)}}return i},o9=function(e){return o5(e.start,e.end,e.payload.join("\n"))},o7=function(e){return"function"==typeof us.VTTCue&&v(e,us.VTTCue)},se=function(e){var t=e.paragraph,n=e.timeOffset,i=e.paragraphStyle,r=e.ttParams,a=e.shouldTrimWhiteSpace;if(!t.hasAttribute("begin")&&!t.hasAttribute("end")&&/^\s*$/.test(null===t.textContent?"":t.textContent))return null;var o=ow(t,r),s=o5(o.start+n,o.end+n,st(t,a));return null===s?null:(o7(s)&&sn(s,i),s)},st=function(e,t){return function e(t,n){for(var i=t.childNodes,r="",a=0;a<i.length;a++){var o=i[a];if("#text"===o.nodeName){var s=o.textContent;if(null===s&&(s=""),n){var u=s.trim();s=u=u.replace(/\s+/g," ")}r+=s.replace(/&|\u0026/g,"&amp;").replace(/<|\u003C/g,"&lt;").replace(/>|\u2265/g,"&gt;").replace(/\u200E/g,"&lrm;").replace(/\u200F/g,"&rlm;").replace(/\u00A0/g,"&nbsp;")}else if(o_(o))r+="\n";else if(oS(o)&&o.nodeType===Node.ELEMENT_NODE&&o.childNodes.length>0){var l=o.getAttribute("xml:space");r+=e(o,ed(l)?"default"===l:n)}}return r}(e,t)},sn=function(e,t){var n=t.extent;if(ed(n)){var r=cY.exec(n);i(r)||(e.size=Number(r[1]))}switch(t.writingMode){case"tb":case"tblr":e.vertical="lr";break;case"tbrl":e.vertical="rl"}var a=t.origin;ed(a)&&i(cY.exec(a));var o=t.align;if(ed(o)){e.align=o,"center"===o&&("center"!==e.align&&(e.align="middle"),e.position="auto");var s=fv[o];e.positionAlign=void 0===s?"":s;var u=ff[o];e.lineAlign=void 0===u?"":u}},si=function(e,t){if(ed(e.vertical)&&("rl"===e.vertical||"lr"===e.vertical)&&(t.vertical=e.vertical),ed(e.line)){var n=/^(\d+(\.\d+)?)%(,([a-z]+))?/.exec(e.line);if(Array.isArray(n))t.line=Number(n[1]),t.snapToLines=!1,e_(["start","center","end"],n[4])&&(t.lineAlign=n[4]);else{var i=/^(-?\d+)(,([a-z]+))?/.exec(e.line);Array.isArray(i)&&(t.line=Number(i[1]),t.snapToLines=!0,e_(["start","center","end"],i[3])&&(t.lineAlign=i[3]))}}if(ed(e.position)){var r=/^([\d\.]+)%(?:,(line-left|line-right|center))?$/.exec(e.position);if(Array.isArray(r)&&r.length>=2){var a=parseInt(r[1],10);isNaN(a)||(t.position=a,void 0!==r[2]&&(t.positionAlign=r[2]))}}ed(e.size)&&(t.size=e.size),"string"==typeof e.align&&e_(["start","center","end","left"],e.align)&&(t.align=e.align)},sr=function(e,t){var n;return 0==(n="AACH"===t?5:ed(e)?(248&parseInt(e.substring(0,2),16))>>3:2)?"mp4a.40.2":"mp4a.40.".concat(n)},sa=function(e){var t=/00000001\d7([0-9a-fA-F]{6})/.exec(e);return null!==t&&ed(t[1])?"avc1."+t[1]:"avc1.4D401E"},so=function(e){return[{systemId:"edef8ba9-79d6-4ace-a3c8-27dcd51d21ed",privateData:t3([8,1,18,16],e)}]},ss=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:so;if(null===e.firstElementChild||"ProtectionHeader"!==e.firstElementChild.nodeName)throw Error("Protection should have ProtectionHeader child");var n=e.firstElementChild,i=tY(null===n.textContent?"":n.textContent),r=t0(nI(i)),a=n.getAttribute("SystemID");return{keyId:r,keySystems:[{systemId:(null!==a?a:"").toLowerCase().replace(/\{|\}/g,""),privateData:i}].concat(t(r))}},su=function(e,t,n){var i=t-e;return i>0?Math.floor(i/n):0},sl=function(e,t,n){var i=void 0===e||0===e?1:e;return{up:t*i,to:(t+n)*i}},sd=function(e,t){var n=e.repeatCount;return void 0!==e.duration&&n<0&&(n=Math.ceil(((void 0!==t?t.start:1/0)-e.start)/e.duration)-1),n},sc=function(e,t,n,i){var r=e.length,a=e[r-1],o=n.timescale===t?{time:n.time,duration:n.duration}:{time:n.time/n.timescale*t,duration:n.duration/n.timescale*t};return i.time!==o.time&&o.time>=iK(a,null)&&(a.duration===o.duration?a.repeatCount++:e.push({duration:o.duration,start:o.time,repeatCount:0}),!0)},sf=function(e,t,n){for(var i=e.firstElementChild,r=n;null!==i;)r=t(r,i.nodeName,i),i=i.nextElementSibling;return r},sv=function(e,t){if(32!==e.length)throw Error("HSS: wrong system id length");return nS("pssh",t3([0,0,0,0],t0(e),nt(t.length),t))},sh=function(e,t){return nS("schm",t3(4,tX(e),nt(t)))},sp=function(){var e=new Uint8Array(12);return e[3]=1,nS("vmhd",e)},sm=function(e){return nS("frma",tX(e))},sg=function(e,t,n){var i;return i=2===n?1:4===n?3:0,nS("avcC",t3([1,e[1],e[2],e[3],252|i,225],ne(e.length),e,[1],ne(t.length),t))},sy=function(e){var t,n;switch(e){case"video":t="vide",n="VideoHandler";break;case"audio":t="soun",n="SoundHandler";break;default:t="hint",n=""}return nS("hdlr",t3(8,tX(t),12,tX(n),1))},s_=function(e){if(0===e.length)return nS("saiz",new Uint8Array(0));var t=t9(e,0),n=t9(e,4),i=new Uint8Array(n+9);i.set(nt(n),5);for(var r,a,o=9,s=8;s<e.length;)s+=8,(2&t)==2?(a=2,r=t8(e,s),s+=6*r+2):(r=0,a=0),i[o]=6*r+8+a,o++;return nS("saiz",i)},sS=function(e){var t=[7,[e.length]];return nS("stsd",t3.apply(void 0,S(t.concat(e))))},sb=function(e,t,n){return nS("tenc",t3(6,[e,t],n))},sE=function(e,t,n,i,r,a){var o,s,u=nb("stbl",[n,nS("stts",new Uint8Array(8)),nS("stsc",new Uint8Array(8)),nS("stsz",new Uint8Array(12)),nS("stco",new Uint8Array(8))]),l=nS("url ",new Uint8Array([0,0,0,1])),d=nb("dinf",[nS("dref",t3(7,[1],l))]),c=nb("minf",[i,d,u]),f=sy(t),v=nb("mdia",[nS("mdhd",t3(12,nt(e),8)),f,c]),h=nb("trak",[nS("tkhd",t3(nt(7),8,nt(1),20,[1,0,0,0],[0,1,0,0],12,[0,1,0,0],12,[64,0,0,0],ne(r),2,ne(a),2)),v]),p=nb("mvex",[nS("trex",t3(4,nt(1),[0,0,0,1],12))]),m=nb("moov",[nS("mvhd",t3(12,nt(e),4,[0,1],2,[1,0],10,[0,1],14,[0,1],14,[64,0,0,0],26,ne(2))),p,h]),g=(o="isom",s=["isom","iso2","iso6","avc1","dash"],nS("ftyp",t3.apply(void 0,S([tX(o),[0,0,0,1]].concat(s.map(tX))))));return t3(g,m)},sk=function(e,t,n,i,r,a,o){var s,u,l,d=(l=0===a.length?(s=r,u=t,t1(ne(((32|31&fb.indexOf(s))<<4|31&u)<<3))):a,nS("esds",t3(4,[3,25],ne(1),[0,4,17,64,21],11,[5,2],t0(l),[6,1,2])));return sE(e,"audio",function(){if(void 0===o)return sS([nS("mp4a",t3(6,ne(1),8,ne(t),ne(n),2,ne(i),ne(r),2,d))]);var e=nb("schi",[sb(1,8,o)]),a=sh("cenc",65536),s=nb("sinf",[sm("mp4a"),a,e]);return sS([nS("enca",t3(6,ne(1),8,ne(t),ne(n),2,ne(i),ne(r),2,d,s))])}(),nS("smhd",new Uint8Array(8)),0,0)},sT=function(e,t,n,i,r,a,o,s){var u=y(o.split("00000001"),3),l=u[1],d=u[2];if(void 0===l||void 0===d)throw Error("Smooth: unsupported codec private data.");var c,f=sg(t0(l),t0(d),a);if(void 0===s)c=sS([(v="AVC Coding",nS("avc1",t3(6,ne(1),16,ne(t),ne(n),ne(i),2,ne(r),6,[0,1,v.length],tX(v),31-v.length,ne(24),[255,255],f)))]);else{var v,h,p=nb("schi",[sb(1,8,s)]),m=sh("cenc",65536),g=nb("sinf",[sm("avc1"),m,p]);c=sS([(h="AVC Coding",nS("encv",t3(6,ne(1),16,ne(t),ne(n),ne(i),2,ne(r),6,[0,1,h.length],tX(h),31-h.length,ne(24),[255,255],f,g)))])}return sE(e,"video",c,sp(),t,n)},sw=function(e){var t=np(e,3565190898,3392751253,2387879627,2655430559);if(void 0===t)return[];for(var n=[],i=t[0],r=t[4],a=0;a<r;a++){var o=void 0,s=void 0;1===i?(s=t7(t,16*a+5),o=t7(t,16*a+5+8)):(s=t9(t,8*a+5),o=t9(t,8*a+5+4)),n.push({time:s,duration:o})}return n},sI=function(e){var t=np(e,1830656773,1121273062,2162299933,2952222642);if(void 0!==t)return{duration:t7(t,12),time:t7(t,4)}},sA=function(e,t,n,i,r){var a=[e,t,n];return void 0!==r&&a.push(nS("senc",r),s_(r),nS("saio",t3(4,[0,0,0,1],nt(i.length+e.length+t.length+n.length+8+8+8+8)))),nb("traf",a)},sR=function(e,t){var n=nh(e,1836019558);if(null===n)throw Error("Smooth: Invalid ISOBMFF given");var i=e.subarray(n[1],n[2]),r=nv(i,1835427940),a=nc(i,1953653094);if(null===a||null===r)throw Error("Smooth: Invalid ISOBMFF given");var o=nh(a,1952868452),s=nh(a,1953658222);if(null===o||null===s)throw Error("Smooth: Invalid ISOBMFF given");var u=a.subarray(o[0],o[2]),l=a.subarray(s[0],s[2]);u.set([0,0,0,1],o[1]-o[0]+4);var d=nS("tfdt",t3([1,0,0,0],nn(t))),c=sC(l,s[1]-s[0]),f=sA(u,d,c,r,np(a,2721664850,1520127764,2722393154,2086964724)),v=nb("moof",[r,f]),h=nh(v,1836019558),p=nh(f,1953653094),m=nh(c,1953658222);if(null===h||null===p||null===m)throw Error("Smooth: Invalid moof, trun or traf generation");var g=h[1]-h[0]+r.length+(p[1]-p[0])+u.length+d.length+(m[1]-m[0])+8,y=n[2]-n[0],_=v.length-y,S=nh(e,1835295092);if(null===S)throw Error("Smooth: Invalid ISOBMFF given");if(!uc&&(0===_||_<=-8)){var b=S[1];return v.set(nt(b),g),e.set(v,n[0]),_<=-8&&e.set(nS("free",new Uint8Array(-_-8)),v.length),e}var E=S[1]+_;v.set(nt(E),g);var k=new Uint8Array(e.length+_),T=e.subarray(0,n[0]),w=e.subarray(n[2],e.length);return k.set(T,0),k.set(v,T.length),k.set(w,T.length+v.length),k},sC=function(e,t){if((1&e[t+3])>0)return e;var n=new Uint8Array(e.length+4);return n.set(e.subarray(0,t+8),0),n[t+3]=1|n[t+3],n.set([0,0,0,0],t+8),n.set(e.subarray(t+8,e.length),t+12),nD(n)},sM=function(e,t,n,i,r){var a,o,s,u=[];if(r){var l=nE(e);null!==l?(s=sw(l),o=sI(l)):uw.warn("smooth: could not find traf atom")}if(void 0!==s)for(var d=0;d<s.length;d++)u.push({time:s[d].time,duration:s[d].duration,timescale:n});if(void 0!==o)return{nextSegments:u,chunkInfos:{time:o.time/n,duration:o.duration/n},scaledSegmentTime:o.time};if(t||!i.complete)return{nextSegments:u,chunkInfos:null,scaledSegmentTime:void 0};var c=i.duration*n,f=Math.min(.9*n,c/4),v=nM(e),h=(null==(a=i.privateInfos)?void 0:a.smoothMediaSegment)!==void 0?i.privateInfos.smoothMediaSegment.time:Math.round(i.time*n);return{nextSegments:u,chunkInfos:void 0!==v&&Math.abs(v-c)<=f?{time:i.time,duration:v/n}:{time:i.time,duration:i.duration},scaledSegmentTime:h}},sP=function(e){return"string"==typeof e&&e.indexOf("mp4")>=0},sD=function(e,t,n,i,r,a){var o,s=t.segment.range;return Array.isArray(s)&&(o={Range:av(s)}),uZ({url:e,responseType:"arraybuffer",headers:o,timeout:i.timeout,connectionTimeout:i.connectionTimeout,cancelSignal:r,onProgress:n.onProgress}).then(function(e){if(!sP(t.mimeType)||!0!==a)return{resultType:"segment-loaded",resultData:e};var n=new Uint8Array(e.responseData);return ap(n,t.segment.isInit),{resultType:"segment-loaded",resultData:un(ut({},e),{responseData:n})}})},sx=function(e,t){return null===e?null:null===t.url?e.baseUrl:ra(e.baseUrl,t.url)},sN=function(){if(!uf)return uw.warn("Compat: Can't access Firefox version on no firefox browser."),null;var e=navigator.userAgent,t=/Firefox\/([0-9]+)\./.exec(e);if(null===t)return -1;var n=parseInt(t[1],10);return isNaN(n)?-1:n},sO=function(){if(!uf)return!0;var e=sN();if(null===e||e<67)return!0;var t=null==HTMLVideoElement?void 0:HTMLVideoElement.prototype;return(null==t?void 0:t.requirePictureInPicture)!==void 0},sL=function(e){if("function"==typeof e.getStartDate){var t=e.getStartDate();if("object"==typeof t&&null!==t){var n=+t;if(!isNaN(n))return n/1e3}else if("number"==typeof t&&!isNaN(t))return t}},sU=function(e,t){if(null===e)return 0;var n=t?"LOW_LATENCY":"DEFAULT",i=uT.getCurrent(),r=i.RESUME_GAP_AFTER_SEEKING,a=i.RESUME_GAP_AFTER_NOT_ENOUGH_DATA,o=i.RESUME_GAP_AFTER_BUFFERING;switch(e.reason){case"seeking":return r[n];case"not-ready":return a[n];case"buffering":return o[n]}},sF=function(e,t,n,i,r){var a=uT.getCurrent().REBUFFERING_GAP,o=r?"LOW_LATENCY":"DEFAULT";return void 0===t?n&&Math.abs(i-e)<=a[o]:null!==t&&i-t.end<=a[o]},sB=function(e){return{buffered:e.buffered,position:e.currentTime,duration:e.duration,ended:e.ended,paused:e.paused,playbackRate:e.playbackRate,readyState:e.readyState,seeking:e.seeking}},sV=function(e){var t,n,i,r=e.previousObservation,a=e.currentObservation,o=e.basePosition,s=e.observationEvent,u=e.withMediaSource,l=e.lowLatencyMode,d=e.bufferGap,c=e.currentRange,f=uT.getCurrent().REBUFFERING_GAP,v=a.position,h=a.duration,p=a.paused,m=a.readyState,g=a.ended,y=r.rebuffering,_=r.event,S=r.position,b=sF(o,c,g,h,l),E=m>=1&&"loadedmetadata"!==s&&null===y&&!(b||g),k=null,T=l?f.LOW_LATENCY:f.DEFAULT;if(u){if(E)d===1/0?(n=!0,k=o):void 0===d?m<3&&(n=!0,k=void 0):d<=T&&(n=!0,k=o+d);else if(null!==y){var w=sU(y,l);!0!==n&&null!==y&&m>1&&(b||g||void 0!==d&&isFinite(d)&&d>w)||void 0===d&&m>=3?i=!0:void 0===d?k=void 0:d===1/0?k=o:d<=w&&(k=o+d)}}else E&&(!p&&"timeupdate"===s&&"timeupdate"===_&&v===S.getPolled()||"seeking"===s&&(d===1/0||void 0===d&&m<3))?n=!0:null!==y&&("seeking"!==s&&v!==S.getPolled()||"canplay"===s||void 0===d&&m>=3||void 0!==d&&d<1/0&&(d>sU(y,l)||b||g))&&(i=!0);return!0===i?null:!0===n||null!==y?(t="seeking"===s||null!==y&&"seeking"===y.reason||a.seeking?"seeking":1===m?"not-ready":"buffering",null!==y&&y.reason===t?{reason:y.reason,timestamp:y.timestamp,position:k}:{reason:t,timestamp:uN(),position:k}):null},sz=function(e,t,n,i){var r=uT.getCurrent().MINIMUM_BUFFER_AMOUNT_BEFORE_FREEZING;return e.freezing?t.ended||t.paused||0===t.readyState||0===t.playbackRate||e.position.getPolled()!==t.position?null:e.freezing:"timeupdate"===n&&void 0!==i&&i>r&&!t.ended&&!t.paused&&t.readyState>=1&&0!==t.playbackRate&&t.position===e.position.getPolled()?{timestamp:uN()}:null},sK=function(e,t){for(var n="",i="",r=0;r<e.length;r++){var a=e.start(r),o=e.end(r),s=a.toFixed(2),u=o.toFixed(2),l=(o-a).toFixed(2),d="".concat(s,"|==").concat(l,"==|").concat(u);if(n+=d,0===i.length&&o>t){var c=n.length-Math.floor(d.length/2);i=" ".repeat(c)+"^".concat(t)}if(r<e.length-1){var f=e.start(r+1),v=" ~".concat((f-o).toFixed(2),"~ ");if(n+=v,0===i.length&&t<f){var h=n.length-Math.floor(v.length/2);i=" ".repeat(h)+"^".concat(t)}}}return 0===i.length&&(i=" ".repeat(n.length)+"^".concat(t)),n+"\n"+i},sW=function(e){var t=sB(e);return uk(t,{rebuffering:null,event:"init",seeking:0,position:new d$(t.position,null),freezing:null,bufferGap:0,currentRange:null})},sG=function(e,t){for(var n=0;n<e.length;n++)if(e[n].period.id===t.id)return n},sH=function(e,t){for(var n=0;n<e.length;n++){var i=e[n];if(i.period.id===t)return i}},sq=function(e){var t,n,i;return!e.inManifest&&(null==(t=e.text)?void 0:t.dispatcher)===null&&(null==(n=e.audio)?void 0:n.dispatcher)===null&&(null==(i=e.video)?void 0:i.dispatcher)===null},sY=function(e,t){var n;return t&&(null==(n=e.trickModeTracks)?void 0:n[0])!==void 0?e.trickModeTracks[0]:e},sj=function(e,t,n,i){var r,a,o=eT(e,"audio")[0],s=eT(e,"video")[0],u=sY(s,n),l=uT.getCurrent().DEFAULT_VIDEO_TRACK_SWITCHING_MODE,d=void 0!==o?{adaptation:o,switchingMode:i,lockedRepresentations:new uR(null)}:null,c=void 0!==u?{adaptation:u,adaptationBase:s,switchingMode:l,lockedRepresentations:new uR(null)}:null,f=null,v=(null!=(r=e.adaptations.text)?r:[]).filter(function(e){return!0===e.isForcedSubtitles});if(v.length>0){if(null!=o){var h=j(v,function(e){return e.normalizedLanguage===o.normalizedLanguage});void 0!==h&&(f=h)}null===f&&(f=null!=(a=j(v,function(e){return void 0===e.normalizedLanguage}))?a:null)}var p=null;return null!==f&&(p={adaptation:f,switchingMode:"direct",lockedRepresentations:new uR(null)}),{period:e,inManifest:t,isPeriodAdvertised:!1,isRemoved:!1,audio:{storedSettings:d,dispatcher:null},video:{storedSettings:c,dispatcher:null},text:{storedSettings:p,dispatcher:null}}},sQ=function(e){return{start:e.start,end:e.end,id:e.id}},sX=function(e){var t,n,r,a,o,s,u=uT.getCurrent(),l=u.DEFAULT_BASE_BANDWIDTH,d=u.DEFAULT_VIDEO_RESOLUTION_LIMIT,c=u.DEFAULT_MAX_BUFFER_AHEAD,f=u.DEFAULT_MAX_BUFFER_BEHIND,h=u.DEFAULT_MAX_VIDEO_BUFFER_SIZE,p=u.DEFAULT_THROTTLE_VIDEO_BITRATE_WHEN_HIDDEN,m=u.DEFAULT_WANTED_BUFFER_AHEAD;if(i(e.maxBufferAhead))t=c;else if(isNaN(t=Number(e.maxBufferAhead)))throw Error("Invalid maxBufferAhead parameter. Should be a number.");if(i(e.maxBufferBehind))n=f;else if(isNaN(n=Number(e.maxBufferBehind)))throw Error("Invalid maxBufferBehind parameter. Should be a number.");if(i(e.wantedBufferAhead))r=m;else if(isNaN(r=Number(e.wantedBufferAhead)))throw Error("Invalid wantedBufferAhead parameter. Should be a number.");if(i(e.maxVideoBufferSize))a=h;else if(isNaN(a=Number(e.maxVideoBufferSize)))throw Error("Invalid maxVideoBufferSize parameter. Should be a number.");var g=i(e.videoResolutionLimit)?d:e.videoResolutionLimit,y=i(e.throttleVideoBitrateWhenHidden)?p:!!e.throttleVideoBitrateWhenHidden;if(i(e.videoElement))o=document.createElement("video");else if(v(e.videoElement,HTMLMediaElement))o=e.videoElement;else throw Error("Invalid videoElement parameter. Should be a HTMLMediaElement.");if(i(e.baseBandwidth))s=l;else if(isNaN(s=Number(e.baseBandwidth)))throw Error("Invalid baseBandwidth parameter. Should be a number.");return{maxBufferAhead:t,maxBufferBehind:n,videoResolutionLimit:g,videoElement:o,wantedBufferAhead:r,maxVideoBufferSize:a,throttleVideoBitrateWhenHidden:y,baseBandwidth:s}},s$=function(e){var t,n,i,r;if(null===e||"object"!=typeof e&&void 0!==e)throw Error("API: reload - Invalid options format.");if((null==e?void 0:e.reloadAt)===null||"object"!=typeof(null==e?void 0:e.reloadAt)&&(null==e?void 0:e.reloadAt)!==void 0)throw Error("API: reload - Invalid 'reloadAt' option format.");if("number"!=typeof(null==(t=null==e?void 0:e.reloadAt)?void 0:t.position)&&(null==(n=null==e?void 0:e.reloadAt)?void 0:n.position)!==void 0)throw Error("API: reload - Invalid 'reloadAt.position' option format.");if("number"!=typeof(null==(i=null==e?void 0:e.reloadAt)?void 0:i.relative)&&(null==(r=null==e?void 0:e.reloadAt)?void 0:r.relative)!==void 0)throw Error("API: reload - Invalid 'reloadAt.relative' option format.");if(!Array.isArray(null==e?void 0:e.keySystems)&&(null==e?void 0:e.keySystems)!==void 0)throw Error("API: reload - Invalid 'keySystems' option format.");if((null==e?void 0:e.autoPlay)!==void 0&&"boolean"!=typeof e.autoPlay)throw Error("API: reload - Invalid 'autoPlay' option format.")},sZ=function(e){var t,n,r,a,o,s,u,l,d,c,f=uT.getCurrent(),h=f.DEFAULT_AUTO_PLAY,p=f.DEFAULT_CODEC_SWITCHING_BEHAVIOR,m=f.DEFAULT_ENABLE_FAST_SWITCHING,g=f.DEFAULT_TEXT_TRACK_MODE;if(i(e))throw Error("No option set on loadVideo");if(i(e.url)){if(i(e.initialManifest)&&i(e.manifestLoader))throw Error("Unable to load a content: no url set on loadVideo.\nPlease provide at least either an `url` argument, a `initialManifest` option or a `manifestLoader` option so the RxPlayer can load the content.")}else a=String(e.url);if(i(e.transport))throw Error("No transport set on loadVideo");o=String(e.transport);var y=i(e.autoPlay)?h:!!e.autoPlay;if(i(e.keySystems))s=[];else{s=Array.isArray(e.keySystems)?e.keySystems:[e.keySystems];var _=!0,S=!1,b=void 0;try{for(var E,k=s[Symbol.iterator]();!(_=(E=k.next()).done);_=!0){var T=E.value;if("string"!=typeof T.type||"function"!=typeof T.getLicense)throw Error("Invalid key system given: Missing type string or getLicense callback")}}catch(e){S=!0,b=e}finally{try{_||null==k.return||k.return()}finally{if(S)throw b}}}var w=void 0!==e.lowLatencyMode&&!!e.lowLatencyMode,I=e.initialManifest,A=null!=(t=e.minimumManifestUpdateInterval)?t:0,R=null!=(n=e.defaultAudioTrackSwitchingMode)?n:void 0;void 0===R||e_(["seamless","direct","reload"],R)||(uw.warn("The `defaultAudioTrackSwitchingMode` loadVideo option must match one of the following strategy name:\n- `seamless`\n- `direct`\n- `reload`"),R=void 0);var C=i(e.onCodecSwitch)?p:e.onCodecSwitch;if(e_(["continue","reload"],C)||(uw.warn("The `onCodecSwitch` loadVideo option must match one of the following string:\n- `continue`\n- `reload`\nIf badly set, "+p+" will be used as default"),C=p),i(e.textTrackMode))u=g;else{if("native"!==e.textTrackMode&&"html"!==e.textTrackMode)throw Error("Invalid textTrackMode.");u=e.textTrackMode}if("html"===u){if(i(e.textTrackElement))throw Error('You have to provide a textTrackElement in "html" textTrackMode.');if(v(e.textTrackElement,HTMLElement))d=e.textTrackElement;else throw Error("textTrackElement should be an HTMLElement.")}else i(e.textTrackElement)||uw.warn('API: You have set a textTrackElement without being in an "html" textTrackMode. It will be ignored.');if(i(e.mode))l="auto";else{if(!e_(["auto","multithread","main"],e.mode))throw Error("Invalid `mode` option.");l=e.mode}var M=i(e.enableFastSwitching)?m:e.enableFastSwitching;if(!i(e.startAt)){if("wallClockTime"in e.startAt&&v(e.startAt.wallClockTime,Date)){var P=e.startAt.wallClockTime.getTime()/1e3;c=uk({},e.startAt,{wallClockTime:P})}else c=e.startAt}var D=null!=(r=e.requestConfig)?r:{};return{__priv_patchLastSegmentInSidx:e.__priv_patchLastSegmentInSidx,__priv_manifestUpdateUrl:e.__priv_manifestUpdateUrl,checkMediaSegmentIntegrity:e.checkMediaSegmentIntegrity,autoPlay:y,defaultAudioTrackSwitchingMode:R,enableFastSwitching:M,initialManifest:I,keySystems:s,lowLatencyMode:w,manifestLoader:e.manifestLoader,minimumManifestUpdateInterval:A,requestConfig:D,onCodecSwitch:C,referenceDateTime:e.referenceDateTime,representationFilter:e.representationFilter,segmentLoader:e.segmentLoader,serverSyncInfos:e.serverSyncInfos,startAt:c,textTrackElement:d,textTrackMode:u,transport:o,mode:l,url:a}},sJ=function(e,t,n,i,r){if(!r.isCancelled()&&null!==e){var a=2===t.getReference().getValue().seeking;a&&(n(),r.isCancelled())||t.listen(function(e){"seeking"===e.event?(a=!0,n()):a&&"seeked"===e.event&&(a=!1,i())},{includeLastObservation:!0,clearSignal:r})}},s0=function(e,t,n,i){i.isCancelled()||null===e||(e.addEventListener("play",t),e.addEventListener("pause",n),i.register(function(){e.removeEventListener("play",t),e.removeEventListener("pause",n)}))},s1=function(e,t,n,i){var r=new uR("LOADING",i);e.addEventListener("loaded",function(){if("LOADING"===r.getValue()){if(r.setValue("LOADED"),!i.isCancelled()){var e=s2(t,null);"PAUSED"!==e&&r.setValue(e)}}else"RELOADING"===r.getValue()?r.setValue(s2(t,null)):o(null)},i),e.addEventListener("reloadingMediaSource",function(){s5(r.getValue())&&r.setValueIfChanged("RELOADING")},i);var a=null;return e.addEventListener("stalled",function(e){e!==a&&(o(e),a=e)},i),e.addEventListener("unstalled",function(){null!==a&&(o(null),a=null)},i),n.listen(function(e){e_(["seeking","ended","play","pause"],e.event)&&o(a)},{clearSignal:i}),r;function o(e){if(s5(r.getValue())){var n=s2(t,e);"LOADED"===r.getValue()&&"PAUSED"===n||r.setValueIfChanged(n)}}},s2=function(e,t){var n=uT.getCurrent().FORCED_ENDED_THRESHOLD;if(e.ended)return"ENDED";if(null!==t){var r=Math.abs(e.duration-e.currentTime);return!i(n)&&r<n?"ENDED":"seeking"===t?"SEEKING":"freezing"===t?"FREEZING":"BUFFERING"}return e.paused?"PAUSED":"PLAYING"},s5=function(e){return"LOADING"!==e&&"RELOADING"!==e&&"STOPPED"!==e},s4=Object.defineProperty,s3=Object.defineProperties,s8=Object.getOwnPropertyDescriptors,s6=Object.getOwnPropertySymbols,s9=Object.prototype.hasOwnProperty,s7=Object.prototype.propertyIsEnumerable,ue=function(e,t,n){return t in e?s4(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n},ut=function(e,t){for(var n in t||(t={}))s9.call(t,n)&&ue(e,n,t[n]);var i=!0,r=!1,a=void 0;if(s6)try{for(var o,s=s6(t)[Symbol.iterator]();!(i=(o=s.next()).done);i=!0){var n=o.value;s7.call(t,n)&&ue(e,n,t[n])}}catch(e){r=!0,a=e}finally{try{i||null==s.return||s.return()}finally{if(r)throw a}}return e},un=function(e,t){return s3(e,s8(t))},ui={PRODUCTION:0,DEV:1,CURRENT_ENV:0},ur=function(){function e(){a(this,e),this._listeners={}}return u(e,[{key:"addEventListener",value:function(e,t,n){var i=this,r=this._listeners[e];Array.isArray(r)?r.push(t):this._listeners[e]=[t],void 0!==n&&n.register(function(){i.removeEventListener(e,t)})}},{key:"removeEventListener",value:function(e,t){if(i(e)){this._listeners={};return}var n=this._listeners[e];if(Array.isArray(n)){if(i(t)){delete this._listeners[e];return}var r=n.indexOf(t);-1!==r&&n.splice(r,1),0===n.length&&delete this._listeners[e]}}},{key:"trigger",value:function(e,t){var n=this._listeners[e];Array.isArray(n)&&n.slice().forEach(function(e){try{e(t)}catch(e){if(ui.CURRENT_ENV===ui.DEV)throw v(e,Error)?e:Error("EventEmitter: listener error");console.error("RxPlayer: EventEmitter error",v(e,Error)?e:null)}})}}]),e}(),ua="undefined"!=typeof WorkerGlobalScope&&v(self,WorkerGlobalScope),uo="undefined"==typeof window&&!ua,us=ua?self:uo?global:window,uu="function"==typeof queueMicrotask?queueMicrotask:function(e){Promise.resolve().then(e,function(){return e()})},ul=!1,ud=!1,uc=!1,uf=!1,uv=!1,uh=!1,up=!1,um=!1,ug=!1,uy=!1,u_=!1,uS=!1;uo||(void 0!==us.MSInputMethodContext&&void 0!==document.documentMode?(ud=!0,uc=!0):"Microsoft Internet Explorer"===navigator.appName||"Netscape"===navigator.appName&&/(Trident|Edge)\//.test(navigator.userAgent)?uc=!0:-1!==navigator.userAgent.toLowerCase().indexOf("edg/")?ul=!0:-1!==navigator.userAgent.toLowerCase().indexOf("firefox")?uf=!0:"string"==typeof navigator.platform&&/iPad|iPhone|iPod/.test(navigator.platform)?uh=!0:(Object.prototype.toString.call(us.HTMLElement).indexOf("Constructor")>=0||(null==(lH=null==(lG=us.safari)?void 0:lG.pushNotification)?void 0:lH.toString())==="[object SafariRemoteNotification]"||/Safari\/(\d+)/.test(navigator.userAgent)&&/Version\/(\d+)/.test(navigator.userAgent)&&(null==(lq=navigator.vendor)?void 0:lq.indexOf("Apple"))!==-1&&!/Chrome\/(\d+)/.test(navigator.userAgent)&&!/Chromium\/(\d+)/.test(navigator.userAgent))&&(uv=!0),/SamsungBrowser/.test(navigator.userAgent)&&(up=!0),-1!==navigator.userAgent.indexOf("PlayStation 4")?u_=!0:-1!==navigator.userAgent.indexOf("PlayStation 5")?uS=!0:/Tizen/.test(navigator.userAgent)?um=!0:/[Ww]eb[O0]S/.test(navigator.userAgent)?(ug=!0,!!(/[Ww]eb[O0]S.TV-2022/.test(navigator.userAgent)||/[Cc]hr[o0]me\/87/.test(navigator.userAgent))||/[Ww]eb[O0]S.TV-2021/.test(navigator.userAgent)||/[Cc]hr[o0]me\/79/.test(navigator.userAgent)):/[Pp]anasonic/.test(navigator.userAgent)?uy=!0:navigator.userAgent.indexOf("Xbox"));var ub=uS,uE={DEFAULT_REQUEST_TIMEOUT:3e4,DEFAULT_CONNECTION_TIMEOUT:15e3,DEFAULT_TEXT_TRACK_MODE:"native",DEFAULT_ENABLE_FAST_SWITCHING:!0,DELTA_POSITION_AFTER_RELOAD:{bitrateSwitch:-.1,trackSwitch:{audio:0,video:0,other:0}},DEFAULT_CODEC_SWITCHING_BEHAVIOR:"continue",DEFAULT_AUTO_PLAY:!1,DEFAULT_WANTED_BUFFER_AHEAD:30,DEFAULT_MAX_BUFFER_AHEAD:1/0,DEFAULT_MAX_BUFFER_BEHIND:1/0,DEFAULT_MAX_VIDEO_BUFFER_SIZE:1/0,MAXIMUM_MAX_BUFFER_AHEAD:{text:18e3},MINIMUM_MAX_BUFFER_AHEAD:{text:120},MAXIMUM_MAX_BUFFER_BEHIND:{text:18e3},DEFAULT_BASE_BANDWIDTH:0,INACTIVITY_DELAY:6e4,DEFAULT_THROTTLE_VIDEO_BITRATE_WHEN_HIDDEN:!1,DEFAULT_VIDEO_RESOLUTION_LIMIT:"none",DEFAULT_LIVE_GAP:{DEFAULT:10,LOW_LATENCY:3.5},BUFFER_DISCONTINUITY_THRESHOLD:.2,BITRATE_REBUFFERING_RATIO:1.5,DEFAULT_MAX_MANIFEST_REQUEST_RETRY:4,DEFAULT_CDN_DOWNGRADE_TIME:60,DEFAULT_MAX_REQUESTS_RETRY_ON_ERROR:4,INITIAL_BACKOFF_DELAY_BASE:{REGULAR:200,LOW_LATENCY:50},MAX_BACKOFF_DELAY_BASE:{REGULAR:3e3,LOW_LATENCY:1e3},SAMPLING_INTERVAL_MEDIASOURCE:1e3,SAMPLING_INTERVAL_LOW_LATENCY:500,SAMPLING_INTERVAL_NO_MEDIASOURCE:500,ABR_ENTER_BUFFER_BASED_ALGO:10,ABR_EXIT_BUFFER_BASED_ALGO:5,ABR_MINIMUM_TOTAL_BYTES:15e4,ABR_MINIMUM_CHUNK_SIZE:16e3,ABR_STARVATION_FACTOR:{DEFAULT:.72,LOW_LATENCY:.72},ABR_REGULAR_FACTOR:{DEFAULT:.72,LOW_LATENCY:.72},ABR_STARVATION_GAP:{DEFAULT:5,LOW_LATENCY:5},OUT_OF_STARVATION_GAP:{DEFAULT:7,LOW_LATENCY:7},ABR_STARVATION_DURATION_DELTA:.1,ABR_FAST_EMA:2,ABR_SLOW_EMA:10,RESUME_GAP_AFTER_SEEKING:{DEFAULT:1.5,LOW_LATENCY:.5},RESUME_GAP_AFTER_NOT_ENOUGH_DATA:{DEFAULT:.5,LOW_LATENCY:.5},RESUME_GAP_AFTER_BUFFERING:{DEFAULT:5,LOW_LATENCY:.5},REBUFFERING_GAP:{DEFAULT:.5,LOW_LATENCY:.2},MINIMUM_BUFFER_AMOUNT_BEFORE_FREEZING:2,UNFREEZING_SEEK_DELAY:6e3,FREEZING_STALLED_DELAY:600,UNFREEZING_DELTA_POSITION:.001,SEGMENT_SYNCHRONIZATION_DELAY:1500,MISSING_DATA_TRIGGER_SYNC_DELAY:.1,MAX_TIME_MISSING_FROM_COMPLETE_SEGMENT:.15,MAX_MANIFEST_BUFFERED_START_END_DIFFERENCE:.4,MAX_MANIFEST_BUFFERED_DURATION_DIFFERENCE:.3,MINIMUM_SEGMENT_SIZE:.005,APPEND_WINDOW_SECURITIES:{START:.2,END:.1},MAXIMUM_HTML_TEXT_TRACK_UPDATE_INTERVAL:50,TEXT_TRACK_SIZE_CHECKS_INTERVAL:250,BUFFER_PADDING:{audio:1,video:3,other:1},SEGMENT_PRIORITIES_STEPS:[2,4,8,12,18,25],MAX_HIGH_PRIORITY_LEVEL:1,MIN_CANCELABLE_PRIORITY:3,EME_DEFAULT_VIDEO_CODECS:['video/mp4;codecs="avc1.4d401e"','video/mp4;codecs="avc1.42e01e"','video/webm;codecs="vp8"'],EME_DEFAULT_AUDIO_CODECS:['audio/mp4;codecs="mp4a.40.2"',"audio/webm;codecs=opus"],EME_DEFAULT_WIDEVINE_ROBUSTNESSES:["HW_SECURE_ALL","HW_SECURE_DECODE","HW_SECURE_CRYPTO","SW_SECURE_DECODE","SW_SECURE_CRYPTO"],EME_DEFAULT_PLAYREADY_RECOMMENDATION_ROBUSTNESSES:["3000","2000"],EME_KEY_SYSTEMS:{clearkey:["webkit-org.w3.clearkey","org.w3.clearkey"],widevine:["com.widevine.alpha"],playready:["com.microsoft.playready.recommendation","com.microsoft.playready","com.chromecast.playready","com.youtube.playready"],fairplay:["com.apple.fps.1_0"]},MAX_CONSECUTIVE_MANIFEST_PARSING_IN_UNSAFE_MODE:10,MIN_MANIFEST_PARSING_TIME_TO_ENTER_UNSAFE_MODE:200,MIN_DASH_S_ELEMENTS_TO_PARSE_UNSAFELY:300,OUT_OF_SYNC_MANIFEST_REFRESH_DELAY:3e3,FAILED_PARTIAL_UPDATE_MANIFEST_REFRESH_DELAY:3e3,DASH_FALLBACK_LIFETIME_WHEN_MINIMUM_UPDATE_PERIOD_EQUAL_0:3,EME_DEFAULT_MAX_SIMULTANEOUS_MEDIA_KEY_SESSIONS:15,EME_MAX_STORED_PERSISTENT_SESSION_INFORMATION:1e3,EME_WAITING_DELAY_LOADED_SESSION_EMPTY_KEYSTATUSES:100,FORCED_ENDED_THRESHOLD:8e-4,ADAP_REP_SWITCH_BUFFER_PADDINGS:{video:{before:5,after:5},audio:{before:2,after:2.5},text:{before:0,after:0}},SOURCE_BUFFER_FLUSHING_INTERVAL:500,CONTENT_REPLACEMENT_PADDING:1.2,CACHE_LOAD_DURATION_THRESHOLDS:{video:50,audio:10},STREAM_EVENT_EMITTER_POLL_INTERVAL:250,DEFAULT_MAXIMUM_TIME_ROUNDING_ERROR:.001,BUFFERED_HISTORY_RETENTION_TIME:6e4,BUFFERED_HISTORY_MAXIMUM_ENTRIES:200,MIN_BUFFER_AHEAD:5,UPTO_CURRENT_POSITION_CLEANUP:5,DEFAULT_VIDEO_REPRESENTATIONS_SWITCHING_MODE:"seamless",DEFAULT_AUDIO_REPRESENTATIONS_SWITCHING_MODE:"seamless",DEFAULT_VIDEO_TRACK_SWITCHING_MODE:"reload",DEFAULT_AUDIO_TRACK_SWITCHING_MODE:"seamless"},uk="function"==typeof Object.assign?Object.assign:function(e){for(var t=arguments.length,n=Array(t>1?t-1:0),i=1;i<t;i++)n[i-1]=arguments[i];if(null==e)throw TypeError("Cannot convert undefined or null to object");for(var r=Object(e),a=0;a<n.length;a++){var o=n[a];for(var s in o)Object.prototype.hasOwnProperty.call(o,s)&&(r[s]=o[s])}return r},uT=new(function(){function e(){a(this,e),this._config=uE}return u(e,[{key:"update",value:function(e){var t=function e(t){for(var n=arguments.length,i=Array(n>1?n-1:0),r=1;r<n;r++)i[r-1]=arguments[r];if(0===i.length)return t;var a=i.shift();if(o(t)&&o(a))for(var s in a)if(o(a[s])){var u=t[s];void 0===u&&(u={},t[s]=u),e(u,a[s])}else uk(t,l({},s,a[s]));return e.apply(void 0,[t].concat(S(i)))}(this._config,e);this._config=t}},{key:"getCurrent",value:function(){return this._config}}]),e}()),uw=new(function(e){f(n,e);var t=w(n);function n(){var e;return a(this,n),(e=t.call(this)).error=s,e.warn=s,e.info=s,e.debug=s,e._levels={NONE:0,ERROR:1,WARNING:2,INFO:3,DEBUG:4},e._currentLevel="NONE",m(e)}return u(n,[{key:"setLevel",value:function(e,t){var n,i=this._levels[e];"number"==typeof i?(n=i,this._currentLevel=e):(n=0,this._currentLevel="NONE"),void 0===t?(this.error=n>=this._levels.ERROR?console.error.bind(console):s,this.warn=n>=this._levels.WARNING?console.warn.bind(console):s,this.info=n>=this._levels.INFO?console.info.bind(console):s,this.debug=n>=this._levels.DEBUG?console.log.bind(console):s):(this.error=n>=this._levels.ERROR?function(){for(var e=arguments.length,n=Array(e),i=0;i<e;i++)n[i]=arguments[i];return t("ERROR",n)}:s,this.warn=n>=this._levels.WARNING?function(){for(var e=arguments.length,n=Array(e),i=0;i<e;i++)n[i]=arguments[i];return t("WARNING",n)}:s,this.info=n>=this._levels.INFO?function(){for(var e=arguments.length,n=Array(e),i=0;i<e;i++)n[i]=arguments[i];return t("INFO",n)}:s,this.debug=n>=this._levels.DEBUG?function(){for(var e=arguments.length,n=Array(e),i=0;i<e;i++)n[i]=arguments[i];return t("DEBUG",n)}:s),this.trigger("onLogLevelChange",this._currentLevel)}},{key:"getLevel",value:function(){return this._currentLevel}},{key:"hasLevel",value:function(e){return this._levels[e]>=this._levels[this._currentLevel]}}]),n}(ur)),uI=.016666666666666666,uA=function(){function e(t,n){var i=this;a(this,e),this._value=t,this._listeners=[],this._isFinished=!1,this._onFinishCbs=[],void 0!==n&&(this._deregisterCancellation=n.register(function(){return i.finish()}))}return u(e,[{key:"getValue",value:function(){return this._value}},{key:"setValue",value:function(e){if(this._isFinished){ui.CURRENT_ENV===ui.DEV&&console.error("Finished shared references cannot be updated");return}if(this._value=e,0!==this._listeners.length){var t=this._listeners.slice(),n=!0,i=!1,r=void 0;try{for(var a,o=t[Symbol.iterator]();!(n=(a=o.next()).done);n=!0){var s=a.value;try{s.hasBeenCleared||s.trigger(e,s.complete)}catch(e){}}}catch(e){i=!0,r=e}finally{try{n||null==o.return||o.return()}finally{if(i)throw r}}}}},{key:"setValueIfChanged",value:function(e){e!==this._value&&this.setValue(e)}},{key:"onUpdate",value:function(e,t){var n=this,i=function(){if((null==t?void 0:t.clearSignal)!==void 0&&t.clearSignal.deregister(i),!r.hasBeenCleared){r.hasBeenCleared=!0;var e=n._listeners.indexOf(r);e>=0&&n._listeners.splice(e,1)}},r={trigger:e,complete:i,hasBeenCleared:!1};if(this._listeners.push(r),(null==t?void 0:t.emitCurrentValue)===!0&&e(this._value,i),this._isFinished||r.hasBeenCleared){i();return}(null==t?void 0:t.clearSignal)!==void 0&&t.clearSignal.register(i)}},{key:"waitUntilDefined",value:function(e,t){var n=this;this.onUpdate(function(t,i){void 0!==t&&(i(),e(n._value))},{clearSignal:null==t?void 0:t.clearSignal,emitCurrentValue:!0})}},{key:"_onFinished",value:function(e,t){var n=this;if(t.isCancelled())return s;var i=function(){var e=z(n._onFinishCbs,function(e){return e.trigger===r});e>=0&&(n._onFinishCbs[e].hasBeenCleared=!0,n._onFinishCbs.splice(e,1))},r=function(){i(),e()},a=t.register(i);return this._onFinishCbs.push({trigger:r,hasBeenCleared:!1}),a}},{key:"finish",value:function(){void 0!==this._deregisterCancellation&&this._deregisterCancellation(),this._isFinished=!0;var e=this._listeners.slice(),t=!0,n=!1,i=void 0;try{for(var r,a=e[Symbol.iterator]();!(t=(r=a.next()).done);t=!0){var o=r.value;try{o.hasBeenCleared||(o.complete(),o.hasBeenCleared=!0)}catch(e){}}}catch(e){n=!0,i=e}finally{try{t||null==a.return||a.return()}finally{if(n)throw i}}if(this._listeners.length=0,this._onFinishCbs.length>0){var s=this._onFinishCbs.slice(),u=!0,l=!1,d=void 0;try{for(var c,f=s[Symbol.iterator]();!(u=(c=f.next()).done);u=!0){var v=c.value;try{v.hasBeenCleared||(v.trigger(),v.hasBeenCleared=!0)}catch(e){}}}catch(e){l=!0,d=e}finally{try{u||null==f.return||f.return()}finally{if(l)throw d}}this._onFinishCbs.length=0}}}]),e}(),uR=uA,uC=function(e){f(i,e);var t=w(i);function i(e){var r;return a(this,i),Object.setPrototypeOf(n(r=t.call(this)),i.prototype),r.name="AssertionError",r.message=e,m(r)}return i}(k(Error)),uM=function(){function e(){a(this,e);var t=y(q(),2),n=t[0],i=t[1];this._isUsed=!1,this._trigger=n,this.signal=new uP(i)}return u(e,[{key:"isUsed",value:function(){return this._isUsed}},{key:"linkToSignal",value:function(e){var t=this,n=e.register(function(){t.cancel()});return this.signal.register(n),n}},{key:"cancel",value:function(e){if(!this._isUsed){this._isUsed=!0;var t=null!=e?e:new uD;this._trigger(t)}}}],[{key:"isCancellationError",value:function(e){return v(e,uD)}}]),e}(),uP=function(){function e(t){var n=this;a(this,e),this._isCancelled=!1,this.cancellationError=null,this._listeners=[],t(function(e){for(n.cancellationError=e,n._isCancelled=!0;n._listeners.length>0;)try{var t=n._listeners.pop();null==t||t(e)}catch(e){uw.error("Error while calling clean up listener",v(e,Error)?e.toString():"Unknown error")}})}return u(e,[{key:"isCancelled",value:function(){return this._isCancelled}},{key:"register",value:function(e){var t=this;return this._isCancelled?(W(null!==this.cancellationError),e(this.cancellationError),s):(this._listeners.push(e),function(){return t.deregister(e)})}},{key:"deregister",value:function(e){for(var t=this._listeners.length-1;t>=0;t--)this._listeners[t]===e&&this._listeners.splice(t,1)}}]),e}(),uD=function(e){f(i,e);var t=w(i);function i(){var e;return a(this,i),Object.setPrototypeOf(n(e=t.call(this)),i.prototype),e.name="CancellationError",e.message="This task was cancelled.",m(e)}return i}(k(Error)),ux=new uR(0),uN="undefined"!=typeof performance?function(){return performance.now()+ux.getValue()}:function(){return Date.now()+ux.getValue()},uO=function(){function e(t){a(this,e),this._alpha=Math.exp(Math.log(.5)/t),this._lastEstimate=0,this._totalWeight=0}return u(e,[{key:"addSample",value:function(e,t){var n=Math.pow(this._alpha,e),i=t*(1-n)+n*this._lastEstimate;isNaN(i)||(this._lastEstimate=i,this._totalWeight+=e)}},{key:"getEstimate",value:function(){var e=1-Math.pow(this._alpha,this._totalWeight);return this._lastEstimate/e}}]),e}(),uL=function(){function e(){a(this,e),this._currentRepresentationData=null,this._lastRepresentationWithGoodScore=null}return u(e,[{key:"addSample",value:function(e,t,n){var i,r=n/t,a=this._currentRepresentationData;null!==a&&a.representation.id===e.id?(i=a.ewma,a.ewma.addSample(t,r),a.loadedDuration+=n,a.loadedSegments++):((i=new uO(5)).addSample(t,r),this._currentRepresentationData={representation:e,ewma:i,loadedDuration:n,loadedSegments:0}),i.getEstimate()>1&&this._lastRepresentationWithGoodScore!==e&&(uw.debug("ABR: New last stable representation",e.bitrate),this._lastRepresentationWithGoodScore=e)}},{key:"getEstimate",value:function(e){if(null!==this._currentRepresentationData&&this._currentRepresentationData.representation.id===e.id){var t=this._currentRepresentationData,n=t.ewma,i=t.loadedSegments,r=t.loadedDuration;return{score:n.getEstimate(),confidenceLevel:i>=5&&r>=10?1:0}}}},{key:"getLastStableRepresentation",value:function(){return this._lastRepresentationWithGoodScore}}]),e}(),uU=function(){function e(t){a(this,e),this._levelsMap=Y(t).map(function(e){return e+4}),this._bitrates=t,this._lastUnsuitableQualityTimestamp=void 0,this._blockRaiseDelay=6e3,uw.debug("ABR: Steps for buffer based chooser.",this._levelsMap.map(function(e,n){return"bufferLevel: ".concat(e,", bitrate: ").concat(t[n])}).join(" ,"))}return u(e,[{key:"onAddedSegment",value:function(e){var t,n=this._levelsMap,r=this._bitrates,a=e.bufferGap,o=e.currentBitrate,s=e.currentScore,u=e.speed;if(i(o)){this._currentEstimate=r[0];return}for(var l=-1,d=0;d<r.length;d++){var c=r[d];if(c===o)l=d;else if(c>o)break}if(l<0||r.length!==n.length){uw.info("ABR: Current Bitrate not found in the calculated levels"),this._currentEstimate=r[0];return}void 0!==s&&(t=0===u?s.score:s.score/u);var f=isFinite(a)?a:0,v=uN();if(f<n[l]||void 0!==t&&t<1&&(null==s?void 0:s.confidenceLevel)===1){if((void 0===this._lastUnsuitableQualityTimestamp?-1:v-this._lastUnsuitableQualityTimestamp)<this._blockRaiseDelay+9e3){var h=this._blockRaiseDelay+3e3;this._blockRaiseDelay=Math.min(h,15e3),uw.debug("ABR: Incrementing blocking raise in BufferBasedChooser due to unstable quality",this._blockRaiseDelay)}else{var p=this._blockRaiseDelay-1e3;this._blockRaiseDelay=Math.max(6e3,p),uw.debug("ABR: Lowering quality in BufferBasedChooser",this._blockRaiseDelay)}this._lastUnsuitableQualityTimestamp=v;for(var m=z(r,function(e){return e===o}),g=m-1;g>=0;g--)if(f>=n[g]){this._currentEstimate=r[g];return}this._currentEstimate=r[0];return}if(void 0!==this._lastUnsuitableQualityTimestamp&&v-this._lastUnsuitableQualityTimestamp<this._blockRaiseDelay||void 0===t||t<1.15||(null==s?void 0:s.confidenceLevel)!==1){this._currentEstimate=o;return}var y=n[l],_=function(){for(var e=l+1;e<n.length;e++)if(n[e]>y)return e}();if(void 0!==_&&a>=n[_]){uw.debug("ABR: Raising quality in BufferBasedChooser",r[_]),this._currentEstimate=r[_];return}this._currentEstimate=o}},{key:"getLastEstimate",value:function(){return this._currentEstimate}}]),e}(),uF=function(){function e(t,n){a(this,e);var i=uT.getCurrent(),r=i.ABR_STARVATION_GAP,o=i.OUT_OF_STARVATION_GAP,s=i.ABR_STARVATION_FACTOR,u=i.ABR_REGULAR_FACTOR;this._initialBitrate=t,this._inStarvationMode=!1,this._lowLatencyMode=n,n?this._config={starvationGap:r.LOW_LATENCY,outOfStarvationGap:o.LOW_LATENCY,starvationBitrateFactor:s.LOW_LATENCY,regularBitrateFactor:u.LOW_LATENCY}:this._config={starvationGap:r.DEFAULT,outOfStarvationGap:o.DEFAULT,starvationBitrateFactor:s.DEFAULT,regularBitrateFactor:u.DEFAULT}}return u(e,[{key:"getBandwidthEstimate",value:function(e,t,n,r,a){var o,s,u=this._config,l=e.bufferGap,d=e.position,c=e.duration,f=isFinite(l)?l:0,v=uT.getCurrent().ABR_STARVATION_DURATION_DELTA;return isNaN(c)||f+d.getWanted()<c-v?!this._inStarvationMode&&f<=u.starvationGap?(uw.info("ABR: enter starvation mode."),this._inStarvationMode=!0):this._inStarvationMode&&f>=u.outOfStarvationGap&&(uw.info("ABR: exit starvation mode."),this._inStarvationMode=!1):this._inStarvationMode&&(uw.info("ABR: exit starvation mode."),this._inStarvationMode=!1),this._inStarvationMode&&void 0!==(s=Z(r,e,n,this._lowLatencyMode,a))&&(uw.info("ABR: starvation mode emergency estimate:",s),t.reset(),o=i(n)?s:Math.min(s,n.bitrate)),i(o)&&(o=void 0!==(s=t.getEstimate())?s*(this._inStarvationMode?u.starvationBitrateFactor:u.regularBitrateFactor):void 0!==a?a*(this._inStarvationMode?u.starvationBitrateFactor:u.regularBitrateFactor):this._initialBitrate),e.speed>1&&(o/=e.speed),{bandwidthEstimate:s,bitrateChosen:o}}},{key:"isUrgent",value:function(e,t,n,i){return null===t||!(e>=t.bitrate)&&J(i,n,this._lowLatencyMode)}}]),e}(),uB=function(){function e(){a(this,e),this.bandwidth=void 0,this.representation=null,this.algorithmType=3}return u(e,[{key:"update",value:function(e,t,n){this.representation=e,this.bandwidth=t,this.algorithmType=n}}]),e}(),uV=function(){function e(t,n){a(this,e),this._scoreCalculator=t,this._lastAbrEstimate=n,this._consecutiveWrongGuesses=0,this._blockGuessesUntil=0,this._lastMaintanableBitrate=null}return u(e,[{key:"getGuess",value:function(e,t,n,i,r){var a=t.bufferGap,o=t.speed,s=this._lastAbrEstimate.representation;if(null===s)return null;if(i>s.bitrate)return 2===this._lastAbrEstimate.algorithmType&&(null!==this._lastAbrEstimate.representation&&(this._lastMaintanableBitrate=this._lastAbrEstimate.representation.bitrate),this._consecutiveWrongGuesses=0),null;var u=this._scoreCalculator.getEstimate(n);if(2!==this._lastAbrEstimate.algorithmType){if(void 0===u)return null;if(this._canGuessHigher(a,o,u)){var l=ee(e,n);if(null!==l)return l}return null}if(this._isLastGuessValidated(s,i,u)&&(uw.debug("ABR: Guessed Representation validated",s.bitrate),this._lastMaintanableBitrate=s.bitrate,this._consecutiveWrongGuesses=0),n.id!==s.id)return s;if(this._shouldStopGuess(n,u,a,r))return this._consecutiveWrongGuesses++,this._blockGuessesUntil=uN()+Math.min(15e3*this._consecutiveWrongGuesses,12e4),et(e,n);if(void 0===u)return n;if(this._canGuessHigher(a,o,u)){var d=ee(e,n);if(null!==d)return d}return n}},{key:"_canGuessHigher",value:function(e,t,n){var i=n.score,r=n.confidenceLevel;return isFinite(e)&&e>=2.5&&uN()>this._blockGuessesUntil&&1===r&&i/t>1.01}},{key:"_shouldStopGuess",value:function(e,t,n,i){if(void 0!==t&&t.score<1.01||(void 0===t||t.score<1.2)&&n<.6)return!0;var r=i.filter(function(t){return t.content.representation.id===e.id}),a=uN(),o=!0,s=!1,u=void 0;try{for(var l,d=r[Symbol.iterator]();!(o=(l=d.next()).done);o=!0){var c=l.value,f=a-c.requestTimestamp;if(c.content.segment.isInit){if(f>1e3)return!0}else{if(f>1e3*c.content.segment.duration+200)return!0;var v=X(c);if(void 0!==v&&v<.8*e.bitrate)return!0}}}catch(e){s=!0,u=e}finally{try{o||null==d.return||d.return()}finally{if(s)throw u}}return!1}},{key:"_isLastGuessValidated",value:function(e,t,n){return void 0!==n&&1===n.confidenceLevel&&n.score>1.5||t>=e.bitrate&&(null===this._lastMaintanableBitrate||this._lastMaintanableBitrate<e.bitrate)}}]),e}(),uz=function(){function e(){a(this,e);var t=uT.getCurrent(),n=t.ABR_FAST_EMA,i=t.ABR_SLOW_EMA;this._fastEWMA=new uO(n),this._slowEWMA=new uO(i),this._bytesSampled=0}return u(e,[{key:"addSample",value:function(e,t){if(!(t<uT.getCurrent().ABR_MINIMUM_CHUNK_SIZE)){var n=8e3*t/e,i=e/1e3;this._bytesSampled+=t,this._fastEWMA.addSample(i,n),this._slowEWMA.addSample(i,n)}}},{key:"getEstimate",value:function(){var e=uT.getCurrent().ABR_MINIMUM_TOTAL_BYTES;if(!(this._bytesSampled<e))return Math.min(this._fastEWMA.getEstimate(),this._slowEWMA.getEstimate())}},{key:"reset",value:function(){var e=uT.getCurrent(),t=e.ABR_FAST_EMA,n=e.ABR_SLOW_EMA;this._fastEWMA=new uO(t),this._slowEWMA=new uO(n),this._bytesSampled=0}}]),e}(),uK="function"==typeof Object.values?Object.values:er,uW=function(){function e(){a(this,e),this._currentRequests={}}return u(e,[{key:"add",value:function(e){var t=e.id,n=e.requestTimestamp,i=e.content;this._currentRequests[t]={requestTimestamp:n,progress:[],content:i}}},{key:"addProgress",value:function(e){var t=this._currentRequests[e.id];if(i(t)){if(ui.CURRENT_ENV===ui.DEV)throw Error("ABR: progress for a request not added");uw.warn("ABR: progress for a request not added");return}t.progress.push(e)}},{key:"remove",value:function(e){if(i(this._currentRequests[e])){if(ui.CURRENT_ENV===ui.DEV)throw Error("ABR: can't remove unknown request");uw.warn("ABR: can't remove unknown request")}delete this._currentRequests[e]}},{key:"getRequests",value:function(){return uK(this._currentRequests).filter(function(e){return!i(e)}).sort(function(e,t){return e.content.segment.time-t.content.segment.time})}}]),e}(),uG=new uR(void 0);uG.finish();var uH=new uR(1/0);uH.finish();var uq=function(e){var t={},n=e.initialBitrates,r=e.throttlers,a=e.lowLatencyMode;return function(e,o,s,u,l){var d,c,f,v=e.adaptation.type,h=function(e){var n=t[e];if(i(n)){uw.debug("ABR: Creating new BandwidthEstimator for ",e);var r=new uz;return t[e]=r,r}return n}(v),p=null!=(d=n[v])?d:0;return eo({bandwidthEstimator:h,context:e,currentRepresentation:o,filters:{limitResolution:null!=(c=r.limitResolution[v])?c:uG,throttleBitrate:null!=(f=r.throttleBitrate[v])?f:uH},initialBitrate:p,playbackObserver:u,representations:s,lowLatencyMode:a},l)}},uY=function(e){f(i,e);var t=w(i);function i(e,r,o){var s;return a(this,i),Object.setPrototypeOf(n(s=t.call(this)),i.prototype),s.name="CustomLoaderError",s.message=e,s.canRetry=r,s.xhr=o,m(s)}return i}(k(Error)),uj=function(e){f(i,e);var t=w(i);function i(e,r,o){var s;switch(a(this,i),Object.setPrototypeOf(n(s=t.call(this)),i.prototype),s.name="RequestError",s.url=e,s.status=r,s.type=o,o){case"TIMEOUT":s.message="The request timed out";break;case"ERROR_EVENT":s.message="An error prevented the request to be performed successfully";break;case"PARSE_ERROR":s.message="An error happened while formatting the response data";break;case"ERROR_HTTP_CODE":s.message="An HTTP status code indicating failure was received: "+String(s.status)}return m(s)}return u(i,[{key:"serialize",value:function(){return{url:this.url,status:this.status,type:this.type}}}]),i}(k(Error)),uQ={TIMEOUT:"TIMEOUT",ERROR_EVENT:"ERROR_EVENT",ERROR_HTTP_CODE:"ERROR_HTTP_CODE",PARSE_ERROR:"PARSE_ERROR"},uX="function"==typeof Headers?Headers:null,u$="function"==typeof AbortController?AbortController:null,uZ=function(e){var t={url:e.url,headers:e.headers,responseType:i(e.responseType)?"json":e.responseType,timeout:e.timeout,connectionTimeout:e.connectionTimeout};return new Promise(function(n,r){var a,o,s=function(){void 0!==a&&clearTimeout(a),void 0!==o&&clearTimeout(o),null!==_&&_()},u=e.onProgress,l=e.cancelSignal,d=t.url,c=t.headers,f=t.responseType,h=t.timeout,p=t.connectionTimeout,m=new XMLHttpRequest;if(m.open("GET",d,!0),void 0!==h&&(m.timeout=h,a=setTimeout(function(){s(),r(new uj(d,m.status,uQ.TIMEOUT))},h+3e3)),void 0!==p&&(o=setTimeout(function(){s(),m.readyState!==XMLHttpRequest.DONE&&m.abort(),r(new uj(d,m.status,uQ.TIMEOUT))},p)),m.responseType=f,"document"===m.responseType&&m.overrideMimeType("text/xml"),!i(c))for(var g in c)c.hasOwnProperty(g)&&m.setRequestHeader(g,c[g]);var y=uN(),_=null;void 0!==l&&(_=l.register(function(e){s(),m.readyState!==XMLHttpRequest.DONE&&m.abort(),r(e)}),l.isCancelled())||(m.onerror=function(){s(),r(new uj(d,m.status,uQ.ERROR_EVENT))},m.ontimeout=function(){s(),r(new uj(d,m.status,uQ.TIMEOUT))},void 0!==p&&(m.onreadystatechange=function(){m.readyState>=XMLHttpRequest.HEADERS_RECEIVED&&clearTimeout(o)}),void 0!==u&&(m.onprogress=function(e){var t=uN();u({url:d,duration:t-y,sendingTime:y,currentTime:t,size:e.loaded,totalSize:e.total})}),m.onload=function(e){if(m.readyState===XMLHttpRequest.DONE){if(s(),m.status>=200&&m.status<300){var t,a=uN(),o=v(m.response,ArrayBuffer)?m.response.byteLength:e.total,u=m.status,l=m.responseType,c=ed(m.responseURL)?m.responseURL:d;if(i(t="json"===l?"object"==typeof m.response?m.response:ec(m.responseText):m.response)){r(new uj(d,m.status,uQ.PARSE_ERROR));return}n({status:u,url:c,responseType:l,sendingTime:y,receivedTime:a,requestDuration:a-y,size:o,responseData:t})}else r(new uj(d,m.status,uQ.ERROR_HTTP_CODE))}},m.send())})},uJ={NETWORK_ERROR:"NETWORK_ERROR",MEDIA_ERROR:"MEDIA_ERROR",ENCRYPTED_MEDIA_ERROR:"ENCRYPTED_MEDIA_ERROR",OTHER_ERROR:"OTHER_ERROR"},u0={PIPELINE_LOAD_ERROR:"PIPELINE_LOAD_ERROR",PIPELINE_PARSE_ERROR:"PIPELINE_PARSE_ERROR",INTEGRITY_ERROR:"INTEGRITY_ERROR",MANIFEST_PARSE_ERROR:"MANIFEST_PARSE_ERROR",MANIFEST_INCOMPATIBLE_CODECS_ERROR:"MANIFEST_INCOMPATIBLE_CODECS_ERROR",MANIFEST_UPDATE_ERROR:"MANIFEST_UPDATE_ERROR",MANIFEST_UNSUPPORTED_ADAPTATION_TYPE:"MANIFEST_UNSUPPORTED_ADAPTATION_TYPE",MEDIA_STARTING_TIME_NOT_FOUND:"MEDIA_STARTING_TIME_NOT_FOUND",MEDIA_TIME_BEFORE_MANIFEST:"MEDIA_TIME_BEFORE_MANIFEST",MEDIA_TIME_AFTER_MANIFEST:"MEDIA_TIME_AFTER_MANIFEST",MEDIA_TIME_NOT_FOUND:"MEDIA_TIME_NOT_FOUND",NO_PLAYABLE_REPRESENTATION:"NO_PLAYABLE_REPRESENTATION",MEDIA_IS_ENCRYPTED_ERROR:"MEDIA_IS_ENCRYPTED_ERROR",CREATE_MEDIA_KEYS_ERROR:"CREATE_MEDIA_KEYS_ERROR",MEDIA_KEYS_ATTACHMENT_ERROR:"MEDIA_KEYS_ATTACHMENT_ERROR",KEY_ERROR:"KEY_ERROR",KEY_STATUS_CHANGE_ERROR:"KEY_STATUS_CHANGE_ERROR",KEY_UPDATE_ERROR:"KEY_UPDATE_ERROR",KEY_LOAD_ERROR:"KEY_LOAD_ERROR",KEY_LOAD_TIMEOUT:"KEY_LOAD_TIMEOUT",KEY_GENERATE_REQUEST_ERROR:"KEY_GENERATE_REQUEST_ERROR",INCOMPATIBLE_KEYSYSTEMS:"INCOMPATIBLE_KEYSYSTEMS",INVALID_ENCRYPTED_EVENT:"INVALID_ENCRYPTED_EVENT",INVALID_KEY_SYSTEM:"INVALID_KEY_SYSTEM",LICENSE_SERVER_CERTIFICATE_ERROR:"LICENSE_SERVER_CERTIFICATE_ERROR",MULTIPLE_SESSIONS_SAME_INIT_DATA:"MULTIPLE_SESSIONS_SAME_INIT_DATA",BUFFER_APPEND_ERROR:"BUFFER_APPEND_ERROR",BUFFER_FULL_ERROR:"BUFFER_FULL_ERROR",BUFFER_TYPE_UNKNOWN:"BUFFER_TYPE_UNKNOWN",MEDIA_ERR_BLOCKED_AUTOPLAY:"MEDIA_ERR_BLOCKED_AUTOPLAY",MEDIA_ERR_PLAY_NOT_ALLOWED:"MEDIA_ERR_PLAY_NOT_ALLOWED",MEDIA_ERR_NOT_LOADED_METADATA:"MEDIA_ERR_NOT_LOADED_METADATA",MEDIA_ERR_ABORTED:"MEDIA_ERR_ABORTED",MEDIA_ERR_NETWORK:"MEDIA_ERR_NETWORK",MEDIA_ERR_DECODE:"MEDIA_ERR_DECODE",MEDIA_ERR_SRC_NOT_SUPPORTED:"MEDIA_ERR_SRC_NOT_SUPPORTED",MEDIA_ERR_UNKNOWN:"MEDIA_ERR_UNKNOWN",MEDIA_SOURCE_NOT_SUPPORTED:"MEDIA_SOURCE_NOT_SUPPORTED",MEDIA_KEYS_NOT_SUPPORTED:"MEDIA_KEYS_NOT_SUPPORTED",DISCONTINUITY_ENCOUNTERED:"DISCONTINUITY_ENCOUNTERED",NONE:"NONE"},u1=function(e){f(i,e);var t=w(i);function i(e,r,o){var s;return a(this,i),Object.setPrototypeOf(n(s=t.call(this)),i.prototype),s.name="EncryptedMediaError",s.type=uJ.ENCRYPTED_MEDIA_ERROR,s.code=e,s._originalMessage=r,s.message=ef(s.code,r),s.fatal=!1,"string"==typeof(null==o?void 0:o.keyStatuses)&&(s.keyStatuses=o.keyStatuses),m(s)}return u(i,[{key:"serialize",value:function(){return{name:this.name,code:this.code,reason:this._originalMessage,keyStatuses:this.keyStatuses}}}]),i}(k(Error)),u2=function(e){f(i,e);var t=w(i);function i(e,r,o){var s;return a(this,i),Object.setPrototypeOf(n(s=t.call(this)),i.prototype),s.name="MediaError",s.type=uJ.MEDIA_ERROR,s._originalMessage=r,s.code=e,s.message=ef(s.code,r),s.fatal=!1,(null==o?void 0:o.tracks)!==void 0&&(null==o?void 0:o.tracks.length)>0&&(s.tracksInfo=o.tracks),m(s)}return u(i,[{key:"serialize",value:function(){return{name:this.name,code:this.code,reason:this._originalMessage,tracks:this.tracksInfo}}}]),i}(k(Error)),u5=function(e){f(i,e);var t=w(i);function i(e,r){var o;return a(this,i),Object.setPrototypeOf(n(o=t.call(this)),i.prototype),o.name="NetworkError",o.type=uJ.NETWORK_ERROR,o.url=r.url,o.status=r.status,o.errorType=r.type,o._baseError=r,o.code=e,o.message=ef(o.code,r.message),o.fatal=!1,m(o)}return u(i,[{key:"isHttpError",value:function(e){return this.errorType===uQ.ERROR_HTTP_CODE&&this.status===e}},{key:"serialize",value:function(){return{name:this.name,code:this.code,baseError:this._baseError.serialize()}}}]),i}(k(Error)),u4=function(e){f(i,e);var t=w(i);function i(e,r){var o;return a(this,i),Object.setPrototypeOf(n(o=t.call(this)),i.prototype),o.name="OtherError",o.type=uJ.OTHER_ERROR,o.code=e,o.message=ef(o.code,r),o.fatal=!1,o._originalMessage=r,m(o)}return u(i,[{key:"serialize",value:function(){return{name:this.name,code:this.code,reason:this._originalMessage}}}]),i}(k(Error)),u3=function(e){f(i,e);var t=w(i);function i(e,r,o){var s;return a(this,i),Object.setPrototypeOf(n(s=t.call(this)),i.prototype),s.name="SourceBufferError",s.errorName=e,s.message=r,s.isBufferFull=o,m(s)}return u(i,[{key:"serialize",value:function(){return{errorName:this.name,message:this.message,isBufferFull:this.isBufferFull}}},{key:"toString",value:function(){return"".concat(this.errorName,": ").concat(this.message)}}]),i}(k(Error)),u8={aa:"aar",ab:"abk",ae:"ave",af:"afr",ak:"aka",am:"amh",an:"arg",ar:"ara",as:"asm",av:"ava",ay:"aym",az:"aze",ba:"bak",be:"bel",bg:"bul",bi:"bis",bm:"bam",bn:"ben",bo:"bod",br:"bre",bs:"bos",ca:"cat",ce:"che",ch:"cha",co:"cos",cr:"cre",cs:"ces",cu:"chu",cv:"chv",cy:"cym",da:"dan",de:"deu",dv:"div",dz:"dzo",ee:"ewe",el:"ell",en:"eng",eo:"epo",es:"spa",et:"est",eu:"eus",fa:"fas",ff:"ful",fi:"fin",fj:"fij",fo:"fao",fr:"fra",fy:"fry",ga:"gle",gd:"gla",gl:"glg",gn:"grn",gu:"guj",gv:"glv",ha:"hau",he:"heb",hi:"hin",ho:"hmo",hr:"hrv",ht:"hat",hu:"hun",hy:"hye",hz:"her",ia:"ina",id:"ind",ie:"ile",ig:"ibo",ii:"iii",ik:"ipk",io:"ido",is:"isl",it:"ita",iu:"iku",ja:"jpn",jv:"jav",ka:"kat",kg:"kon",ki:"kik",kj:"kua",kk:"kaz",kl:"kal",km:"khm",kn:"kan",ko:"kor",kr:"kau",ks:"kas",ku:"kur",kv:"kom",kw:"cor",ky:"kir",la:"lat",lb:"ltz",lg:"lug",li:"lim",ln:"lin",lo:"lao",lt:"lit",lu:"lub",lv:"lav",mg:"mlg",mh:"mah",mi:"mri",mk:"mkd",ml:"mal",mn:"mon",mr:"mar",ms:"msa",mt:"mlt",my:"mya",na:"nau",nb:"nob",nd:"nde",ne:"nep",ng:"ndo",nl:"nld",nn:"nno",no:"nor",nr:"nbl",nv:"nav",ny:"nya",oc:"oci",oj:"oji",om:"orm",or:"ori",os:"oss",pa:"pan",pi:"pli",pl:"pol",ps:"pus",pt:"por",qu:"que",rm:"roh",rn:"run",ro:"ron",ru:"rus",rw:"kin",sa:"san",sc:"srd",sd:"snd",se:"sme",sg:"sag",si:"sin",sk:"slk",sl:"slv",sm:"smo",sn:"sna",so:"som",sq:"sqi",sr:"srp",ss:"ssw",st:"sot",su:"sun",sv:"swe",sw:"swa",ta:"tam",te:"tel",tg:"tgk",th:"tha",ti:"tir",tk:"tuk",tl:"tgl",tn:"tsn",to:"ton",tr:"tur",ts:"tso",tt:"tat",tw:"twi",ty:"tah",ug:"uig",uk:"ukr",ur:"urd",uz:"uzb",ve:"ven",vi:"vie",vo:"vol",wa:"wln",wo:"wol",xh:"xho",yi:"yid",yo:"yor",za:"zha",zh:"zho",zu:"zul"},u6={alb:"sqi",arm:"hye",baq:"eus",bur:"mya",chi:"zho",cze:"ces",dut:"nld",fre:"fra",geo:"kat",ger:"deu",gre:"ell",ice:"isl",mac:"mkd",mao:"mri",may:"msa",per:"fas",slo:"slk",rum:"ron",tib:"bod",wel:"cym"},u9=function(e){if(i(e)||""===e)return"";var t=ep((""+e).toLowerCase().split("-")[0]);return ed(t)?t:e},u7={dashParsers:{wasm:null,native:null,fastJs:null},codecSupportProber:null,createDebugElement:null,directfile:null,decrypt:null,htmlTextDisplayer:null,htmlTextTracksParsers:{},mainThreadMediaSourceInit:null,multithread:null,nativeTextDisplayer:null,nativeTextTracksParsers:{},transports:{}},le=u7,lt=ey(),ln=function(){function e(t,n){if(a(this,e),this.id=t.id,this.uniqueId=lt(),this.bitrate=t.bitrate,this.codecs=[],void 0!==t.isSpatialAudio&&(this.isSpatialAudio=t.isSpatialAudio),void 0!==t.height&&(this.height=t.height),void 0!==t.width&&(this.width=t.width),void 0!==t.mimeType&&(this.mimeType=t.mimeType),void 0!==t.contentProtections&&(this.contentProtections=t.contentProtections),void 0!==t.frameRate&&(this.frameRate=t.frameRate),void 0!==t.hdrInfo&&(this.hdrInfo=t.hdrInfo),this.cdnMetadata=t.cdnMetadata,this.index=t.index,"audio"===n||"video"===n){if(null!==le.codecSupportProber){if(void 0!==t.supplementalCodecs){var i,r,o,s,u,l=le.codecSupportProber.isSupported(null!=(i=this.mimeType)?i:"",null!=(r=t.supplementalCodecs)?r:"");!1!==l&&(this.codecs=[t.supplementalCodecs],!0===l&&(this.isSupported=!0))}!0!==this.isSupported&&(this.codecs.length>0?this.codecs.push(null!=(o=t.codecs)?o:""):(this.codecs=void 0===t.codecs?[]:[t.codecs],this.isSupported=le.codecSupportProber.isSupported(null!=(s=this.mimeType)?s:"",null!=(u=t.codecs)?u:"")))}else void 0!==t.supplementalCodecs&&this.codecs.push(t.supplementalCodecs),void 0!==t.codecs&&this.codecs.push(t.codecs)}else void 0!==t.codecs&&this.codecs.push(t.codecs),this.isSupported=!0}return u(e,[{key:"refreshCodecSupport",value:function(e){var t=null!=(s=this.mimeType)?s:"",n=this.codecs;0===n.length&&(n=[""]);for(var i=!0,r=!1,a=void 0,o=0;o<n.length;o++)try{for(var s,u,l=e[Symbol.iterator]();!(i=(u=l.next()).done);i=!0){var d=u.value,c=n[o];if(d.codec===c&&d.mimeType===t){if(d.result){this.isSupported=!0,this.codecs=[c];return}if(o===n.length){this.isSupported=!1,this.codecs=[c];return}}}}catch(e){r=!0,a=e}finally{try{i||null==l.return||l.return()}finally{if(r)throw a}}}},{key:"getMimeTypeString",value:function(){var e,t,n;return"".concat(null!=(e=this.mimeType)?e:"",';codecs="').concat(null!=(n=null==(t=this.codecs)?void 0:t[0])?n:"",'"')}},{key:"getEncryptionData",value:function(e){for(var t,n,i=this.getAllEncryptionData(),r=[],a=0;a<i.length;a++)for(var o=!1,s=i[a],u=0;u<s.values.length;u++)if(s.values[u].systemId.toLowerCase()===e.toLowerCase()){if(o)r[r.length-1].values.push(s.values[u]);else{var l=null==(n=null==(t=this.contentProtections)?void 0:t.keyIds)?void 0:n.map(function(e){return e.keyId});r.push({type:s.type,keyIds:l,values:[s.values[u]]}),o=!0}}return r}},{key:"getAllEncryptionData",value:function(){if(void 0===this.contentProtections||0===this.contentProtections.initData.length)return[];var e,t,n=null==(t=null==(e=this.contentProtections)?void 0:e.keyIds)?void 0:t.map(function(e){return e.keyId});return this.contentProtections.initData.map(function(e){return{type:e.type,keyIds:n,values:e.values}})}},{key:"addProtectionData",value:function(e,t,n){var i=!1;if(void 0===this.contentProtections)return this.contentProtections={keyIds:void 0!==t?[{keyId:t}]:[],initData:[{type:e,values:n}]},!0;if(void 0!==t){var r=this.contentProtections.keyIds;if(void 0===r)this.contentProtections.keyIds=[{keyId:t}];else{var a=!1,o=!0,s=!1,u=void 0;try{for(var l,d=r[Symbol.iterator]();!(o=(l=d.next()).done);o=!0){var c=l.value;eg(c.keyId,t)&&(a=!0)}}catch(e){s=!0,u=e}finally{try{o||null==d.return||d.return()}finally{if(s)throw u}}a||(uw.warn("Manifest: found unanounced key id."),r.push({keyId:t}))}}for(var f=this.contentProtections.initData,v=0;v<f.length;v++)if(f[v].type===e){for(var h=f[v].values,p=0;p<n.length;p++){var m=n[p],g=void 0;for(g=0;g<h.length;g++)if(m.systemId===h[g].systemId){if(eg(m.data,h[g].data))break;uw.warn("Manifest: different init data for the same system ID")}g===h.length&&(h.push(m),i=!0)}return i}return this.contentProtections.initData.push({type:e,values:n}),!0}},{key:"getMetadataSnapshot",value:function(){return{id:this.id,uniqueId:this.uniqueId,bitrate:this.bitrate,codecs:this.codecs,mimeType:this.mimeType,width:this.width,height:this.height,frameRate:this.frameRate,isSupported:this.isSupported,hdrInfo:this.hdrInfo,contentProtections:this.contentProtections,decipherable:this.decipherable}}}]),e}(),li=function(){function e(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};a(this,e);var r=t.trickModeTracks,o=n.representationFilter,s=n.isManuallyAdded;this.id=t.id,this.type=t.type,void 0!==t.isTrickModeTrack&&(this.isTrickModeTrack=t.isTrickModeTrack),void 0!==t.language&&(this.language=t.language,this.normalizedLanguage=u9(t.language)),void 0!==t.closedCaption&&(this.isClosedCaption=t.closedCaption),void 0!==t.audioDescription&&(this.isAudioDescription=t.audioDescription),void 0!==t.isDub&&(this.isDub=t.isDub),void 0!==t.forcedSubtitles&&(this.isForcedSubtitles=t.forcedSubtitles),void 0!==t.isSignInterpreted&&(this.isSignInterpreted=t.isSignInterpreted),void 0!==t.label&&(this.label=t.label),void 0!==r&&r.length>0&&(this.trickModeTracks=r.map(function(t){return new e(t)}));for(var u,l=t.representations,d=[],c=0;c<l.length;c++){var f=new ln(l[c],this.type),v=!0;if(!i(o)){var h={id:f.id,bitrate:f.bitrate,codecs:f.codecs,height:f.height,width:f.width,frameRate:f.frameRate,hdrInfo:f.hdrInfo};if(void 0!==f.contentProtections&&(h.contentProtections={},void 0!==f.contentProtections.keyIds)){var p=f.contentProtections.keyIds.map(function(e){return e.keyId});h.contentProtections.keyIds=p}v=o(h,{trackType:this.type,language:this.language,normalizedLanguage:this.normalizedLanguage,isClosedCaption:this.isClosedCaption,isDub:this.isDub,isAudioDescription:this.isAudioDescription,isSignInterpreted:this.isSignInterpreted})}v?(d.push(f),void 0===u&&(!0===f.isSupported?u=!0:!1===f.isSupported&&(u=!1))):uw.debug("Filtering Representation due to representationFilter",this.type,"Adaptation: ".concat(this.id),"Representation: ".concat(f.id),"(".concat(f.bitrate,")"))}d.sort(function(e,t){return e.bitrate-t.bitrate}),this.representations=d,this.isSupported=u,this.manuallyAdded=!0===s}return u(e,[{key:"refreshCodecSupport",value:function(e){var t=!0,n=!1,i=void 0;try{for(var r,a=this.representations[Symbol.iterator]();!(t=(r=a.next()).done);t=!0){var o=r.value;void 0===o.isSupported&&(o.refreshCodecSupport(e),!0!==this.isSupported&&!0===o.isSupported?this.isSupported=!0:void 0===this.isSupported&&!1===o.isSupported&&(this.isSupported=!1))}}catch(e){n=!0,i=e}finally{try{t||null==a.return||a.return()}finally{if(n)throw i}}}},{key:"getRepresentation",value:function(e){return j(this.representations,function(t){return e===t.id})}},{key:"getMetadataSnapshot",value:function(){var e=[],t=this.representations,n=!0,i=!1,r=void 0;try{for(var a,o=t[Symbol.iterator]();!(n=(a=o.next()).done);n=!0){var s=a.value;e.push(s.getMetadataSnapshot())}}catch(e){i=!0,r=e}finally{try{n||null==o.return||o.return()}finally{if(i)throw r}}return{id:this.id,type:this.type,isSupported:this.isSupported,language:this.language,isForcedSubtitles:this.isForcedSubtitles,isClosedCaption:this.isClosedCaption,isAudioDescription:this.isAudioDescription,isSignInterpreted:this.isSignInterpreted,normalizedLanguage:this.normalizedLanguage,representations:e,label:this.label,isDub:this.isDub}}}]),e}(),lr=[],la=["audio","video","text"],lo=function(){function e(t,n,r){if(a(this,e),this.id=t.id,this.adaptations=Object.keys(t.adaptations).reduce(function(e,a){var o=t.adaptations[a];if(i(o))return e;var s=o.map(function(e){var t=new li(e,{representationFilter:r});return t.representations.length>0&&!1===t.isSupported&&n.push(t),t}).filter(function(e){return e.representations.length>0});if(s.every(function(e){return!1===e.isSupported})&&o.length>0&&("video"===a||"audio"===a))throw new u2("MANIFEST_INCOMPATIBLE_CODECS_ERROR","No supported "+a+" adaptations",{tracks:void 0});return s.length>0&&(e[a]=s),e},{}),!Array.isArray(this.adaptations.video)&&!Array.isArray(this.adaptations.audio))throw new u2("MANIFEST_PARSE_ERROR","No supported audio and video tracks.");this.duration=t.duration,this.start=t.start,i(this.duration)||i(this.start)||(this.end=this.start+this.duration),this.streamEvents=void 0===t.streamEvents?[]:t.streamEvents}return u(e,[{key:"refreshCodecSupport",value:function(e,t){var n=this;Object.keys(this.adaptations).forEach(function(i){var r=n.adaptations[i];if(void 0!==r){var a=!1,o=!0,s=!1,u=void 0;try{for(var l,d=r[Symbol.iterator]();!(o=(l=d.next()).done);o=!0){var c=l.value,f=c.isSupported;c.refreshCodecSupport(e),!1!==f&&!1===c.isSupported&&t.push(c),!1===a?a=c.isSupported:void 0===a&&!0===c.isSupported&&(a=!0)}}catch(e){s=!0,u=e}finally{try{o||null==d.return||d.return()}finally{if(s)throw u}}if(("video"===i||"audio"===i)&&!1===a)throw new u2("MANIFEST_INCOMPATIBLE_CODECS_ERROR","No supported "+i+" adaptations",{tracks:void 0})}},{})}},{key:"getAdaptations",value:function(){return eR(this)}},{key:"getAdaptationsForType",value:function(e){var t=this.adaptations[e];return null!=t?t:[]}},{key:"getAdaptation",value:function(e){return j(this.getAdaptations(),function(t){return e===t.id})}},{key:"getSupportedAdaptations",value:function(e){return eT(this,e)}},{key:"containsTime",value:function(e,t){return eA(this,e,t)}},{key:"getMetadataSnapshot",value:function(){var e={},t=this.getAdaptations(),n=!0,i=!1,r=void 0;try{for(var a,o=t[Symbol.iterator]();!(n=(a=o.next()).done);n=!0){var s=a.value,u=e[s.type];void 0===u&&(u=[],e[s.type]=u),u.push(s.getMetadataSnapshot())}}catch(e){i=!0,r=e}finally{try{n||null==o.return||o.return()}finally{if(i)throw r}}return{start:this.start,end:this.end,id:this.id,streamEvents:this.streamEvents,adaptations:e}}}]),e}(),ls=ey(),lu=function(e){f(n,e);var t=w(n);function n(e,i,r){a(this,n),o=t.call(this);var o,s,u=i.representationFilter,l=i.manifestUpdateUrl;o.manifestFormat=0,o.id=ls(),o.expired=null!=(s=e.expired)?s:null,o.transport=e.transportType,o.clockOffset=e.clockOffset;var d=[];if(o.periods=e.periods.map(function(e){return new lo(e,d,u)}).sort(function(e,t){return e.start-t.start}),d.length>0){var c=new u2("MANIFEST_INCOMPATIBLE_CODECS_ERROR","An Adaptation contains only incompatible codecs.",{tracks:d.map(eN)});r.push(c)}return o.adaptations=void 0===o.periods[0]?{}:o.periods[0].adaptations,o.timeBounds=e.timeBounds,o.isDynamic=e.isDynamic,o.isLive=e.isLive,o.isLastPeriodKnown=e.isLastPeriodKnown,o.uris=void 0===e.uris?[]:e.uris,o.updateUrl=l,o.lifetime=e.lifetime,o.clockOffset=e.clockOffset,o.suggestedPresentationDelay=e.suggestedPresentationDelay,o.availabilityStartTime=e.availabilityStartTime,o.publishTime=e.publishTime,o}return u(n,[{key:"refreshCodecSupport",value:function(e){var t=[],n=!0,i=!1,r=void 0;try{for(var a,o=this.periods[Symbol.iterator]();!(n=(a=o.next()).done);n=!0)a.value.refreshCodecSupport(e,t)}catch(e){i=!0,r=e}finally{try{n||null==o.return||o.return()}finally{if(i)throw r}}return t.length>0?new u2("MANIFEST_INCOMPATIBLE_CODECS_ERROR","An Adaptation contains only incompatible codecs.",{tracks:t.map(eN)}):null}},{key:"getPeriod",value:function(e){return j(this.periods,function(t){return e===t.id})}},{key:"getPeriodForTime",value:function(e){return ew(this,e)}},{key:"getNextPeriod",value:function(e){return j(this.periods,function(t){return t.start>e})}},{key:"getPeriodAfter",value:function(e){return eI(this,e)}},{key:"getUrls",value:function(){return this.uris}},{key:"replace",value:function(e){this._performUpdate(e,0)}},{key:"update",value:function(e){this._performUpdate(e,1)}},{key:"getMinimumSafePosition",value:function(){return eb(this)}},{key:"getLivePosition",value:function(){return eE(this)}},{key:"getMaximumSafePosition",value:function(){return ek(this)}},{key:"updateRepresentationsDeciperability",value:function(e){var t=eF(this,e);t.length>0&&this.trigger("decipherabilityUpdate",t)}},{key:"getAdaptations",value:function(){eS("manifest.getAdaptations() is deprecated. Please use manifest.period[].getAdaptations() instead");var e=this.periods[0];if(void 0===e)return[];var t=e.adaptations,n=[];for(var i in t)if(t.hasOwnProperty(i)){var r=t[i];n.push.apply(n,S(r))}return n}},{key:"getAdaptationsForType",value:function(e){eS("manifest.getAdaptationsForType(type) is deprecated. Please use manifest.period[].getAdaptationsForType(type) instead");var t=this.periods[0];if(void 0===t)return[];var n=t.adaptations[e];return void 0===n?[]:n}},{key:"getAdaptation",value:function(e){return eS("manifest.getAdaptation(id) is deprecated. Please use manifest.period[].getAdaptation(id) instead"),j(this.getAdaptations(),function(t){return e===t.id})}},{key:"getMetadataSnapshot",value:function(){var e=[],t=!0,n=!1,i=void 0;try{for(var r,a=this.periods[Symbol.iterator]();!(t=(r=a.next()).done);t=!0){var o=r.value;e.push(o.getMetadataSnapshot())}}catch(e){n=!0,i=e}finally{try{t||null==a.return||a.return()}finally{if(n)throw i}}return{manifestFormat:1,id:this.id,periods:e,isDynamic:this.isDynamic,isLive:this.isLive,isLastPeriodKnown:this.isLastPeriodKnown,suggestedPresentationDelay:this.suggestedPresentationDelay,clockOffset:this.clockOffset,uris:this.uris,availabilityStartTime:this.availabilityStartTime,timeBounds:this.timeBounds}}},{key:"_performUpdate",value:function(e,t){if(this.availabilityStartTime=e.availabilityStartTime,this.expired=e.expired,this.isDynamic=e.isDynamic,this.isLive=e.isLive,this.isLastPeriodKnown=e.isLastPeriodKnown,this.lifetime=e.lifetime,this.clockOffset=e.clockOffset,this.suggestedPresentationDelay=e.suggestedPresentationDelay,this.transport=e.transport,this.publishTime=e.publishTime,0===t)this.timeBounds=e.timeBounds,this.uris=e.uris,n=eL(this.periods,e.periods);else{this.timeBounds.maximumTimeData=e.timeBounds.maximumTimeData,this.updateUrl=e.uris[0],n=eU(this.periods,e.periods);for(var n,i=this.getMinimumSafePosition();this.periods.length>0;){var r=this.periods[0];if(void 0===r.end||r.end>i)break;this.periods.shift()}}this.adaptations=void 0===this.periods[0]?{}:this.periods[0].adaptations,this.trigger("manifestUpdate",n)}}]),n}(ur);function ll(){return(ll=r(function(e,t,n,i,a){var o,u,l,d,c,f;function h(){if(null===e){var n=c.get(null);return void 0!==n&&n.isBlacklisted?void 0:null}return null===t?_(e):_(t.getCdnPreferenceForResource(e))}function p(e){return m.apply(this,arguments)}function m(){return(m=r(function(e){var i,r,s,d;return I(this,function(f){switch(f.label){case 0:return f.trys.push([0,2,,3]),[4,n(e,a)];case 1:return[2,f.sent()];case 2:if(i=f.sent(),uM.isCancellationError(i))throw i;if(null!==e&&null!==t&&t.downgradeCdn(e),void 0===(r=c.get(e))?(r={errorCounter:1,blockedUntil:void 0,isBlacklisted:!1},c.set(e,r)):r.errorCounter++,!(v(i,uj)?i.type===uQ.ERROR_HTTP_CODE?i.status>=500||404===i.status||415===i.status||412===i.status:i.type===uQ.TIMEOUT||i.type===uQ.ERROR_EVENT:v(i,uY)?"boolean"==typeof i.canRetry?i.canRetry:void 0!==i.xhr&&(i.xhr.status>=500||404===i.xhr.status||415===i.xhr.status||412===i.xhr.status):ev(i)&&"INTEGRITY_ERROR"===i.code))return[2,(r.blockedUntil=void 0,r.isBlacklisted=!0,g(i))];return r.errorCounter>l?(r.blockedUntil=void 0,r.isBlacklisted=!0):(s=r.errorCounter,d=eG(Math.min(o*Math.pow(2,s-1),u)),r.blockedUntil=uN()+d),[2,g(i)];case 3:return[2]}})})).apply(this,arguments)}function g(e){return y.apply(this,arguments)}function y(){return(y=r(function(e){var n;return I(this,function(i){if(n=h(),a.isCancelled())throw a.cancellationError;if(void 0===n)throw e;if(d(e),a.isCancelled())throw a.cancellationError;return[2,function e(n,i){var r=c.get(n);if(void 0===r||void 0===r.blockedUntil)return p(n);var o=uN(),u=r.blockedUntil-o;if(u<=0)return p(n);var l=new uM,d=l.linkToSignal(a);return new Promise(function(r,o){var c=function(e){d(),r(e)},f=function(e){d(),o(e)};null==t||t.addEventListener("priorityChange",function(){var t=h();if(a.isCancelled())throw a.cancellationError;if(void 0===t)return f(i);t!==n&&(l.cancel(),e(t,i).then(c,f))},l.signal),eW(u,l.signal).then(function(){return p(n).then(c,f)},s)})}(n,e)]})})).apply(this,arguments)}function _(e){if(0===c.size)return e[0];var t,n=uN();return null==(t=e.filter(function(e){var t;return(null==(t=c.get(e))?void 0:t.isBlacklisted)!==!0}).reduce(function(e,t){var i,r=null==(i=c.get(t))?void 0:i.blockedUntil;return void 0!==r&&r<=n&&(r=void 0),void 0===e?[t,r]:void 0===e[1]?e:void 0===r?[t,void 0]:r<e[1]?[t,r]:e},void 0))?void 0:t[0]}return I(this,function(t){if(null!==a.cancellationError)return[2,Promise.reject(a.cancellationError)];if(o=i.baseDelay,u=i.maxDelay,l=i.maxRetry,d=i.onRetry,null!==e&&0===e.length&&uw.warn("Fetchers: no CDN given to `scheduleRequestWithCdns`."),c=new Map,void 0===(f=h()))throw Error("No CDN to request");return[2,p(f)]})})).apply(this,arguments)}var ld=function(e){f(n,e);var t=w(n);function n(e,i,r){var o;return a(this,n),(o=t.call(this)).scheduleManualRefresh=s,o._manifestUrls=e,o._pipelines=i.manifest,o._settings=r,o._canceller=new uM,o._isStarted=!1,o._isRefreshPending=!1,o._consecutiveUnsafeMode=0,o._prioritizedContentUrl=null,m(o)}return u(n,[{key:"dispose",value:function(){this._canceller.cancel(),this.removeEventListener()}},{key:"start",value:function(){var e=this;if(!this._isStarted){this._isStarted=!0;var t=this._settings.initialManifest;(v(t,lu)?Promise.resolve({manifest:t}):void 0!==t?this.parse(t,{previousManifest:null,unsafeMode:!1},void 0):this._fetchManifest(void 0).then(function(e){return e.parse({previousManifest:null,unsafeMode:!1})})).then(function(t){e.trigger("manifestReady",t.manifest),e._canceller.isUsed()||e._recursivelyRefreshManifest(t.manifest,t)}).catch(function(t){return e._onFatalError(t)})}}},{key:"updateContentUrls",value:function(e,t){var n;this._prioritizedContentUrl=null!=(n=null==e?void 0:e[0])?n:void 0,t&&this.scheduleManualRefresh({enablePartialRefresh:!1,delay:0,canUseUnsafeMode:!1})}},{key:"_fetchManifest",value:function(e){var t=this;return r(function(){var n,i,r,a,o,s,u;return I(this,function(l){switch(l.label){case 0:i=t._canceller.signal,r=t._settings,a=t._pipelines,o=null!=e?e:null==(n=t._manifestUrls)?void 0:n[0],s=t._getBackoffSetting(function(e){t.trigger("warning",ez(e))}),l.label=1;case 1:var d,c,f,v;return l.trys.push([1,3,,4]),[4,(d=o,c=a.loadManifest,f=void 0===r.requestTimeout?uT.getCurrent().DEFAULT_REQUEST_TIMEOUT:r.requestTimeout,v=void 0===r.connectionTimeout?uT.getCurrent().DEFAULT_CONNECTION_TIMEOUT:r.connectionTimeout,f<0&&(f=void 0),v<0&&(v=void 0),eq(function(){return c(d,{timeout:f,connectionTimeout:v},i)},s,i))];case 2:return u=l.sent(),[2,{parse:function(e){return t._parseLoadedManifest(u,e,o)}}];case 3:throw ez(l.sent());case 4:return[2]}})})()}},{key:"parse",value:function(e,t,n){return this._parseLoadedManifest({responseData:e,size:void 0,requestDuration:void 0},t,n)}},{key:"_parseLoadedManifest",value:function(e,t,n){var i=this;return r(function(){var a,o,s,u,l,d,c,f,h,p,m;function g(e){return y.apply(this,arguments)}function y(){return(y=r(function(e){return I(this,function(t){switch(t.label){case 0:return t.trys.push([0,2,,3]),[4,eq(e,c,s)];case 1:return[2,t.sent()];case 2:throw ez(t.sent());case 3:return[2]}})})).apply(this,arguments)}function _(e){var t=!0,n=!1,i=void 0;try{for(var r,a=e[Symbol.iterator]();!(t=(r=a.next()).done);t=!0){var o=r.value;if(s.isCancelled())return;var l=eh(o,{defaultCode:"PIPELINE_PARSE_ERROR",defaultReason:"Unknown error when parsing the Manifest"});u("warning",l)}}catch(e){n=!0,i=e}finally{try{t||null==a.return||a.return()}finally{if(n)throw i}}}function S(e,t){_(t);var n=uN()-o;return uw.info("MF: Manifest parsed in ".concat(n,"ms")),{manifest:e,sendingTime:l,receivedTime:d,parsingTime:n}}return I(this,function(r){switch(r.label){case 0:o=uN(),s=i._canceller.signal,u=i.trigger.bind(i),l=e.sendingTime,d=e.receivedTime,c=i._getBackoffSetting(function(e){i.trigger("warning",ez(e))}),f=null!=n?n:null==(a=i._manifestUrls)?void 0:a[0],h={externalClockOffset:t.externalClockOffset,unsafeMode:t.unsafeMode,previousManifest:t.previousManifest,originalUrl:f},r.label=1;case 1:if(r.trys.push([1,5,,6]),!v(p=i._pipelines.parseManifest(e,h,_,s,g),Promise))return[3,3];return[4,p];case 2:return[2,S((m=r.sent()).manifest,m.warnings)];case 3:return[2,S(p.manifest,p.warnings)];case 4:return[3,6];case 5:throw eh(r.sent(),{defaultCode:"PIPELINE_PARSE_ERROR",defaultReason:"Unknown error when parsing the Manifest"});case 6:return[2]}})})()}},{key:"_getBackoffSetting",value:function(e){var t=uT.getCurrent(),n=t.DEFAULT_MAX_MANIFEST_REQUEST_RETRY,i=t.INITIAL_BACKOFF_DELAY_BASE,r=t.MAX_BACKOFF_DELAY_BASE,a=this._settings,o=a.lowLatencyMode,s=a.maxRetry;return{onRetry:e,baseDelay:o?i.LOW_LATENCY:i.REGULAR,maxDelay:o?r.LOW_LATENCY:r.REGULAR,maxRetry:null!=s?s:n}}},{key:"_recursivelyRefreshManifest",value:function(e,t){var n=this,i=t.sendingTime,r=t.parsingTime,a=t.updatingTime,o=uT.getCurrent(),u=o.MAX_CONSECUTIVE_MANIFEST_PARSING_IN_UNSAFE_MODE,l=o.MIN_MANIFEST_PARSING_TIME_TO_ENTER_UNSAFE_MODE,d=void 0!==r?r+(null!=a?a:0):void 0,c=!1;this._consecutiveUnsafeMode>0?c=this._consecutiveUnsafeMode<u:void 0!==d&&(c=d>=l);var f=void 0===i?0:uN()-i,v=Math.max(this._settings.minimumManifestUpdateInterval-f,0),h=new uM;if(h.linkToSignal(this._canceller.signal),this.scheduleManualRefresh=function(t){var r=t.enablePartialRefresh,a=t.delay,o=t.canUseUnsafeMode&&c,s=void 0===i?0:uN()-i,u=Math.max(n._settings.minimumManifestUpdateInterval-s,0),l=setTimeout(function(){h.cancel(),n._triggerNextManifestRefresh(e,{enablePartialRefresh:r,unsafeMode:o})},Math.max((null!=a?a:0)-s,u));h.signal.register(function(){clearTimeout(l)})},null!==e.expired){var p=setTimeout(function(){var t;null==(t=e.expired)||t.then(function(){h.cancel(),n._triggerNextManifestRefresh(e,{enablePartialRefresh:!1,unsafeMode:c})},s)},v);h.signal.register(function(){clearTimeout(p)})}if(void 0!==e.lifetime&&e.lifetime>=0){var m,g=1e3*e.lifetime-f;void 0===d?m=g:e.lifetime<3&&d>=100?(m=Math.min(Math.max(3e3-f,Math.max(g,0)+d),6*g),uw.info("MUS: Manifest update rythm is too frequent. Postponing next request.",g,m)):d>=1e3*e.lifetime/10?(m=Math.min(Math.max(g,0)+d,6*g),uw.info("MUS: Manifest took too long to parse. Postponing next request",m,m)):m=g;var y=setTimeout(function(){h.cancel(),n._triggerNextManifestRefresh(e,{enablePartialRefresh:!1,unsafeMode:c})},Math.max(m,v));h.signal.register(function(){clearTimeout(y)})}}},{key:"_triggerNextManifestRefresh",value:function(e,t){var n,i,r=this,a=t.enablePartialRefresh,o=t.unsafeMode,u=e.updateUrl;null!==this._prioritizedContentUrl?(n=!0,i=this._prioritizedContentUrl,this._prioritizedContentUrl=null):i=(n=!a||void 0===u)?e.getUrls()[0]:u;var l=e.clockOffset;o?(this._consecutiveUnsafeMode+=1,uw.info('Init: Refreshing the Manifest in "unsafeMode" for the '+String(this._consecutiveUnsafeMode)+" consecutive time.")):this._consecutiveUnsafeMode>0&&(uw.info('Init: Not parsing the Manifest in "unsafeMode" anymore after '+String(this._consecutiveUnsafeMode)+" consecutive times."),this._consecutiveUnsafeMode=0),this._isRefreshPending||(this._isRefreshPending=!0,this._fetchManifest(i).then(function(t){return t.parse({externalClockOffset:l,previousManifest:e,unsafeMode:o})}).then(function(t){r._isRefreshPending=!1;var i=t.manifest,a=t.sendingTime,o=t.parsingTime,u=uN();if(n)e.replace(i);else try{e.update(i)}catch(t){var l=v(t,Error)?t.message:"unknown error";uw.warn("MUS: Attempt to update Manifest failed: ".concat(l),"Re-downloading the Manifest fully");var d=uT.getCurrent().FAILED_PARTIAL_UPDATE_MANIFEST_REFRESH_DELAY,c=void 0===a?0:uN()-a,f=Math.max(r._settings.minimumManifestUpdateInterval-c,0),h=s,p=setTimeout(function(){h(),r._triggerNextManifestRefresh(e,{enablePartialRefresh:!1,unsafeMode:!1})},Math.max(d-c,f));h=r._canceller.signal.register(function(){clearTimeout(p)});return}var m=uN()-u;r._recursivelyRefreshManifest(e,{sendingTime:a,parsingTime:o,updatingTime:m})}).catch(function(e){r._isRefreshPending=!1,r._onFatalError(e)}))}},{key:"_onFatalError",value:function(e){this._canceller.isUsed()||(this.trigger("error",e),this.dispose())}}]),n}(ur),lc=function(e){f(n,e);var t=w(n);function n(e){var i;return a(this,n),(i=t.call(this))._downgradedCdnList={metadata:[],timeouts:[]},e.register(function(){var e=!0,t=!1,n=void 0;try{for(var r,a=i._downgradedCdnList.timeouts[Symbol.iterator]();!(e=(r=a.next()).done);e=!0){var o=r.value;clearTimeout(o)}}catch(e){t=!0,n=e}finally{try{e||null==a.return||a.return()}finally{if(t)throw n}}i._downgradedCdnList={metadata:[],timeouts:[]}}),m(i)}return u(n,[{key:"getCdnPreferenceForResource",value:function(e){return e.length<=1?e:this._innerGetCdnPreferenceForResource(e)}},{key:"downgradeCdn",value:function(e){var t=this,n=ej(this._downgradedCdnList.metadata,e);n>=0&&this._removeIndexFromDowngradeList(n);var i=uT.getCurrent().DEFAULT_CDN_DOWNGRADE_TIME;this._downgradedCdnList.metadata.push(e);var r=setTimeout(function(){var n=ej(t._downgradedCdnList.metadata,e);n>=0&&t._removeIndexFromDowngradeList(n),t.trigger("priorityChange",null)},i);this._downgradedCdnList.timeouts.push(r),this.trigger("priorityChange",null)}},{key:"_innerGetCdnPreferenceForResource",value:function(e){var t=this,n=y(e.reduce(function(e,n){return t._downgradedCdnList.metadata.some(function(e){return e.id===n.id&&e.baseUrl===n.baseUrl})?e[1].push(n):e[0].push(n),e},[[],[]]),2),i=n[0],r=n[1];return i.concat(r)}},{key:"_removeIndexFromDowngradeList",value:function(e){this._downgradedCdnList.metadata.splice(e,1),clearTimeout(this._downgradedCdnList.timeouts.splice(e,1)[0])}}]),n}(ur),lf=function(){function e(){a(this,e),this._cache=new WeakMap}return u(e,[{key:"add",value:function(e,t){var n=e.representation;e.segment.isInit&&this._cache.set(n,t)}},{key:"get",value:function(e){var t=e.representation;if(e.segment.isInit){var n=this._cache.get(t);if(void 0!==n)return n}return null}}]),e}(),lv=ey(),lh=function(){function e(t){var n=t.prioritySteps;if(a(this,e),this._minPendingPriority=null,this._waitingQueue=[],this._pendingTasks=[],this._prioritySteps=n,this._prioritySteps.high>=this._prioritySteps.low)throw Error("TP: the max high level priority should be given a lowerpriority number than the min low priority.")}return u(e,[{key:"create",value:function(e,t,n,i){var r,a=this;return eK(i,function(o,s){return r={hasEnded:!1,priority:t,trigger:function(){if(!r.hasEnded){var e=function(){l(),a._endTask(r)},t=function(t){e(),s(t)},u=new uM,l=u.linkToSignal(i);r.interrupter=u,u.signal.register(function(){r.interrupter=null,i.isCancelled()||n.beforeInterrupted()}),a._minPendingPriority=null===a._minPendingPriority?r.priority:Math.min(a._minPendingPriority,r.priority),a._pendingTasks.push(r),r.taskFn(u.signal).then(function(t){n.beforeEnded(),e(),o(t)}).catch(function(e){!i.isCancelled()&&u.isUsed()&&v(e,uD)||t(e)})}},taskFn:e,interrupter:null},a._canBeStartedNow(r)?(r.trigger(),a._isRunningHighPriorityTasks()&&a._interruptCancellableTasks()):a._waitingQueue.push(r),function(){return a._endTask(r)}})}},{key:"_endTask",value:function(e){e.hasEnded=!0;var t=e$(e.taskFn,this._waitingQueue);if(t>=0)this._waitingQueue.splice(t,1);else{var n,i=e$(e.taskFn,this._pendingTasks);if(i<0)return;this._pendingTasks.splice(i,1),this._pendingTasks.length>0?this._minPendingPriority===e.priority&&(this._minPendingPriority=(n=Math).min.apply(n,S(this._pendingTasks.map(function(e){return e.priority})))):this._minPendingPriority=null,this._loopThroughWaitingQueue()}}},{key:"updatePriority",value:function(e,t){var n,i=e$(e,this._waitingQueue);if(i>=0){var r=this._waitingQueue[i];if(r.priority===t||(r.priority=t,!this._canBeStartedNow(r)))return;this._findAndRunWaitingQueueTask(i),this._isRunningHighPriorityTasks()&&this._interruptCancellableTasks();return}var a=e$(e,this._pendingTasks);if(a<0){uw.warn("TP: request to update the priority of a non-existent task");return}var o=this._pendingTasks[a];if(o.priority!==t){var s=o.priority;o.priority=t,null===this._minPendingPriority||t<this._minPendingPriority?this._minPendingPriority=t:this._minPendingPriority===s&&(1===this._pendingTasks.length?this._minPendingPriority=t:this._minPendingPriority=(n=Math).min.apply(n,S(this._pendingTasks.map(function(e){return e.priority}))),this._loopThroughWaitingQueue()),this._isRunningHighPriorityTasks()&&this._interruptCancellableTasks()}}},{key:"_loopThroughWaitingQueue",value:function(){var e=this._waitingQueue.reduce(function(e,t){return null===e||e>t.priority?t.priority:e},null);if(!(null===e||null!==this._minPendingPriority&&this._minPendingPriority<e))for(var t=0;t<this._waitingQueue.length;t++){var n=null===this._minPendingPriority?e:Math.min(this._minPendingPriority,e);this._waitingQueue[t].priority<=n&&(this._findAndRunWaitingQueueTask(t),t--)}}},{key:"_interruptCancellableTasks",value:function(){for(var e=0;e<this._pendingTasks.length;e++){var t=this._pendingTasks[e];if(t.priority>=this._prioritySteps.low)return this._interruptPendingTask(t),this._interruptCancellableTasks()}}},{key:"_findAndRunWaitingQueueTask",value:function(e){return e>=this._waitingQueue.length||e<0?(uw.warn("TP : Tried to start a non existing task"),!1):(this._waitingQueue.splice(e,1)[0].trigger(),!0)}},{key:"_interruptPendingTask",value:function(e){var t,n,i=e$(e.taskFn,this._pendingTasks);if(i<0){uw.warn("TP: Interrupting a non-existent pending task. Aborting...");return}this._pendingTasks.splice(i,1),this._waitingQueue.push(e),0===this._pendingTasks.length?this._minPendingPriority=null:this._minPendingPriority===e.priority&&(this._minPendingPriority=(t=Math).min.apply(t,S(this._pendingTasks.map(function(e){return e.priority})))),null==(n=e.interrupter)||n.cancel()}},{key:"_canBeStartedNow",value:function(e){return null===this._minPendingPriority||e.priority<=this._minPendingPriority}},{key:"_isRunningHighPriorityTasks",value:function(){return null!==this._minPendingPriority&&this._minPendingPriority<=this._prioritySteps.high}}]),e}(),lp=function(){function e(t,n,i){a(this,e);var r=new lc(i),o=uT.getCurrent(),s=o.MIN_CANCELABLE_PRIORITY,u=o.MAX_HIGH_PRIORITY_LEVEL;this._transport=t,this._prioritizer=new lh({prioritySteps:{high:u,low:s}}),this._cdnPrioritizer=r,this._backoffOptions=n}return u(e,[{key:"createSegmentFetcher",value:function(e,t){var n=eX(this._backoffOptions),i=this._transport[e],r=eQ(e,i,this._cdnPrioritizer,t,n);return eY(this._prioritizer,r)}}]),e}(),lm=function(){function e(t){a(this,e),this._array=[],this._sortingFn=t}return u(e,[{key:"add",value:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];t.sort(this._sortingFn);for(var i=0,r=0;r<t.length;r++){for(var a=t[r],o=!1;!o&&i<this._array.length;)0>this._sortingFn(a,this._array[i])?(this._array.splice(i,0,a),o=!0):i++;o||this._array.push(a)}}},{key:"length",value:function(){return this._array.length}},{key:"get",value:function(e){if(e<0||e>=this._array.length)throw Error("Invalid index.");return this._array[e]}},{key:"toArray",value:function(){return this._array.slice()}},{key:"findFirst",value:function(e){return j(this._array,e)}},{key:"has",value:function(e){return e_(this._array,e)}},{key:"removeElement",value:function(e){var t=this._array.indexOf(e);if(t>=0)return this._array.splice(t,1),t}},{key:"head",value:function(){return this._array[0]}},{key:"last",value:function(){return this._array[this._array.length-1]}},{key:"shift",value:function(){return this._array.shift()}},{key:"pop",value:function(){return this._array.pop()}}]),e}(),lg=function(e){f(n,e);var t=w(n);function n(e,i,r){a(this,n),(o=t.call(this))._canceller=new uM,o._manifest=e,o._activeStreams=new Map,o._allBufferTypes=r,o._lastCurrentPeriodId=null;var o,s=new ly(e);o._maximumPositionCalculator=s;var u=o._canceller.signal;return i.listen(function(t){var n=t.position.getWanted();if(n<e.getMinimumSafePosition()){var i=new u2("MEDIA_TIME_BEFORE_MANIFEST","The current position is behind the earliest time announced in the Manifest.");o.trigger("warning",i)}else if(n>s.getMaximumAvailablePosition()){var r=new u2("MEDIA_TIME_AFTER_MANIFEST","The current position is after the latest time announced in the Manifest.");o.trigger("warning",r)}},{includeLastObservation:!0,clearSignal:u}),e.addEventListener("manifestUpdate",function(){o.trigger("endingPositionChange",o._getManifestEndTime()),u.isCancelled()||o._checkEndOfStream()},u),m(o)}return u(n,[{key:"getCurrentEndingTime",value:function(){return this._getManifestEndTime()}},{key:"onAdaptationChange",value:function(e,t,n){if(this._manifest.isLastPeriodKnown){var i=this._manifest.periods[this._manifest.periods.length-1];if(t.id===(null==i?void 0:i.id)&&("audio"===e||"video"===e)){"audio"===e?this._maximumPositionCalculator.updateLastAudioAdaptation(n):this._maximumPositionCalculator.updateLastVideoAdaptation(n);var r=this._maximumPositionCalculator.getEndingPosition(),a=void 0!==r?{isEnd:!0,endingPosition:r}:{isEnd:!1,endingPosition:this._maximumPositionCalculator.getMaximumAvailablePosition()};this.trigger("endingPositionChange",a)}}this._canceller.isUsed()||null===n&&this._addActivelyLoadedPeriod(t,e)}},{key:"onRepresentationChange",value:function(e,t){this._addActivelyLoadedPeriod(t,e)}},{key:"onPeriodCleared",value:function(e,t){this._removeActivelyLoadedPeriod(t,e)}},{key:"onLastSegmentFinishedLoading",value:function(e){var t=this._lazilyCreateActiveStreamInfo(e);t.hasFinishedLoadingLastPeriod||(t.hasFinishedLoadingLastPeriod=!0,this._checkEndOfStream())}},{key:"onLastSegmentLoadingResume",value:function(e){var t=this._lazilyCreateActiveStreamInfo(e);t.hasFinishedLoadingLastPeriod&&(t.hasFinishedLoadingLastPeriod=!1,this._checkEndOfStream())}},{key:"dispose",value:function(){this.removeEventListener(),this._canceller.cancel()}},{key:"_addActivelyLoadedPeriod",value:function(e,t){var n=this._lazilyCreateActiveStreamInfo(t);n.activePeriods.has(e)||(n.activePeriods.add(e),this._checkCurrentPeriod())}},{key:"_removeActivelyLoadedPeriod",value:function(e,t){var n=this._activeStreams.get(t);void 0!==n&&n.activePeriods.has(e)&&(n.activePeriods.removeElement(e),this._checkCurrentPeriod())}},{key:"_checkCurrentPeriod",value:function(){if(0!==this._allBufferTypes.length){var e=this._activeStreams.get(this._allBufferTypes[0]),t=!0,n=!1,i=void 0;if(void 0!==e)try{for(var r,a=e.activePeriods.toArray()[Symbol.iterator]();!(t=(r=a.next()).done);t=!0){for(var o=r.value,s=!0,u=1;u<this._allBufferTypes.length;u++){var l=this._activeStreams.get(this._allBufferTypes[u]);if(void 0===l)return;if(!l.activePeriods.toArray().some(function(e){return e.id===o.id})){s=!1;break}}if(s){this._lastCurrentPeriodId!==o.id&&(this._lastCurrentPeriodId=o.id,this.trigger("periodChange",o));return}}}catch(e){n=!0,i=e}finally{try{t||null==a.return||a.return()}finally{if(n)throw i}}}}},{key:"_getManifestEndTime",value:function(){var e=this._maximumPositionCalculator.getEndingPosition();return void 0!==e?{isEnd:!0,endingPosition:e}:{isEnd:!1,endingPosition:this._maximumPositionCalculator.getMaximumAvailablePosition()}}},{key:"_lazilyCreateActiveStreamInfo",value:function(e){var t=this._activeStreams.get(e);return void 0===t&&(t={activePeriods:new lm(function(e,t){return e.start-t.start}),hasFinishedLoadingLastPeriod:!1},this._activeStreams.set(e,t)),t}},{key:"_checkEndOfStream",value:function(){var e=this;this._manifest.isLastPeriodKnown&&(this._allBufferTypes.every(function(t){var n=e._activeStreams.get(t);return void 0!==n&&n.hasFinishedLoadingLastPeriod})?this.trigger("endOfStream",null):this.trigger("resumeStream",null))}}]),n}(ur),ly=function(){function e(t){a(this,e),this._manifest=t,this._lastAudioAdaptation=void 0,this._lastVideoAdaptation=void 0}return u(e,[{key:"updateLastAudioAdaptation",value:function(e){this._lastAudioAdaptation=e}},{key:"updateLastVideoAdaptation",value:function(e){this._lastVideoAdaptation=e}},{key:"getMaximumAvailablePosition",value:function(){if(this._manifest.isDynamic||void 0===this._lastVideoAdaptation||void 0===this._lastAudioAdaptation)return this._manifest.getMaximumSafePosition();if(null===this._lastAudioAdaptation){if(null===this._lastVideoAdaptation)return this._manifest.getMaximumSafePosition();var e=eZ(this._lastVideoAdaptation);return"number"!=typeof e?this._manifest.getMaximumSafePosition():e}if(null===this._lastVideoAdaptation){var t=eZ(this._lastAudioAdaptation);return"number"!=typeof t?this._manifest.getMaximumSafePosition():t}var n=eZ(this._lastAudioAdaptation),i=eZ(this._lastVideoAdaptation);return"number"!=typeof n||"number"!=typeof i?this._manifest.getMaximumSafePosition():Math.min(n,i)}},{key:"getEndingPosition",value:function(){var e,t;if(!this._manifest.isDynamic)return this.getMaximumAvailablePosition();if(!(void 0===this._lastVideoAdaptation||void 0===this._lastAudioAdaptation)){if(null===this._lastAudioAdaptation)return null===this._lastVideoAdaptation?void 0:null!=(e=eJ(this._lastVideoAdaptation))?e:void 0;if(null===this._lastVideoAdaptation)return null!=(t=eJ(this._lastAudioAdaptation))?t:void 0;var n=eJ(this._lastAudioAdaptation),i=eJ(this._lastVideoAdaptation);return"number"!=typeof n||"number"!=typeof i?void 0:Math.min(n,i)}}}]),e}(),l_=function(){function e(t){a(this,e),this._segmentSinksStore=t,this._currentFreezeTimestamp=null}return u(e,[{key:"needToReload",value:function(e){var t=e.readyState,n=e.rebuffering,i=e.freezing;if((void 0!==e.bufferGap&&isFinite(e.bufferGap)?e.bufferGap:0)<6||null===n&&null===i||t>1)return this._currentFreezeTimestamp=null,!1;var r=uN();null===this._currentFreezeTimestamp&&(this._currentFreezeTimestamp=r);var a=null!==n&&r-n.timestamp>4e3,o=null!==i&&r-i.timestamp>4e3;if((a||o)&&uN()-this._currentFreezeTimestamp>4e3){for(var s=this._segmentSinksStore.getStatus("audio"),u=this._segmentSinksStore.getStatus("video"),l=!0,d=!0,c=!0,f=!1,v=void 0,h=0,p=[s,u];h<p.length;h++){var m=p[h];if("initialized"===m.type)try{for(var g,y=m.value.getLastKnownInventory()[Symbol.iterator]();!(c=(g=y.next()).done);c=!0){var _=g.value.infos.representation;if(!1===_.decipherable)return uw.warn("Init: we have undecipherable segments left in the buffer, reloading"),this._currentFreezeTimestamp=null,!0;void 0!==_.contentProtections&&(d=!1,!0!==_.decipherable&&(l=!1))}}catch(e){f=!0,v=e}finally{try{c||null==y.return||y.return()}finally{if(f)throw v}}}if(!d&&l)return uw.warn("Init: we are frozen despite only having decipherable segments left in the buffer, reloading"),this._currentFreezeTimestamp=null,!0}return!1}}]),e}();function lS(){return(lS=r(function(e,t,n,r,a,o){var s,u,l,d,c,f,v,h,p,m,g,y,_;return I(this,function(S){switch(S.label){case 0:if(!isFinite(r)&&!isFinite(a))return[2,Promise.resolve()];s=[],l=(u=N(n,t)).innerRange,d=u.outerRanges,c=function(){if(isFinite(r)){for(var e=0;e<d.length;e++){var n=d[e];t-r>=n.end?s.push(n):t>=n.end&&t-r>n.start&&t-r<n.end&&s.push({start:n.start,end:t-r})}i(l)||t-r>l.start&&s.push({start:l.start,end:t-r})}},f=function(){if(isFinite(a)){for(var e=0;e<d.length;e++){var n=d[e];t+a<=n.start?s.push(n):t<=n.start&&t+a<n.end&&t+a>n.start&&s.push({start:t+a,end:n.end})}i(l)||t+a<l.end&&s.push({start:t+a,end:l.end})}},c(),f(),v=!0,h=!1,p=void 0,S.label=1;case 1:S.trys.push([1,6,7,8]),m=s[Symbol.iterator](),S.label=2;case 2:if(v=(g=m.next()).done)return[3,5];if(!((y=g.value).start<y.end))return[3,4];if(uw.debug("GC: cleaning range from SegmentSink",y.start,y.end),null!==o.cancellationError)throw o.cancellationError;return[4,e.removeBuffer(y.start,y.end)];case 3:S.sent(),S.label=4;case 4:return v=!0,[3,2];case 5:return[3,8];case 6:return _=S.sent(),h=!0,p=_,[3,8];case 7:try{v||null==m.return||m.return()}finally{if(h)throw p}return[7];case 8:return[2]}})})).apply(this,arguments)}var lb=function(){function e(t,n){a(this,e),this._history=[],this._lifetime=t,this._maxHistoryLength=n}return u(e,[{key:"addBufferedSegment",value:function(e,t){var n=uN();this._history.push({date:n,buffered:t,context:e}),this._cleanHistory(n)}},{key:"getHistoryFor",value:function(e){return this._history.filter(function(t){return eB(t.context,e)})}},{key:"_cleanHistory",value:function(e){var t=e-this._lifetime,n=0,i=!0,r=!1,a=void 0;try{for(var o,s=this._history[Symbol.iterator]();!(i=(o=s.next()).done);i=!0)if(o.value.date<t)n++;else break}catch(e){r=!0,a=e}finally{try{i||null==s.return||s.return()}finally{if(r)throw a}}if(n>0&&(this._history=this._history.splice(n)),this._history.length>this._maxHistoryLength){var u=this._history.length-this._maxHistoryLength;this._history=this._history.splice(u)}}}]),e}(),lE=function(){function e(){a(this,e);var t=uT.getCurrent(),n=t.BUFFERED_HISTORY_RETENTION_TIME,i=t.BUFFERED_HISTORY_MAXIMUM_ENTRIES;this._inventory=[],this._bufferedHistory=new lb(n,i)}return u(e,[{key:"reset",value:function(){this._inventory.length=0}},{key:"synchronizeBuffered",value:function(e){for(var t=this._inventory,n=0,r=t[0],a=uT.getCurrent().MINIMUM_SEGMENT_SIZE,o=null==r?void 0:r.infos.adaptation.type,s=e.length,u=0;u<s;u++){if(void 0===r)return;var l=e[u].start,d=e[u].end;if(d-l<a){uw.warn("SI: skipped range when synchronizing because it was too small",o,l,d);continue}for(var c=n;void 0!==r&&(null!=(_=r.bufferedEnd)?_:r.end)-l<a;)r=t[++n];var f=null,v=n-c;if(v>0){var h=t[c+v-1];f={end:null!=(S=h.bufferedEnd)?S:h.end,precizeEnd:h.precizeEnd},uw.debug("SI: ".concat(v," segments GCed."),o);var p=t.splice(c,v),m=!0,g=!1,y=void 0;try{for(var _,S,b,E,k,T,w,I,A=p[Symbol.iterator]();!(m=(I=A.next()).done);m=!0){var R=I.value;void 0===R.bufferedStart&&void 0===R.bufferedEnd&&2!==R.status&&this._bufferedHistory.addBufferedSegment(R.infos,null)}}catch(e){g=!0,y=e}finally{try{m||null==A.return||A.return()}finally{if(g)throw y}}n=c}if(void 0===r)return;if(d-(null!=(b=r.bufferedStart)?b:r.start)>=a){if(e3(r,l,f,o),n===t.length-1){e8(r,d,o);return}for(var C=null!=(E=(r=t[++n]).bufferedStart)?E:r.start,M=null!=(k=r.bufferedEnd)?k:r.end,P=u<s-1?e[u+1].start:void 0;void 0!==r&&d-C>=a&&(void 0===P||d-C>=M-P);){var D=t[n-1];void 0===D.bufferedEnd&&(D.bufferedEnd=r.precizeStart?r.start:D.end,uw.debug("SI: calculating buffered end of contiguous segment",o,D.bufferedEnd,D.end)),r.bufferedStart=D.bufferedEnd,void 0!==(r=t[++n])&&(C=null!=(T=r.bufferedStart)?T:r.start,M=null!=(w=r.bufferedEnd)?w:r.end)}}var x=t[n-1];void 0!==x&&e8(x,d,o)}if(!i(r)){uw.debug("SI: last segments have been GCed",o,n,t.length);var N=t.splice(n,t.length-n),O=!0,L=!1,U=void 0;try{for(var F,B=N[Symbol.iterator]();!(O=(F=B.next()).done);O=!0){var V=F.value;void 0===V.bufferedStart&&void 0===V.bufferedEnd&&2!==V.status&&this._bufferedHistory.addBufferedSegment(V.infos,null)}}catch(e){L=!0,U=e}finally{try{O||null==B.return||B.return()}finally{if(L)throw U}}}void 0!==o&&uw.hasLevel("DEBUG")&&uw.debug("SI: current ".concat(o," inventory timeline:\n")+e6(this._inventory))}},{key:"insertChunk",value:function(e,t,n){var i=e.period,r=e.adaptation,a=e.representation,o=e.segment,s=e.chunkSize,u=e.start,l=e.end;if(!o.isInit){var d=r.type;if(u>=l){uw.warn("SI: Invalid chunked inserted: starts before it ends",d,u,l);return}for(var c=this._inventory,f={status:t?0:2,insertionTs:n,chunkSize:s,splitted:!1,start:u,end:l,precizeStart:!1,precizeEnd:!1,bufferedStart:void 0,bufferedEnd:void 0,infos:{segment:o,period:i,adaptation:r,representation:a}},v=c.length-1;v>=0;v--){var h=c[v];if(h.start<=u){if(h.end<=u){for(uw.debug("SI: Pushing segment strictly after previous one.",d,u,h.end),this._inventory.splice(v+1,0,f),v+=2;v<c.length&&c[v].start<f.end;){if(c[v].end>f.end){uw.debug("SI: Segment pushed updates the start of the next one",d,f.end,c[v].start),c[v].start=f.end,c[v].bufferedStart=void 0,c[v].precizeStart=c[v].precizeStart&&f.precizeEnd;break}uw.debug("SI: Segment pushed removes the next one",d,u,l,c[v].start,c[v].end),c.splice(v,1)}return}if(h.start===u){if(h.end<=l){for(uw.debug("SI: Segment pushed replace another one",d,u,l,h.end),this._inventory.splice(v,1,f),v+=1;v<c.length&&c[v].start<f.end;){if(c[v].end>f.end){uw.debug("SI: Segment pushed updates the start of the next one",d,f.end,c[v].start),c[v].start=f.end,c[v].bufferedStart=void 0,c[v].precizeStart=c[v].precizeStart&&f.precizeEnd;break}uw.debug("SI: Segment pushed removes the next one",d,u,l,c[v].start,c[v].end),c.splice(v,1)}return}uw.debug("SI: Segment pushed ends before another with the same start",d,u,l,h.end),c.splice(v,0,f),h.start=f.end,h.bufferedStart=void 0,h.precizeStart=h.precizeStart&&f.precizeEnd;return}if(h.end<=f.end){for(uw.debug("SI: Segment pushed updates end of previous one",d,u,l,h.start,h.end),this._inventory.splice(v+1,0,f),h.end=f.start,h.bufferedEnd=void 0,h.precizeEnd=h.precizeEnd&&f.precizeStart,v+=2;v<c.length&&c[v].start<f.end;){if(c[v].end>f.end){uw.debug("SI: Segment pushed updates the start of the next one",d,f.end,c[v].start),c[v].start=f.end,c[v].bufferedStart=void 0,c[v].precizeStart=c[v].precizeStart&&f.precizeEnd;break}uw.debug("SI: Segment pushed removes the next one",d,u,l,c[v].start,c[v].end),c.splice(v,1)}return}else{uw.warn("SI: Segment pushed is contained in a previous one",d,u,l,h.start,h.end);var p={status:h.status,insertionTs:h.insertionTs,chunkSize:h.chunkSize,splitted:!0,start:f.end,end:h.end,precizeStart:h.precizeStart&&h.precizeEnd&&f.precizeEnd,precizeEnd:h.precizeEnd,bufferedStart:void 0,bufferedEnd:h.end,infos:h.infos};h.end=f.start,h.splitted=!0,h.bufferedEnd=void 0,h.precizeEnd=h.precizeEnd&&f.precizeStart,c.splice(v+1,0,f),c.splice(v+2,0,p);return}}}var m=this._inventory[0];if(void 0===m){uw.debug("SI: first segment pushed",d,u,l),this._inventory.push(f);return}if(m.start>=l)uw.debug("SI: Segment pushed comes before all previous ones",d,u,l,m.start),this._inventory.splice(0,0,f);else if(m.end<=l){for(uw.debug("SI: Segment pushed starts before and completely recovers the previous first one",d,u,l,m.start,m.end),this._inventory.splice(0,1,f);c.length>1&&c[1].start<f.end;){if(c[1].end>f.end){uw.debug("SI: Segment pushed updates the start of the next one",d,f.end,c[1].start),c[1].start=f.end,c[1].bufferedStart=void 0,c[1].precizeStart=f.precizeEnd;break}uw.debug("SI: Segment pushed removes the next one",d,u,l,c[1].start,c[1].end),c.splice(1,1)}return}else{uw.debug("SI: Segment pushed start of the next one",d,u,l,m.start,m.end),m.start=l,m.bufferedStart=void 0,m.precizeStart=f.precizeEnd,this._inventory.splice(0,0,f);return}}}},{key:"completeSegment",value:function(e){if(!e.segment.isInit){for(var t=this._inventory,n=[],i=0;i<t.length;i++)if(eB(t[i].infos,e)){var r=!1;n.length>0&&(r=!0,1===n.length&&(uw.warn("SI: Completed Segment is splitted.",e.segment.id,e.segment.time,e.segment.end),n[0].splitted=!0));var a=i,o=t[i].chunkSize;for(i+=1;i<t.length&&eB(t[i].infos,e);){var s=t[i].chunkSize;void 0!==o&&void 0!==s&&(o+=s),i++}var u=i-1,l=u-a,d=t[u].end,c=t[u].bufferedEnd;l>0&&(this._inventory.splice(a+1,l),i-=l),0===this._inventory[a].status&&(this._inventory[a].status=1),this._inventory[a].chunkSize=o,this._inventory[a].end=d,this._inventory[a].bufferedEnd=c,this._inventory[a].splitted=r,n.push(this._inventory[a])}var f=!0,v=!1,h=void 0;if(0===n.length)uw.warn("SI: Completed Segment not found",e.segment.id,e.segment.time);else try{for(var p,m=n[Symbol.iterator]();!(f=(p=m.next()).done);f=!0){var g=p.value;void 0!==g.bufferedStart&&void 0!==g.bufferedEnd?2!==g.status&&this._bufferedHistory.addBufferedSegment(g.infos,{start:g.bufferedStart,end:g.bufferedEnd}):uw.debug("SI: buffered range not known after sync. Skipping history.",g.start,g.end)}}catch(e){v=!0,h=e}finally{try{f||null==m.return||m.return()}finally{if(v)throw h}}}}},{key:"getInventory",value:function(){return this._inventory}},{key:"getHistoryFor",value:function(e){return this._bufferedHistory.getHistoryFor(e)}}]),e}(),lk=function(){function e(){a(this,e),this._segmentInventory=new lE}return u(e,[{key:"synchronizeInventory",value:function(e){this._segmentInventory.synchronizeBuffered(e)}},{key:"getLastKnownInventory",value:function(){return this._segmentInventory.getInventory()}},{key:"getSegmentHistory",value:function(e){return this._segmentInventory.getHistoryFor(e)}}]),e}(),lT=function(e){f(n,e);var t=w(n);function n(e,i,r){a(this,n),o=t.call(this),uw.info("AVSB: calling `mediaSource.addSourceBuffer`",i);var o,s=r.addSourceBuffer(e,i);return o.bufferType=e,o._sourceBuffer=s,o._lastInitSegmentUniqueId=null,o.codec=i,o._initSegmentsMap=new Map,o._pendingOperations=[],m(o)}return u(n,[{key:"declareInitSegment",value:function(e,t){te(t),this._initSegmentsMap.set(e,t)}},{key:"freeInitSegment",value:function(e){this._initSegmentsMap.delete(e)}},{key:"pushChunk",value:function(e){var t=this;return r(function(){var n,i,r,a,o;return I(this,function(s){switch(s.label){case 0:te(e.data.chunk),uw.debug("AVSB: receiving order to push data to the SourceBuffer",t.bufferType,eV(e.inventoryInfos)),0===(n=t._getActualDataToPush(e.data)).length&&n.push(new Uint8Array),i=Promise.all(n.map(function(n){var i=e.data,r=i.codec,a=i.timestampOffset,o=i.appendWindow;return uw.debug("AVSB: pushing segment",t.bufferType,eV(e.inventoryInfos)),t._sourceBuffer.appendBuffer(n,{codec:r,timestampOffset:a,appendWindow:o})})),t._addToOperationQueue(i,{type:0,value:e}),s.label=1;case 1:return s.trys.push([1,3,,4]),[4,i];case 2:return r=s.sent(),[3,4];case 3:throw a=s.sent(),t._segmentInventory.insertChunk(e.inventoryInfos,!1,uN()),a;case 4:return null!==e.inventoryInfos&&t._segmentInventory.insertChunk(e.inventoryInfos,!0,uN()),o=r[r.length-1],[2,(t._segmentInventory.synchronizeBuffered(o),o)]}})})()}},{key:"removeBuffer",value:function(e,t){var n=this;return r(function(){var i,r;return I(this,function(a){switch(a.label){case 0:return uw.debug("AVSB: receiving order to remove data from the SourceBuffer",n.bufferType,e,t),i=n._sourceBuffer.remove(e,t),n._addToOperationQueue(i,{type:1,value:{start:e,end:t}}),[4,i];case 1:return r=a.sent(),[2,(n._segmentInventory.synchronizeBuffered(r),r)]}})})()}},{key:"signalSegmentComplete",value:function(e){var t=this;return r(function(){var n;return I(this,function(i){switch(i.label){case 0:if(!(t._pendingOperations.length>0))return[3,4];n=t._pendingOperations[t._pendingOperations.length-1].promise,t._addToOperationQueue(n,{type:2,value:e}),i.label=1;case 1:return i.trys.push([1,3,,4]),[4,n];case 2:case 3:return i.sent(),[3,4];case 4:return t._segmentInventory.completeSegment(e),[2]}})})()}},{key:"getPendingOperations",value:function(){return this._pendingOperations.map(function(e){return e.operation})}},{key:"dispose",value:function(){try{uw.debug("AVSB: Calling `dispose` on the SourceBufferInterface"),this._sourceBuffer.dispose()}catch(e){uw.debug("AVSB: Failed to dispose a ".concat(this.bufferType," SourceBufferInterface:"),v(e,Error)?e:"")}}},{key:"_getActualDataToPush",value:function(e){var t=[];if(null!==e.initSegmentUniqueId&&!this._isLastInitSegment(e.initSegmentUniqueId)){var n=this._initSegmentsMap.get(e.initSegmentUniqueId);if(void 0===n)throw Error("Invalid initialization segment uniqueId");var i=new Uint8Array(new ArrayBuffer(n.byteLength));i.set(new Uint8Array(v(n,ArrayBuffer)?n:n.buffer)),n=i,t.push(n),this._lastInitSegmentUniqueId=e.initSegmentUniqueId}return null!==e.chunk&&t.push(e.chunk),t}},{key:"_isLastInitSegment",value:function(e){return null!==this._lastInitSegmentUniqueId&&this._lastInitSegmentUniqueId===e}},{key:"_addToOperationQueue",value:function(e,t){var n=this,i={operation:t,promise:e};this._pendingOperations.push(i);var r=function(){var e=n._pendingOperations.indexOf(i);e>=0&&n._pendingOperations.splice(e,1)};e.then(r,r)}}]),n}(lk),lw=function(e){f(n,e);var t=w(n);function n(e){var i;return a(this,n),uw.debug("HTSB: Creating TextSegmentSink"),(i=t.call(this)).bufferType="text",i._sender=e,i._pendingOperations=[],i._sender.reset(),m(i)}return u(n,[{key:"declareInitSegment",value:function(e){uw.warn("HTSB: Declaring initialization segment for  Text SegmentSink",e)}},{key:"freeInitSegment",value:function(e){uw.warn("HTSB: Freeing initialization segment for  Text SegmentSink",e)}},{key:"pushChunk",value:function(e){var t=this;return r(function(){var n,i,r;return I(this,function(a){switch(a.label){case 0:return tt((n=e.data).chunk),i=t._sender.pushTextData(un(ut({},n),{chunk:n.chunk})),t._addToOperationQueue(i,{type:0,value:e}),[4,i];case 1:return r=a.sent(),[2,(null!==e.inventoryInfos&&t._segmentInventory.insertChunk(e.inventoryInfos,!0,uN()),t._segmentInventory.synchronizeBuffered(r),r)]}})})()}},{key:"removeBuffer",value:function(e,t){var n=this;return r(function(){var i,r;return I(this,function(a){switch(a.label){case 0:return i=n._sender.remove(e,t),n._addToOperationQueue(i,{type:1,value:{start:e,end:t}}),[4,i];case 1:return r=a.sent(),[2,(n._segmentInventory.synchronizeBuffered(r),r)]}})})()}},{key:"signalSegmentComplete",value:function(e){var t=this;return r(function(){var n;return I(this,function(i){switch(i.label){case 0:if(!(t._pendingOperations.length>0))return[3,4];n=t._pendingOperations[t._pendingOperations.length-1].promise,t._addToOperationQueue(n,{type:2,value:e}),i.label=1;case 1:return i.trys.push([1,3,,4]),[4,n];case 2:case 3:return i.sent(),[3,4];case 4:return t._segmentInventory.completeSegment(e),[2]}})})()}},{key:"getPendingOperations",value:function(){return this._pendingOperations.map(function(e){return e.operation})}},{key:"dispose",value:function(){uw.debug("HTSB: Disposing TextSegmentSink"),this._sender.reset()}},{key:"_addToOperationQueue",value:function(e,t){var n=this,i={operation:t,promise:e};this._pendingOperations.push(i);var r=function(){var e=n._pendingOperations.indexOf(i);e>=0&&n._pendingOperations.splice(e,1)};e.then(r,r)}}]),n}(lk);ui.CURRENT_ENV,ui.DEV;var lI=["audio","video","text"],lA=function(){function e(t,n,i){a(this,e),this._mediaSource=t,this._textInterface=i,this._hasVideo=n,this._initializedSegmentSinks={},this._onNativeBufferAddedOrDisabled=[]}return u(e,[{key:"getBufferTypes",value:function(){var e=this.getNativeBufferTypes();return null!==this._textInterface&&e.push("text"),e}},{key:"getNativeBufferTypes",value:function(){return this._hasVideo?["video","audio"]:["audio"]}},{key:"getStatus",value:function(e){var t=this._initializedSegmentSinks[e];return void 0===t?{type:"uninitialized"}:null===t?{type:"disabled"}:{type:"initialized",value:t}}},{key:"waitForUsableBuffers",value:function(e){var t=this;return this._areNativeBuffersUsable()?Promise.resolve():eK(e,function(e){var n,i=function(){var e=t._onNativeBufferAddedOrDisabled.indexOf(n);e>=0&&t._onNativeBufferAddedOrDisabled.splice(e,1)};return n=function(){t._areNativeBuffersUsable()&&(i(),e())},t._onNativeBufferAddedOrDisabled.push(n),i})}},{key:"disableSegmentSink",value:function(t){var n=this._initializedSegmentSinks[t];if(null===n){uw.warn("SBS: The ".concat(t," SegmentSink was already disabled."));return}if(void 0!==n)throw Error("Cannot disable an active SegmentSink.");this._initializedSegmentSinks[t]=null,e.isNative(t)&&this._onNativeBufferAddedOrDisabled.forEach(function(e){return e()})}},{key:"createSegmentSink",value:function(e,t){var n,r=this._initializedSegmentSinks[e];if(tn(e)){if(!i(r))return v(r,lT)&&r.codec!==t?uw.warn("SB: Reusing native SegmentSink with codec",r.codec,"for codec",t):uw.info("SB: Reusing native SegmentSink with codec",t),r;uw.info("SB: Adding native SegmentSink with codec",t);var a=new lT("audio"===e?"audio":"video",t,this._mediaSource);return this._initializedSegmentSinks[e]=a,this._onNativeBufferAddedOrDisabled.forEach(function(e){return e()}),a}if(!i(r))return uw.info("SB: Reusing a previous custom SegmentSink for the type",e),r;if("text"===e){if(uw.info("SB: Creating a new text SegmentSink"),null===this._textInterface)throw Error("HTML Text track feature not activated");return n=new lw(this._textInterface),this._initializedSegmentSinks.text=n,n}throw uw.error("SB: Unknown buffer type:",e),new u2("BUFFER_TYPE_UNKNOWN","The player wants to create a SegmentSink of an unknown type.")}},{key:"disposeSegmentSink",value:function(e){var t=this._initializedSegmentSinks[e];if(i(t)){uw.warn("SB: Trying to dispose a SegmentSink that does not exist");return}uw.info("SB: Aborting SegmentSink",e),t.dispose(),delete this._initializedSegmentSinks[e]}},{key:"disposeAll",value:function(){var e=this;lI.forEach(function(t){"initialized"===e.getStatus(t).type&&e.disposeSegmentSink(t)})}},{key:"_areNativeBuffersUsable",value:function(){var e=this,t=this.getNativeBufferTypes();return!(t.some(function(t){return void 0===e._initializedSegmentSinks[t]})||t.every(function(t){return null===e._initializedSegmentSinks[t]}))}}],[{key:"isNative",value:function(e){return tn(e)}}]),e}(),lR=function(){function e(t){a(this,e),this._weakMap=new WeakMap,this._fn=t}return u(e,[{key:"get",value:function(e){var t=this._weakMap.get(e);if(void 0!==t)return t;var n=this._fn(e);return this._weakMap.set(e,n),n}},{key:"destroy",value:function(e){this._weakMap.delete(e)}}]),e}(),lC=function(e){f(n,e);var t=w(n);function n(e,i,r,o){var s;return a(this,n),(s=t.call(this))._content=e,s._currentCanceller=null,s._downloadQueue=i,s._initSegmentRequest=null,s._mediaSegmentRequest=null,s._segmentFetcher=r,s._initSegmentInfoRef=new uR(void 0),s._mediaSegmentAwaitingInitMetadata=null,o||s._initSegmentInfoRef.setValue(null),m(s)}return u(n,[{key:"getRequestedInitSegment",value:function(){return null===this._initSegmentRequest?null:this._initSegmentRequest.segment}},{key:"getRequestedMediaSegment",value:function(){return null===this._mediaSegmentRequest?null:this._mediaSegmentRequest.segment}},{key:"start",value:function(){var e=this;null===this._currentCanceller&&(this._currentCanceller=new uM,this._downloadQueue.onUpdate(function(t){var n=t.segmentQueue;if(!(n.length>0)||n[0].segment.id!==e._mediaSegmentAwaitingInitMetadata){var i=e._mediaSegmentRequest;if(0===n.length){if(null===i)return;uw.debug("Stream: no more media segment to request. Cancelling queue.",e._content.adaptation.type),e._restartMediaSegmentDownloadingQueue();return}if(null===i){uw.debug("Stream: Media segments now need to be requested. Starting queue.",e._content.adaptation.type,n.length),e._restartMediaSegmentDownloadingQueue();return}var r=n[0];if(i.segment.id!==r.segment.id){uw.debug("Stream: Next media segment changed, cancelling previous",e._content.adaptation.type),e._restartMediaSegmentDownloadingQueue();return}i.priority!==r.priority&&(uw.debug("Stream: Priority of next media segment changed, updating",e._content.adaptation.type,i.priority,r.priority),e._segmentFetcher.updatePriority(i.request,r.priority));return}},{emitCurrentValue:!0,clearSignal:this._currentCanceller.signal}),this._downloadQueue.onUpdate(function(t){var n,i=e._initSegmentRequest;if(null!==t.initSegment&&null!==i){t.initSegment.priority!==i.priority&&e._segmentFetcher.updatePriority(i.request,t.initSegment.priority);return}(null==(n=t.initSegment)?void 0:n.segment.id)!==(null==i?void 0:i.segment.id)&&(null===t.initSegment&&uw.debug("Stream: no more init segment to request. Cancelling queue.",e._content.adaptation.type),e._restartInitSegmentDownloadingQueue(t.initSegment))},{emitCurrentValue:!0,clearSignal:this._currentCanceller.signal}))}},{key:"stop",value:function(){var e;null==(e=this._currentCanceller)||e.cancel(),this._currentCanceller=null}},{key:"_restartMediaSegmentDownloadingQueue",value:function(){var e=this;null!==this._mediaSegmentRequest&&this._mediaSegmentRequest.canceller.cancel();var t=this._downloadQueue.getValue().segmentQueue[0],n=function(t){if(null!==e._currentCanceller&&e._currentCanceller.isUsed()){e._mediaSegmentRequest=null;return}if(void 0===t){e._mediaSegmentRequest=null,e.trigger("emptyQueue",null);return}var i=new uM,r=null===e._currentCanceller?s:i.linkToSignal(e._currentCanceller.signal),a=t.segment,o=t.priority,u=uk({segment:a},e._content),l=!1,d=!1;i.signal.register(function(){e._mediaSegmentRequest=null,l||(e._mediaSegmentAwaitingInitMetadata===a.id&&(e._mediaSegmentAwaitingInitMetadata=null),l=!0,d=!1)});var c=function(t){W("media"===t.segmentType,"Should have loaded a media segment."),e.trigger("parsedMediaSegment",uk({},t,{segment:a}))},f=function(){var t=e._downloadQueue.getValue().segmentQueue;if(0===t.length){l=!0,e.trigger("emptyQueue",null);return}t[0].segment.id===a.id&&t.shift(),l=!0,n(t[0])},v=e._segmentFetcher.createRequest(u,o,{onRetry:function(t){e.trigger("requestRetry",{segment:a,error:t})},beforeInterrupted:function(){uw.info("Stream: segment request interrupted temporarly.",a.id,a.time)},onChunk:function(t){var n=e._initSegmentInfoRef.getValue();void 0!==n?c(t(null!=n?n:void 0)):(d=!0,e._initSegmentInfoRef.waitUntilDefined(function(e){c(t(null!=e?e:void 0))},{clearSignal:i.signal}))},onAllChunksReceived:function(){d?(e._mediaSegmentAwaitingInitMetadata=a.id,e._initSegmentInfoRef.waitUntilDefined(function(){e._mediaSegmentAwaitingInitMetadata=null,d=!1,e.trigger("fullyLoadedSegment",a)},{clearSignal:i.signal})):e.trigger("fullyLoadedSegment",a)},beforeEnded:function(){r(),e._mediaSegmentRequest=null,d?e._initSegmentInfoRef.waitUntilDefined(f,{clearSignal:i.signal}):f()}},i.signal);v.catch(function(t){r(),l||(l=!0,e.stop(),e.trigger("error",t))}),e._mediaSegmentRequest={segment:a,priority:o,request:v,canceller:i}};n(t)}},{key:"_restartInitSegmentDownloadingQueue",value:function(e){var t=this;if(!(null!==this._currentCanceller&&this._currentCanceller.isUsed())&&(null!==this._initSegmentRequest&&this._initSegmentRequest.canceller.cancel(),null!==e)){var n=new uM,i=null===this._currentCanceller?s:n.linkToSignal(this._currentCanceller.signal),r=e.segment,a=e.priority,o=uk({segment:r},this._content),u=!1,l=this._segmentFetcher.createRequest(o,a,{onRetry:function(e){t.trigger("requestRetry",{segment:r,error:e})},beforeInterrupted:function(){uw.info("Stream: init segment request interrupted temporarly.",r.id)},beforeEnded:function(){i(),t._initSegmentRequest=null,u=!0},onChunk:function(e){var n,i=e(void 0);W("init"===i.segmentType,"Should have loaded an init segment."),t.trigger("parsedInitSegment",uk({},i,{segment:r})),"init"===i.segmentType&&t._initSegmentInfoRef.setValue(null!=(n=i.initTimescale)?n:null)},onAllChunksReceived:function(){t.trigger("fullyLoadedSegment",r)}},n.signal);l.catch(function(e){i(),u||(u=!0,t.stop(),t.trigger("error",e))}),n.signal.register(function(){t._initSegmentRequest=null,u||(u=!0)}),this._initSegmentRequest={segment:r,priority:a,request:l,canceller:n}}}}]),n}(ur);function lM(){return(lM=r(function(e,t,n,i,r){var a,o,s,u,l;return I(this,function(d){switch(d.label){case 0:return d.trys.push([0,2,,10]),[4,t.pushChunk(n)];case 1:return[2,d.sent()];case 2:if(a=d.sent(),r.isCancelled()&&v(a,uD))throw a;if(!v(a,u3)||!a.isBufferFull)throw new u2("BUFFER_APPEND_ERROR",v(a,Error)?a.toString():"An unknown error happened when pushing content",{tracks:[eN(n.inventoryInfos.adaptation)]});o=e.getReference().getValue().position.getWanted(),d.label=3;case 3:return d.trys.push([3,8,,9]),uw.warn("Stream: Running garbage collector"),s=Math.max(o-5,0),u=o+i.getValue()+12,[4,t.removeBuffer(0,s)];case 4:return d.sent(),[4,t.removeBuffer(u,Number.MAX_VALUE)];case 5:return d.sent(),[4,tb(200)];case 6:if(d.sent(),null!==r.cancellationError)throw r.cancellationError;return[4,t.pushChunk(n)];case 7:return[2,d.sent()];case 8:if(v(l=d.sent(),uD))throw l;throw new u2("BUFFER_FULL_ERROR",v(l,Error)?l.toString():"Could not clean the buffer",{tracks:[eN(n.inventoryInfos.adaptation)]});case 9:return[3,10];case 10:return[2]}})})).apply(this,arguments)}function lP(){return(lP=r(function(e,t){var n,i,r,a,o,s,u;return I(this,function(l){switch(l.label){case 0:if(n=e.playbackObserver,i=e.content,r=e.initSegmentUniqueId,a=e.segment,o=e.segmentSink,s=e.bufferGoal,null!==t.cancellationError)throw t.cancellationError;return[4,tE(n,o,{data:{initSegmentUniqueId:r,chunk:null,timestampOffset:0,appendWindow:[void 0,void 0],codec:i.representation.getMimeTypeString()},inventoryInfos:uk({segment:a,chunkSize:void 0,start:0,end:0},i)},s,t)];case 1:return u=l.sent(),[2,{content:i,segment:a,buffered:u}]}})})).apply(this,arguments)}function lD(){return(lD=r(function(e,t){var n,i,r,a,o,s,u,l,d,c,f,v,h,p,m,g,y,_,S,b,E,k;return I(this,function(T){switch(T.label){case 0:if(n=e.playbackObserver,i=e.bufferGoal,r=e.content,a=e.initSegmentUniqueId,o=e.parsedSegment,s=e.segment,u=e.segmentSink,null===o.chunkData)return[2,null];if(null!==t.cancellationError)throw t.cancellationError;return c=o.chunkData,f=o.chunkInfos,v=o.chunkOffset,h=o.chunkSize,p=o.appendWindow,m=r.representation.getMimeTypeString(),g=uT.getCurrent().APPEND_WINDOW_SECURITIES,_={initSegmentUniqueId:a,chunk:c,timestampOffset:v,appendWindow:y=[void 0!==p[0]?Math.max(0,p[0]-g.START):void 0,void 0!==p[1]?p[1]+g.END:void 0],codec:m},S=null!=(l=null==f?void 0:f.time)?l:s.time,b=null!=(d=null==f?void 0:f.duration)?d:s.duration,E=S+b,void 0!==y[0]&&(S=Math.max(S,y[0])),void 0!==y[1]&&(E=Math.min(E,y[1])),[4,tE(n,u,{data:_,inventoryInfos:uk({segment:s,chunkSize:h,start:S,end:E},r)},i,t)];case 1:return k=T.sent(),[2,{content:r,segment:s,buffered:k}]}})})).apply(this,arguments)}var lx=function(e,t,n){var i=e.content,r=e.options,a=e.playbackObserver,o=e.segmentSink,s=e.segmentFetcher,u=e.terminate,l=i.period,d=i.adaptation,c=i.representation,f=r.bufferGoal,h=r.maxBufferSize,p=r.drmSystemId,m=r.fastSwitchThreshold,g=d.type,y=new uM;y.linkToSignal(n);var _=new uM;_.linkToSignal(y.signal);var S={segment:c.index.getInitSegment(),uniqueId:null,isLoaded:!1};y.signal.register(function(){null!==S.uniqueId&&o.freeInitSegment(S.uniqueId)});var b=new uR({initSegment:null,segmentQueue:[]},_.signal),E=null!==S.segment;E||(S.isLoaded=!0);var k=!1;if(void 0!==p){var T=c.getEncryptionData(p);if(T.length>0&&T.every(function(e){return void 0!==e.keyIds})&&(k=!0,t.encryptionDataEncountered(T.map(function(e){return uk({content:i},e)})),y.isUsed()))return}var w=new lC(i,b,s,E);function I(){if(!_.isUsed()){var e=a.getReference().getValue(),n=e.position.getWanted(),r=tg(i,n,a,m.getValue(),f.getValue(),h.getValue(),o),s=r.neededSegments,d=null;if(c.index.isInitialized()){if(s.length>0&&!S.isLoaded&&null!==S.segment){var v=s[0].priority;d={segment:S.segment,priority:v}}}else if(null===S.segment)uw.warn("Stream: Uninitialized index without an initialization segment");else if(S.isLoaded)uw.warn("Stream: Uninitialized index with an already loaded initialization segment");else{var p=e.position.getWanted();d={segment:S.segment,priority:tm(l.start,p)}}var y=u.getValue();if(null===y)b.setValue({initSegment:d,segmentQueue:s});else if(y.urgent){uw.debug("Stream: Urgent switch, terminate now.",g),b.setValue({initSegment:null,segmentQueue:[]}),b.finish(),_.cancel(),t.terminating();return}else{var E=s[0],k=w.getRequestedInitSegment(),T=w.getRequestedMediaSegment(),I=null===T||void 0===E||T.id!==E.segment.id?[]:[E],A=null===k?null:d;if(b.setValue({initSegment:A,segmentQueue:I}),0===I.length&&null===A){uw.debug("Stream: No request left, terminate",g),b.finish(),_.cancel(),t.terminating();return}}if(t.streamStatusUpdate({period:l,position:e.position.getWanted(),bufferType:g,imminentDiscontinuity:r.imminentDiscontinuity,isEmptyStream:!1,hasFinishedLoading:r.hasFinishedLoading,neededSegments:r.neededSegments}),!_.signal.isCancelled()){var C=uT.getCurrent().UPTO_CURRENT_POSITION_CLEANUP;if(r.isBufferFull){var M=Math.max(0,n-C);M>0&&o.removeBuffer(0,M).catch(R)}r.shouldRefreshManifest&&t.needsManifestRefresh()}}}function A(e){if(!y.isUsed()){var n=!0,r=!1,s=void 0;try{for(var u,l=e.protectionData[Symbol.iterator]();!(n=(u=l.next()).done);n=!0){var d=u.value;c.addProtectionData(d.initDataType,d.keyId,d.initData)}}catch(e){r=!0,s=e}finally{try{n||null==l.return||l.return()}finally{if(r)throw s}}if(!k){var v=c.getAllEncryptionData();if(v.length>0&&(t.encryptionDataEncountered(v.map(function(e){return uk({content:i},e)})),k=!0,y.isUsed()))return}if("init"===e.segmentType){if(c.index.isInitialized()||void 0===e.segmentList||c.index.initialize(e.segmentList),S.isLoaded=!0,null!==e.initializationData){var h=c.uniqueId;S.uniqueId=h,o.declareInitSegment(h,e.initializationData),(function(e,t){return lP.apply(this,arguments)})({playbackObserver:a,bufferGoal:f,content:i,initSegmentUniqueId:h,segment:e.segment,segmentData:e.initializationData,segmentSink:o},y.signal).then(function(e){null!==e&&t.addedSegment(e)}).catch(R)}I();return}var p=e.inbandEvents,m=e.predictedSegments,g=e.needsManifestRefresh;void 0!==m&&c.index.addPredictedSegments(m,e.segment),!0===g&&(t.needsManifestRefresh(),y.isUsed())||void 0!==p&&p.length>0&&(t.inbandEvent(p),y.isUsed())||(function(e,t){return lD.apply(this,arguments)})({playbackObserver:a,bufferGoal:f,content:i,initSegmentUniqueId:S.uniqueId,parsedSegment:e,segment:e.segment,segmentSink:o},y.signal).then(function(e){null!==e&&t.addedSegment(e)}).catch(R)}}function R(e){y.isUsed()&&v(e,uD)||(y.cancel(),t.error(e))}w.addEventListener("error",function(e){_.signal.isCancelled()||(y.cancel(),t.error(e))}),w.addEventListener("parsedInitSegment",A),w.addEventListener("parsedMediaSegment",A),w.addEventListener("emptyQueue",I),w.addEventListener("requestRetry",function(e){if(t.warning(e.error),!_.signal.isCancelled()){var n=e.segment,i=c.index;!1===i.isSegmentStillAvailable(n)?I():i.canBeOutOfSyncError(e.error,n)&&t.manifestMightBeOufOfSync()}}),w.addEventListener("fullyLoadedSegment",function(e){o.signalSegmentComplete(uk({segment:e},i)).catch(R)}),w.start(),_.signal.register(function(){w.removeEventListener(),w.stop()}),a.listen(I,{includeLastObservation:!1,clearSignal:_.signal}),i.manifest.addEventListener("manifestUpdate",I,_.signal),f.onUpdate(I,{emitCurrentValue:!1,clearSignal:_.signal}),h.onUpdate(I,{emitCurrentValue:!1,clearSignal:_.signal}),u.onUpdate(I,{emitCurrentValue:!1,clearSignal:_.signal}),I()},lN=function(e,t,n){var i,a=e.playbackObserver,o=e.content,u=e.options,l=e.representationEstimator,d=e.segmentSink,c=e.segmentFetcherCreator,f=e.wantedBufferAhead,v=e.maxVideoBufferSize,h=o.manifest,p=o.period,m=o.adaptation,g=new uM;g.linkToSignal(n);var y,_=new Map,S=new uR(null,g.signal),b=o.representations.getValue().representationIds,E=new uR(o.adaptation.representations.filter(function(e){return e_(b,e.id)&&!1!==e.decipherable&&!1!==e.isSupported}),g.signal),k=l({manifest:h,period:p,adaptation:m},S,E,a,g.signal),T=k.estimates,w=k.callbacks,A=c.createSegmentFetcher(m.type,{onRequestBegin:w.requestBegin,onRequestEnd:w.requestEnd,onProgress:w.requestProgress,onMetrics:w.metrics}),R=new uR(0);function C(){return(C=r(function(e,n){var i,r,o,l,c,y,b,E;return I(this,function(k){switch(k.label){case 0:switch((i=tk(p,m,e,d,a)).type){case"continue":return[3,1];case"needs-reload":return[3,2];case"flush-buffer":case"clean-buffer":return[3,3]}return[3,12];case 1:return[3,13];case 2:return[2,uu(function(){a.listen(function(){if(!n.isCancelled()){var e=uT.getCurrent().DELTA_POSITION_AFTER_RELOAD.bitrateSwitch;return t.waitingMediaSourceReload({bufferType:m.type,period:p,timeOffset:e,stayInPeriod:!0})}},{includeLastObservation:!0,clearSignal:n})})];case 3:r=!0,o=!1,l=void 0,k.label=4;case 4:k.trys.push([4,9,10,11]),c=i.value[Symbol.iterator](),k.label=5;case 5:if(r=(y=c.next()).done)return[3,8];return b=y.value,[4,d.removeBuffer(b.start,b.end)];case 6:if(k.sent(),n.isCancelled())return[2];k.label=7;case 7:return r=!0,[3,5];case 8:return[3,11];case 9:return E=k.sent(),o=!0,l=E,[3,11];case 10:try{r||null==c.return||c.return()}finally{if(o)throw l}return[7];case 11:if("flush-buffer"===i.type&&(t.needsBufferFlush(),n.isCancelled()))return[2];return[3,13];case 12:H(i),k.label=13;case 13:return function e(n){var i=new uM;i.linkToSignal(n);var r=T.getValue().representation;if(null!==r){var o=new uR(null,i.signal);T.onUpdate(function(e){if(!(null===e.representation||e.representation.id===r.id))return e.urgent?(uw.info("Stream: urgent Representation switch",m.type),o.setValue({urgent:!0})):(uw.info("Stream: slow Representation switch",m.type),o.setValue({urgent:!1}))},{clearSignal:i.signal,emitCurrentValue:!0});var l={type:m.type,adaptation:m,period:p,representation:r};S.setValue(r),g.isUsed()||(t.representationChange(l),g.isUsed())||function e(n,i,r,o){var l=new uM;l.linkToSignal(o);var c=K(f,function(e){var t,i;return e*(i=void 0!==(t=_.get(n.id))?t:1,void 0===t&&_.set(n.id,i),i)},l.signal),y="video"===m.type?v:new uR(1/0);uw.info("Stream: changing representation",m.type,n.id,n.bitrate);var S=uk({},r,{error:function(t){var a,u=eh(t,{defaultCode:"NONE",defaultReason:"Unknown `RepresentationStream` error"});if("BUFFER_FULL_ERROR"!==u.code)r.error(t);else{var l=f.getValue(),d=(null!=(a=_.get(n.id))?a:1)*.7;if(d<=.05||l*d<=2)throw u;_.set(n.id,d),eW(4e3,g.signal).then(function(){return e(n,i,r,o)}).catch(s)}},terminating:function(){l.cancel(),r.terminating()}});lx({playbackObserver:a,content:{representation:n,adaptation:m,period:p,manifest:h},segmentSink:d,segmentFetcher:A,terminate:i,options:{bufferGoal:c,maxBufferSize:y,drmSystemId:u.drmSystemId,fastSwitchThreshold:R}},S,o),h.addEventListener("manifestUpdate",function(e){var i=!0,r=!1,a=void 0;try{for(var s,u=e.updatedPeriods[Symbol.iterator]();!(i=(s=u.next()).done);i=!0){var l=s.value;if(l.period.id===p.id){var d=!0,c=!1,f=void 0;try{for(var v,h=l.result.updatedAdaptations[Symbol.iterator]();!(d=(v=h.next()).done);d=!0){var g=v.value;if(g.adaptation===m.id){var y=!0,_=!1,S=void 0;try{for(var b,E=g.removedRepresentations[Symbol.iterator]();!(y=(b=E.next()).done);y=!0)if(b.value===n.id)return o.isCancelled()?void 0:t.waitingMediaSourceReload({bufferType:m.type,period:p,timeOffset:0,stayInPeriod:!0})}catch(e){_=!0,S=e}finally{try{y||null==E.return||E.return()}finally{if(_)throw S}}}}}catch(e){c=!0,f=e}finally{try{d||null==h.return||h.return()}finally{if(c)throw f}}}else if(l.period.start>p.start)break}}catch(e){r=!0,a=e}finally{try{i||null==u.return||u.return()}finally{if(r)throw a}}},o)}(r,o,{streamStatusUpdate:t.streamStatusUpdate,encryptionDataEncountered:t.encryptionDataEncountered,manifestMightBeOufOfSync:t.manifestMightBeOufOfSync,needsManifestRefresh:t.needsManifestRefresh,inbandEvent:t.inbandEvent,warning:t.warning,error:function(e){g.cancel(),t.error(e)},addedSegment:function(e){w.addedSegment(e)},terminating:function(){if(!i.isUsed())return i.cancel(),e(n)}},n)}}(n),[2]}})})).apply(this,arguments)}T.onUpdate(function(e){var n=e.bitrate,i=e.knownStableBitrate;u.enableFastSwitching&&R.setValueIfChanged(i),void 0===n||n===y||(y=n,uw.debug("Stream: new ".concat(m.type," bitrate estimate"),n),t.bitrateEstimateChange({type:m.type,bitrate:n}))},{emitCurrentValue:!0,clearSignal:g.signal}),o.representations.onUpdate(function(e){void 0!==i&&i.cancel();var n=o.representations.getValue().representationIds,r=o.adaptation.representations.filter(function(e){return e_(n,e.id)});E.setValueIfChanged(r),(i=new uM).linkToSignal(g.signal),(function(e,t){return C.apply(this,arguments)})(e,i.signal).catch(function(e){(null==i?void 0:i.isUsed())===!0&&uM.isCancellationError(e)||(g.cancel(),t.error(e))})},{clearSignal:g.signal,emitCurrentValue:!0})},lO=function(e,t){var n=_(e.split(";")),i=n[0],r=n.slice(1),a=_(t.split(";")),o=a[0],s=a.slice(1);if(i!==o)return!1;var u=j(r,function(e){return tT(e,"codecs=")}),l=j(s,function(e){return tT(e,"codecs=")});if(void 0===u||void 0===l)return!1;var d=u.substring(7),c=l.substring(7);return d.split(".")[0]===c.split(".")[0]},lL=function(e,t,n){var i=e.bufferType,a=e.content,o=e.garbageCollectors,s=e.playbackObserver,u=e.representationEstimator,l=e.segmentFetcherCreator,d=e.segmentSinksStore,c=e.options,f=e.wantedBufferAhead,h=e.maxVideoBufferSize,p=a.manifest,m=a.period,g=new uR(void 0,n);if(t.periodStreamReady({type:i,manifest:p,period:m,adaptationRef:g}),!n.isCancelled()){var y,_=!0;g.onUpdate(function(e){r(function(){var r,a,g,b,E,k,T,w,A,R,C,M,P,D,x,N,O,U,F,B,V;return I(this,function(I){switch(I.label){case 0:if(void 0===e)return[2];if((a=new uM).linkToSignal(n),null==y||y.cancel(),y=a,null!==e)return[3,6];if(uw.info("Stream: Set no ".concat(i," Adaptation. P:"),m.start),"initialized"!==(g=d.getStatus(i)).type)return[3,4];if(uw.info("Stream: Clearing previous ".concat(i," SegmentSink")),lA.isNative(i))return[2,S(0,!0,a.signal)];if(b=null!=(r=m.end)?r:1/0,!(m.start>b))return[3,1];return uw.warn("Stream: Can't free buffer: period's start is after its end"),[3,3];case 1:return[4,g.value.removeBuffer(m.start,b)];case 2:if(I.sent(),a.isUsed())return[2];I.label=3;case 3:return[3,5];case 4:if("uninitialized"===g.type&&(d.disableSegmentSink(i),a.isUsed()))return[2];I.label=5;case 5:return[2,(t.adaptationChange({type:i,adaptation:null,period:m}),a.isUsed()?void 0:tC(s,f,i,{period:m},t,a.signal))];case 6:if(void 0===(k=j(null!=(E=m.adaptations[i])?E:[],function(t){return t.id===e.adaptationId})))return y.cancel(),uw.warn("Stream: Unfound chosen Adaptation choice",e.adaptationId),[2];if(T=uT.getCurrent().DELTA_POSITION_AFTER_RELOAD,w=!1,_)A=0;else if(void 0!==e.relativeResumingPosition)A=e.relativeResumingPosition;else switch(w=!0,i){case"audio":A=T.trackSwitch.audio;break;case"video":A=T.trackSwitch.video;break;default:A=T.trackSwitch.other}if(_=!1,lA.isNative(i)&&"disabled"===d.getStatus(i).type)return[2,S(A,!0,a.signal)];if(p.addEventListener("manifestUpdate",function(e){var t=!0,n=!1,i=void 0;try{for(var r,o=e.updatedPeriods[Symbol.iterator]();!(t=(r=o.next()).done);t=!0){var s=r.value;if(s.period.id===m.id){var u=!0,l=!1,d=void 0;try{for(var c,f=s.result.removedAdaptations[Symbol.iterator]();!(u=(c=f.next()).done);u=!0)if(c.value.id===k.id)return S(A,!0,a.signal)}catch(e){l=!0,d=e}finally{try{u||null==f.return||f.return()}finally{if(l)throw d}}}else if(s.period.start>m.start)break}}catch(e){n=!0,i=e}finally{try{t||null==o.return||o.return()}finally{if(n)throw i}}},y.signal),R=e.representations,uw.info("Stream: Updating ".concat(i," adaptation"),"A: ".concat(k.id),"P: ".concat(m.start)),t.adaptationChange({type:i,adaptation:k,period:m}),a.isUsed())return[2];if("needs-reload"===(M=tw(C=tA(d,i,k),m,k,e.switchingMode,s,c)).type)return[2,S(A,!0,a.signal)];return[4,d.waitForUsableBuffers(a.signal)];case 7:if(I.sent(),a.isUsed())return[3,17];if(!("flush-buffer"===M.type||"clean-buffer"===M.type))return[3,16];P=!0,D=!1,x=void 0,I.label=8;case 8:I.trys.push([8,13,14,15]),N=M.value[Symbol.iterator](),I.label=9;case 9:if(P=(O=N.next()).done)return[3,12];return F=(U=O.value).start,B=U.end,[4,C.removeBuffer(F,B)];case 10:if(I.sent(),a.isUsed())return[2];I.label=11;case 11:return P=!0,[3,9];case 12:return[3,15];case 13:return V=I.sent(),D=!0,x=V,[3,15];case 14:try{P||null==N.return||N.return()}finally{if(D)throw x}return[7];case 15:if("flush-buffer"===M.type&&(t.needsBufferFlush({relativeResumingPosition:A,relativePosHasBeenDefaulted:w}),a.isUsed()))return[2];I.label=16;case 16:var z,K,W,G,H;o.get(C)(a.signal),z=k,K=R,W=C,G=a.signal,H=z.type,lN({content:{manifest:p,period:m,adaptation:z,representations:K},options:c,playbackObserver:s.deriveReadOnlyObserver(function(e,t){var n=new uR(i(),t);return e.onUpdate(function(){n.setValue(i())},{clearSignal:t,emitCurrentValue:!1}),n;function i(){var t=e.getValue(),n=t.buffered[H],i=null!==n?L(n,t.position.getWanted()):0;return uk({},t,{bufferGap:i,buffered:n})}}),representationEstimator:u,segmentSink:W,segmentFetcherCreator:l,wantedBufferAhead:f,maxVideoBufferSize:h},un(ut({},t),{error:function(e){if(!lA.isNative(i)){uw.error("Stream: ".concat(i," Stream crashed. Aborting it."),v(e,Error)?e:""),d.disposeSegmentSink(i);var n=eh(e,{defaultCode:"NONE",defaultReason:"Unknown `AdaptationStream` error"});return t.warning(n),G.isCancelled()?void 0:tC(s,f,i,{period:m},t,G)}uw.error("Stream: ".concat(i," Stream crashed. Stopping playback."),v(e,Error)?e:""),t.error(e)}}),G),I.label=17;case 17:return[2]}})})().catch(function(e){v(e,uD)||(null==y||y.cancel(),t.error(e))})},{clearSignal:n,emitCurrentValue:!0})}function S(e,n,r){uu(function(){s.listen(function(){r.isCancelled()||t.waitingMediaSourceReload({bufferType:i,period:m,timeOffset:e,stayInPeriod:n})},{includeLastObservation:!0,clearSignal:r})})}},lU=function(e,t,n,a,o,s,u,l){var d=e.manifest,c=e.initialPeriod,f=s.maxBufferAhead,v=s.maxBufferBehind,h=s.wantedBufferAhead,p=s.maxVideoBufferSize,m=uT.getCurrent(),g=m.MINIMUM_MAX_BUFFER_AHEAD,y=m.MAXIMUM_MAX_BUFFER_AHEAD,_=m.MAXIMUM_MAX_BUFFER_BEHIND,b=new lR(function(e){var n,i,r=e.bufferType,a=null!=(n=_[r])?n:1/0,o=null!=(i=y[r])?i:1/0;return function(n){e1({segmentSink:e,playbackObserver:t,maxBufferBehind:K(v,function(e){return Math.min(e,a)},n),maxBufferAhead:K(f,function(e){var t;return Math.min(Math.max(e,null!=(t=g[r])?t:0),o)},n)},n)}}),E=!0,k=!1,T=void 0;try{for(var w,A=a.getBufferTypes()[Symbol.iterator]();!(E=(w=A.next()).done);E=!0){var R=w.value;!function(e,c){var f=new lm(function(e,t){return e.start-t.start}),v=!1,m=new uM;return m.linkToSignal(l),t.listen(function(t){var n,r=t.position.getWanted();if(v&&function(e){var t=f.head(),n=f.last();return void 0===t||void 0===n||t.start>e||(i(n.end)?1/0:n.end)<e}(r)){for(uw.info("Stream: Destroying all PeriodStreams due to out of bounds situation",e,r),v=!1;f.length()>0;){var a=f.get(f.length()-1);f.removeElement(a),u.periodStreamCleared({type:e,manifest:d,period:a})}m.cancel(),(m=new uM).linkToSignal(l);var o=null!=(n=d.getPeriodForTime(r))?n:d.getNextPeriod(r);if(void 0===o){uw.warn("Stream: The wanted position is not found in the Manifest."),v=!0;return}g(o)}},{clearSignal:l,includeLastObservation:!0}),d.addEventListener("decipherabilityUpdate",function(e){l.isCancelled()||(function(e){return y.apply(this,arguments)})(e).catch(function(e){l.isCancelled()||(m.cancel(),u.error(e))})},l),g(c);function g(i){!function e(i,r,l,c){uw.info("Stream: Creating new Stream for",i,r.start);var f=null,v=new uM;v.linkToSignal(c),t.listen(function(e,t){var n=e.position;if(void 0!==r.end&&n.getWanted()>=r.end){var a=d.getPeriodAfter(r);if(r.containsTime(n.getWanted(),a))return;uw.info("Stream: Destroying PeriodStream as the current playhead moved above it",i,r.start,n.getWanted(),r.end),t(),l.periodStreamCleared({type:i,manifest:d,period:r}),v.cancel()}},{clearSignal:c,includeLastObservation:!0});var m=un(ut({},l),{streamStatusUpdate:function(t){if(t.hasFinishedLoading){var n=d.getPeriodAfter(r);null!==n&&function(t){if(null!==f){if(f.period.id===t.id)return;uw.warn("Stream: Creating next `PeriodStream` while one was already created.",i,t.id,f.period.id),l.periodStreamCleared({type:i,manifest:d,period:f.period}),f.canceller.cancel()}var n=new uM;n.linkToSignal(c),f={canceller:n,period:t},e(i,t,l,f.canceller.signal)}(n)}else null!==f&&(uw.info("Stream: Destroying next PeriodStream due to current one being active",i,f.period.start),l.periodStreamCleared({type:i,manifest:d,period:f.period}),f.canceller.cancel(),f=null);l.streamStatusUpdate(t)},error:function(e){null!==f&&(f.canceller.cancel(),f=null),v.cancel(),l.error(e)}});lL({bufferType:i,content:{manifest:d,period:r},garbageCollectors:b,maxVideoBufferSize:p,segmentFetcherCreator:o,segmentSinksStore:a,options:s,playbackObserver:t,representationEstimator:n,wantedBufferAhead:h},m,v.signal),function(e){d.addEventListener("manifestUpdate",function(t){var n=!0,a=!1,o=void 0;try{for(var s,c=t.removedPeriods[Symbol.iterator]();!(n=(s=c.next()).done);n=!0){var v=s.value;if(v.id===r.id){if(d.periods.length>0&&d.periods[0].start<=v.start)return uu(function(){if(!e.isCancelled())return u.needsMediaSourceReload({timeOffset:0,minimumPosition:void 0,maximumPosition:void 0})})}else if(v.start>r.start)break}}catch(e){a=!0,o=e}finally{try{n||null==c.return||c.return()}finally{if(a)throw o}}if(t.addedPeriods.length>0&&null!==f){var h=d.getPeriodAfter(r);(null===h||f.period.id!==h.id)&&(uw.warn("Stream: Destroying next PeriodStream due to new one being added",i,f.period.start),l.periodStreamCleared({type:i,manifest:d,period:f.period}),f.canceller.cancel(),f=null)}},e)}(v.signal)}(e,i,un(ut({},u),{waitingMediaSourceReload:function(e){var t=f.head();void 0===t||t.id!==e.period.id?u.lockedStream({bufferType:e.bufferType,period:e.period}):u.needsMediaSourceReload({timeOffset:e.timeOffset,minimumPosition:e.stayInPeriod?e.period.start:void 0,maximumPosition:e.stayInPeriod?e.period.end:void 0})},periodStreamReady:function(e){v=!0,f.add(e.period),u.periodStreamReady(e)},periodStreamCleared:function(e){f.removeElement(e.period),u.periodStreamCleared(e)},error:function(e){m.cancel(),u.error(e)}}),m.signal)}function y(){return(y=r(function(n){var i,r,o,s,c,h,p,y,_,b,E,k,T,w,A,R,C;return I(this,function(I){switch(I.label){case 0:if(i=a.getStatus(e),0===(r=n.filter(function(t){return t.adaptation.type===e})).length||"initialized"!==i.type||r.every(function(e){return!0===e.representation.decipherable}))return[2];for(o=i.value,s=r.filter(function(e){return void 0===e.representation.decipherable}),c=r.filter(function(e){return!1===e.representation.decipherable}),h=tM(o,c),p=tM(o,s),v=!1,uw.info("Stream: Destroying all PeriodStreams for decipherability matters",e);f.length()>0;)y=f.get(f.length()-1),f.removeElement(y),u.periodStreamCleared({type:e,manifest:d,period:y});m.cancel(),(m=new uM).linkToSignal(l),_=!0,b=!1,E=void 0,I.label=1;case 1:I.trys.push([1,6,7,8]),k=S(h).concat(S(p))[Symbol.iterator](),I.label=2;case 2:if(_=(T=k.next()).done)return[3,5];if(A=(w=T.value).start,R=w.end,l.isCancelled())return[2];if(!(A<R))return[3,4];if(l.isCancelled())return[2];return[4,o.removeBuffer(A,R)];case 3:I.sent(),I.label=4;case 4:return _=!0,[3,2];case 5:return[3,8];case 6:return C=I.sent(),b=!0,E=C,[3,8];case 7:try{_||null==k.return||k.return()}finally{if(b)throw E}return[7];case 8:return uu(function(){if(!l.isCancelled()){var e=t.getReference().getValue();if(tP(e,h)){if(u.needsDecipherabilityFlush(),l.isCancelled())return}else if(tP(e,p)&&(u.needsBufferFlush(),l.isCancelled()))return;var n=e.position.getWanted(),i=d.getPeriodForTime(n);if(void 0===i){u.error(new u2("MEDIA_TIME_NOT_FOUND","The wanted position is not found in the Manifest."));return}g(i)}}),[2]}})})).apply(this,arguments)}}(R,c)}}catch(e){k=!0,T=e}finally{try{E||null==A.return||A.return()}finally{if(k)throw T}}},lF={createAsync:function(e){var t=null;return e.then(function(e){t=e},s),{syncValue:t,getValueAsAsync:function(){return e}}}},lB=new WeakMap,lV={setState:function(e,t){lB.set(e,t)},getState:function(e){var t=lB.get(e);return void 0===t?null:t},clearState:function(e){lB.set(e,null)}};function lz(){return(lz=r(function(e){var t,n;return I(this,function(i){switch(i.label){case 0:if(null===(t=lV.getState(e)))return[2];return uw.info("DRM: Disposing of the current MediaKeys"),n=t.loadedSessionsStore,lV.clearState(e),[4,n.closeAllSessions()];case 1:return[2,(i.sent(),tD(t.emeImplementation,e,null))]}})})).apply(this,arguments)}var lK=function(){function e(t,n,i){a(this,e),this._keyType=t,this._mediaKeys=n,this._configuration=i}return u(e,[{key:"keySystem",get:function(){return this._keyType}},{key:"createMediaKeys",value:function(){var e=this;return new Promise(function(t){return t(e._mediaKeys)})}},{key:"getConfiguration",value:function(){return this._configuration}}]),e}(),lW=["","webkit","moz","ms"];tF(["loadedmetadata"]),tF(["timeupdate"]),tF(["addtrack"]),tF(["removetrack"]);var lG,lH,lq,lY,lj=tF(["sourceopen","webkitsourceopen"]),lQ=tF(["sourceclose","webkitsourceclose"]),lX=tF(["sourceended","webkitsourceended"]),l$=tF(["update"]),lZ=tF(["removesourcebuffer"]),lJ=tF(["keymessage","message"]),l0=tF(["keyadded","ready"]),l1=tF(["keyerror","error"]),l2=tF(["keystatuseschange"]),l5=tF(["seeking"]),l4=tF(["seeked"]),l3=tF(["ended"]),l8=us.MSMediaKeys;void 0!==l8&&void 0!==l8.prototype&&"function"==typeof l8.isTypeSupported&&"function"==typeof l8.prototype.createSession&&(lY=l8);var l6,l9=function(e){f(n,e);var t=w(n);function n(e){var i;return a(this,n),(i=t.call(this)).expiration=NaN,i.keyStatuses=new Map,i._mk=e,i._sessionClosingCanceller=new uM,i.closed=new Promise(function(e){i._sessionClosingCanceller.signal.register(function(){return e()})}),i.update=function(e){return new Promise(function(t,n){if(void 0===i._ss)return n("MediaKeySession not set.");try{t(i._ss.update(e,""))}catch(e){n(e)}})},m(i)}return u(n,[{key:"generateRequest",value:function(e,t){var n=this;return new Promise(function(e){var i;v(t,Uint8Array)?i=t:i=new Uint8Array(v(t,ArrayBuffer)?t:t.buffer),n._ss=n._mk.createSession("video/mp4",i),lJ(n._ss,function(e){var t;n.trigger(null!=(t=e.type)?t:"message",e)},n._sessionClosingCanceller.signal),l0(n._ss,function(e){var t;n.trigger(null!=(t=e.type)?t:"keyadded",e)},n._sessionClosingCanceller.signal),l1(n._ss,function(e){var t;n.trigger(null!=(t=e.type)?t:"keyerror",e)},n._sessionClosingCanceller.signal),e()})}},{key:"close",value:function(){var e=this;return new Promise(function(t){i(e._ss)||(e._ss.close(),e._ss=void 0),e._sessionClosingCanceller.cancel(),t()})}},{key:"load",value:function(){return Promise.resolve(!1)}},{key:"remove",value:function(){return Promise.resolve()}},{key:"sessionId",get:function(){var e,t;return null!=(t=null==(e=this._ss)?void 0:e.sessionId)?t:""}}]),n}(ur),l7=function(){function e(t){if(a(this,e),void 0===lY)throw Error("No MSMediaKeys API.");this._mediaKeys=new lY(t)}return u(e,[{key:"_setVideo",value:function(e){var t=this;return tL(function(){t._videoElement=e,void 0!==t._videoElement.msSetMediaKeys&&t._videoElement.msSetMediaKeys(t._mediaKeys)})}},{key:"createSession",value:function(){if(void 0===this._videoElement||void 0===this._mediaKeys)throw Error("Video not attached to the MediaKeys");return new l9(this._mediaKeys)}},{key:"setServerCertificate",value:function(){throw Error("Server certificate is not implemented in your browser")}}]),e}(),de=us.MozMediaKeys;void 0!==de&&void 0!==de.prototype&&"function"==typeof de.isTypeSupported&&"function"==typeof de.prototype.createSession&&(l6=de);var dt,dn=["A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","0","1","2","3","4","5","6","7","8","9","+","/"],di=[255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,255,62,255,255,255,63,52,53,54,55,56,57,58,59,60,61,255,255,255,0,255,255,255,0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,255,255,255,255,255,255,26,27,28,29,30,31,32,33,34,35,36,37,38,39,40,41,42,43,44,45,46,47,48,49,50,51],dr="object"==typeof us&&"function"==typeof us.TextDecoder,da="object"==typeof us&&"function"==typeof us.TextEncoder,ds=function(e){f(n,e);var t=w(n);function n(e,i){a(this,n),(r=t.call(this))._vid=e,r._key=i,r.sessionId="",r._closeSession=s,r.keyStatuses=new Map,r.expiration=NaN;var r,o=function(e){r.trigger(e.type,e)};return r.closed=new Promise(function(t){r._closeSession=function(){["keymessage","message","keyadded","ready","keyerror","error"].forEach(function(t){e.removeEventListener(t,o),e.removeEventListener("webkit".concat(t),o)}),t()}}),["keymessage","message","keyadded","ready","keyerror","error"].forEach(function(t){e.addEventListener(t,o),e.addEventListener("webkit".concat(t),o)}),m(r)}return u(n,[{key:"update",value:function(e){var t=this;return new Promise(function(n,i){try{if(t._key.indexOf("clearkey")>=0){var r=v(e,ArrayBuffer)?new Uint8Array(e):e,a=JSON.parse(tJ(r)),o=tY(a.keys[0].k),s=tY(a.keys[0].kid);n(t._vid.webkitAddKey(t._key,o,s,""))}else n(t._vid.webkitAddKey(t._key,e,null,""))}catch(e){i(e)}})}},{key:"generateRequest",value:function(e,t){var n=this;return new Promise(function(e){n._vid.webkitGenerateKeyRequest(n._key,t),e()})}},{key:"close",value:function(){var e=this;return new Promise(function(t){e._closeSession(),t()})}},{key:"load",value:function(){return Promise.resolve(!1)}},{key:"remove",value:function(){return Promise.resolve()}}]),n}(ur),du=function(){function e(t){a(this,e),this._keySystem=t}return u(e,[{key:"_setVideo",value:function(e){var t=this;return tL(function(){if(!t4(e))throw Error("Video not attached to the MediaKeys");t._videoElement=e})}},{key:"createSession",value:function(){if(i(this._videoElement))throw Error("Video not attached to the MediaKeys");return new ds(this._videoElement,this._keySystem)}},{key:"setServerCertificate",value:function(){throw Error("Server certificate is not implemented in your browser")}}]),e}(),dl=us.WebKitMediaKeys;void 0!==dl&&"function"==typeof dl.isTypeSupported&&"function"==typeof dl.prototype.createSession&&"function"==typeof HTMLMediaElement.prototype.webkitSetMediaKeys&&(dt=dl);var dd=function(e){f(n,e);var t=w(n);function n(e,i,r){var o;return a(this,n),(o=t.call(this))._serverCertificate=r,o._videoElement=e,o._keyType=i,o._unbindSession=s,o._closeSession=s,o.closed=new Promise(function(e){o._closeSession=e}),o.keyStatuses=new Map,o.expiration=NaN,m(o)}return u(n,[{key:"update",value:function(e){var t=this;return new Promise(function(n,i){if(void 0===t._nativeSession||void 0===t._nativeSession.update||"function"!=typeof t._nativeSession.update)return i("Unavailable WebKit key session.");try{var r;v(e,ArrayBuffer)?r=new Uint8Array(e):v(e,Uint8Array)?r=e:r=new Uint8Array(e.buffer),n(t._nativeSession.update(r))}catch(e){i(e)}})}},{key:"generateRequest",value:function(e,t){var n=this;return new Promise(function(e){var i,r,a=n._videoElement;if((null==(i=a.webkitKeys)?void 0:i.createSession)===void 0)throw Error("No WebKitMediaKeys API.");if(tT(n._keyType,"com.apple.fps")){if(void 0===n._serverCertificate)throw Error("A server certificate is needed for creating fairplay session.");r=nr(t,n._serverCertificate)}else r=t;var o=a.webkitKeys.createSession("video/mp4",r);if(null==o)throw Error("Impossible to get the key sessions");n._listenEvent(o),n._nativeSession=o,e()})}},{key:"close",value:function(){var e=this;return new Promise(function(t,n){if(e._unbindSession(),e._closeSession(),void 0===e._nativeSession){n("No session to close.");return}e._nativeSession.close(),t()})}},{key:"load",value:function(){return Promise.resolve(!1)}},{key:"remove",value:function(){return Promise.resolve()}},{key:"sessionId",get:function(){var e,t;return null!=(t=null==(e=this._nativeSession)?void 0:e.sessionId)?t:""}},{key:"_listenEvent",value:function(e){var t=this;this._unbindSession();var n=function(e){t.trigger(e.type,e)};["keymessage","message","keyadded","ready","keyerror","error"].forEach(function(t){e.addEventListener(t,n),e.addEventListener("webkit".concat(t),n)}),this._unbindSession=function(){["keymessage","message","keyadded","ready","keyerror","error"].forEach(function(t){e.removeEventListener(t,n),e.removeEventListener("webkit".concat(t),n)})}}}]),n}(ur),dc=function(){function e(t){if(a(this,e),void 0===dt)throw Error("No WebKitMediaKeys API.");this._keyType=t,this._mediaKeys=new dt(t)}return u(e,[{key:"_setVideo",value:function(e){if(this._videoElement=e,void 0===this._videoElement)throw Error("Video not attached to the MediaKeys");return na(this._videoElement,this._mediaKeys)}},{key:"createSession",value:function(){if(void 0===this._videoElement||void 0===this._mediaKeys)throw Error("Video not attached to the MediaKeys");return new dd(this._videoElement,this._keyType,this._serverCertificate)}},{key:"setServerCertificate",value:function(e){return this._serverCertificate=e,Promise.resolve()}}]),e}(),df=function(e){var t,n,r,a,o,s,u,l=ns;if("standard"!==e&&("auto"!==e||(uv||uh)&&void 0!==dt)||!uo&&i(navigator.requestMediaKeySystemAccess)){if("webkit"===e&&void 0!==dt){s=tF(["needkey"]);var d=no();t=d.isTypeSupported,n=d.createCustomMediaKeys,l=d.setMediaKeys,u="webkit"}else if(t4(null==(a=us.HTMLVideoElement)?void 0:a.prototype)){s=tF(["needkey"]);var c={isTypeSupported:function(e){var t=document.querySelector("video");return i(t)&&(t=document.createElement("video")),!i(t)&&"function"==typeof t.canPlayType&&!!t.canPlayType("video/mp4",e)},createCustomMediaKeys:function(e){return new du(e)},setMediaKeys:function(e,t){if(null===t)return Promise.resolve(void 0);if(!v(t,du))throw Error("Custom setMediaKeys is supposed to be called with old webkit custom MediaKeys.");return t._setVideo(e)}};t=c.isTypeSupported,n=c.createCustomMediaKeys,l=c.setMediaKeys,u="older-webkit"}else if(void 0!==dt){s=tF(["needkey"]);var f=no();t=f.isTypeSupported,n=f.createCustomMediaKeys,l=f.setMediaKeys,u="webkit"}else if(ud&&void 0!==lY){s=tF(["encrypted","needkey"]);var h={isTypeSupported:function(e,t){if(void 0===lY)throw Error("No MSMediaKeys API.");return void 0!==t?lY.isTypeSupported(e,t):lY.isTypeSupported(e)},createCustomMediaKeys:function(e){return new l7(e)},setMediaKeys:function(e,t){if(null===t)return Promise.resolve(void 0);if(!v(t,l7))throw Error("Custom setMediaKeys is supposed to be called with IE11 custom MediaKeys.");return t._setVideo(e)}};t=h.isTypeSupported,n=h.createCustomMediaKeys,l=h.setMediaKeys,u="ms"}else if(void 0!==l6){s=tF(["encrypted","needkey"]);var p={isTypeSupported:function(e,t){if(void 0===l6)throw Error("No MozMediaKeys API.");return void 0!==t?l6.isTypeSupported(e,t):l6.isTypeSupported(e)},createCustomMediaKeys:function(e){if(void 0===l6)throw Error("No MozMediaKeys API.");return new l6(e)},setMediaKeys:function(e,t){return tL(function(){if(void 0===e.mozSetMediaKeys||"function"!=typeof e.mozSetMediaKeys)throw Error("Can't set video on MozMediaKeys.");return e.mozSetMediaKeys(t)})}};t=p.isTypeSupported,n=p.createCustomMediaKeys,l=p.setMediaKeys,u="moz"}else{s=tF(["encrypted","needkey"]);var m=us.MediaKeys,g=function(){if(void 0===m)throw new u2("MEDIA_KEYS_NOT_SUPPORTED","No `MediaKeys` implementation found in the current browser.");if(void 0===m.isTypeSupported)throw Error("This browser seems to be unable to play encrypted contents currently.Note: Some browsers do not allow decryption in some situations, like when not using HTTPS.")};t=function(e){return g(),W("function"==typeof m.isTypeSupported),m.isTypeSupported(e)},n=function(e){return g(),new m(e)},u="unknown"}o=function(e,r){if(!t(e))return Promise.reject(Error("Unsupported key type"));for(var a=0;a<r.length;a++){var o=r[a],s=o.videoCapabilities,u=o.audioCapabilities,l=o.initDataTypes,d=o.distinctiveIdentifier;if((i(l)||l.some(function(e){return"cenc"===e}))&&"required"!==d){var c={initDataTypes:["cenc"],distinctiveIdentifier:"not-allowed",persistentState:"required",sessionTypes:["temporary","persistent-license"]};void 0!==s&&(c.videoCapabilities=s),void 0!==u&&(c.audioCapabilities=u);var f=n(e);return Promise.resolve(new lK(e,f,c))}}return Promise.reject(Error("Unsupported configuration"))}}else o=function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return(r=navigator).requestMediaKeySystemAccess.apply(r,S(t))},s=tF(["encrypted"]),u="standard";return{requestMediaKeySystemAccess:o,onEncrypted:s,setMediaKeys:l,implementation:u}}("auto"),dv="function"==typeof Uint8Array.prototype.slice?function(e,t,n){return e.slice(t,n)}:function(e,t,n){return new Uint8Array(Array.prototype.slice.call(e,t,n))},dh=4294967295,dp={},dm=t9(tX("pssh"),0);function dg(){return(dg=r(function(e,t){var n;return I(this,function(i){switch(i.label){case 0:return uw.info("DRM: Load persisted session",t),[4,e.load(t)];case 1:return[2,(n=i.sent())&&!(e.keyStatuses.size>0)?new Promise(function(t){var i=function(){r(),t(n)},r=function(){clearTimeout(a),e.removeEventListener("keystatuseschange",i)};e.addEventListener("keystatuseschange",i);var a=setTimeout(i,100)}):n]}})})).apply(this,arguments)}var dy=df;function d_(){return(d_=r(function(e,t,n){var i,r,a,o,s,u;return I(this,function(l){switch(l.label){case 0:return i=t.emeImplementation,r=t.keySystemOptions,a=t.loadedSessionsStore,o=t.mediaKeySystemAccess,s=t.mediaKeys,[4,null!==(u=lV.getState(e))&&u.loadedSessionsStore!==a?u.loadedSessionsStore.closeAllSessions():Promise.resolve()];case 1:if(l.sent(),n.isCancelled())throw n.cancellationError;if(lV.setState(e,{emeImplementation:i,keySystemOptions:r,mediaKeySystemAccess:o,mediaKeys:s,loadedSessionsStore:a}),e.mediaKeys!==s)return[2,(uw.info("DRM: Attaching MediaKeys to the media element"),tD(i,e,s).then(function(){uw.info("DRM: MediaKeys attached with success")}).catch(function(e){throw new u1("MEDIA_KEYS_ATTACHMENT_ERROR","Could not attach the MediaKeys to the media element: "+(v(e,Error)?e.toString():"Unknown Error"))}))];return[2]}})})).apply(this,arguments)}function dS(){return(dS=r(function(e,t,n,i){var a,o,s,u;function l(){return d.apply(this,arguments)}function d(){return(d=r(function(){var r,o;return I(this,function(s){switch(s.label){case 0:if(null!==i.cancellationError)throw i.cancellationError;uw.info("DRM: Removing previous persistent session."),null!==(r=t.get(n))&&t.delete(r.sessionId),s.label=1;case 1:return s.trys.push([1,3,,4]),[4,e.closeSession(a.mediaKeySession)];case 2:return s.sent(),[3,4];case 3:if(o=s.sent(),""!==a.mediaKeySession.sessionId)throw o;return e.removeSessionWithoutClosingIt(a.mediaKeySession),[3,4];case 4:if(null!==i.cancellationError)throw i.cancellationError;return[2,{type:"created-session",value:e.createSession(n,"persistent-license")}]}})})).apply(this,arguments)}return I(this,function(r){switch(r.label){case 0:if(null!==i.cancellationError)throw i.cancellationError;if(uw.info("DRM: Creating persistent MediaKeySession"),a=e.createSession(n,"persistent-license"),null===(o=t.getAndReuse(n)))return[2,{type:"created-session",value:a}];r.label=1;case 1:return r.trys.push([1,3,,4]),[4,e.loadPersistentSession(a.mediaKeySession,o.sessionId)];case 2:if(!(s=r.sent()))return uw.warn("DRM: No data stored for the loaded session"),t.delete(o.sessionId),e.removeSessionWithoutClosingIt(a.mediaKeySession),[2,{type:"created-session",value:e.createSession(n,"persistent-license")}];return[2,s&&nK(a.mediaKeySession)?(t.add(n,n.keyIds,a.mediaKeySession),uw.info("DRM: Succeeded to load persistent session."),{type:"loaded-persistent-session",value:a}):(uw.warn("DRM: Previous persistent session not usable anymore."),l())];case 3:return u=r.sent(),[2,(uw.warn("DRM: Unable to load persistent session: "+(v(u,Error)?u.toString():"Unknown Error")),l())];case 4:return[2]}})})).apply(this,arguments)}function db(){return(db=r(function(e,t){var n,i,r,a,o;return I(this,function(s){switch(s.label){case 0:if(t<0||t>=e.getLength())return[2];for(uw.info("DRM: LSS cache limit exceeded",t,e.getLength()),n=[],r=(i=e.getAll().slice()).length-t,a=0;a<r;a++)o=i[a],n.push(e.closeSession(o.mediaKeySession));return[4,Promise.all(n)];case 1:return s.sent(),[2]}})})).apply(this,arguments)}function dE(){return(dE=r(function(e,t,n,i,r){var a,o,s,u,l,d,c;return I(this,function(f){switch(f.label){case 0:if(a=null,o=t.loadedSessionsStore,s=t.persistentSessionsStore,null!==(u=o.reuse(e))){if(nK(a=u.mediaKeySession))return[2,(uw.info("DRM: Reuse loaded session",a.sessionId),{type:"loaded-open-session",value:{mediaKeySession:a,sessionType:u.sessionType,keySessionRecord:u.keySessionRecord}})];null!==s&&""!==u.mediaKeySession.sessionId&&s.delete(u.mediaKeySession.sessionId)}if(!(d=null!==a))return[3,2];return[4,o.closeSession(a)];case 1:f.sent(),d=null!==r.cancellationError,f.label=2;case 2:if(l=d)return[3,4];return[4,function(e,t){return db.apply(this,arguments)}(o,i)];case 3:f.sent(),l=null!==r.cancellationError,f.label=4;case 4:if(l)throw r.cancellationError;return[4,nW(t,e,n,r)];case 5:return[2,{type:(c=f.sent()).type,value:{mediaKeySession:c.value.mediaKeySession,sessionType:c.value.sessionType,keySessionRecord:c.value.keySessionRecord}}]}})})).apply(this,arguments)}var dk=function(){function e(t){a(this,e),this._initializationData=t,this._keyIds=null}return u(e,[{key:"associateKeyIds",value:function(e){null===this._keyIds&&(this._keyIds=[]);var t=Array.from(e),n=!0,i=!1,r=void 0;try{for(var a,o=t[Symbol.iterator]();!(n=(a=o.next()).done);n=!0){var s=a.value;this.isAssociatedWithKeyId(s)||this._keyIds.push(s)}}catch(e){i=!0,r=e}finally{try{n||null==o.return||o.return()}finally{if(i)throw r}}}},{key:"isAssociatedWithKeyId",value:function(e){if(null===this._keyIds)return!1;var t=!0,n=!1,i=void 0;try{for(var r,a=this._keyIds[Symbol.iterator]();!(t=(r=a.next()).done);t=!0){var o=r.value;if(eg(o,e))return!0}}catch(e){n=!0,i=e}finally{try{t||null==a.return||a.return()}finally{if(n)throw i}}return!1}},{key:"getAssociatedKeyIds",value:function(){return null===this._keyIds?[]:this._keyIds}},{key:"isCompatibleWith",value:function(e){var t=e.keyIds;if(void 0!==t&&t.length>0){if(null!==this._keyIds&&n$(t,this._keyIds))return!0;if(void 0!==this._initializationData.keyIds)return n$(t,this._initializationData.keyIds)}return this._checkInitializationDataCompatibility(e)}},{key:"_checkInitializationDataCompatibility",value:function(e){return void 0!==e.keyIds&&e.keyIds.length>0&&void 0!==this._initializationData.keyIds?n$(e.keyIds,this._initializationData.keyIds):this._initializationData.type===e.type&&this._initializationData.values.isCompatibleWith(e.values)}}]),e}(),dT=function(){function e(t){a(this,e),this._mediaKeys=t,this._storage=[]}return u(e,[{key:"createSession",value:function(e,t){var n=this,r=new dk(e);uw.debug("DRM-LSS: calling `createSession`",t);var a=this._mediaKeys.createSession(t),o={mediaKeySession:a,sessionType:t,keySessionRecord:r,isGeneratingRequest:!1,isLoadingPersistentSession:!1,closingStatus:{type:"none"}};return i(a.closed)||a.closed.then(function(){uw.info("DRM-LSS: session was closed, removing it.",a.sessionId);var e=n.getIndex(r);e>=0&&n._storage[e].mediaKeySession===a&&n._storage.splice(e,1)}).catch(function(e){uw.warn("DRM-LSS: MediaKeySession.closed rejected: ".concat(e))}),this._storage.push(ut({},o)),uw.debug("DRM-LSS: MediaKeySession added",o.sessionType,this._storage.length),o}},{key:"reuse",value:function(e){for(var t=this._storage.length-1;t>=0;t--){var n=this._storage[t];if(n.keySessionRecord.isCompatibleWith(e))return this._storage.splice(t,1),this._storage.push(n),uw.debug("DRM-LSS: Reusing session:",n.mediaKeySession.sessionId,n.sessionType),ut({},n)}return null}},{key:"getEntryForSession",value:function(e){for(var t=this._storage.length-1;t>=0;t--){var n=this._storage[t];if(n.mediaKeySession===e)return ut({},n)}return null}},{key:"generateLicenseRequest",value:function(e,t,n){var i=this;return r(function(){var r,a,o,s,u,l,d,c;return I(this,function(f){switch(f.label){case 0:a=!0,o=!1,s=void 0;try{for(u=i._storage[Symbol.iterator]();!(a=(l=u.next()).done);a=!0)if((d=l.value).mediaKeySession===e){r=d;break}}catch(e){o=!0,s=e}finally{try{a||null==u.return||u.return()}finally{if(o)throw s}}if(void 0===r)return[2,(uw.error("DRM-LSS: generateRequest error. No MediaKeySession found with the given initData and initDataType"),nL(e,t,n))];if(r.isGeneratingRequest=!0,"none"!==r.closingStatus.type)throw Error("The `MediaKeySession` is being closed.");f.label=1;case 1:return f.trys.push([1,3,,4]),[4,nL(e,t,n)];case 2:return f.sent(),[3,4];case 3:throw c=f.sent(),void 0===r||(r.isGeneratingRequest=!1,"awaiting"===r.closingStatus.type&&r.closingStatus.start()),c;case 4:return void 0!==r&&(r.isGeneratingRequest=!1,"awaiting"===r.closingStatus.type&&r.closingStatus.start()),[2]}})})()}},{key:"loadPersistentSession",value:function(e,t){var n=this;return r(function(){var i,r,a,o,s,u,l,d,c;return I(this,function(f){switch(f.label){case 0:r=!0,a=!1,o=void 0;try{for(s=n._storage[Symbol.iterator]();!(r=(u=s.next()).done);r=!0)if((l=u.value).mediaKeySession===e){i=l;break}}catch(e){a=!0,o=e}finally{try{r||null==s.return||s.return()}finally{if(a)throw o}}if(void 0===i)return[2,(uw.error("DRM-LSS: loadPersistentSession error. No MediaKeySession found with the given initData and initDataType"),nV(e,t))];if(i.isLoadingPersistentSession=!0,"none"!==i.closingStatus.type)throw Error("The `MediaKeySession` is being closed.");f.label=1;case 1:return f.trys.push([1,3,,4]),[4,nV(e,t)];case 2:return d=f.sent(),[3,4];case 3:throw c=f.sent(),void 0===i||(i.isLoadingPersistentSession=!1,"awaiting"===i.closingStatus.type&&i.closingStatus.start()),c;case 4:return[2,(void 0===i||(i.isLoadingPersistentSession=!1,"awaiting"===i.closingStatus.type&&i.closingStatus.start()),d)]}})})()}},{key:"closeSession",value:function(e){var t=this;return r(function(){var n,i,r,a,o,s,u;return I(this,function(l){i=!0,r=!1,a=void 0;try{for(o=t._storage[Symbol.iterator]();!(i=(s=o.next()).done);i=!0)if((u=s.value).mediaKeySession===e){n=u;break}}catch(e){r=!0,a=e}finally{try{i||null==o.return||o.return()}finally{if(r)throw a}}return[2,void 0===n?(uw.warn("DRM-LSS: No MediaKeySession found with the given initData and initDataType"),Promise.resolve(!1)):t._closeEntry(n)]})})()}},{key:"getLength",value:function(){return this._storage.length}},{key:"getAll",value:function(){return this._storage}},{key:"closeAllSessions",value:function(){var e=this;return r(function(){var t;return I(this,function(n){switch(n.label){case 0:return t=e._storage,uw.debug("DRM-LSS: Closing all current MediaKeySessions",t.length),e._storage=[],[4,Promise.all(t.map(function(t){return e._closeEntry(t)}))];case 1:return n.sent(),[2]}})})()}},{key:"removeSessionWithoutClosingIt",value:function(e){W(""===e.sessionId,"Initialized `MediaKeySession`s should always be properly closed");for(var t=this._storage.length-1;t>=0;t--)if(this._storage[t].mediaKeySession===e)return uw.debug("DRM-LSS: Removing session without closing it",e.sessionId),this._storage.splice(t,1),!0;return!1}},{key:"getIndex",value:function(e){for(var t=0;t<this._storage.length;t++)if(this._storage[t].keySessionRecord===e)return t;return -1}},{key:"_closeEntry",value:function(e){return r(function(){var t;return I(this,function(n){return t=e.mediaKeySession,[2,new Promise(function(n,i){var r=function(){void 0!==e&&(e.closingStatus={type:"pending"}),(function(e){return dw.apply(this,arguments)})(t).then(function(){void 0!==e&&(e.closingStatus={type:"done"}),n(!0)}).catch(function(t){void 0!==e&&(e.closingStatus={type:"failed"}),i(t)})};void 0!==e&&(e.isLoadingPersistentSession||e.isGeneratingRequest)?e.closingStatus={type:"awaiting",start:r}:r()})]})})()}}]),e}();function dw(){return(dw=r(function(e){var t;return I(this,function(n){switch(n.label){case 0:uw.debug("DRM: Trying to close a MediaKeySession",e.sessionId),n.label=1;case 1:return n.trys.push([1,3,,4]),[4,tO(e)];case 2:return n.sent(),uw.debug("DRM: Succeeded to close MediaKeySession"),[2];case 3:return t=n.sent(),uw.error("DRM: Could not close MediaKeySession: "+(v(t,Error)?t.toString():"Unknown error")),[2];case 4:return[2]}})})).apply(this,arguments)}var dI=function(){function e(t){a(this,e),this.initData=t}return u(e,[{key:"toJSON",value:function(){return tq(this.initData)}}],[{key:"decode",value:function(e){return tY(e)}}]),e}(),dA=function(){function e(t){a(this,e),n2(t),this._entries=[],this._storage=t;try{var n=this._storage.load();Array.isArray(n)||(n=[]),this._entries=n}catch(e){uw.warn("DRM-PSS: Could not get entries from license storage",v(e,Error)?e:""),this.dispose()}}return u(e,[{key:"getLength",value:function(){return this._entries.length}},{key:"getAll",value:function(){return this._entries}},{key:"get",value:function(e){var t=this._getIndex(e);return -1===t?null:this._entries[t]}},{key:"getAndReuse",value:function(e){var t=this._getIndex(e);if(-1===t)return null;var n=this._entries.splice(t,1)[0];return this._entries.push(n),n}},{key:"add",value:function(e,t,n){if(i(n)||!ed(n.sessionId)){uw.warn("DRM-PSS: Invalid Persisten Session given.");return}var r,a=n.sessionId,o=this._getIndex(e);if(o>=0){var s=this._entries[o];if((null!=(r=s.version)?r:-1)>=(void 0===t?3:4)&&a===s.sessionId)return;uw.info("DRM-PSS: Updating session info.",a),this._entries.splice(o,1)}else uw.info("DRM-PSS: Add new session",a);var u=e.values.getFormattedValues().map(function(e){var t=e.systemId,n=e.data;return{systemId:t,hash:e.hash,data:new dI(n)}});void 0===t?this._entries.push({version:3,sessionId:a,values:u,initDataType:e.type}):this._entries.push({version:4,sessionId:a,keyIds:t.map(function(e){return new dI(e)}),values:u,initDataType:e.type}),this._save()}},{key:"delete",value:function(e){for(var t=-1,n=0;n<this._entries.length;n++)if(this._entries[n].sessionId===e){t=n;break}if(-1===t){uw.warn("DRM-PSS: initData to delete not found.");return}var i=this._entries[t];uw.warn("DRM-PSS: Delete session from store",i.sessionId),this._entries.splice(t,1),this._save()}},{key:"deleteOldSessions",value:function(e){uw.info("DRM-PSS: Deleting last ".concat(e," sessions.")),e<=0||(e<=this._entries.length?this._entries.splice(0,e):(uw.warn("DRM-PSS: Asked to remove more information that it contains",e,this._entries.length),this._entries=[]),this._save())}},{key:"dispose",value:function(){this._entries=[],this._save()}},{key:"_getIndex",value:function(e){var t,n=null;function i(){if(null===n){var t=e.values.constructRequestData();n={initData:t,initDataHash:nJ(t)}}return n}for(var r=0;r<this._entries.length;r++){var a=(t=this,function(n){var r=t._entries[n];if(r.initDataType===e.type)switch(r.version){case 4:if(void 0!==e.keyIds){if(e.keyIds.every(function(e){var t=tq(e),n=!0,i=!1,a=void 0;try{for(var o,s=r.keyIds[Symbol.iterator]();!(n=(o=s.next()).done);n=!0){var u=o.value;if("string"==typeof u){if(t===u)return!0}else if(eg(u.initData,e))return!0}}catch(e){i=!0,a=e}finally{try{n||null==s.return||s.return()}finally{if(i)throw a}}return!1}))return{v:n}}else if(n0(e.values.getFormattedValues(),r.values))return{v:n};break;case 3:if(n0(e.values.getFormattedValues(),r.values))return{v:n};break;case 2:var a=i(),o=a.initData,s=a.initDataHash;if(r.initDataHash===s)try{var u="string"==typeof r.initData?dI.decode(r.initData):r.initData.initData;if(eg(u,o))return{v:n}}catch(e){uw.warn("DRM-PSS: Could not decode initialization data.",v(e,Error)?e:"")}break;case 1:var l=i(),d=l.initData,c=l.initDataHash;if(r.initDataHash===c&&(void 0===r.initData.length||eg(r.initData,d)))return{v:n};break;default:var f=i().initDataHash;if(r.initData===f)return{v:n}}}(r));if("object"===b(a))return a.v}return -1}},{key:"_save",value:function(){try{this._storage.save(this._entries)}catch(t){var e=v(t,Error)?t:void 0;uw.warn("DRM-PSS: Could not save MediaKeySession information",e)}}}]),e}(),dR=new WeakMap,dC={prepare:function(e){dR.set(e,null)},set:function(e,t){var n=v(t,Uint8Array)?t:new Uint8Array(v(t,ArrayBuffer)?t:t.buffer),i=nJ(n);dR.set(e,{hash:i,serverCertificate:n})},hasOne:function(e){var t=dR.get(e);return void 0!==t&&(null!==t||void 0)},has:function(e,t){var n=dR.get(e);if(null==n)return!1;var i=n.hash,r=n.serverCertificate,a=v(t,Uint8Array)?t:new Uint8Array(v(t,ArrayBuffer)?t:t.buffer);if(nJ(a)!==i||r.length!==a.length)return!1;for(var o=0;o<r.length;o++)if(r[o]!==a[o])return!1;return!0}};function dM(){return(dM=r(function(e,t,n){var r,a,o,s,u,l,d,c,f,v;return I(this,function(h){switch(h.label){case 0:return[4,nX(e,t,n)];case 1:if(r=h.sent(),null!==n.cancellationError)throw n.cancellationError;if(o=(a=r.value).options,s=a.mediaKeySystemAccess,u=lV.getState(e),l=n5(o),!ug&&!uy&&null!==u&&"reuse-media-key-system-access"===r.type&&(d=u.mediaKeys,c=u.loadedSessionsStore,!1===dC.hasOne(d)||!i(o.serverCertificate)&&dC.has(d,o.serverCertificate)))return[2,{mediaKeys:d,mediaKeySystemAccess:s,stores:{loadedSessionsStore:c,persistentSessionsStore:l},options:o}];return[4,function(e){return dP.apply(this,arguments)}(s)];case 2:return f=h.sent(),uw.info("DRM: MediaKeys created with success"),v=new dT(f),[2,{mediaKeys:f,mediaKeySystemAccess:s,stores:{loadedSessionsStore:v,persistentSessionsStore:l},options:o}]}})})).apply(this,arguments)}function dP(){return(dP=r(function(e){var t;return I(this,function(n){switch(n.label){case 0:uw.info("DRM: Calling createMediaKeys on the MediaKeySystemAccess"),n.label=1;case 1:return n.trys.push([1,3,,4]),[4,e.createMediaKeys()];case 2:return[2,n.sent()];case 3:throw new u1("CREATE_MEDIA_KEYS_ERROR",v(t=n.sent(),Error)?t.message:"Unknown error when creating MediaKeys.");case 4:return[2]}})})).apply(this,arguments)}function dD(){return(dD=r(function(e,t,n){var i,r;return I(this,function(a){switch(a.label){case 0:return[4,function(e,t,n){return dM.apply(this,arguments)}(e,t,n)];case 1:if(r=(i=a.sent()).mediaKeys,!(null!==e.mediaKeys&&void 0!==e.mediaKeys&&r!==e.mediaKeys))return[3,3];return uw.debug("DRM: Disabling old MediaKeys"),[4,nz(e)];case 2:a.sent(),a.label=3;case 3:return[2,i]}})})).apply(this,arguments)}var dx=function(e){f(i,e);var t=w(i);function i(e){var r;return a(this,i),Object.setPrototypeOf(n(r=t.call(this)),i.prototype),r.reason=e,m(r)}return i}(k(Error)),dN={EXPIRED:"expired",INTERNAL_ERROR:"internal-error",OUTPUT_RESTRICTED:"output-restricted"};function dO(){return(dO=r(function(e,t){var n;return I(this,function(i){switch(i.label){case 0:uw.info("DRM: Updating MediaKeySession with message"),i.label=1;case 1:return i.trys.push([1,3,,4]),[4,e.update(t)];case 2:return i.sent(),[3,4];case 3:throw new u1("KEY_UPDATE_ERROR",v(n=i.sent(),Error)?n.toString():"`session.update` failed");case 4:return uw.info("DRM: MediaKeySession update succeeded."),[2]}})})).apply(this,arguments)}var dL=function(e){f(i,e);var t=w(i);function i(e){var r;return a(this,i),Object.setPrototypeOf(n(r=t.call(this)),i.prototype),r.sessionError=e,m(r)}return i}(k(Error)),dU=function(e){f(i,e);var t=w(i);function i(e){var r;return a(this,i),Object.setPrototypeOf(n(r=t.call(this)),dL.prototype),r.message=e,m(r)}return i}(k(Error));function dF(){return(dF=r(function(e,t){var n;return I(this,function(i){switch(i.label){case 0:return i.trys.push([0,2,,3]),[4,e.setServerCertificate(t)];case 1:return[2,i.sent()];case 2:throw n=i.sent(),uw.warn("DRM: mediaKeys.setServerCertificate returned an error",v(n,Error)?n:""),new u1("LICENSE_SERVER_CERTIFICATE_ERROR",v(n,Error)?n.toString():"`setServerCertificate` error");case 3:return[2]}})})).apply(this,arguments)}function dB(){return(dB=r(function(e,t){var n,i;return I(this,function(r){switch(r.label){case 0:if(!0===dC.hasOne(e))return[2,(uw.info("DRM: The MediaKeys already has a server certificate, skipping..."),{type:"already-has-one"})];if("function"!=typeof e.setServerCertificate)return[2,(uw.warn("DRM: Could not set the server certificate. mediaKeys.setServerCertificate is not a function"),{type:"method-not-implemented"})];uw.info("DRM: Setting server certificate on the MediaKeys"),dC.prepare(e),r.label=1;case 1:return r.trys.push([1,3,,4]),[4,function(e,t){return dF.apply(this,arguments)}(e,t)];case 2:return n=r.sent(),[2,(dC.set(e,t),{type:"success",value:n})];case 3:return[2,{type:"error",value:ev(i=r.sent())?i:new u1("LICENSE_SERVER_CERTIFICATE_ERROR","Unknown error when setting the server certificate.")}];case 4:return[2]}})})).apply(this,arguments)}var dV=function(){function e(t){a(this,e),this._innerValues=t,this._lazyFormattedValues=null}return u(e,[{key:"constructRequestData",value:function(){return t3.apply(void 0,S(this._innerValues.map(function(e){return e.data})))}},{key:"isCompatibleWith",value:function(t){var n=v(t,e)?t.getFormattedValues():t;return n0(this.getFormattedValues(),n)}},{key:"getFormattedValues",value:function(){return null===this._lazyFormattedValues&&(this._lazyFormattedValues=this._innerValues.slice().sort(function(e,t){return e.systemId===t.systemId?0:void 0===e.systemId?1:void 0===t.systemId||e.systemId<t.systemId?-1:1}).map(function(e){var t=e.systemId,n=e.data;return{systemId:t,data:n,hash:nJ(n)}})),this._lazyFormattedValues}}]),e}(),dz=function(e){f(n,e);var t=w(n);function n(e,r){a(this,n),o=t.call(this),uw.debug("DRM: Starting ContentDecryptor logic.");var o,s=new uM;return o._currentSessions=[],o._canceller=s,o._initDataQueue=[],o._stateData={state:0,isMediaKeysAttached:0,isInitDataQueueLocked:!0,data:null},o.error=null,dy.onEncrypted(e,function(e){uw.debug("DRM: Encrypted event received from media element.");var t=nB(e);null!==t&&o.onInitializationData(t)},s.signal),(function(e,t,n){return dD.apply(this,arguments)})(e,r,s.signal).then(function(t){var n,r,a=t.options,s=t.mediaKeySystemAccess;(i(a.persistentLicenseConfig)||!0===a.persistentLicenseConfig.disableRetroCompatibility)&&(r=tT(n=s.keySystem,"com.microsoft.playready")||"com.chromecast.playready"===n||"com.youtube.playready"===n?"9a04f07998404286ab92e65be0885f95":"com.widevine.alpha"===n?"edef8ba979d64acea3c827dcd51d21ed":tT(n,"com.apple.fps")?"94ce86fb07ff4f43adb893d2fa968ca2":tT(n,"com.nagra.")?"adb41c242dbf4a6d958b4457c0d27b95":void 0),o.systemId=r,0===o._stateData.state&&(o._stateData={state:1,isInitDataQueueLocked:!0,isMediaKeysAttached:0,data:{mediaKeysInfo:t,mediaElement:e}},o.trigger("stateChange",o._stateData.state))}).catch(function(e){o._onFatalError(e)}),m(o)}return u(n,[{key:"getState",value:function(){return this._stateData.state}},{key:"attach",value:function(){var e=this;if(1!==this._stateData.state)throw Error("`attach` should only be called when in the WaitingForAttachment state");if(0!==this._stateData.isMediaKeysAttached){uw.warn("DRM: ContentDecryptor's `attach` method called more than once.");return}var t=this._stateData.data,n=t.mediaElement,a=t.mediaKeysInfo,o=a.options,s=a.mediaKeys,u=a.mediaKeySystemAccess,l=a.stores;if(!(!0===o.disableMediaKeysAttachmentLock&&(this._stateData={state:2,isInitDataQueueLocked:!0,isMediaKeysAttached:1,data:{mediaKeysInfo:a,mediaElement:n}},this.trigger("stateChange",this._stateData.state),this._isStopped()))){this._stateData.isMediaKeysAttached=1;var d={emeImplementation:dy,loadedSessionsStore:l.loadedSessionsStore,mediaKeySystemAccess:u,mediaKeys:s,keySystemOptions:o},c=this;uw.debug("DRM: Attaching current MediaKeys"),(function(e,t,n){return d_.apply(this,arguments)})(n,d,this._canceller.signal).then(r(function(){var e,t,n;return I(this,function(r){switch(r.label){case 0:if(c._stateData.isMediaKeysAttached=2,i(e=o.serverCertificate))return[3,2];return[4,function(e,t){return dB.apply(this,arguments)}(s,e)];case 1:"error"===(t=r.sent()).type&&c.trigger("warning",t.value),r.label=2;case 2:if(c._isStopped())return[2];return n=c._stateData.state,c._stateData={state:2,isMediaKeysAttached:2,isInitDataQueueLocked:!1,data:{mediaKeysData:a}},2!==n&&c.trigger("stateChange",2),c._isStopped()||c._processCurrentInitDataQueue(),[2]}})})).catch(function(t){e._onFatalError(t)})}}},{key:"dispose",value:function(){this.removeEventListener(),this._stateData={state:4,isMediaKeysAttached:void 0,isInitDataQueueLocked:void 0,data:null},this._canceller.cancel(),this.trigger("stateChange",this._stateData.state)}},{key:"onInitializationData",value:function(e){var t=this;if(!1!==this._stateData.isInitDataQueueLocked){if(this._isStopped())throw Error("ContentDecryptor either disposed or stopped.");this._initDataQueue.push(e);return}var n=this._stateData.data.mediaKeysData,i=un(ut({},e),{values:new dV(e.values)});this._processInitializationData(i,n).catch(function(e){t._onFatalError(e)})}},{key:"_processInitializationData",value:function(e,t){var n=this;return r(function(){var r,a,o,s,u,l,d,c,f,h,p,m,g,y,_,S,b,E,k,T,w,A,R,C,M,P,D,x,N,O,L,U,F,B,V,z,K,W,G,H,q,Y,Q;return I(this,function(I){switch(I.label){case 0:if(r=t.mediaKeySystemAccess,a=t.stores,o=t.options,n._tryToUseAlreadyCreatedSession(e,t)||n._isStopped())return[2];if("content"===o.singleLicensePer){if(void 0!==(s=j(n._currentSessions,function(e){return"created-session"===e.source}))){if(void 0===(u=e.keyIds))return void 0===e.content?uw.warn("DRM: Unable to fallback from a non-decipherable quality."):n.trigger("blackListProtectionData",e),[2];return s.record.associateKeyIds(u),void 0!==e.content&&(uw.hasLevel("DEBUG")&&(l=u.reduce(function(e,t){return"".concat(e,", ").concat(t1(t))},""),uw.debug("DRM: Blacklisting new key ids",l)),n.trigger("keyIdsCompatibilityUpdate",{whitelistedKeyIds:[],blacklistedKeyIds:u,delistedKeyIds:[]})),[2]}}else if("periods"===o.singleLicensePer&&void 0!==e.content){d=e.content.period,c=n._currentSessions.filter(function(e){return"created-session"===e.source}),iu(f=new Set,d),h=!0,p=!1,m=void 0;try{for(g=c[Symbol.iterator]();!(h=(y=g.next()).done);h=!0){_=y.value,S=Array.from(f),b=!0,E=!1,k=void 0;try{for(T=S[Symbol.iterator]();!(b=(w=T.next()).done);b=!0)if(A=w.value,_.record.isAssociatedWithKeyId(A)){_.record.associateKeyIds(f.values()),R=!0,C=!1,M=void 0;try{for(P=function(){var e=x.value;_.keyStatuses.whitelisted.some(function(t){return eg(t,e)})||_.keyStatuses.blacklisted.some(function(t){return eg(t,e)})||_.keyStatuses.blacklisted.push(e)},D=S[Symbol.iterator]();!(R=(x=D.next()).done);R=!0)P()}catch(e){C=!0,M=e}finally{try{R||null==D.return||D.return()}finally{if(C)throw M}}return n.trigger("keyIdsCompatibilityUpdate",{whitelistedKeyIds:_.keyStatuses.whitelisted,blacklistedKeyIds:_.keyStatuses.blacklisted,delistedKeyIds:[]}),[2]}}catch(e){E=!0,k=e}finally{try{b||null==T.return||T.return()}finally{if(E)throw k}}}}catch(e){p=!0,m=e}finally{try{h||null==g.return||g.return()}finally{if(p)throw m}}}return n._lockInitDataQueue(),i(o.persistentLicenseConfig)?N="temporary":it(r)?N="persistent-license":(uw.warn('DRM: Cannot create "persistent-license" session: not supported'),N="temporary"),L=(O=uT.getCurrent()).EME_DEFAULT_MAX_SIMULTANEOUS_MEDIA_KEY_SESSIONS,U=O.EME_MAX_STORED_PERSISTENT_SESSION_INFORMATION,F="number"==typeof o.maxSessionCacheSize?o.maxSessionCacheSize:L,[4,function(e,t,n,i,r){return dE.apply(this,arguments)}(e,a,N,F,n._canceller.signal)];case 1:if(B=I.sent(),n._isStopped())return[2];if(V={record:B.value.keySessionRecord,source:B.type,keyStatuses:{whitelisted:[],blacklisted:[]},blacklistedSessionError:null},n._currentSessions.push(V),K=(z=B.value).mediaKeySession,W=z.sessionType,G=!1,n6(K,o,r.keySystem,{onKeyUpdate:function(t){var i=io(e,V.record,o.singleLicensePer,"created-session"===V.source,t.whitelistedKeyIds,t.blacklistedKeyIds);if(V.record.associateKeyIds(i.whitelisted),V.record.associateKeyIds(i.blacklisted),V.keyStatuses={whitelisted:i.whitelisted,blacklisted:i.blacklisted},0!==V.record.getAssociatedKeyIds().length&&"persistent-license"===W&&null!==a.persistentSessionsStore&&!G){var r=a.persistentSessionsStore;ie(r,U-1),r.add(e,V.record.getAssociatedKeyIds(),K),G=!0}void 0!==e.content&&n.trigger("keyIdsCompatibilityUpdate",{whitelistedKeyIds:i.whitelisted,blacklistedKeyIds:i.blacklisted,delistedKeyIds:[]}),n._unlockInitDataQueue()},onWarning:function(e){n.trigger("warning",e)},onError:function(t){var i;if(v(t,dx)){uw.warn("DRM: A session's closing condition has been triggered"),n._lockInitDataQueue();var r=n._currentSessions.indexOf(V);r>=0&&n._currentSessions.splice(r),void 0!==e.content&&n.trigger("keyIdsCompatibilityUpdate",{whitelistedKeyIds:[],blacklistedKeyIds:[],delistedKeyIds:V.record.getAssociatedKeyIds()}),null==(i=a.persistentSessionsStore)||i.delete(K.sessionId),a.loadedSessionsStore.closeSession(K).catch(function(e){var t=v(e,Error)?e:"unknown error";uw.warn("DRM: failed to close expired session",t)}).then(function(){return n._unlockInitDataQueue()}).catch(function(e){return n._onFatalError(e)}),n._isStopped()||n.trigger("warning",t.reason);return}if(!v(t,dL)){n._onFatalError(t);return}V.blacklistedSessionError=t,void 0!==e.content&&(uw.info("DRM: blacklisting Representations based on protection data."),n.trigger("blackListProtectionData",e)),n._unlockInitDataQueue()}},n._canceller.signal),(void 0===o.singleLicensePer||"init-data"===o.singleLicensePer)&&n._unlockInitDataQueue(),"created-session"!==B.type)return[3,5];H=e.values.constructRequestData(),I.label=2;case 2:return I.trys.push([2,4,,5]),[4,a.loadedSessionsStore.generateLicenseRequest(K,e.type,H)];case 3:return I.sent(),[3,5];case 4:if(q=I.sent(),null===(Y=a.loadedSessionsStore.getEntryForSession(K))||"none"!==Y.closingStatus.type)return[2,((Q=n._currentSessions.indexOf(V))>=0&&n._currentSessions.splice(Q,1),Promise.resolve())];throw new u1("KEY_GENERATE_REQUEST_ERROR",v(q,Error)?q.toString():"Unknown error");case 5:return[2,Promise.resolve()]}})})()}},{key:"_tryToUseAlreadyCreatedSession",value:function(e,t){var n,r=t.stores,a=t.options,o=j(this._currentSessions,function(t){return t.record.isCompatibleWith(e)});if(void 0===o)return!1;if(!i(o.blacklistedSessionError))return void 0===e.type||void 0===e.content?uw.error("DRM: This initialization data has already been blacklisted but the current content is not known."):(uw.info("DRM: This initialization data has already been blacklisted. Blacklisting the related content."),this.trigger("blackListProtectionData",e)),!0;if(void 0!==e.keyIds){if(void 0===a.singleLicensePer||"init-data"===a.singleLicensePer){var s=o.keyStatuses.blacklisted;n=nZ(e.keyIds,s)}else{var u=o.keyStatuses.whitelisted;n=!n$(e.keyIds,u)}if(n)return void 0===e.content?uw.error("DRM: Cannot forbid key id, the content is unknown."):(uw.info("DRM: Current initialization data is linked to blacklisted keys. Marking Representations as not decipherable"),this.trigger("keyIdsCompatibilityUpdate",{whitelistedKeyIds:[],blacklistedKeyIds:e.keyIds,delistedKeyIds:[]})),!0}if(null!==r.loadedSessionsStore.reuse(e))return uw.debug("DRM: Init data already processed. Skipping it."),!0;var l=this._currentSessions.indexOf(o);return -1===l?uw.error("DRM: Unable to remove processed init data: not found."):(uw.debug("DRM: A session from a processed init data is not available anymore. Re-processing it."),this._currentSessions.splice(l,1)),!1}},{key:"_onFatalError",value:function(e){if(!this._canceller.isUsed()){var t=v(e,Error)?e:new u4("NONE","Unknown decryption error");this.error=t,this._initDataQueue.length=0,this._stateData={state:3,isMediaKeysAttached:void 0,isInitDataQueueLocked:void 0,data:null},this._canceller.cancel(),this.trigger("error",t),3===this._stateData.state&&this.trigger("stateChange",this._stateData.state)}}},{key:"_isStopped",value:function(){return 4===this._stateData.state||3===this._stateData.state}},{key:"_processCurrentInitDataQueue",value:function(){for(;!1===this._stateData.isInitDataQueueLocked;){var e=this._initDataQueue.shift();if(void 0===e)return;this.onInitializationData(e)}}},{key:"_lockInitDataQueue",value:function(){!1===this._stateData.isInitDataQueueLocked&&(this._stateData.isInitDataQueueLocked=!0)}},{key:"_unlockInitDataQueue",value:function(){if(2!==this._stateData.isMediaKeysAttached){uw.error("DRM: Trying to unlock in the wrong state");return}this._stateData.isInitDataQueueLocked=!1,this._processCurrentInitDataQueue()}}],[{key:"hasEmeApis",value:function(){return!i(dy.requestMediaKeySystemAccess)}}]),n}(ur),dK=function(e){f(n,e);var t=w(n);function n(){return a(this,n),t.apply(this,arguments)}return n}(ur),dW=void 0===us?void 0:i(us.MediaSource)?i(us.MozMediaSource)?i(us.WebKitMediaSource)?us.MSMediaSource:us.WebKitMediaSource:us.MozMediaSource:us.MediaSource;function dG(e,t){if(uw.debug("Init: Trying to call endOfStream"),"open"!==e.readyState){uw.debug("Init: MediaSource not open, cancel endOfStream");return}var n=e.sourceBuffers,i=ig(n);if(0===i.length){uw.info("Init: Triggering end of stream"),e.endOfStream();return}uw.debug("Init: Waiting SourceBuffers to be updated before calling endOfStream.");var r=new uM;r.linkToSignal(t);var a=!0,o=!1,s=void 0;try{for(var u,l=i[Symbol.iterator]();!(a=(u=l.next()).done);a=!0){var d=u.value;l$(d,function(){r.cancel(),dG(e,t)},r.signal)}}catch(e){o=!0,s=e}finally{try{a||null==l.return||l.return()}finally{if(o)throw s}}lZ(n,function(){r.cancel(),dG(e,t)},r.signal)}var dH=31536e3,dq=function(){function e(t){a(this,e),this._mediaSource=t,this._currentMediaSourceDurationUpdateCanceller=null}return u(e,[{key:"updateDuration",value:function(e,t){null!==this._currentMediaSourceDurationUpdateCanceller&&this._currentMediaSourceDurationUpdateCanceller.cancel(),this._currentMediaSourceDurationUpdateCanceller=new uM;var n=this._mediaSource,i=this._currentMediaSourceDurationUpdateCanceller.signal,r=ib(n,i),a=new uM;a.linkToSignal(i),r.onUpdate(function(){if(a.cancel(),r.getValue()){(a=new uM).linkToSignal(i);var o=iS(n.sourceBuffers,a.signal),s=new uM;return s.linkToSignal(a.signal),o.onUpdate(function(i){s.cancel(),(s=new uM).linkToSignal(a.signal),i||function e(t,n,i,r){if("success"!==i_(t,n,i))var a=setTimeout(function(){o(),e(t,n,i,r)},2e3),o=r.register(function(){clearTimeout(a)})}(n,e,t,s.signal)},{clearSignal:a.signal,emitCurrentValue:!0})}},{emitCurrentValue:!0,clearSignal:i})}},{key:"stopUpdating",value:function(){null!==this._currentMediaSourceDurationUpdateCanceller&&(this._currentMediaSourceDurationUpdateCanceller.cancel(),this._currentMediaSourceDurationUpdateCanceller=null)}}]),e}(),dY=function(e){f(n,e);var t=w(n);function n(e){if(a(this,n),(r=t.call(this)).id=e,r.sourceBuffers=[],r._canceller=new uM,i(dW))throw new u2("MEDIA_SOURCE_NOT_SUPPORTED","No MediaSource Object was found in the current browser.");uw.info("Init: Creating MediaSource");var r,o=new dW;r.readyState=o.readyState;var s=o.handle;return r.handle=i(s)?{type:"media-source",value:o}:{type:"handle",value:s},r._mediaSource=o,r._durationUpdater=new dq(o),r._endOfStreamCanceller=null,lj(o,function(){r.readyState=o.readyState,r.trigger("mediaSourceOpen",null)},r._canceller.signal),lX(o,function(){r.readyState=o.readyState,r.trigger("mediaSourceEnded",null)},r._canceller.signal),lQ(o,function(){r.readyState=o.readyState,r.trigger("mediaSourceClose",null)},r._canceller.signal),m(r)}return u(n,[{key:"addSourceBuffer",value:function(e,t){var n=this._mediaSource.addSourceBuffer(t),i=new dj(e,t,n);return this.sourceBuffers.push(i),i}},{key:"setDuration",value:function(e,t){this._durationUpdater.updateDuration(e,t)}},{key:"interruptDurationSetting",value:function(){this._durationUpdater.stopUpdating()}},{key:"maintainEndOfStream",value:function(){null===this._endOfStreamCanceller&&(this._endOfStreamCanceller=new uM,this._endOfStreamCanceller.linkToSignal(this._canceller.signal),uw.debug("Init: end-of-stream order received."),iy(this._mediaSource,this._endOfStreamCanceller.signal))}},{key:"stopEndOfStream",value:function(){null!==this._endOfStreamCanceller&&(uw.debug("Init: resume-stream order received."),this._endOfStreamCanceller.cancel(),this._endOfStreamCanceller=null)}},{key:"dispose",value:function(){this.sourceBuffers.forEach(function(e){return e.dispose()}),this._canceller.cancel(),ik(this._mediaSource)}}]),n}(ur),dj=function(){function e(t,n,i){var r=this;a(this,e),this.type=t,this.codec=n,this._canceller=new uM,this._sourceBuffer=i,this._operationQueue=[],this._currentOperations=[];var o=function(e){s=v(e,Error)?e:v(e.error,Error)?e.error:Error("Unknown SourceBuffer Error");var t=r._currentOperations;if(r._currentOperations=[],0===t.length)uw.error("SBI: error for an unknown operation",s);else{var n=new u3(s.name,s.message,"QuotaExceededError"===s.name),i=!0,a=!1,o=void 0;try{for(var s,u,l=t[Symbol.iterator]();!(i=(u=l.next()).done);i=!0)u.value.reject(n)}catch(e){a=!0,o=e}finally{try{i||null==l.return||l.return()}finally{if(a)throw o}}}},s=function(){var e=r._currentOperations;r._currentOperations=[];try{var t=!0,n=!1,i=void 0;try{for(var a,o=e[Symbol.iterator]();!(t=(a=o.next()).done);t=!0)a.value.resolve(M(r._sourceBuffer.buffered))}catch(e){n=!0,i=e}finally{try{t||null==o.return||o.return()}finally{if(n)throw i}}}catch(t){var s=!0,u=!1,l=void 0;try{for(var d,c=e[Symbol.iterator]();!(s=(d=c.next()).done);s=!0){var f=d.value;v(t,Error)&&"InvalidStateError"===t.name?f.resolve([]):f.reject(t)}}catch(e){u=!0,l=e}finally{try{s||null==c.return||c.return()}finally{if(u)throw l}}}r._performNextOperation()};i.addEventListener("error",o),i.addEventListener("updateend",s),this._canceller.signal.register(function(){i.removeEventListener("error",o),i.removeEventListener("updateend",s)})}return u(e,[{key:"appendBuffer",value:function(){for(var e=arguments.length,t=Array(e),n=0;n<e;n++)t[n]=arguments[n];return uw.debug("SBI: receiving order to push data to the SourceBuffer",this.type),this._addToQueue({operationName:0,params:t})}},{key:"remove",value:function(e,t){return uw.debug("SBI: receiving order to remove data from the SourceBuffer",this.type,e,t),this._addToQueue({operationName:1,params:[e,t]})}},{key:"getBuffered",value:function(){try{return M(this._sourceBuffer.buffered)}catch(e){return uw.error("Failed to get buffered time range of SourceBuffer",this.type,v(e,Error)?e:null),[]}}},{key:"abort",value:function(){try{this._sourceBuffer.abort()}catch(e){uw.debug("Init: Failed to abort SourceBuffer:",v(e,Error)?e:null)}this._emptyCurrentQueue()}},{key:"dispose",value:function(){try{this._sourceBuffer.abort()}catch(e){}this._emptyCurrentQueue()}},{key:"_emptyCurrentQueue",value:function(){var e=new uD;this._currentOperations.length>0&&(this._currentOperations.forEach(function(t){t.reject(e)}),this._currentOperations=[]),this._operationQueue.length>0&&(this._operationQueue.forEach(function(t){t.reject(e)}),this._operationQueue=[])}},{key:"_addToQueue",value:function(e){var t=this;return new Promise(function(n,i){var r=0===t._operationQueue.length&&0===t._currentOperations.length,a=uk({resolve:n,reject:i},e);t._operationQueue.push(a),r&&t._performNextOperation()})}},{key:"_performNextOperation",value:function(){if(0===this._currentOperations.length&&!this._sourceBuffer.updating){var e=this._operationQueue.shift();if(void 0!==e){if(0===e.operationName){this._currentOperations=[{operationName:0,resolve:e.resolve,reject:e.reject}];var t=e.params[0],n=e.params[1],i=t;if(this._operationQueue.length>0&&0===this._operationQueue[0].operationName){v(t,ArrayBuffer)?l=new Uint8Array(t):v(t,Uint8Array)?l=t:l=new Uint8Array(t.buffer);for(var r,a,o,s,u,l,d=[l];(null==(r=this._operationQueue[0])?void 0:r.operationName)===0;){var c=this._operationQueue[0],f=null!=(a=n.appendWindow)?a:[void 0,void 0],h=null!=(o=c.params[1].appendWindow)?o:[void 0,void 0],p=null!=(s=n.timestampOffset)?s:0,m=null!=(u=c.params[1].timestampOffset)?u:0;if(f[0]===h[0]&&f[1]===h[1]&&n.codec===c.params[1].codec&&p===m){var g=c.params[0],_=void 0;v(g,ArrayBuffer)?_=new Uint8Array(g):v(g,Uint8Array)?_=g:_=new Uint8Array(g.buffer),d.push(_),this._operationQueue.splice(0,1),this._currentOperations.push({operationName:0,resolve:c.resolve,reject:c.reject})}else break}d.length>1&&(uw.info("MMSI: Merging ".concat(d.length," segments together for perf"),this.type),i=t3.apply(void 0,S(d)))}try{this._appendBufferNow(i,n)}catch(e){var b=v(e,Error)?new u3(e.name,e.message,"QuotaExceededError"===e.name):new u3("Error","Unknown SourceBuffer Error during appendBuffer",!1);this._currentOperations.forEach(function(e){e.reject(b)}),this._currentOperations=[]}}else{this._currentOperations=[e];var E=y(e.params,2),k=E[0],T=E[1];uw.debug("SBI: removing data from SourceBuffer",this.type,k,T);try{this._sourceBuffer.remove(k,T)}catch(t){var w=v(t,Error)?new u3(t.name,t.message,!1):new u3("Error","Unknown SourceBuffer Error during remove",!1);e.reject(w),this._currentOperations=[]}}}}}},{key:"_appendBufferNow",value:function(e,t){var n=this._sourceBuffer,i=t.codec,r=t.timestampOffset,a=t.appendWindow,o=void 0===a?[]:a;if(void 0!==i&&i!==this.codec&&(uw.debug("SBI: updating codec",i),im(n,i)?this.codec=i:uw.debug("SBI: could not update codec",i,this.codec)),void 0!==r&&n.timestampOffset!==r&&(uw.debug("SBI: updating timestampOffset",i,n.timestampOffset,r),n.timestampOffset=r),void 0===o[0])n.appendWindowStart>0&&(uw.debug("SBI: re-setting `appendWindowStart` to `0`"),n.appendWindowStart=0);else if(o[0]!==n.appendWindowStart){if(o[0]>=n.appendWindowEnd){var s=o[0]+1;uw.debug("SBI: pre-updating `appendWindowEnd`",s),n.appendWindowEnd=s}uw.debug("SBI: setting `appendWindowStart`",o[0]),n.appendWindowStart=o[0]}void 0===o[1]?n.appendWindowEnd!==1/0&&(uw.debug("SBI: re-setting `appendWindowEnd` to `Infinity`"),n.appendWindowEnd=1/0):o[1]!==n.appendWindowEnd&&(uw.debug("SBI: setting `appendWindowEnd`",o[1]),n.appendWindowEnd=o[1]),uw.debug("SBI: pushing segment",this.type),n.appendBuffer(e)}}]),e}(),dQ=ey(),dX=!uh,d$=function(){function e(t,n){a(this,e),this._last=t,this._wanted=n}return u(e,[{key:"serialize",value:function(){return[this._last,this._wanted]}},{key:"getPolled",value:function(){return this._last}},{key:"getWanted",value:function(){var e;return null!=(e=this._wanted)?e:this._last}},{key:"forceWantedPosition",value:function(e){this._wanted=e}},{key:"isAwaitingFuturePosition",value:function(){return null!==this._wanted}}]),e}(),dZ=function(){function e(t){a(this,e),this._displayer=t}return u(e,[{key:"pushTextData",value:function(e){try{return Promise.resolve(this._displayer.pushTextData(e))}catch(e){return Promise.reject(e)}}},{key:"remove",value:function(e,t){try{return Promise.resolve(this._displayer.removeBuffer(e,t))}catch(e){return Promise.reject(e)}}},{key:"reset",value:function(){this._displayer.reset()}},{key:"stop",value:function(){this._displayer.stop()}}]),e}(),dJ=1/60,d0=function(e){f(n,e);var t=w(n);function n(e,i,r){var o;return a(this,n),(o=t.call(this))._playbackObserver=e,o._manifest=i,o._speed=r,o._discontinuitiesStore=[],o._isStarted=!1,o._canceller=new uM,m(o)}return u(n,[{key:"start",value:function(){var e=this;if(!this._isStarted){this._isStarted=!0;var t=new d1(this._playbackObserver,this._speed);this._canceller.signal.register(function(){t.dispose()});var n=null;this._playbackObserver.listen(function(i){var r,a=e._discontinuitiesStore,o=i.buffered,s=i.position,u=i.readyState,l=i.rebuffering,d=i.freezing,c=uT.getCurrent(),f=c.BUFFER_DISCONTINUITY_THRESHOLD,v=c.FREEZING_STALLED_DELAY,h=c.UNFREEZING_SEEK_DELAY,p=c.UNFREEZING_DELTA_POSITION;if(null!==d){var m=uN(),g=null===n?d.timestamp:n.attemptTimestamp;if(!s.isAwaitingFuturePosition()&&m-g>h&&(uw.warn("Init: trying to seek to un-freeze player"),e._playbackObserver.setCurrentTime(e._playbackObserver.getCurrentTime()+p),n={attemptTimestamp:m}),m-d.timestamp>v){null===l?t.stopRebuffering():t.startRebuffering(),e.trigger("stalled","freezing");return}}else n=null;if(null===l){if(t.stopRebuffering(),1===u){r=0!==i.seeking?1===i.seeking?"internal-seek":"seeking":"not-ready",e.trigger("stalled",r);return}e.trigger("unstalled",null);return}var y="seeking"===l.reason&&1===i.seeking?"internal-seek":l.reason;if(s.isAwaitingFuturePosition()){t.stopRebuffering(),uw.debug("Init: let rebuffering happen as we're awaiting a future position"),e.trigger("stalled",y);return}if(t.startRebuffering(),null===e._manifest){e.trigger("stalled",y);return}var _=l.position;if(null!=_&&e._speed.getValue()>0){var S=iD(a,e._manifest,_);if(null!==S){var b=S+.001;if(b<=e._playbackObserver.getCurrentTime())uw.info("Init: position to seek already reached, no seeking",e._playbackObserver.getCurrentTime(),b);else{uw.warn("SA: skippable discontinuity found in the stream",s.getPolled(),b),e._playbackObserver.setCurrentTime(b),e.trigger("warning",iO(_,b));return}}}var E=null!=_?_:s.getPolled(),k=x(o,E);if(e._speed.getValue()>0&&k<f){var T=E+k+dJ;if(e._playbackObserver.getCurrentTime()<T){uw.warn("Init: discontinuity encountered inferior to the threshold",E,T,f),e._playbackObserver.setCurrentTime(T),e.trigger("warning",iO(E,T));return}}for(var w=e._manifest.periods.length-2;w>=0;w--){var I=e._manifest.periods[w];if(void 0!==I.end&&I.end<=E){if(e._manifest.periods[w+1].start>E&&e._manifest.periods[w+1].start>e._playbackObserver.getCurrentTime()){var A=e._manifest.periods[w+1];e._playbackObserver.setCurrentTime(A.start),e.trigger("warning",iO(E,A.start));return}break}}e.trigger("stalled",y)},{includeLastObservation:!0,clearSignal:this._canceller.signal})}}},{key:"updateDiscontinuityInfo",value:function(e){this._isStarted||this.start();var t=this._playbackObserver.getReference().getValue();iN(this._discontinuitiesStore,e,t)}},{key:"onLockedStream",value:function(e,t){this._isStarted||this.start();var n,i=this._playbackObserver.getReference().getValue();if(!(!i.rebuffering||i.paused||0>=this._speed.getValue())&&("audio"===e||"video"===e)){var r=i.position.getWanted(),a=null!=(n=i.rebuffering.position)?n:r,o=t.start;r<o&&1>Math.abs(a-o)&&(uw.warn("Init: rebuffering because of a future locked stream.\nTrying to unlock by seeking to the next Period"),this._playbackObserver.setCurrentTime(o+.001))}}},{key:"destroy",value:function(){this._canceller.cancel()}}]),n}(ur),d1=function(){function e(t,n){a(this,e),this._speedUpdateCanceller=new uM,this._isRebuffering=!1,this._playbackObserver=t,this._isDisposed=!1,this._speed=n,this._updateSpeed()}return u(e,[{key:"startRebuffering",value:function(){this._isRebuffering||this._isDisposed||(this._isRebuffering=!0,this._speedUpdateCanceller.cancel(),uw.info("Init: Pause playback to build buffer"),this._playbackObserver.setPlaybackRate(0))}},{key:"stopRebuffering",value:function(){!this._isRebuffering||this._isDisposed||(this._isRebuffering=!1,this._speedUpdateCanceller=new uM,this._updateSpeed())}},{key:"dispose",value:function(){this._speedUpdateCanceller.cancel(),this._isDisposed=!0}},{key:"_updateSpeed",value:function(){var e=this;this._speed.onUpdate(function(t){uw.info("Init: Resume playback speed",t),e._playbackObserver.setPlaybackRate(t)},{clearSignal:this._speedUpdateCanceller.signal,emitCurrentValue:!0})}}]),e}(),d2=function(e,t){for(var n=[],i=t.periods,r=0;r<i.length;r++)i[r].streamEvents.forEach(function(t){for(var i,r=t.start,a=t.end,o=t.id,s=t.data,u=0;u<e.length;u++){var l,d=e[u];if(l={id:o,start:r,end:a},d.id===l.id&&d.start===l.start&&d.end===l.end){n.push(d);return}}if(void 0!==s.value.element)i=s.value.element;else{if(void 0===s.value.xmlData)return;var c=s.value.xmlData.namespaces.reduce(function(e,t){return e+"xmlns:"+t.key+'="'+t.value+'" '},"<toremove ");c+=">";var f=new DOMParser().parseFromString(c+s.value.xmlData.data+"</toremove>","application/xml").documentElement;i=f.children.length>0?f.children[0]:f.childNodes[0]}var v={type:s.type,value:un(ut({},s.value),{element:i})};if(void 0===a){var h={start:r,id:o,data:v,publicEvent:{start:r,data:v}};n.push(h)}else{var p={start:r,end:a,id:o,data:v,publicEvent:{start:r,end:a,data:v}};n.push(p)}});return n},d5=function(e){f(n,e);var t=w(n);function n(e,i,r){var o;return a(this,n),(o=t.call(this))._manifest=e,o._mediaElement=i,o._playbackObserver=r,o._canceller=null,o._scheduledEventsRef=new uR([]),o._eventsBeingPlayed=new WeakMap,m(o)}return u(n,[{key:"start",value:function(){var e=this;if(null===this._canceller){this._canceller=new uM;var t=this._canceller.signal,n=this._playbackObserver,i=this._mediaElement,r=!1,a=new uM;a.linkToSignal(t),this._scheduledEventsRef.setValue(d2([],this._manifest)),this._scheduledEventsRef.onUpdate(function(o){var s=o.length,u=function(){var e=n.getReference().getValue();return{currentTime:i.currentTime,isSeeking:0!==e.seeking}};if(0===s){r&&(a.cancel(),(a=new uM).linkToSignal(t),r=!1);return}if(!r){r=!0;var l=u(),d=function(){var t=u();e._emitStreamEvents(e._scheduledEventsRef.getValue(),l,t,a.signal),l=t},c=setInterval(d,uT.getCurrent().STREAM_EVENT_EMITTER_POLL_INTERVAL);n.listen(d,{includeLastObservation:!1,clearSignal:a.signal}),a.signal.register(function(){clearInterval(c)})}},{emitCurrentValue:!0,clearSignal:t})}}},{key:"onManifestUpdate",value:function(e){var t=this._scheduledEventsRef.getValue();this._scheduledEventsRef.setValue(d2(t,e))}},{key:"stop",value:function(){null!==this._canceller&&(this._canceller.cancel(),this._canceller=null)}},{key:"_emitStreamEvents",value:function(e,t,n,i){for(var r=t.currentTime,a=n.isSeeking,o=n.currentTime,s=[],u=[],l=0;l<e.length;l++){var d=e[l],c=d.start,f=iL(d)?d.end:void 0;this._eventsBeingPlayed.has(d)?(c>o||void 0!==f&&o>=f)&&(iL(d)&&u.push(d.publicEvent),this._eventsBeingPlayed.delete(d)):c<=o&&void 0!==f&&o<f?(s.push({type:"stream-event",value:d.publicEvent}),this._eventsBeingPlayed.set(d,!0)):r<c&&o>=(null!=f?f:c)&&(a?s.push({type:"stream-event-skip",value:d.publicEvent}):(s.push({type:"stream-event",value:d.publicEvent}),iL(d)&&u.push(d.publicEvent)))}if(s.length>0){var v=!0,h=!1,p=void 0;try{for(var m,g=s[Symbol.iterator]();!(v=(m=g.next()).done);v=!0){var y=m.value;if("stream-event"===y.type?this.trigger("event",y.value):this.trigger("eventSkip",y.value),i.isCancelled())return}}catch(e){h=!0,p=e}finally{try{v||null==g.return||g.return()}finally{if(h)throw p}}}if(u.length>0){var _=!0,S=!1,b=void 0;try{for(var E,k=u[Symbol.iterator]();!(_=(E=k.next()).done);_=!0){var T=E.value;if("function"==typeof T.onExit&&T.onExit(),i.isCancelled())return}}catch(e){S=!0,b=e}finally{try{_||null==k.return||k.return()}finally{if(S)throw b}}}}}]),n}(ur),d4=function(e){f(n,e);var t=w(n);function n(e){a(this,n),(i=t.call(this))._settings=e,i._initCanceller=new uM,i._manifest=null;var i,r=void 0===e.url?void 0:[e.url];return i._manifestFetcher=new ld(r,e.transport,e.manifestRequestSettings),m(i)}return u(n,[{key:"prepare",value:function(){var e=this;null===this._manifest&&(this._manifest=lF.createAsync(eK(this._initCanceller.signal,function(t,n){e._manifestFetcher.addEventListener("warning",function(t){return e.trigger("warning",t)}),e._manifestFetcher.addEventListener("error",function(t){e.trigger("error",t),n(t)}),e._manifestFetcher.addEventListener("manifestReady",function(e){t(e)})})),this._manifestFetcher.start(),this._initCanceller.signal.register(function(){e._manifestFetcher.dispose()}))}},{key:"start",value:function(e,t){var n=this;this.prepare(),iU(e,function(e){return n._onFatalError(e)},this._initCanceller.signal);var i=new uR(null,this._initCanceller.signal);this._initializeMediaSourceAndDecryption(e,i).then(function(r){return n._onInitialMediaSourceReady(e,r.mediaSource,t,r.drmSystemId,i,r.unlinkMediaSource)}).catch(function(e){n._onFatalError(e)})}},{key:"updateContentUrls",value:function(e,t){this._manifestFetcher.updateContentUrls(e,t)}},{key:"dispose",value:function(){this._initCanceller.cancel()}},{key:"_onFatalError",value:function(e){this._initCanceller.isUsed()||(this._initCanceller.cancel(),this.trigger("error",e))}},{key:"_initializeMediaSourceAndDecryption",value:function(e,t){var n=this,i=this._initCanceller;return eK(i.signal,function(a){var o=iP(e,n._settings.keySystems,t,{onWarning:function(e){return n.trigger("warning",e)},onError:function(e){return n._onFatalError(e)},onBlackListProtectionData:function(e){r(function(){var t,i;return I(this,function(r){switch(r.label){case 0:if(null===n._manifest)return[2];if(!(null!=(t=n._manifest.syncValue)))return[3,1];return i=t,[3,3];case 1:return[4,n._manifest.getValueAsAsync()];case 2:i=r.sent(),r.label=3;case 3:return iB(i,e),[2]}})})().catch(s)},onKeyIdsCompatibilityUpdate:function(e){r(function(){var t,i;return I(this,function(r){switch(r.label){case 0:if(null===n._manifest)return[2];if(!(null!=(t=n._manifest.syncValue)))return[3,1];return i=t,[3,3];case 1:return[4,n._manifest.getValueAsAsync()];case 2:i=r.sent(),r.label=3;case 3:return iF(i,e.whitelistedKeyIds,e.blacklistedKeyIds,e.delistedKeyIds),[2]}})})().catch(s)}},i.signal);o.onUpdate(function(t,r){if("uninitialized"!==t.initializationState.type){r();var s=new uM;s.linkToSignal(i.signal),iI(e,s.signal).then(function(e){var n=o.getValue();if("awaiting-media-link"===n.initializationState.type)n.initializationState.value.isMediaLinked.setValue(!0),o.onUpdate(function(t,n){if("initialized"===t.initializationState.type){n(),a({mediaSource:e,drmSystemId:t.drmSystemId,unlinkMediaSource:s});return}},{emitCurrentValue:!0,clearSignal:i.signal});else if("initialized"===t.initializationState.type){a({mediaSource:e,drmSystemId:t.drmSystemId,unlinkMediaSource:s});return}}).catch(function(e){s.isUsed()||n._onFatalError(e)})}},{emitCurrentValue:!0,clearSignal:i.signal})})}},{key:"_onInitialMediaSourceReady",value:function(e,t,n,i,a,o){var s=this;return r(function(){var r,u,l,d,c,f,v,h,p,m,g,y,_,S,b,E,k,T,w,A,R;return I(this,function(I){switch(I.label){case 0:l=(u=s._settings).adaptiveOptions,d=u.autoPlay,c=u.bufferOptions,f=u.lowLatencyMode,v=u.segmentRequestOptions,h=u.speed,p=u.startAt,m=u.textTrackOptions,g=u.transport,y=s._initCanceller,W(null!==s._manifest),I.label=1;case 1:if(I.trys.push([1,5,,6]),!(null!=(r=s._manifest.syncValue)))return[3,2];return S=r,[3,4];case 2:return[4,s._manifest.getValueAsAsync()];case 3:S=I.sent(),I.label=4;case 4:return _=S,[3,6];case 5:return I.sent(),[2];case 6:if(_.addEventListener("manifestUpdate",function(e){s.trigger("manifestUpdate",e)},y.signal),_.addEventListener("decipherabilityUpdate",function(e){s.trigger("decipherabilityUpdate",e)},y.signal),uw.debug("Init: Calculating initial time"),b=iA(_,f,p),uw.debug("Init: Initial time calculated:",b),E=uq(l),k=uk({textTrackOptions:m,drmSystemId:i},c),T=new lp(g,v,y.signal),s.trigger("manifestReady",_),y.isUsed())return[2];return w=s._startBufferingOnMediaSource.bind(s),A=s.trigger.bind(s),R=s._onFatalError.bind(s),function t(i,r,o,s){w({mediaElement:e,playbackObserver:n,mediaSource:i,initialTime:r,autoPlay:o,manifest:_,representationEstimator:E,segmentFetcherCreator:T,speed:h,protectionRef:a,bufferOptions:k},function(n){if(s.cancel(),!(y.isUsed()||(A("reloadingMediaSource",n),y.isUsed()))){var i=new uM;i.linkToSignal(y.signal),iI(e,i.signal).then(function(e){t(e,n.position,n.autoPlay,i)}).catch(function(e){i.isUsed()||R(e)})}},s.signal)}(t,b,d,o),[2]}})})()}},{key:"_startBufferingOnMediaSource",value:function(e,t,n){var i,r=this,a=e.autoPlay,o=e.bufferOptions,s=e.initialTime,u=e.manifest,l=e.mediaElement,d=e.mediaSource,c=e.playbackObserver,f=e.protectionRef,v=e.representationEstimator,h=e.segmentFetcherCreator,p=e.speed,m=null!=(i=u.getPeriodForTime(s))?i:u.getNextPeriod(s);if(void 0===m){var g=new u2("MEDIA_STARTING_TIME_NOT_FOUND","Wanted starting time not found in the Manifest.");return this._onFatalError(g)}var y=null,_=null;if("html"===this._settings.textTrackOptions.textTrackMode&&null!==le.htmlTextDisplayer?_=new le.htmlTextDisplayer(l,this._settings.textTrackOptions.textTrackElement):null!==le.nativeTextDisplayer&&(_=new le.nativeTextDisplayer(l)),null!==_){var S=new dZ(_);y=S,n.register(function(){S.stop(),null==_||_.stop()})}var b=new lA(d,"VIDEO"===l.nodeName,y);n.register(function(){b.disposeAll()});var E=iM({mediaElement:l,playbackObserver:c,startTime:s,mustAutoPlay:a,onWarning:function(e){r.trigger("warning",e)},isDirectfile:!1},n),k=E.autoPlayResult,T=E.initialPlayPerformed;if(!n.isCancelled()){T.onUpdate(function(e,t){if(e){t();var i=new d5(u,l,c);u.addEventListener("manifestUpdate",function(){i.onManifestUpdate(u)},n),i.addEventListener("event",function(e){r.trigger("streamEvent",e)},n),i.addEventListener("eventSkip",function(e){r.trigger("streamEventSkip",e)},n),i.start(),n.register(function(){i.stop()})}},{clearSignal:n,emitCurrentValue:!0});var w=ic(c,{autoPlay:a,manifest:u,mediaSource:d,textDisplayer:_,initialPlayPerformed:T,speed:p},n),I=this._createRebufferingController(c,u,p,n),A=new l_(b);ub&&u.addEventListener("decipherabilityUpdate",function(e){e.some(function(e){return!0!==e.representation.decipherable})&&M(0,void 0,void 0)},n),c.listen(function(e){if(A.needToReload(e)){var n=c.getReference().getValue();t({position:n.position.isAwaitingFuturePosition()?n.position.getWanted():c.getCurrentTime(),autoPlay:T.getValue()?!c.getIsPaused():a})}},{clearSignal:n}),w.listen(function(e){["video","audio","text"].forEach(function(t){var n,i=b.getStatus(t);"initialized"===i.type&&i.value.synchronizeInventory(null!=(n=e.buffered[t])?n:[])})},{clearSignal:n});var R=e0(u,d,w,b,{onWarning:function(e){return r.trigger("warning",e)},onPeriodChanged:function(e){return r.trigger("activePeriodChanged",{period:e})}},n);k.then(function(){iC(c,l,!1,n).onUpdate(function(e,t){e&&(t(),r.trigger("loaded",{segmentSinksStore:b}))},{emitCurrentValue:!0,clearSignal:n})}).catch(function(e){n.isCancelled()||r._onFatalError(e)});var C=this;lU({manifest:u,initialPeriod:m},w,v,b,h,o,{needsBufferFlush:function(e){var t,i,r=c.getCurrentTime(),a=null!=(t=null==e?void 0:e.relativeResumingPosition)?t:0,o=!!(null!=e&&e.relativePosHasBeenDefaulted);i=0===a&&o?r+.001:r+a,c.setCurrentTime(i),c.listen(function(e,t){(null!==e.currentRange||e.position.getPolled()>i+.1)&&(t(),c.setCurrentTime(e.position.getWanted()+.001))},{includeLastObservation:!1,clearSignal:n})},streamStatusUpdate:function(e){var t=e.period,i=e.bufferType,r=e.imminentDiscontinuity,a=e.position;I.updateDiscontinuityInfo({period:t,bufferType:i,discontinuity:r,position:a}),!n.isCancelled()&&u.isLastPeriodKnown&&e.period.id===u.periods[u.periods.length-1].id&&(e.hasFinishedLoading||e.isEmptyStream?R.onLastSegmentFinishedLoading(e.bufferType):R.onLastSegmentLoadingResume(e.bufferType))},needsManifestRefresh:function(){return C._manifestFetcher.scheduleManualRefresh({enablePartialRefresh:!0,canUseUnsafeMode:!0})},manifestMightBeOufOfSync:function(){var e=uT.getCurrent().OUT_OF_SYNC_MANIFEST_REFRESH_DELAY;C._manifestFetcher.scheduleManualRefresh({enablePartialRefresh:!1,canUseUnsafeMode:!1,delay:e})},lockedStream:function(e){return I.onLockedStream(e.bufferType,e.period)},adaptationChange:function(e){C.trigger("adaptationChange",e),n.isCancelled()||R.onAdaptationChange(e.type,e.period,e.adaptation)},representationChange:function(e){C.trigger("representationChange",e),n.isCancelled()||R.onRepresentationChange(e.type,e.period)},inbandEvent:function(e){return C.trigger("inbandEvents",e)},warning:function(e){return C.trigger("warning",e)},periodStreamReady:function(e){return C.trigger("periodStreamReady",e)},periodStreamCleared:function(e){R.onPeriodCleared(e.type,e.period),n.isCancelled()||C.trigger("periodStreamCleared",e)},bitrateEstimateChange:function(e){return C.trigger("bitrateEstimateChange",e)},needsMediaSourceReload:function(e){M(e.timeOffset,e.minimumPosition,e.maximumPosition)},needsDecipherabilityFlush:function(){var e,n,i,r,a,o=il(l);if(void 0===(e=null==o?void 0:o[0])||0>e.indexOf("widevine")){var s=w.getReference().getValue();t({position:s.position.isAwaitingFuturePosition()?s.position.getWanted():null!=(n=w.getCurrentTime())?n:s.position.getPolled(),autoPlay:!(null!=(r=null!=(i=s.paused.pending)?i:w.getIsPaused())?r:s.paused.last)})}else{var u=w.getReference().getValue(),d=u.position.isAwaitingFuturePosition()?u.position.getWanted():null!=(a=w.getCurrentTime())?a:u.position.getPolled();d+.001<u.duration?c.setCurrentTime(l.currentTime+.001):c.setCurrentTime(d)}},encryptionDataEncountered:function(e){var t=!0,i=!1,r=void 0;try{for(var a,o=e[Symbol.iterator]();!(t=(a=o.next()).done);t=!0){var s=a.value;if(f.setValue(s),n.isCancelled())return}}catch(e){i=!0,r=e}finally{try{t||null==o.return||o.return()}finally{if(i)throw r}}},error:function(e){return C._onFatalError(e)}},n)}function M(e,n,i){var r,a,o,s=w.getReference().getValue(),u=s.position.isAwaitingFuturePosition()?s.position.getWanted():null!=(r=w.getCurrentTime())?r:s.position.getPolled(),l=null!=(o=null!=(a=s.paused.pending)?a:w.getIsPaused())?o:s.paused.last,d=u+e;void 0!==n&&(d=Math.max(n,d)),void 0!==i&&(d=Math.min(i,d)),t({position:d,autoPlay:!l})}}},{key:"_createRebufferingController",value:function(e,t,n,i){var r=this,a=new d0(e,t,n);return a.addEventListener("stalled",function(e){return r.trigger("stalled",e)}),a.addEventListener("unstalled",function(){return r.trigger("unstalled",null)}),a.addEventListener("warning",function(e){return r.trigger("warning",e)}),i.register(function(){return a.destroy()}),a.start(),a}}]),n}(dK),d3=200,d8=new Map,d6=new(function(){function e(){a(this,e),this._cachedCodecSupport=new Map}return u(e,[{key:"isSupported",value:function(e,t){var n="".concat(null!=e?e:"",';codecs="').concat(null!=t?t:"",'"'),i=this._cachedCodecSupport.get(n);if(void 0!==i)return i;this._cachedCodecSupport.size>=50&&this._cachedCodecSupport.clear();var r=iV(n);return this._cachedCodecSupport.set(n,r),r}}]),e}()),d9=function(){function e(t,n){a(this,e);var r,o,s,u,l,d=n.periodStart,c=n.periodEnd,f=n.representationId,v=n.representationBitrate,h=n.isEMSGWhitelisted,p=null!=(r=t.timescale)?r:1,m=(null!=(o=t.presentationTimeOffset)?o:0)-d*p,g=(null==(s=t.initialization)?void 0:s.media)===void 0?null:iX(t.initialization.media,f,v),y=void 0===t.media?null:iX(t.media,f,v);void 0!==t.initialization?l=t.initialization.range:void 0!==t.indexRange&&(l=[0,t.indexRange[0]-1]),this._index={indexRange:t.indexRange,indexTimeOffset:m,initialization:{url:g,range:l},segmentUrlTemplate:y,startNumber:t.startNumber,endNumber:t.endNumber,timeline:null!=(u=t.timeline)?u:[],timescale:p},this._manifestBoundsCalculator=n.manifestBoundsCalculator,this._scaledPeriodStart=iW(d,this._index),this._scaledPeriodEnd=i(c)?void 0:iW(c,this._index),this._isInitialized=this._index.timeline.length>0,this._isEMSGWhitelisted=h}return u(e,[{key:"getInitSegment",value:function(){return iY(this._index,this._isEMSGWhitelisted)}},{key:"getSegments",value:function(e,t){return i0(this._index,e,t,this._manifestBoundsCalculator,this._scaledPeriodEnd,this._isEMSGWhitelisted)}},{key:"shouldRefresh",value:function(){return!1}},{key:"getFirstAvailablePosition",value:function(){var e=this._index;return 0===e.timeline.length?null:iG(Math.max(this._scaledPeriodStart,e.timeline[0].start),e)}},{key:"getLastAvailablePosition",value:function(){var e,t=this._index.timeline;return 0===t.length?null:iG(Math.min(iK(t[t.length-1],null,this._scaledPeriodEnd),null!=(e=this._scaledPeriodEnd)?e:1/0),this._index)}},{key:"getEnd",value:function(){return this.getLastAvailablePosition()}},{key:"awaitSegmentBetween",value:function(){return!1}},{key:"isSegmentStillAvailable",value:function(){return!0}},{key:"checkDiscontinuity",value:function(){return null}},{key:"canBeOutOfSyncError",value:function(){return!1}},{key:"isStillAwaitingFutureSegments",value:function(){return!1}},{key:"isInitialized",value:function(){return this._isInitialized}},{key:"initialize",value:function(e){if(!this._isInitialized){for(var t=0;t<e.length;t++)i1(this._index,e[t]);this._isInitialized=!0}}},{key:"addPredictedSegments",value:function(){uw.warn("Cannot add predicted segments to a `BaseRepresentationIndex`")}},{key:"_replace",value:function(e){this._index=e._index,this._isInitialized=e._isInitialized,this._scaledPeriodEnd=e._scaledPeriodEnd,this._isEMSGWhitelisted=e._isEMSGWhitelisted}},{key:"_update",value:function(){uw.error("Base RepresentationIndex: Cannot update a SegmentList")}}]),e}(),d7=function(){function e(t,n){if(a(this,e),void 0===t.duration)throw Error("Invalid SegmentList: no duration");var r,o,s,u=n.periodStart,l=n.periodEnd,d=n.representationId,c=n.representationBitrate,f=n.isEMSGWhitelisted;this._isEMSGWhitelisted=f,this._periodStart=u,this._periodEnd=l;var v=null!=(r=t.presentationTimeOffset)?r:0,h=null!=(o=t.timescale)?o:1,p=(null==(s=t.initialization)?void 0:s.media)===void 0?null:iX(t.initialization.media,d,c),m=t.list.map(function(e){return{url:void 0===e.media?null:iX(e.media,d,c),mediaRange:e.mediaRange}});this._index={list:m,timescale:h,duration:t.duration,indexTimeOffset:v-u*h,indexRange:t.indexRange,initialization:i(t.initialization)?void 0:{url:p,range:t.initialization.range}}}return u(e,[{key:"getInitSegment",value:function(){var e=iY(this._index);return void 0===e.privateInfos&&(e.privateInfos={}),e.privateInfos.isEMSGWhitelisted=this._isEMSGWhitelisted,e}},{key:"getSegments",value:function(e,t){for(var n,i=this._index,r=i.duration,a=i.list,o=i.timescale,s=r/o,u=y([(n=e-this._periodStart)*o,(n+t)*o],2),l=u[0],d=u[1],c=Math.min(a.length-1,Math.floor(d/r)),f=[],v=Math.floor(l/r);v<=c;){var h=a[v].mediaRange,p=a[v].url,m=v*s+this._periodStart,g={id:String(v),time:m,isInit:!1,range:h,duration:s,timescale:1,end:m+s,url:p,timestampOffset:-(i.indexTimeOffset/o),complete:!0,privateInfos:{isEMSGWhitelisted:this._isEMSGWhitelisted}};f.push(g),v++}return f}},{key:"shouldRefresh",value:function(e,t){return!1}},{key:"getFirstAvailablePosition",value:function(){return this._periodStart}},{key:"getLastAvailablePosition",value:function(){var e,t=this._index,n=t.duration;return Math.min(t.list.length*n/t.timescale+this._periodStart,null!=(e=this._periodEnd)?e:1/0)}},{key:"getEnd",value:function(){return this.getLastAvailablePosition()}},{key:"awaitSegmentBetween",value:function(){return!1}},{key:"isSegmentStillAvailable",value:function(){return!0}},{key:"checkDiscontinuity",value:function(){return null}},{key:"canBeOutOfSyncError",value:function(){return!1}},{key:"isStillAwaitingFutureSegments",value:function(){return!1}},{key:"isInitialized",value:function(){return!0}},{key:"initialize",value:function(){uw.error("A `ListRepresentationIndex` does not need to be initialized")}},{key:"addPredictedSegments",value:function(){uw.warn("Cannot add predicted segments to a `ListRepresentationIndex`")}},{key:"_replace",value:function(e){this._index=e._index}},{key:"_update",value:function(){uw.error("A `ListRepresentationIndex` cannot be updated")}}]),e}(),ce=function(){function e(t,n){a(this,e);var r,o,s,u=n.availabilityTimeOffset,l=n.manifestBoundsCalculator,d=n.isDynamic,c=n.periodEnd,f=n.periodStart,v=n.representationId,h=n.representationBitrate,p=n.isEMSGWhitelisted,m=null!=(r=t.timescale)?r:1;this._availabilityTimeOffset=u,this._manifestBoundsCalculator=l;var g=null!=(o=t.presentationTimeOffset)?o:0;if(void 0===t.duration)throw Error("Invalid SegmentTemplate: no duration");var y=(null==(s=t.initialization)?void 0:s.media)===void 0?null:iX(t.initialization.media,v,h),_=void 0===t.media?null:iX(t.media,v,h);this._index={duration:t.duration,timescale:m,indexRange:t.indexRange,indexTimeOffset:g-f*m,initialization:i(t.initialization)?void 0:{url:y,range:t.initialization.range},url:_,presentationTimeOffset:g,startNumber:t.startNumber,endNumber:t.endNumber},this._isDynamic=d,this._periodStart=f,this._scaledRelativePeriodEnd=void 0===c?void 0:(c-f)*m,this._isEMSGWhitelisted=p}return u(e,[{key:"getInitSegment",value:function(){return iY(this._index,this._isEMSGWhitelisted)}},{key:"getSegments",value:function(e,t){var n=this._index,r=n.duration,a=n.startNumber,o=n.endNumber,s=n.timescale,u=n.url,l=this._periodStart*s,d=this._scaledRelativePeriodEnd,c=this._getFirstSegmentStart(),f=this._getLastSegmentStart();if(i(c)||i(f))return[];var v=Math.max(c,e*s-l),h=Math.min(f,(e+t)*s-l);if(h+r<=v)return[];for(var p=[],m=null!=a?a:1,g=Math.floor(v/r),y=g*r;y<=h;y+=r){var _=g+m;if(void 0!==o&&_>o)break;var S=!i(d)&&y+r>d?d-y:r,b=y+l,E=y+this._index.presentationTimeOffset,k=null===u?null:iZ(E,_)(u),T={id:String(_),number:_,time:b/s,end:(b+S)/s,duration:S/s,timescale:1,isInit:!1,scaledDuration:S/s,url:k,timestampOffset:-(n.indexTimeOffset/s),complete:!0,privateInfos:{isEMSGWhitelisted:this._isEMSGWhitelisted}};p.push(T),g++}return p}},{key:"getFirstAvailablePosition",value:function(){var e=this._getFirstSegmentStart();return i(e)?e:e/this._index.timescale+this._periodStart}},{key:"getLastAvailablePosition",value:function(){var e=this._getLastSegmentStart();if(i(e))return e;var t=this._estimateRelativeScaledEnd();return Math.min(e+this._index.duration,null!=t?t:1/0)/this._index.timescale+this._periodStart}},{key:"getEnd",value:function(){if(!this._isDynamic)return this.getLastAvailablePosition();var e=this._estimateRelativeScaledEnd();if(void 0!==e){var t=this._index.timescale;return(e+this._periodStart*t)/t}}},{key:"awaitSegmentBetween",value:function(e,t){if(W(e<=t),!this._isDynamic)return!1;var n=this._index.timescale,r=i2(n),a=this._periodStart*n,o=e*n-a,s=t*n-a,u=this._getLastSegmentStart();if(i(u)){var l=this._estimateRelativeScaledEnd();return void 0===l?s+r>=0:s+r>=0&&o<l-r}var d=u+this._index.duration,c=this._estimateRelativeScaledEnd();return void 0===c?s>d-r:s>d-r&&o<c-r}},{key:"shouldRefresh",value:function(){return!1}},{key:"checkDiscontinuity",value:function(){return null}},{key:"isSegmentStillAvailable",value:function(e){if(e.isInit)return!0;var t=this.getSegments(e.time,.1);return 0!==t.length&&t[0].time===e.time&&t[0].end===e.end&&t[0].number===e.number}},{key:"canBeOutOfSyncError",value:function(){return!1}},{key:"isStillAwaitingFutureSegments",value:function(){if(!this._isDynamic)return!1;var e=this._estimateRelativeScaledEnd();if(void 0===e)return!0;var t=this._index.timescale,n=this._getLastSegmentStart();return!!i(n)||n+this._index.duration+i2(t)<e}},{key:"isInitialized",value:function(){return!0}},{key:"initialize",value:function(){uw.error("A `TemplateRepresentationIndex` does not need to be initialized")}},{key:"addPredictedSegments",value:function(){uw.warn("Cannot add predicted segments to a `TemplateRepresentationIndex`")}},{key:"_replace",value:function(e){this._index=e._index,this._isDynamic=e._isDynamic,this._periodStart=e._periodStart,this._scaledRelativePeriodEnd=e._scaledRelativePeriodEnd,this._manifestBoundsCalculator=e._manifestBoundsCalculator}},{key:"_update",value:function(e){this._replace(e)}},{key:"_getFirstSegmentStart",value:function(){if(!this._isDynamic)return 0;if(0===this._scaledRelativePeriodEnd||void 0===this._scaledRelativePeriodEnd){var e,t=this._manifestBoundsCalculator.getEstimatedMaximumPosition(null!=(e=this._availabilityTimeOffset)?e:0);if(void 0!==t&&t<this._periodStart)return null}var n=this._index,i=n.duration,r=n.timescale,a=this._manifestBoundsCalculator.getEstimatedMinimumSegmentTime();if(void 0!==a)return Math.floor((a>this._periodStart?(a-this._periodStart)*r:0)/i)*i}},{key:"_getLastSegmentStart",value:function(){var e,t,n=this._index,i=n.duration,r=n.timescale,a=n.endNumber,o=n.startNumber,s=void 0===o?1:o;if(this._isDynamic){var u=this._manifestBoundsCalculator.getEstimatedLiveEdge();if(void 0!==u&&void 0!==this._scaledRelativePeriodEnd&&this._scaledRelativePeriodEnd<u-this._periodStart*this._index.timescale){var l=Math.ceil(this._scaledRelativePeriodEnd/i);return void 0!==a&&a-s+1<l&&(l=a-s+1),(l-1)*i}var d=this._manifestBoundsCalculator.getEstimatedMaximumPosition(null!=(e=this._availabilityTimeOffset)?e:0);if(void 0===d)return;var c=(d-this._periodStart)*r;if(c<0)return null;var f=Math.floor(c/i);return void 0!==a&&a-s+1<f&&(f=a-s+1),f<=0?null:(f-1)*i}var v=null!=(t=this._scaledRelativePeriodEnd)?t:0,h=Math.ceil(v/i);void 0!==a&&a-s+1<h&&(h=a-s+1);var p=(h-1)*i,m=uT.getCurrent().MINIMUM_SEGMENT_SIZE*r;return void 0!==a||v-p>m||h<2?p:(h-2)*i}},{key:"_estimateRelativeScaledEnd",value:function(){var e,t;return void 0!==this._index.endNumber?Math.max(Math.min((this._index.endNumber-(null!=(e=this._index.startNumber)?e:1)+1)*this._index.duration,null!=(t=this._scaledRelativePeriodEnd)?t:1/0),0):void 0!==this._scaledRelativePeriodEnd?Math.max(this._scaledRelativePeriodEnd,0):void 0}}]),e}(),ct=function(){function e(t,n){if(a(this,e),!e.isTimelineIndexArgument(t))throw Error("The given index is not compatible with a TimelineRepresentationIndex.");var r=n.availabilityTimeComplete,o=n.availabilityTimeOffset,s=n.manifestBoundsCalculator,u=n.isDynamic,l=n.isLastPeriod,d=n.representationId,c=n.representationBitrate,f=n.periodStart,h=n.periodEnd,p=n.isEMSGWhitelisted,m=null!=(_=t.timescale)?_:1,g=null!=(S=t.presentationTimeOffset)?S:0,y=f*m;this._manifestBoundsCalculator=s,this._isEMSGWhitelisted=p,this._isLastPeriod=l,this._lastUpdate=null!=(b=n.receivedTime)?b:uN(),this._unsafelyBaseOnPreviousIndex=null,null!==n.unsafelyBaseOnPreviousRepresentation&&v(n.unsafelyBaseOnPreviousRepresentation.index,e)&&(n.unsafelyBaseOnPreviousRepresentation.index._unsafelyBaseOnPreviousIndex=null,this._unsafelyBaseOnPreviousIndex=n.unsafelyBaseOnPreviousRepresentation.index),this._isDynamic=u,this._parseTimeline=null!=(E=t.timelineParser)?E:null;var _,S,b,E,k,T,w=(null==(k=t.initialization)?void 0:k.media)===void 0?null:iX(t.initialization.media,d,c),I=void 0===t.media?null:iX(t.media,d,c);T=void 0===o&&void 0===r?1/0:null!=o?o:0,this._index={availabilityTimeComplete:null==r||r,availabilityTimeOffset:T,indexRange:t.indexRange,indexTimeOffset:g-y,initialization:i(t.initialization)?void 0:{url:w,range:t.initialization.range},segmentUrlTemplate:I,startNumber:t.startNumber,endNumber:t.endNumber,timeline:void 0===t.timeline?null:rt(t.timeline,t.startNumber,t.endNumber),timescale:m},this._scaledPeriodStart=iW(f,this._index),this._scaledPeriodEnd=void 0===h?void 0:iW(h,this._index)}return u(e,[{key:"getInitSegment",value:function(){return iY(this._index,this._isEMSGWhitelisted)}},{key:"getSegments",value:function(e,t){this._refreshTimeline(),null===this._index.timeline&&(this._index.timeline=this._getTimeline());var n=this._index;return i0({segmentUrlTemplate:n.segmentUrlTemplate,startNumber:n.startNumber,endNumber:n.endNumber,timeline:n.timeline,timescale:n.timescale,indexTimeOffset:n.indexTimeOffset},e,t,this._manifestBoundsCalculator,this._scaledPeriodEnd,this._isEMSGWhitelisted)}},{key:"shouldRefresh",value:function(){return!1}},{key:"getFirstAvailablePosition",value:function(){this._refreshTimeline(),null===this._index.timeline&&(this._index.timeline=this._getTimeline());var e=this._index.timeline;return 0===e.length?null:iG(Math.max(this._scaledPeriodStart,e[0].start),this._index)}},{key:"getLastAvailablePosition",value:function(){this._refreshTimeline(),null===this._index.timeline&&(this._index.timeline=this._getTimeline());var e,t=ri(this._index,this._manifestBoundsCalculator,this._scaledPeriodEnd);return null===t?null:iG(Math.min(t.end,null!=(e=this._scaledPeriodEnd)?e:1/0),this._index)}},{key:"getEnd",value:function(){if(!this._isDynamic||this._isLastPeriod){var e;return(this._refreshTimeline(),null===this._index.timeline&&(this._index.timeline=this._getTimeline()),this._index.timeline.length<=0)?null:iG(Math.min(iK(this._index.timeline[this._index.timeline.length-1],null,this._scaledPeriodEnd),null!=(e=this._scaledPeriodEnd)?e:1/0),this._index)}}},{key:"awaitSegmentBetween",value:function(e,t){if(W(e<=t),!this._isDynamic)return!1;this._refreshTimeline(),null===this._index.timeline&&(this._index.timeline=this._getTimeline());var n,i,r=this._index,a=r.timescale,o=r.timeline,s=i2(a),u=iW(t,this._index),l=ri(this._index,this._manifestBoundsCalculator,this._scaledPeriodEnd);if(null!==l&&Math.min(l.end,null!=(n=this._scaledPeriodEnd)?n:1/0)+s>=Math.min(u,null!=(i=this._scaledPeriodEnd)?i:1/0))return!1;var d=iW(e,this._index);return!!(o.length>0&&null!==l&&!l.isLastOfTimeline&&d<iK(o[o.length-1],null,this._scaledPeriodEnd)+s+s)||!!this._isLastPeriod&&(void 0===this._scaledPeriodEnd?u+s>this._scaledPeriodStart&&void 0:d-s<this._scaledPeriodEnd&&u+s>this._scaledPeriodStart)}},{key:"isSegmentStillAvailable",value:function(e){return!!e.isInit||(this._refreshTimeline(),null===this._index.timeline&&(this._index.timeline=this._getTimeline()),rn(e,this._index,this._manifestBoundsCalculator,this._scaledPeriodEnd))}},{key:"checkDiscontinuity",value:function(e){this._refreshTimeline();var t=this._index.timeline;return null===t&&(t=this._getTimeline(),this._index.timeline=t),iq({timeline:t,timescale:this._index.timescale,indexTimeOffset:this._index.indexTimeOffset},e,this._scaledPeriodEnd)}},{key:"canBeOutOfSyncError",value:function(e){return!!this._isDynamic&&v(e,u5)&&e.isHttpError(404)}},{key:"_replace",value:function(e){this._parseTimeline=e._parseTimeline,this._index=e._index,this._isDynamic=e._isDynamic,this._scaledPeriodStart=e._scaledPeriodStart,this._scaledPeriodEnd=e._scaledPeriodEnd,this._lastUpdate=e._lastUpdate,this._manifestBoundsCalculator=e._manifestBoundsCalculator,this._isLastPeriod=e._isLastPeriod}},{key:"_update",value:function(e){null===this._index.timeline&&(this._index.timeline=this._getTimeline()),null===e._index.timeline&&(e._index.timeline=e._getTimeline()),i4(this._index.timeline,e._index.timeline)&&(this._index.startNumber=e._index.startNumber),this._index.availabilityTimeOffset=e._index.availabilityTimeOffset,this._index.availabilityTimeComplete=e._index.availabilityTimeComplete,this._index.endNumber=e._index.endNumber,this._isDynamic=e._isDynamic,this._scaledPeriodStart=e._scaledPeriodStart,this._scaledPeriodEnd=e._scaledPeriodEnd,this._lastUpdate=e._lastUpdate,this._isLastPeriod=e._isLastPeriod}},{key:"isStillAwaitingFutureSegments",value:function(){if(!this._isDynamic)return!1;this._refreshTimeline(),null===this._index.timeline&&(this._index.timeline=this._getTimeline());var e,t=this._index.timeline;if(0===t.length){if(void 0!==this._scaledPeriodEnd){var n=this._manifestBoundsCalculator.getEstimatedLiveEdge();if(void 0!==n&&iW(n,this._index)>this._scaledPeriodEnd)return!1}return this._isLastPeriod}var i=i2(this._index.timescale),r=ri(this._index,this._manifestBoundsCalculator,this._scaledPeriodEnd);if(null!==r&&!r.isLastOfTimeline){var a=Math.min(r.end,null!=(e=this._scaledPeriodEnd)?e:1/0);return!(void 0!==this._scaledPeriodEnd&&a+i>=this._scaledPeriodEnd)}return!!this._isLastPeriod&&(void 0===this._scaledPeriodEnd||iK(t[t.length-1],null,this._scaledPeriodEnd)+i<this._scaledPeriodEnd)}},{key:"isInitialized",value:function(){return!0}},{key:"initialize",value:function(){uw.error("A `TimelineRepresentationIndex` does not need to be initialized")}},{key:"addPredictedSegments",value:function(){uw.warn("Cannot add predicted segments to a `TimelineRepresentationIndex`")}},{key:"_refreshTimeline",value:function(){if(null===this._index.timeline&&(this._index.timeline=this._getTimeline()),this._isDynamic){var e=this._manifestBoundsCalculator.getEstimatedMinimumSegmentTime();if(!i(e)){var t=iW(e,this._index),n=i5(this._index.timeline,t);void 0!==this._index.startNumber?this._index.startNumber+=n:void 0!==this._index.endNumber&&(this._index.startNumber=n+1)}}}},{key:"_getTimeline",value:function(){if(null===this._parseTimeline)return null!==this._index.timeline?this._index.timeline:(uw.error("DASH: Timeline already lazily parsed."),[]);var e,t=this._parseTimeline();this._parseTimeline=null;var n=uT.getCurrent().MIN_DASH_S_ELEMENTS_TO_PARSE_UNSAFELY;return null===this._unsafelyBaseOnPreviousIndex||t.length<n?rt(i9(t),this._index.startNumber,this._index.endNumber):(null===this._unsafelyBaseOnPreviousIndex._index.timeline?(e=this._unsafelyBaseOnPreviousIndex._getTimeline(),this._unsafelyBaseOnPreviousIndex._index.timeline=e):e=this._unsafelyBaseOnPreviousIndex._index.timeline,this._unsafelyBaseOnPreviousIndex=null,rt(re(t,e),this._index.startNumber,this._index.endNumber))}}],[{key:"isTimelineIndexArgument",value:function(e){return"function"==typeof e.timelineParser||Array.isArray(e.timeline)}}]),e}(),cn=/^(?:[a-z]+:)?\/\//i,ci=/\/\.{1,2}\//;function cr(e){var t=e.lastIndexOf("/");if(t<0)return e.length;if(cn.test(e)){var n=e.indexOf("/");if(n>=0&&t===n+1)return e.length}var i=e.indexOf("?");return i>=0&&i<t?cr(e.substring(0,i)):t+1}var ca=function(){function e(t){a(this,e),this._isDynamic=t.isDynamic,this._timeShiftBufferDepth=t.isDynamic&&void 0!==t.timeShiftBufferDepth?t.timeShiftBufferDepth:null,this._serverTimestampOffset=t.serverTimestampOffset,this._availabilityStartTime=t.availabilityStartTime}return u(e,[{key:"setLastPosition",value:function(e,t){this._lastPosition=e,this._positionTime=t}},{key:"lastPositionIsKnown",value:function(){return this._isDynamic?void 0!==this._positionTime&&void 0!==this._lastPosition:void 0!==this._lastPosition}},{key:"getEstimatedMinimumSegmentTime",value:function(){if(!this._isDynamic||null===this._timeShiftBufferDepth)return 0;var e,t=null!=(e=this.getEstimatedLiveEdge())?e:this.getEstimatedMaximumPosition(0);return void 0===t?void 0:t-this._timeShiftBufferDepth}},{key:"getEstimatedLiveEdge",value:function(){if(!(!this._isDynamic||void 0===this._serverTimestampOffset))return(uN()+this._serverTimestampOffset)/1e3-this._availabilityStartTime}},{key:"getEstimatedMaximumPosition",value:function(e){if(!this._isDynamic)return this._lastPosition;var t=this.getEstimatedLiveEdge();return void 0!==t&&e!==1/0?t+e:void 0!==this._positionTime&&void 0!==this._lastPosition?Math.max(this._lastPosition-this._positionTime+uN()/1e3,0):this._lastPosition}}]),e}(),co=function(e,t){var n=!0,i=!1,r=void 0;try{for(var a,o=t[Symbol.iterator]();!(n=(a=o.next()).done);n=!0){var s=a.value,u=s.adaptation,l=s.trickModeAttachedAdaptationIds,d=!0,c=!1,f=void 0,v=!0,h=!1,p=void 0;try{for(var m,g=l[Symbol.iterator]();!(v=(m=g.next()).done);v=!0){var y=m.value;try{for(var _,S=la[Symbol.iterator]();!(d=(_=S.next()).done);d=!0){var b=e[_.value],E=!0,k=!1,T=void 0;if(void 0!==b)try{for(var w,I=b[Symbol.iterator]();!(E=(w=I.next()).done);E=!0){var A=w.value;A.id===y&&(void 0===A.trickModeTracks&&(A.trickModeTracks=[]),A.trickModeTracks.push(u))}}catch(e){k=!0,T=e}finally{try{E||null==I.return||I.return()}finally{if(k)throw T}}}}catch(e){c=!0,f=e}finally{try{d||null==S.return||S.return()}finally{if(c)throw f}}}}catch(e){h=!0,p=e}finally{try{v||null==g.return||g.return()}finally{if(h)throw p}}}}catch(e){i=!0,r=e}finally{try{n||null==o.return||o.return()}finally{if(i)throw r}}},cs=["subtitle","caption"],cu=/[, ]+/g,cl=ey(),cd=function e(t,n,r,a){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:new WeakMap,s=t.children,u=t.attributes;if(i(n.externalClockOffset)){var l="dynamic"===u.type,d=j(s.utcTimings,function(e){return"urn:mpeg:dash:utc:direct:2014"===e.schemeIdUri&&!i(e.value)}),c=i(d)||i(d.value)?void 0:ro(d.value),f=i(c)||isNaN(c)?void 0:c;if(i(f)||!0===a){if(l&&!0!==a){var v=rs(t);if(!i(v)&&v.length>0)return{type:"needs-clock",value:{url:v,continue:function(i){return i.success?n.externalClockOffset=ro(i.data):(r.push(i.error),uw.warn("DASH Parser: Error on fetching the clock ressource",i.error)),e(t,n,r,!0)}}}}}else n.externalClockOffset=f}for(var h=[],p=0;p<s.periods.length;p++){var m=s.periods[p].attributes,g=m.xlinkHref,y=m.xlinkActuate;i(g)||"onLoad"!==y||h.push({index:p,ressource:g})}return 0===h.length?rD(t,n,r,o):{type:"needs-xlinks",value:{xlinksUrls:h.map(function(e){return e.ressource}),continue:function(i){if(i.length!==h.length)throw Error("DASH parser: wrong number of loaded ressources.");for(var u=i.length-1;u>=0;u--){var l=h[u].index,d=i[u],c=d.parsed,f=d.warnings,v=d.receivedTime,p=d.sendingTime,m=d.url;f.length>0&&r.push.apply(r,S(f));var g=!0,y=!1,_=void 0;try{for(var b,E,k=c[Symbol.iterator]();!(g=(E=k.next()).done);g=!0){var T=E.value;o.set(T,{receivedTime:v,sendingTime:p,url:m})}}catch(e){y=!0,_=e}finally{try{g||null==k.return||k.return()}finally{if(y)throw _}}(b=s.periods).splice.apply(b,[l,1].concat(S(c)))}return e(t,n,r,a,o)}}}},cc=/^P(([\d.]*)Y)?(([\d.]*)M)?(([\d.]*)D)?T?(([\d.]*)H)?(([\d.]*)M)?(([\d.]*)S)?/,cf=/([0-9]+)-([0-9]+)/,cv=function(e){f(i,e);var t=w(i);function i(e){var r;return a(this,i),Object.setPrototypeOf(n(r=t.call(this)),i.prototype),r.name="MPDError",r.message=e,m(r)}return i}(k(Error)),ch=function(e,t){var n=e.documentElement;if(i(n)||"MPD"!==n.nodeName)throw Error("DASH Parser: document root should be MPD");var r=y(ar(n),2);return function e(t){return"done"===t.type?t:"needs-clock"===t.type?{type:"needs-resources",value:{urls:[t.value.url],format:"string",continue:function(n){if(1!==n.length)throw Error("DASH parser: wrong number of loaded ressources.");return e(t.value.continue(n[0].responseData))}}}:"needs-xlinks"===t.type?{type:"needs-resources",value:{urls:t.value.xlinksUrls,format:"string",continue:function(n){for(var r=[],a=0;a<n.length;a++){var o=n[a],s=o.responseData,u=o.receivedTime,l=o.sendingTime,d=o.url;if(!s.success)throw s.error;var c="<root>"+s.data+"</root>",f=new DOMParser().parseFromString(c,"text/xml");if(i(f)||0===f.children.length)throw Error("DASH parser: Invalid external ressources");for(var v=f.children[0].children,h=[],p=[],m=0;m<v.length;m++)if(v[m].nodeType===Node.ELEMENT_NODE){var g=y(at(v[m]),2),_=g[0],b=g[1];p.push.apply(p,S(b)),h.push(_)}r.push({url:d,receivedTime:u,sendingTime:l,parsed:h,warnings:p})}return e(t.value.continue(r))}}}:void H(t)}(cd(r[0],t,r[1]))},cp=408125543,cm=357149030,cg=2807729,cy=17545,c_=475249515,cS=187,cb=179,cE=183,ck=241;function cT(e,t,n,i){for(var r=y(i,2),a=r[0],o=r[1],s=a;s<o;){var u=aI(n,s);if(null===u)break;var l=u.value,d=s+u.length,c=aA(n,d);if(null===c)break;var f=c.length,v=c.value,h=d+f,p=h+v;if(l===e)return[h,p];if(t.length>0){for(var m=0;m<t.length;m++)if(l===t[m])return cT(e,t.slice(m+1,t.length),n,[h,p])}s=p}return null}var cw=function(e){var t=aa({customManifestLoader:e.manifestLoader},null!==le.dashParsers.wasm&&("initialized"===le.dashParsers.wasm.status||"initializing"===le.dashParsers.wasm.status)?"text":"arraybuffer"),n=ao(e),i=ab(e),r=aN(e);return{manifest:{loadManifest:t,parseManifest:n},audio:{loadSegment:i,parseSegment:r},video:{loadSegment:i,parseSegment:r},text:{loadSegment:aO(e),parseSegment:aW(e)}}},cI="function"==typeof MediaSource&&!0===MediaSource.canConstructInDedicatedWorker,cA=function(e){f(n,e);var t=w(n);function n(e){var i;return a(this,n),(i=t.call(this))._settings=e,i._initCanceller=new uM,m(i)}return u(n,[{key:"prepare",value:function(){}},{key:"start",value:function(e,t){var n=this,i=this._initCanceller.signal,r=this._settings,a=r.keySystems,o=r.speed,u=r.url;ip(e);var l=new uR(null);l.finish();var d=iP(e,a,l,{onError:function(e){return n._onFatalError(e)},onWarning:function(e){return n.trigger("warning",e)},onBlackListProtectionData:s,onKeyIdsCompatibilityUpdate:s},i);iU(e,function(e){return n._onFatalError(e)},i);var c=new d0(t,null,o);c.addEventListener("stalled",function(e){return n.trigger("stalled",e)}),c.addEventListener("unstalled",function(){return n.trigger("unstalled",null)}),c.addEventListener("warning",function(e){return n.trigger("warning",e)}),i.register(function(){c.destroy()}),c.start(),d.onUpdate(function(r,a){"uninitialized"!==r.initializationState.type&&(a(),uw.info("Setting URL to HTMLMediaElement",u),e.src=u,i.register(function(){uw.info("Init: Removing directfile src from media element",e.src),ip(e)}),"awaiting-media-link"===r.initializationState.type?(r.initializationState.value.isMediaLinked.setValue(!0),d.onUpdate(function(i,r){"initialized"===i.initializationState.type&&(r(),n._seekAndPlay(e,t))},{emitCurrentValue:!0,clearSignal:i})):(W("initialized"===r.initializationState.type),n._seekAndPlay(e,t)))},{emitCurrentValue:!0,clearSignal:i})}},{key:"updateContentUrls",value:function(e,t){throw Error("Cannot update content URL of directfile contents")}},{key:"dispose",value:function(){this._initCanceller.cancel()}},{key:"_onFatalError",value:function(e){this._initCanceller.cancel(),this.trigger("error",e)}},{key:"_seekAndPlay",value:function(e,t){var n=this,i=this._initCanceller.signal,r=this._settings,a=r.autoPlay,o=r.startAt;iM({mediaElement:e,playbackObserver:t,startTime:function(){uw.debug("Init: Calculating initial time");var t=aG(e,o);return uw.debug("Init: Initial time calculated:",t),t},mustAutoPlay:a,onWarning:function(e){return n.trigger("warning",e)},isDirectfile:!0},i).autoPlayResult.then(function(){return iC(t,e,!0,i).onUpdate(function(e,t){e&&(t(),n.trigger("loaded",{segmentSinksStore:null}))},{emitCurrentValue:!0,clearSignal:i})}).catch(function(e){i.isCancelled()||n._onFatalError(e)})}}]),n}(dK),cR=function(e){f(n,e);var t=w(n);function n(e){var i,r,o,s;return a(this,n),(i=t.call(this))._nativeAudioTracks=e.audioTracks,i._nativeVideoTracks=e.videoTracks,i._nativeTextTracks=e.textTracks,i._audioTracks=void 0!==i._nativeAudioTracks?aY(i._nativeAudioTracks):[],i._videoTracks=void 0!==i._nativeVideoTracks?aQ(i._nativeVideoTracks):[],i._textTracks=void 0!==i._nativeTextTracks?aj(i._nativeTextTracks):[],i._lastEmittedNativeAudioTrack=null==(r=i._getCurrentAudioTrack())?void 0:r.nativeTrack,i._lastEmittedNativeVideoTrack=null==(o=i._getCurrentVideoTrack())?void 0:o.nativeTrack,i._lastEmittedNativeTextTrack=null==(s=i._getCurrentTextTrack())?void 0:s.nativeTrack,i._handleNativeTracksCallbacks(),m(i)}return u(n,[{key:"setAudioTrackById",value:function(e){for(var t=0;t<this._audioTracks.length;t++){var n=this._audioTracks[t],i=n.track,r=n.nativeTrack;if(i.id===e){this._enableAudioTrackFromIndex(t),this._audioTrackLockedOn=r;return}}throw Error("Audio track not found.")}},{key:"disableTextTrack",value:function(){aX(this._textTracks),this._textTrackLockedOn=null}},{key:"setTextTrackById",value:function(e){for(var t=!1,n=0;n<this._textTracks.length;n++){var i=this._textTracks[n],r=i.track,a=i.nativeTrack;r.id===e?(a.mode="showing",t=!0,this._textTrackLockedOn=a):("showing"===a.mode||"hidden"===a.mode)&&(a.mode="disabled")}if(!t)throw Error("Text track not found.")}},{key:"disableVideoTrack",value:function(){aZ(this._videoTracks),this._videoTrackLockedOn=null}},{key:"setVideoTrackById",value:function(e){for(var t=0;t<this._videoTracks.length;t++){var n=this._videoTracks[t],i=n.track,r=n.nativeTrack;if(i.id===e){r.selected=!0,this._videoTrackLockedOn=r;return}}throw Error("Video track not found.")}},{key:"getChosenAudioTrack",value:function(){var e=this._getCurrentAudioTrack();return i(e)?e:e.track}},{key:"getChosenTextTrack",value:function(){var e=this._getCurrentTextTrack();return i(e)?e:e.track}},{key:"getChosenVideoTrack",value:function(){var e=this._getCurrentVideoTrack();return i(e)?e:e.track}},{key:"getAvailableAudioTracks",value:function(){return this._audioTracks.map(function(e){var t=e.track,n=e.nativeTrack;return{id:t.id,language:t.language,normalized:t.normalized,audioDescription:t.audioDescription,active:n.enabled,representations:t.representations}})}},{key:"getAvailableTextTracks",value:function(){return this._textTracks.map(function(e){var t=e.track,n=e.nativeTrack;return{id:t.id,label:t.label,forced:t.forced,language:t.language,normalized:t.normalized,closedCaption:t.closedCaption,active:"showing"===n.mode}})}},{key:"getAvailableVideoTracks",value:function(){return this._videoTracks.map(function(e){var t=e.track,n=e.nativeTrack;return{id:t.id,representations:t.representations,active:n.selected}})}},{key:"dispose",value:function(){void 0!==this._nativeVideoTracks&&(this._nativeVideoTracks.onchange=null,this._nativeVideoTracks.onaddtrack=null,this._nativeVideoTracks.onremovetrack=null),void 0!==this._nativeAudioTracks&&(this._nativeAudioTracks.onchange=null,this._nativeAudioTracks.onaddtrack=null,this._nativeAudioTracks.onremovetrack=null),void 0!==this._nativeTextTracks&&(this._nativeTextTracks.onchange=null,this._nativeTextTracks.onaddtrack=null,this._nativeTextTracks.onremovetrack=null),this.removeEventListener()}},{key:"_getCurrentAudioTrack",value:function(){if(void 0!==this._nativeAudioTracks){for(var e=0;e<this._audioTracks.length;e++){var t=this._audioTracks[e];if(t.nativeTrack.enabled)return t}return null}}},{key:"_getCurrentVideoTrack",value:function(){if(void 0!==this._nativeVideoTracks){for(var e=0;e<this._videoTracks.length;e++){var t=this._videoTracks[e];if(t.nativeTrack.selected)return t}return null}}},{key:"_getCurrentTextTrack",value:function(){if(void 0!==this._nativeTextTracks){for(var e=0;e<this._textTracks.length;e++){var t=this._textTracks[e];if("showing"===t.nativeTrack.mode)return t}return null}}},{key:"_setPreviouslyLockedAudioTrack",value:function(){if(void 0!==this._audioTrackLockedOn){if(null===this._audioTrackLockedOn)for(var e=0;e<this._audioTracks.length;e++)this._audioTracks[e].nativeTrack.enabled=!1;else for(var t=0;t<this._audioTracks.length;t++)if(this._audioTracks[t].nativeTrack===this._audioTrackLockedOn){this._enableAudioTrackFromIndex(t);return}}}},{key:"_setPreviouslyLockedTextTrack",value:function(){if(void 0!==this._textTrackLockedOn){if(null===this._textTrackLockedOn){aX(this._textTracks);return}for(var e=0;e<this._textTracks.length;e++){var t=this._textTracks[e].nativeTrack;if(t===this._textTrackLockedOn){a$(this._textTracks,t),"showing"!==t.mode&&(t.mode="showing");return}}}}},{key:"_setPreviouslyLockedVideoTrack",value:function(){if(void 0!==this._videoTrackLockedOn){if(null===this._videoTrackLockedOn){aZ(this._videoTracks);return}for(var e=0;e<this._videoTracks.length;e++){var t=this._videoTracks[e].nativeTrack;if(t===this._videoTrackLockedOn){t.selected=!0;return}}}}},{key:"_handleNativeTracksCallbacks",value:function(){var e=this;void 0!==this._nativeAudioTracks&&(this._nativeAudioTracks.onaddtrack=function(){var t,n;if(void 0!==e._nativeAudioTracks){var i=aY(e._nativeAudioTracks);if(aq(e._audioTracks,i)){e._audioTracks=i,e._setPreviouslyLockedAudioTrack(),e.trigger("availableAudioTracksChange",e.getAvailableAudioTracks());var r=e._getCurrentAudioTrack();(null==r?void 0:r.nativeTrack)!==e._lastEmittedNativeAudioTrack&&(e.trigger("audioTrackChange",null!=(t=null==r?void 0:r.track)?t:null),e._lastEmittedNativeAudioTrack=null!=(n=null==r?void 0:r.nativeTrack)?n:null)}}},this._nativeAudioTracks.onremovetrack=function(){var t,n;if(void 0!==e._nativeAudioTracks){var i=aY(e._nativeAudioTracks);if(aq(e._audioTracks,i)){e._audioTracks=i,e.trigger("availableAudioTracksChange",e.getAvailableAudioTracks());var r=e._getCurrentAudioTrack();(null==r?void 0:r.nativeTrack)!==e._lastEmittedNativeAudioTrack&&(e.trigger("audioTrackChange",null!=(t=null==r?void 0:r.track)?t:null),e._lastEmittedNativeAudioTrack=null!=(n=null==r?void 0:r.nativeTrack)?n:null)}}},this._nativeAudioTracks.onchange=function(){if(void 0!==e._audioTracks)for(var t=0;t<e._audioTracks.length;t++){var n=e._audioTracks[t],i=n.track,r=n.nativeTrack;if(r.enabled){r!==e._lastEmittedNativeAudioTrack&&(e.trigger("audioTrackChange",i),e._lastEmittedNativeAudioTrack=r);return}}null!==e._lastEmittedNativeAudioTrack&&(e.trigger("audioTrackChange",null),e._lastEmittedNativeAudioTrack=null)}),void 0!==this._nativeTextTracks&&(this._nativeTextTracks.onaddtrack=function(){var t,n;if(void 0!==e._nativeTextTracks){var i=aj(e._nativeTextTracks);if(aq(e._textTracks,i)){e._textTracks=i,e._setPreviouslyLockedTextTrack(),e.trigger("availableTextTracksChange",e.getAvailableTextTracks());var r=e._getCurrentTextTrack();(null==r?void 0:r.nativeTrack)!==e._lastEmittedNativeTextTrack&&(e.trigger("textTrackChange",null!=(t=null==r?void 0:r.track)?t:null),e._lastEmittedNativeTextTrack=null!=(n=null==r?void 0:r.nativeTrack)?n:null)}}},this._nativeTextTracks.onremovetrack=function(){var t,n;if(void 0!==e._nativeTextTracks){var i=aj(e._nativeTextTracks);if(aq(e._textTracks,i)){e._textTracks=i,e._setPreviouslyLockedTextTrack(),e.trigger("availableTextTracksChange",e.getAvailableTextTracks());var r=e._getCurrentTextTrack();(null==r?void 0:r.nativeTrack)!==e._lastEmittedNativeTextTrack&&(e.trigger("textTrackChange",null!=(t=null==r?void 0:r.track)?t:null),e._lastEmittedNativeTextTrack=null!=(n=null==r?void 0:r.nativeTrack)?n:null)}}},this._nativeTextTracks.onchange=function(){if(void 0!==e._textTracks)for(var t=0;t<e._textTracks.length;t++){var n=e._textTracks[t],i=n.track,r=n.nativeTrack;if("showing"===r.mode){r!==e._lastEmittedNativeTextTrack&&(e.trigger("textTrackChange",i),e._lastEmittedNativeTextTrack=r);return}}null!==e._lastEmittedNativeTextTrack&&(e.trigger("textTrackChange",null),e._lastEmittedNativeTextTrack=null)}),void 0!==this._nativeVideoTracks&&(this._nativeVideoTracks.onaddtrack=function(){var t,n;if(void 0!==e._nativeVideoTracks){var i=aQ(e._nativeVideoTracks);if(aq(e._videoTracks,i)){e._videoTracks=i,e._setPreviouslyLockedVideoTrack(),e.trigger("availableVideoTracksChange",e.getAvailableVideoTracks());var r=e._getCurrentVideoTrack();(null==r?void 0:r.nativeTrack)!==e._lastEmittedNativeVideoTrack&&(e.trigger("videoTrackChange",null!=(t=null==r?void 0:r.track)?t:null),e._lastEmittedNativeVideoTrack=null!=(n=null==r?void 0:r.nativeTrack)?n:null)}}},this._nativeVideoTracks.onremovetrack=function(){var t,n;if(void 0!==e._nativeVideoTracks){var i=aQ(e._nativeVideoTracks);if(aq(e._videoTracks,i)){e._videoTracks=i,e._setPreviouslyLockedVideoTrack(),e.trigger("availableVideoTracksChange",e.getAvailableVideoTracks());var r=e._getCurrentVideoTrack();(null==r?void 0:r.nativeTrack)!==e._lastEmittedNativeVideoTrack&&(e.trigger("videoTrackChange",null!=(t=null==r?void 0:r.track)?t:null),e._lastEmittedNativeVideoTrack=null!=(n=null==r?void 0:r.nativeTrack)?n:null)}}},this._nativeVideoTracks.onchange=function(){if(void 0!==e._videoTracks)for(var t=0;t<e._videoTracks.length;t++){var n=e._videoTracks[t],i=n.track,r=n.nativeTrack;if(r.selected){r!==e._lastEmittedNativeVideoTrack&&(e.trigger("videoTrackChange",i),e._lastEmittedNativeVideoTrack=r);return}}null!==e._lastEmittedNativeVideoTrack&&(e.trigger("videoTrackChange",null),e._lastEmittedNativeVideoTrack=null)})}},{key:"_enableAudioTrackFromIndex",value:function(e){aH(this._audioTracks.map(function(e){return e.nativeTrack}),e)}}]),n}(ur),cC=us.ResizeObserver,cM=function(){function e(){a(this,e),this._ranges=[],this.length=0}return u(e,[{key:"insert",value:function(e,t){ui.CURRENT_ENV===ui.DEV&&(W(e>=0,"invalid start time"),W(t-e>0,"invalid end time")),U(this._ranges,{start:e,end:t}),this.length=this._ranges.length}},{key:"remove",value:function(e,t){ui.CURRENT_ENV===ui.DEV&&(W(e>=0,"invalid start time"),W(t-e>0,"invalid end time"));var n=[];e>0&&n.push({start:0,end:e}),t<1/0&&n.push({start:t,end:1/0}),this._ranges=B(this._ranges,n),this.length=this._ranges.length}},{key:"start",value:function(e){if(e>=this._ranges.length)throw Error("INDEX_SIZE_ERROR");return this._ranges[e].start}},{key:"end",value:function(e){if(e>=this._ranges.length)throw Error("INDEX_SIZE_ERROR");return this._ranges[e].end}}]),e}(),cP=function(){function e(){a(this,e),this._cuesBuffer=[]}return u(e,[{key:"isEmpty",value:function(){return 0===this._cuesBuffer.length}},{key:"get",value:function(e){for(var t=this._cuesBuffer,n=[],i=t.length-1;i>=0;i--){var r=t[i];if(e<r.end&&e>=r.start){for(var a=r.cues,o=0;o<a.length;o++)e>=a[o].start&&e<a[o].end&&n.push(a[o].element);if(0===n.length&&a.length>0)for(var s=0;s<a.length;s++)(a1(e,a[s].start,.001)||a1(e,a[s].end,.001))&&n.push(a[s].element);return n}}return[]}},{key:"remove",value:function(e,t){ui.CURRENT_ENV===ui.DEV&&(W(e>=0),W(t>=0),W(t>e));for(var n=Math.max(e,t),i=this._cuesBuffer,r=0;r<i.length;r++)if(i[r].end>e){var a=i[r];if(a.start>=n)return;if(a.end>=n){if(e<=a.start)a.cues=a5(a.cues,n),a.start=n;else{var o=y(a4(a,e,n),2),s=o[0],u=o[1];this._cuesBuffer[r]=s,i.splice(r+1,0,u)}return}a.start>=e?(i.splice(r,1),r--):(a.cues=a2(a.cues,e),a.end=Math.max(e,a.start))}}},{key:"insert",value:function(e,t,n){var i=this._cuesBuffer,r={start:t,end:n,cues:e},a=Math.abs(t-n)/5;function o(e){var t=i[e];void 0===t||a1(r.end,t.end,a)?i[e]=r:(t.start>=r.end||(t.cues=a5(t.cues,r.end),t.start=r.end),i.splice(e,0,r))}for(var s=0;s<i.length;s++){var u=i[s];if(t<u.end){if(a1(t,u.start,a)){if(a1(n,u.end,a)){i[s]=r;return}if(n<u.end){u.cues=a5(u.cues,n),u.start=n,i.splice(s,0,r);return}do i.splice(s,1),u=i[s];while(void 0!==u&&n>u.end);o(s);return}if(t<u.start){if(n<u.start){i.splice(s,0,r);return}if(a1(n,u.start,a)){u.start=n,i.splice(s,0,r);return}if(a1(n,u.end,a)){i.splice(s,1,r);return}if(n<u.end){u.cues=a5(u.cues,n),u.start=n,i.splice(s,0,r);return}do i.splice(s,1),u=i[s];while(void 0!==u&&n>u.end);o(s);return}if(a1(u.end,n,a)){u.cues=a2(u.cues,t),u.end=t,i.splice(s+1,0,r);return}if(u.end>n){var l=y(a4(u,t,n),2),d=l[0],c=l[1];this._cuesBuffer[s]=d,i.splice(s+1,0,r),i.splice(s+2,0,c);return}u.cues=a2(u.cues,t),u.end=t;var f=s+1;for(u=i[f];void 0!==u&&n>u.end;)i.splice(f,1),u=i[f];o(f);return}}if(i.length){var v=i[i.length-1];a1(v.end,t,a)&&(v.end=t)}i.push(r)}}]),e}(),cD=function(){function e(t,n){a(this,e),uw.debug("HTD: Creating HTMLTextDisplayer"),this._buffered=new cM,this._videoElement=t,this._textTrackElement=n,this._sizeUpdateCanceller=new uM,this._subtitlesIntervalCanceller=new uM,this._buffer=new cP,this._currentCues=[],this._isAutoRefreshing=!1}return u(e,[{key:"pushTextData",value:function(e){uw.debug("HTD: Appending new html text tracks");var t,n,i,r,a=e.timestampOffset,o=e.appendWindow,s=e.chunk;if(null===s)return M(this._buffered);var u=s.start,l=s.end,d=s.data,c=s.type,f=s.language,v=null!=(t=o[0])?t:0,h=null!=(n=o[1])?n:1/0,p=a0(c,d,a,f);if(0!==v&&h!==1/0){for(var m=0;m<p.length&&p[m].end<=v;)m++;for(p.splice(0,m),m=0;m<p.length&&p[m].start<v;)p[m].start=v,m++;for(m=p.length-1;m>=0&&p[m].start>=h;)m--;for(p.splice(m,p.length),m=p.length-1;m>=0&&p[m].end>h;)p[m].end=h,m--}if(void 0!==u)i=Math.max(v,u);else{if(p.length<=0)return uw.warn("HTD: Current text tracks have no cues nor start time. Aborting"),M(this._buffered);uw.warn("HTD: No start time given. Guessing from cues."),i=p[0].start}if(void 0!==l)r=Math.min(h,l);else{if(p.length<=0)return uw.warn("HTD: Current text tracks have no cues nor end time. Aborting"),M(this._buffered);uw.warn("HTD: No end time given. Guessing from cues."),r=p[p.length-1].end}return r<=i?uw.warn("HTD: Invalid text track appended: ","the start time is inferior or equal to the end time."):(this._buffer.insert(p,i,r),this._buffered.insert(i,r),this._isAutoRefreshing||this._buffer.isEmpty()||this.autoRefreshSubtitles(this._subtitlesIntervalCanceller.signal)),M(this._buffered)}},{key:"removeBuffer",value:function(e,t){return uw.debug("HTD: Removing html text track data",e,t),this._buffer.remove(e,t),this._buffered.remove(e,t),this._isAutoRefreshing&&this._buffer.isEmpty()&&(this.refreshSubtitles(),this._isAutoRefreshing=!1,this._subtitlesIntervalCanceller.cancel(),this._subtitlesIntervalCanceller=new uM),M(this._buffered)}},{key:"getBufferedRanges",value:function(){return M(this._buffered)}},{key:"reset",value:function(){uw.debug("HTD: Resetting HTMLTextDisplayer"),this.stop(),this._subtitlesIntervalCanceller=new uM}},{key:"stop",value:function(){this._subtitlesIntervalCanceller.isUsed()||(uw.debug("HTD: Stopping HTMLTextDisplayer"),this._disableCurrentCues(),this._buffer.remove(0,1/0),this._buffered.remove(0,1/0),this._isAutoRefreshing=!1,this._subtitlesIntervalCanceller.cancel())}},{key:"_disableCurrentCues",value:function(){if(this._sizeUpdateCanceller.cancel(),this._currentCues.length>0){for(var e=0;e<this._currentCues.length;e++)a8(this._textTrackElement,this._currentCues[e].element);this._currentCues=[]}}},{key:"_displayCues",value:function(e){if(!(this._currentCues.length===e.length&&this._currentCues.every(function(t,n){return t.element===e[n]}))){this._sizeUpdateCanceller.cancel();for(var t=0;t<this._currentCues.length;t++)a8(this._textTrackElement,this._currentCues[t].element);this._currentCues=[];for(var n=0;n<e.length;n++){var i=e[n],r=a6(i);this._currentCues.push({element:i,resolution:r}),this._textTrackElement.appendChild(i)}var a=this._currentCues.filter(function(e){return null!==e.resolution});if(a.length>0){this._sizeUpdateCanceller=new uM,this._sizeUpdateCanceller.linkToSignal(this._subtitlesIntervalCanceller.signal);var o=uT.getCurrent().TEXT_TRACK_SIZE_CHECKS_INTERVAL;aJ(this._textTrackElement,o,this._sizeUpdateCanceller.signal).onUpdate(function(e){for(var t=e.height,n=e.width,i=0;i<a.length;i++){var r=a[i];a3(t,n,r.resolution,r.element)}},{clearSignal:this._sizeUpdateCanceller.signal,emitCurrentValue:!0})}}}},{key:"autoRefreshSubtitles",value:function(e){var t=this;if(!(this._isAutoRefreshing||e.isCancelled())){var n=null,i=uT.getCurrent().MAXIMUM_HTML_TEXT_TRACK_UPDATE_INTERVAL,r=function(){t._isAutoRefreshing=!1,null!==n&&(n.cancel(),n=null)},a=function(){r(),t._isAutoRefreshing=!0,(n=new uM).linkToSignal(e);var a=setInterval(function(){return t.refreshSubtitles()},i);n.signal.register(function(){clearInterval(a)}),t.refreshSubtitles()};l5(this._videoElement,function(){r(),t._disableCurrentCues()},e),l4(this._videoElement,a,e),l3(this._videoElement,a,e),a()}}},{key:"refreshSubtitles",value:function(){var e,t=uT.getCurrent().MAXIMUM_HTML_TEXT_TRACK_UPDATE_INTERVAL;e=this._videoElement.paused||this._videoElement.playbackRate<=0?this._videoElement.currentTime:Math.max(this._videoElement.currentTime+t/1e3/2,0);var n=this._buffer.get(e);0===n.length?this._disableCurrentCues():this._displayCues(n)}}]),e}();ui.CURRENT_ENV,ui.DEV;var cx=/&#([0-9]+);/g,cN=/<br>/gi,cO=/<style[^>]*>([\s\S]*?)<\/style[^>]*>/i,cL=/\s*<p (?:class=([^>]+))?>(.*)/i,cU=/<sync[^>]+?start="?([0-9]*)"?[^0-9]/i,cF=function(e,t,n){var i,r,a=/<sync[ >]/gi,o=/<sync[ >]|<\/body>/gi,s=[],u=cO.exec(e),l=Array.isArray(u)?u[1]:"";o.exec(e);var d,c=a9(l),f=a7(l);if(ed(n)&&void 0===(d=c[n]))throw Error("sami: could not find lang ".concat(n," in CSS"));for(;i=a.exec(e),r=o.exec(e),!(null===i&&null===r);){if(null===i||null===r||i.index>=r.index)throw Error("parse error");var v=e.slice(i.index,r.index),h=cU.exec(v);if(!Array.isArray(h))throw Error("parse error (sync time attribute)");var p=+h[1];if(isNaN(p))throw Error("parse error (sync time attribute NaN)");!function(e,n){for(var i=e.length;--i>=0;){var r=cL.exec(e[i]);if(Array.isArray(r)){var a=y(r,3),o=a[1],u=a[2];if(d===o){if("&nbsp;"===u)s[s.length-1].end=n;else{var l=document.createElement("DIV");l.className="rxp-texttrack-region";var c=document.createElement("DIV");c.className="rxp-texttrack-div",c.style.position="absolute",c.style.bottom="0",c.style.width="100%",c.style.color="#fff",c.style.textShadow="-1px -1px 0 #000,1px -1px 0 #000,-1px 1px 0 #000,1px 1px 0 #000";var v=document.createElement("div");v.className="rxp-texttrack-p",ed(f)&&(v.style.cssText=f);for(var h=u.split(cN),p=0;p<h.length;p++){0!==p&&v.appendChild(document.createElement("BR"));var m=document.createElement("SPAN");m.className="rxp-texttrack-span",m.textContent=h[p].replace(cx,function(e,t){return String.fromCharCode(Number(t))}),v.appendChild(m)}c.appendChild(v),l.appendChild(c),s.push({element:l,start:n+t,end:-1})}}}}}(v.split("\n"),p/1e3)}return s},cB=/(\d+) (\d+)/,cV=["align","backgroundColor","color","direction","display","displayAlign","extent","fontFamily","fontSize","fontStyle","fontWeight","lineHeight","opacity","origin","overflow","padding","textAlign","textDecoration","textOutline","unicodeBidi","visibility","wrapOption","writingMode"],cz=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,cK=/^(?:(\d{2,}):)?(\d{2}):(\d{2})$/,cW=/^(?:(\d{2,}):)?(\d{2}):(\d{2}\.\d{2,})$/,cG=/^(\d*\.?\d*)f$/,cH=/^(\d*\.?\d*)t$/,cq=/^(?:(\d*\.?\d*)h)?(?:(\d*\.?\d*)m)?(?:(\d*\.?\d*)s)?(?:(\d*\.?\d*)ms)?$/,cY=/^(\d{1,2}|100)% (\d{1,2}|100)%$/,cj=/^((?:\+|\-)?\d*(?:\.\d+)?)(px|em|c|%|rh|rw)$/,cQ=/^#([0-9A-f]{2})([0-9A-f]{2})([0-9A-f]{2})([0-9A-f]{2})$/,cX=/^#([0-9A-f])([0-9A-f])([0-9A-f])([0-9A-f])$/,c$=/^rgb\( *(\d+) *, *(\d+) *, *(\d+) *\)/,cZ=/^rgba\( *(\d+) *, *(\d+) *, *(\d+) *, *(\d+) *\)/,cJ=function(e,t){return cz.test(e)?ok(t,e):cK.test(e)?oT(cK,e):cW.test(e)?oT(cW,e):cG.test(e)?Number(cG.exec(e)[1])/t.frameRate:cH.test(e)?Number(cH.exec(e)[1])/t.tickRate:cq.test(e)?oT(cq,e):void 0},c0=["color","direction","display","fontFamily","fontSize","fontStyle","fontWeight","textDecoration","textOutline","unicodeBidi","visibility","wrapOption"],c1=function(e,t){for(var n=ob(e,t),i=[],r=0;r<n.length;r++){var a=n[r].paragraphStyle;void 0===a.extent&&void 0===a.origin&&void 0===a.displayAlign&&void 0===a.display&&void 0===a.textAlign&&void 0===a.fontSize&&oE(a);var o=oB(n[r]);null!==o&&i.push(o)}return i},c2={white:"#ffffff",lime:"#00ff00",cyan:"#00ffff",red:"#ff0000",yellow:"#ffff00",magenta:"#ff00ff",blue:"#0000ff",black:"#000000"},c5=function(e){if(!(void 0!==e&&0!==uK(e).length))return"text-align:center";var t=c4(e),n=c6(e);return"position: absolute;margin: 0;transform: translate(".concat(t.offset,"%,").concat(n.offset,"%);width: ").concat(ft(e.size),"%;left: ").concat(t.position,"%;top: ").concat(null!==n.position?"".concat(n.position,"%"):"auto",";text-align: ").concat(fe(e.align),";")},c4=function(e){return{position:c3(e),offset:c8(e)}},c3=function(e){var t=fi(e.position);return null!==t?t:({left:0,center:50,right:100})[fe(e.align)]},c8=function(e){var t,n,i=void 0!==e.position?(t=e.position,!Array.isArray(n=/,(line-left|line-right|center)/.exec(t))||n.length<2?null:n[1]):null;return null!==i?({"line-left":0,center:-50,"line-right":-100})[i]:({left:0,center:-50,right:-100})[void 0!==e.align?fe(e.align):"center"]},c6=function(e){return{position:c9(e.line),offset:c7(e.line)}},c9=function(e){return fi(e)},c7=function(e){var t,n={start:0,center:-50,end:-100};if(void 0===e)return n.start;var i=!Array.isArray(t=/,(start|center|end)/.exec(e))||t.length<2?null:t[1];return null!==i?n[i]:n.start},fe=function(e){switch(e){case"left":case"start":return"left";case"right":case"end":return"right";default:return"center"}},ft=function(e){return fn(e,100)},fn=function(e,t){var n=fi(e);return null!==n?n:t},fi=function(e){if(void 0===e)return null;var t=/^([\d.]+)%/.exec(e);return!Array.isArray(t)||t.length<2?null:parseInt(t[1],10)},fr=function(e,t){var n=e.split(/\r\n|\n|\r/g),i=[];if(null===/^WEBVTT( |\t|\n|\r|$)/.exec(n[0]))throw Error("Can't parse WebVTT: Invalid File.");for(var r=oV(n),a=oH(n,r),o=oG(n,r),s=oQ(a),u=0;u<o.length;u++){var l=oj(o[u],t);if(null!==l){var d=oZ(l,s);i.push(d)}}return i},fa=function(){function e(t){a(this,e),uw.debug("NTD: Creating NativeTextDisplayer");var n=oJ(t),i=n.track,r=n.trackElement;this._buffered=new cM,this._videoElement=t,this._track=i,this._trackElement=r}return u(e,[{key:"pushTextData",value:function(e){if(uw.debug("NTD: Appending new native text tracks"),null===e.chunk)return M(this._buffered);var t,n,i,r,a=e.timestampOffset,o=e.appendWindow,s=e.chunk,u=s.start,l=s.end,d=s.data,c=s.type,f=s.language,v=null!=(t=o[0])?t:0,h=null!=(n=o[1])?n:1/0,p=o2(c,d,a,f);if(0!==v&&h!==1/0){for(var m=0;m<p.length&&p[m].endTime<=v;)m++;for(p.splice(0,m),m=0;m<p.length&&p[m].startTime<v;)p[m].startTime=v,m++;for(m=p.length-1;m>=0&&p[m].startTime>=h;)m--;for(p.splice(m,p.length),m=p.length-1;m>=0&&p[m].endTime>h;)p[m].endTime=h,m--}if(void 0!==u)i=Math.max(v,u);else{if(p.length<=0)return uw.warn("NTD: Current text tracks have no cues nor start time. Aborting"),M(this._buffered);uw.warn("NTD: No start time given. Guessing from cues."),i=p[0].startTime}if(void 0!==l)r=Math.min(h,l);else{if(p.length<=0)return uw.warn("NTD: Current text tracks have no cues nor end time. Aborting"),M(this._buffered);uw.warn("NTD: No end time given. Guessing from cues."),r=p[p.length-1].endTime}if(r<=i)return uw.warn("NTD: Invalid text track appended: ","the start time is inferior or equal to the end time."),M(this._buffered);if(p.length>0){var g=p[0],y=this._track.cues;null!==y&&y.length>0&&g.startTime<y[y.length-1].startTime&&this._removeData(g.startTime,1/0);for(var _=0;_<p.length;_++)this._track.addCue(p[_])}return this._buffered.insert(i,r),M(this._buffered)}},{key:"removeBuffer",value:function(e,t){return this._removeData(e,t),M(this._buffered)}},{key:"getBufferedRanges",value:function(){return M(this._buffered)}},{key:"reset",value:function(){uw.debug("NTD: Aborting NativeTextDisplayer"),this._removeData(0,1/0);var e=this._trackElement,t=this._videoElement;if(void 0!==e&&t.hasChildNodes())try{t.removeChild(e)}catch(e){uw.warn("NTD: Can't remove track element from the video")}var n=this._track.mode;this._track.mode="disabled",this._track.mode=n,void 0!==this._trackElement&&(this._trackElement.innerHTML="")}},{key:"stop",value:function(){uw.debug("NTD: Aborting NativeTextDisplayer"),this._removeData(0,1/0);var e=this._trackElement,t=this._videoElement;if(void 0!==e&&t.hasChildNodes())try{t.removeChild(e)}catch(e){uw.warn("NTD: Can't remove track element from the video")}this._track.mode="disabled",void 0!==this._trackElement&&(this._trackElement.innerHTML="")}},{key:"_removeData",value:function(e,t){uw.debug("NTD: Removing native text track data",e,t);var n=this._track,i=n.cues;if(null!==i)for(var r=i.length-1;r>=0;r--){var a=i[r],o=a.startTime,s=a.endTime;o>=e&&o<=t&&s<=t&&o1(n,a)}this._buffered.remove(e,t)}}]),e}();ui.CURRENT_ENV,ui.DEV;var fo=/&#([0-9]+);/g,fs=/<br>/gi,fu=/<style[^>]*>([\s\S]*?)<\/style[^>]*>/i,fl=/\s*<p (?:class=([^>]+))?>(.*)/i,fd=/<sync[^>]+?start="?([0-9]*)"?[^0-9]/i,fc=function(e,t,n){var i,r,a=/<sync[ >]/gi,o=/<sync[ >]|<\/body>/gi,s=[],u=fu.exec(e),l=null!==u?u[1]:"";o.exec(e);var d,c=o3(l);if(ed(n)&&void 0===(d=c[n]))throw Error("sami: could not find lang ".concat(n," in CSS"));for(;i=a.exec(e),r=o.exec(e),!(null===i&&null===r);){if(null===i||null===r||i.index>=r.index)throw Error("parse error");var f=e.slice(i.index,r.index),v=fd.exec(f);if(null===v)throw Error("parse error (sync time attribute)");var h=+v[1];if(isNaN(h))throw Error("parse error (sync time attribute NaN)");!function(e,n){for(var i,r=e.length;--r>=0;)if(null!==(i=fl.exec(e[r]))){var a=y(i,3),o=a[1],u=a[2];d===o&&("&nbsp;"===u?s[s.length-1].end=n:s.push({text:u.replace(fs,"\n").replace(fo,function(e,t){return String.fromCharCode(Number(t))}),start:n+t}))}}(f.split("\n"),h/1e3)}return o4(s)},ff={left:"start",center:"center",right:"end",start:"start",end:"end"},fv={left:"line-left",center:"center",right:"line-right"},fh=function(e,t){for(var n=ob(e,t),i=[],r=0;r<n.length;r++){var a=se(n[r]);null!==a&&i.push(a)}return i},fp=function(e,t){var n=e.split(/\r\n|\n|\r/);if(!/^WEBVTT($| |\t)/.test(n[0]))throw Error("Can't parse WebVTT: Invalid file.");for(var i=oV(n),r=oG(n,i),a=[],o=0;o<r.length;o++){var s=oj(r[o],t);if(null!==s){var u=o5(s.start,s.end,s.payload.join("\n"));null!==u&&(o7(u)&&si(s.settings,u),a.push(u))}}return a},fm=function(){function e(t){a(this,e);var n=t.isLive,i=t.segmentPrivateInfos,r=t.media,o=t.sharedSmoothTimeline;if(this._sharedSmoothTimeline=o,this._initSegmentInfos={bitsPerSample:i.bitsPerSample,channels:i.channels,codecPrivateData:i.codecPrivateData,packetSize:i.packetSize,samplingRate:i.samplingRate,timescale:o.timescale,height:i.height,width:i.width,protection:i.protection},this._isLive=n,this._media=r,0!==o.timeline.length&&n){var s=o.timeline,u=o.validityTime,l=iK(s[s.length-1],null),d=u/1e3*o.timescale;this._scaledLiveGap=d-l}}return u(e,[{key:"getInitSegment",value:function(){return{id:"init",isInit:!0,privateInfos:{smoothInitSegment:this._initSegmentInfos},url:null,time:0,end:0,duration:0,timescale:1,complete:!0}}},{key:"getSegments",value:function(e,t){this._refreshTimeline();for(var n,i=this._sharedSmoothTimeline,r=i.timescale,a=i.timeline,o=sl(r,e,t),s=o.up,u=o.to,l=this._media,d=[],c=a.length,f=void 0===this._scaledLiveGap?void 0:uN()/1e3*r-this._scaledLiveGap,v=0;v<c;v++){for(var h=a[v],p=h.duration,m=h.start,g=sd(h,a[v+1]),y=su(m,s,p),_=m+y*p;_<u&&y<=g&&(void 0===f||_+p<=f);){var S=_,b=void 0!==n?n+y:void 0,E={id:String(_),isInit:!1,time:S/r,end:(S+p)/r,duration:p/r,timescale:1,number:b,url:l.replace(/\{start time\}/g,String(S)),complete:!0,privateInfos:{smoothMediaSegment:{time:S,duration:p}}};d.push(E),_=m+ ++y*p}if(_>=u)break;void 0!==n&&(n+=g+1)}return d}},{key:"shouldRefresh",value:function(e,t){if(this._refreshTimeline(),!this._isLive)return!1;var n=this._sharedSmoothTimeline,i=n.timeline,r=n.timescale,a=i[i.length-1];if(void 0===a)return!1;var o=a.repeatCount,s=a.start+(o+1)*a.duration;return!(t*r<s)&&(e*r>=s||e*r>a.start+o*a.duration)}},{key:"getFirstAvailablePosition",value:function(){this._refreshTimeline();var e=this._sharedSmoothTimeline,t=e.timeline,n=e.timescale;return 0===t.length?null:t[0].start/n}},{key:"getLastAvailablePosition",value:function(){this._refreshTimeline();var e=this._sharedSmoothTimeline,t=e.timeline,n=e.timescale;if(void 0===this._scaledLiveGap)return iK(t[t.length-1],null)/n;for(var i=t.length-1;i>=0;i--)for(var r=t[i],a=uN()/1e3*n,o=r.start,s=r.duration,u=r.repeatCount,l=u;l>=0;l--){var d=o+s*(l+1);if(d<=a-this._scaledLiveGap)return d/n}}},{key:"getEnd",value:function(){if(!this._isLive)return this.getLastAvailablePosition()}},{key:"awaitSegmentBetween",value:function(e,t){if(W(e<=t),this.isStillAwaitingFutureSegments())return!1;var n,i=this.getLastAvailablePosition();return(void 0===i||!(t<i))&&t>(null!=(n=this.getFirstAvailablePosition())?n:0)&&void 0}},{key:"checkDiscontinuity",value:function(e){return this._refreshTimeline(),iq(this._sharedSmoothTimeline,e,void 0)}},{key:"isSegmentStillAvailable",value:function(e){if(e.isInit)return!0;this._refreshTimeline();for(var t=this._sharedSmoothTimeline,n=t.timeline,i=t.timescale,r=0;r<n.length;r++){var a=n[r],o=a.start/i;if(o>e.time)break;if(o===e.time)return!0;if(a.repeatCount>=0&&void 0!==a.duration){var s=(o-a.start)/a.duration-1;return s%1==0&&s<=a.repeatCount}}return!1}},{key:"canBeOutOfSyncError",value:function(e){return!!this._isLive&&v(e,u5)&&(e.isHttpError(404)||e.isHttpError(412))}},{key:"_replace",value:function(e){this._initialScaledLastPosition=e._initialScaledLastPosition,this._scaledLiveGap=e._scaledLiveGap,this._sharedSmoothTimeline.replace(e._sharedSmoothTimeline)}},{key:"_update",value:function(e){this._scaledLiveGap=e._scaledLiveGap,this._sharedSmoothTimeline.update(e._sharedSmoothTimeline)}},{key:"isStillAwaitingFutureSegments",value:function(){return this._isLive}},{key:"isInitialized",value:function(){return!0}},{key:"initialize",value:function(){uw.error("A `SmoothRepresentationIndex` does not need to be initialized")}},{key:"addPredictedSegments",value:function(e,t){this._sharedSmoothTimeline.addPredictedSegments(e,t)}},{key:"_refreshTimeline",value:function(){this._sharedSmoothTimeline.refresh()}}]),e}(),fg=function(){function e(t){a(this,e);var n=t.timeline,i=t.timescale,r=t.timeShiftBufferDepth,o=t.manifestReceivedTime;this.timeline=n,this.timescale=i;var s=null!=o?o:uN();if(this.validityTime=s,this._timeShiftBufferDepth=r,0!==n.length){var u=iK(n[n.length-1],null);this._initialScaledLastPosition=u}}return u(e,[{key:"refresh",value:function(){if(void 0!==this._initialScaledLastPosition){var e=this._timeShiftBufferDepth,t=(uN()-this.validityTime)/1e3+this._initialScaledLastPosition/this.timescale;if(void 0!==e){var n=(t-e)*this.timescale;i5(this.timeline,n)}}}},{key:"replace",value:function(e){var t=this.timeline,n=e.timeline,i=this.timescale,r=e.timescale;if(this._initialScaledLastPosition=e._initialScaledLastPosition,this.validityTime=e.validityTime,0!==t.length&&0!==n.length&&i===r){var a=t[t.length-1],o=n[n.length-1],s=iK(o,null);if(!(iK(a,null)<=s))for(var u=0;u<t.length;u++){var l=t[u],d=iK(l,null);if(d===s){this.timeline=this.timeline.concat(t.slice(u+1));return}if(d>s){if(l.duration!==o.duration)return;var c=s-l.start;if(0===c){uw.warn("Smooth Parser: a discontinuity detected in the previous manifest has been resolved."),this.timeline=this.timeline.concat(t.slice(u));return}if(c<0||c%l.duration!=0)return;var f=c/l.duration-1,v=l.repeatCount-f;if(v<0)return;o.repeatCount+=v;var h=t.slice(u+1);this.timeline=this.timeline.concat(h);return}}}}},{key:"update",value:function(e){i4(this.timeline,e.timeline),this._initialScaledLastPosition=e._initialScaledLastPosition,this.validityTime=e.validityTime}},{key:"addPredictedSegments",value:function(e,t){var n;if((null==(n=t.privateInfos)?void 0:n.smoothMediaSegment)===void 0){uw.warn("Smooth Parser: should only encounter SmoothRepresentationIndex");return}this.refresh();for(var i=0;i<e.length;i++)sc(this.timeline,this.timescale,e[i],t.privateInfos.smoothMediaSegment)}}]),e}(),fy={audio:"audio/mp4",video:"video/mp4",text:"application/ttml+xml"},f_={AACL:"audio/mp4",AVC1:"video/mp4",H264:"video/mp4",TTML:"application/ttml+xml+mp4",DFXP:"application/ttml+xml+mp4"},fS=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=void 0===e.referenceDateTime?Date.UTC(1970,0,1,0,0,0,0)/1e3:e.referenceDateTime,n=void 0===e.minRepresentationBitrate?0:e.minRepresentationBitrate,r=e.serverSyncInfos,a=void 0!==r?r.serverTimestamp-r.clientTime:void 0;return function(r,o,s){var u="";if(void 0!==o){var l=cr(o);u=o.substring(0,l)}var d=r.documentElement;if(i(d)||"SmoothStreamingMedia"!==d.nodeName)throw Error("document root should be SmoothStreamingMedia");var c=d.getAttribute("MajorVersion"),f=d.getAttribute("MinorVersion");if(null===c||null===f||!/^[2]-[0-2]$/.test(c+"-"+f))throw Error("Version should be 2.0, 2.1 or 2.2");var v=d.getAttribute("Timescale"),h=ed(v)?+v:1e7;isNaN(h)&&(h=1e7);var p,m,g=sf(d,function(t,n,i){switch(n){case"Protection":t.protections.push(ss(i,e.keySystems));break;case"StreamIndex":t.adaptationNodes.push(i)}return t},{adaptationNodes:[],protections:[]}),y=g.protections,_=g.adaptationNodes,b="boolean"==typeof(p=d.getAttribute("IsLive"))?p:"string"==typeof p&&"TRUE"===p.toUpperCase();if(b){var E=d.getAttribute("DVRWindowLength");null===E||isNaN(+E)||0==+E||(m=+E/h)}var k,T,w,I,A,R,C,M=_.reduce(function(e,t){var r=function(e){var t,r=e.root,a=e.timescale,o=e.baseUrl,s=e.protections,u=e.timeShiftBufferDepth,l=e.manifestReceivedTime,d=e.isLive,c=r.getAttribute("Timescale"),f=null===c?a:+c;isNaN(f)&&(f=a);var v=r.getAttribute("Type");if(null===v)throw Error("StreamIndex without type.");e_(la,v)||uw.warn("Smooth Parser: Unrecognized adaptation type:",v);var h=r.getAttribute("Subtype"),p=r.getAttribute("Language"),m=r.getAttribute("Url"),g=null===m?"":m;ui.CURRENT_ENV===ui.DEV&&W(""!==g);var y=sf(r,function(e,t,i){switch(t){case"QualityLevel":var r=function(e,t){var n,i=sf(e,function(e,t,i){return"CustomAttributes"===t&&(n=e).push.apply(n,S(sf(i,function(e,t,n){if("Attribute"===t){var i=n.getAttribute("Name"),r=n.getAttribute("Value");null!==i&&null!==r&&e.push(i+"="+r)}return e},[]))),e},[]);function r(t){var n=e.getAttribute(t);return null===n?void 0:n}switch(t){case"audio":var a=r("AudioTag"),o=r("BitsPerSample"),s=r("Channels"),u=r("CodecPrivateData"),l=r("FourCC"),d=r("PacketSize"),c=r("SamplingRate"),f=r("Bitrate"),v=void 0===f?0:parseInt(f,10);if(v=isNaN(v)?0:v,void 0!==l&&void 0===f_[l]||void 0===u)return uw.warn("Smooth parser: Unsupported audio codec. Ignoring quality level."),null;var h=sr(u,l);return{audiotag:void 0!==a?parseInt(a,10):a,bitrate:v,bitsPerSample:void 0!==o?parseInt(o,10):o,channels:void 0!==s?parseInt(s,10):s,codecPrivateData:u,codecs:h,customAttributes:i,mimeType:void 0!==l?f_[l]:l,packetSize:void 0!==d?parseInt(d,10):d,samplingRate:void 0!==c?parseInt(c,10):c};case"video":var p=r("CodecPrivateData"),m=r("FourCC"),g=r("MaxWidth"),y=r("MaxHeight"),_=r("Bitrate"),b=void 0===_?0:parseInt(_,10);if(b=isNaN(b)?0:b,void 0!==m&&void 0===f_[m]||void 0===p)return uw.warn("Smooth parser: Unsupported video codec. Ignoring quality level."),null;var E=sa(p);return{bitrate:b,customAttributes:i,mimeType:void 0!==m?f_[m]:m,codecPrivateData:p,codecs:E,width:void 0!==g?parseInt(g,10):void 0,height:void 0!==y?parseInt(y,10):void 0};case"text":var k=r("CodecPrivateData"),T=r("FourCC"),w=r("Bitrate"),I=void 0===w?0:parseInt(w,10);return{bitrate:I=isNaN(I)?0:I,customAttributes:i,mimeType:void 0!==T?f_[T]:T,codecPrivateData:null!=k?k:""};default:return uw.error("Smooth Parser: Unrecognized StreamIndex type: "+t),null}}(i,v);if(null===r)break;("video"!==v||r.bitrate>n)&&e.qualityLevels.push(r);break;case"c":e.cNodes.push(i)}return e},{qualityLevels:[],cNodes:[]}),_=y.qualityLevels,b=new fg({timeline:(t=y.cNodes).reduce(function(e,n,i){var r=n.getAttribute("d"),a=n.getAttribute("t"),o=n.getAttribute("r"),s=null!==a?+a:void 0,u=null!==r?+r:void 0;if(0===i)s=void 0===s||isNaN(s)?0:s;else{var l=e[i-1];if(void 0===s||isNaN(s)){if(void 0===l.duration||isNaN(l.duration))throw Error("Smooth: Invalid CNodes. Missing timestamp.");s=l.start+l.duration*(l.repeatCount+1)}}if(void 0===u||isNaN(u)){var d=t[i+1];if(void 0===d)return e;var c=d.getAttribute("t"),f=ed(c)?+c:null;if(null===f)throw Error("Can't build index timeline from Smooth Manifest.");u=f-s}return e.push({duration:u,start:s,repeatCount:null!==o?+o-1:0}),e},[]),timescale:f,timeShiftBufferDepth:u,manifestReceivedTime:l});W(0!==_.length,"Adaptation should have at least one playable representation.");var E=v+(ed(p)?"_"+p:""),k=_.map(function(e){var t,n,r,a=(t=e.bitrate,n=e.customAttributes,g.replace(/\{bitrate\}/g,String(t)).replace(/{CustomAttributes}/g,n.length>0?n[0]:"")),u=ed(e.mimeType)?e.mimeType:fy[v],l=e.codecs,c=E+"_"+(i(v)?"":v+"-")+(i(u)?"":u+"-")+(i(l)?"":l+"-")+String(e.bitrate),f=[];s.length>0&&(r=s[0],s.forEach(function(e){var t=e.keyId;e.keySystems.forEach(function(e){f.push({keyId:t,systemId:e.systemId})})}));var h=new fm({isLive:d,sharedSmoothTimeline:b,media:a,segmentPrivateInfos:{bitsPerSample:e.bitsPerSample,channels:e.channels,codecPrivateData:e.codecPrivateData,packetSize:e.packetSize,samplingRate:e.samplingRate,height:e.height,width:e.width,protection:i(r)?void 0:{keyId:r.keyId}}}),p=uk({},e,{index:h,cdnMetadata:[{baseUrl:o}],mimeType:u,codecs:l,id:c});if(f.length>0||void 0!==r){var m=void 0===r?[]:r.keySystems.map(function(e){var t=e.systemId,n=e.privateData,i=t.replace(/-/g,""),r=sv(i,n);return{systemId:i,data:r}});m.length>0?p.contentProtections={keyIds:f,initData:[{type:"cenc",values:m}]}:p.contentProtections={keyIds:f,initData:[]}}return p});if("ADVT"===h)return null;var T={id:E,type:v,representations:k,language:null===p?void 0:p};return"text"===v&&"DESC"===h&&(T.closedCaption=!0),T}({root:t,baseUrl:u,timescale:h,protections:y,isLive:b,timeShiftBufferDepth:m,manifestReceivedTime:s});if(null===r)return e;var a=r.type,o=e[a];return void 0===o?e[a]=[r]:o.push(r),e},{}),P=null,D=void 0!==M.video?M.video[0]:void 0,x=void 0!==M.audio?M.audio[0]:void 0;if(void 0!==D||void 0!==x){var N,O,L,U=[],F=[];if(void 0!==D){var B=D.representations[0];if(void 0!==B){var V=B.index.getFirstAvailablePosition(),z=B.index.getLastAvailablePosition();i(V)||U.push(V),i(z)||F.push(z)}}if(void 0!==x){var K=x.representations[0];if(void 0!==K){var G=K.index.getFirstAvailablePosition(),H=K.index.getLastAvailablePosition();i(G)||U.push(G),i(H)||F.push(H)}}U.length>0&&(A=(N=Math).max.apply(N,S(U))),F.length>0&&(R=(O=Math).min.apply(O,S(F)),C=(L=Math).max.apply(L,S(F)))}var q=d.getAttribute("Duration"),Y=null!==q&&0!=+q?+q/h:void 0;if(b){k=e.suggestedPresentationDelay,T=t,w=null!=A?A:T;var j=C;void 0===j&&(j=Date.now()/1e3-T);var Q=R;void 0===Q&&(Q=j),I={isLinear:!0,maximumSafePosition:Q,livePosition:j,time:uN()},P=null!=m?m:null}else{w=null!=A?A:0;var X=R;void 0===X&&(X=void 0!==Y?w+Y:1/0),I={isLinear:!1,maximumSafePosition:X,livePosition:void 0,time:uN()}}var $=b?0:w,Z=b?void 0:I.maximumSafePosition,J={availabilityStartTime:void 0===T?0:T,clockOffset:a,isLive:b,isDynamic:b,isLastPeriodKnown:!0,timeBounds:{minimumSafePosition:w,timeshiftDepth:P,maximumTimeData:I},periods:[{adaptations:M,duration:void 0!==Z?Z-$:Y,end:Z,id:"gen-smooth-period-0",start:$}],suggestedPresentationDelay:k,transportType:"smooth",uris:i(o)?[]:[o]};return function e(t){var n=[];t.periods.forEach(function(i){var r=i.id;if(e_(n,r)){uw.warn("Two periods with the same ID found. Updating.");var a=r+"-dup";i.id=a,e(t),n.push(a)}else n.push(r);var o=i.adaptations,s=[];Object.keys(o).forEach(function(n){var i=o[n];void 0!==i&&i.forEach(function(n){var i=n.id;if(e_(s,i)){uw.warn("Two adaptations with the same ID found. Updating.",i);var r=i+"-dup";n.id=r,e(t),s.push(r)}else s.push(i);var a=[];n.representations.forEach(function(n){var i=n.id;if(e_(a,i)){uw.warn("Two representations with the same ID found. Updating.",i);var r="".concat(i,"-dup");n.id=r,e(t),a.push(r)}else a.push(i)})})})})}(J),J}},fb=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],fE=function(e){var t=e.checkMediaSegmentIntegrity,n=e.segmentLoader;return function(e,i,r,a,o){var s=i.segment;if(!s.isInit)return null===e?Promise.resolve({resultType:"segment-created",resultData:null}):"function"!=typeof n?sD(e,i,o,r,a,t):new Promise(function(s,u){var l,d=function(e){c||(c=!0,u(e))},c=!1;void 0!==i.segment.range&&(l=[i.segment.range],void 0!==i.segment.indexRange&&l.push(i.segment.indexRange)),n({isInit:i.segment.isInit,timeout:r.timeout,byteRanges:l,trackType:i.type,url:e},{reject:function(e){if(!(c||a.isCancelled())){var t,n;c=!0,a.deregister(d),u(new uY(null!=(t=null==e?void 0:e.message)?t:"Unknown error when fetching a Smooth segment through a custom segmentLoader.",null!=(n=null==e?void 0:e.canRetry)&&n,null==e?void 0:e.xhr))}},resolve:function(e){if(!(c||a.isCancelled())){c=!0,a.deregister(d),sP(i.mimeType)&&!0===t||s({resultType:"segment-loaded",resultData:{responseData:e.data,size:e.size,requestDuration:e.duration}});var n=v(e.data,Uint8Array)?e.data:new Uint8Array(e.data);ap(n,i.segment.isInit),s({resultType:"segment-loaded",resultData:{responseData:n,size:e.size,requestDuration:e.duration}})}},fallback:function(){c||a.isCancelled()||(c=!0,a.deregister(d),sD(e,i,o,r,a,t).then(s,u))},progress:function(e){c||a.isCancelled()||o.onProgress({duration:e.duration,size:e.size,totalSize:e.totalSize})}}),a.register(d)});if(void 0===s.privateInfos||void 0===s.privateInfos.smoothInitSegment)throw Error("Smooth: Invalid segment format");var u,l=s.privateInfos.smoothInitSegment,d=l.codecPrivateData,c=l.timescale,f=l.height,h=l.width,p=l.protection,m=void 0===p?{keyId:void 0,keySystems:void 0}:p;if(void 0===d)throw Error("Smooth: no codec private data.");switch(i.type){case"video":u=sT(c,null!=h?h:0,null!=f?f:0,72,72,4,d,m.keyId);break;case"audio":var g=l.channels,y=l.bitsPerSample,_=l.packetSize,S=l.samplingRate;u=sk(c,void 0===g?0:g,void 0===y?0:y,void 0===_?0:_,void 0===S?0:S,d,m.keyId);break;default:ui.CURRENT_ENV===ui.DEV&&W(!1,"responseData should have been set"),u=new Uint8Array(0)}return Promise.resolve({resultType:"segment-created",resultData:u})}},fk=function(e){var t=fS(e),n=fE(e),i={loadManifest:aa({customManifestLoader:e.manifestLoader},"text"),parseManifest:function(n,i){var r,a=null!=(r=n.url)?r:i.originalUrl,o=n.receivedTime,s=n.responseData,u=t("string"==typeof s?new DOMParser().parseFromString(s,"text/xml"):s,a,o),l=[];return{manifest:new lu(u,{representationFilter:e.representationFilter},l),url:a,warnings:l}}},r={loadSegment:function(e,t,i,r,a){return n(sx(e,t.segment),t,i,r,a)},parseSegment:function(e,t,n){var i,r,a=t.segment,o=e.data,s=e.isChunked;if(null===o)return a.isInit?{segmentType:"init",initializationData:null,initializationDataSize:0,protectionData:[],initTimescale:void 0}:{segmentType:"media",chunkData:null,chunkInfos:null,chunkOffset:0,chunkSize:0,protectionData:[],appendWindow:[void 0,void 0]};var u=v(o,Uint8Array)?o:new Uint8Array(o);if(a.isInit){var l=null==(r=null==(i=a.privateInfos)?void 0:i.smoothInitSegment)?void 0:r.timescale;return{segmentType:"init",initializationData:o,initializationDataSize:o.byteLength,initTimescale:l,protectionData:[]}}var d=void 0!==n?sM(u,s,n,a,t.isLive):null;if(null===d||null===d.chunkInfos||void 0===d.scaledSegmentTime)throw Error("Smooth Segment without time information");var c=d.nextSegments,f=d.chunkInfos,h=sR(u,d.scaledSegmentTime),p=c.length>0?c:void 0;return{segmentType:"media",chunkData:h,chunkInfos:f,chunkOffset:0,chunkSize:h.length,protectionData:[],predictedSegments:p,appendWindow:[void 0,void 0]}}};return{manifest:i,audio:r,video:r,text:{loadSegment:function(t,n,i,r,a){var o=n.segment,s=sx(t,o);return o.isInit||null===s?Promise.resolve({resultType:"segment-created",resultData:null}):sP(n.mimeType)?uZ({url:s,responseType:"arraybuffer",timeout:i.timeout,connectionTimeout:i.connectionTimeout,cancelSignal:r,onProgress:a.onProgress}).then(function(t){if(!0!==e.checkMediaSegmentIntegrity)return{resultType:"segment-loaded",resultData:t};var i=new Uint8Array(t.responseData);return ap(i,n.segment.isInit),{resultType:"segment-loaded",resultData:un(ut({},t),{responseData:i})}}):uZ({url:s,responseType:"text",timeout:i.timeout,connectionTimeout:i.connectionTimeout,cancelSignal:r,onProgress:a.onProgress}).then(function(e){return{resultType:"segment-loaded",resultData:e}})},parseSegment:function(e,t,n){var i,r,a=t.segment,o=t.language,s=t.mimeType,u=void 0===s?"":s,l=t.codecs,d=void 0===l?"":l,c=sP(t.mimeType),f=e.data,h=e.isChunked;if(a.isInit)return{segmentType:"init",initializationData:null,initializationDataSize:0,protectionData:[],initTimescale:void 0};if(null===f)return{segmentType:"media",chunkData:null,chunkInfos:null,chunkOffset:0,chunkSize:0,protectionData:[],appendWindow:[void 0,void 0]};var p,m,g,y,_,S=null;if(c){r=(b="string"==typeof f?tX(f):v(f,Uint8Array)?f:new Uint8Array(f)).length;var b,E=void 0!==n?sM(b,h,n,a,t.isLive):null;p=null==E?void 0:E.nextSegments,null===(S=null!=(i=null==E?void 0:E.chunkInfos)?i:null)?h?uw.warn("Smooth: Unavailable time data for current text track."):(m=a.time,g=a.end):(m=S.time,g=void 0!==S.duration?S.time+S.duration:a.end);var k=d.toLowerCase();if("application/ttml+xml+mp4"===u||"stpp"===k||"stpp.ttml.im1t"===k)_="ttml";else if("wvtt"===k)_="vtt";else throw Error("could not find a text-track parser for the type ".concat(u));var T=nk(b);y=null===T?"":tJ(T)}else{if(m=a.time,g=a.end,"string"!=typeof f){var w,I=v(f,Uint8Array)?f:new Uint8Array(f);r=I.length,w=tJ(I)}else w=f;switch(u){case"application/x-sami":case"application/smil":_="sami";break;case"application/ttml+xml":_="ttml";break;case"text/vtt":_="vtt"}if(void 0===_){if("srt"===d.toLowerCase())_="srt";else throw Error("could not find a text-track parser for the type ".concat(u))}y=w}var A=Array.isArray(p)&&p.length>0?p:void 0,R=null!=m?m:0;return{segmentType:"media",chunkData:{type:_,data:y,start:m,end:g,language:o},chunkSize:r,chunkInfos:S,chunkOffset:R,protectionData:[],predictedSegments:A,appendWindow:[void 0,void 0]}}}}},fT=function(e){f(i,e);var t=w(i);function i(e,r){var o;return a(this,i),Object.setPrototypeOf(n(o=t.call(this)),i.prototype),o.name="WorkerInitializationError",o.type="WORKER_INITIALIZATION_ERROR",o.code=e,o.message=ef(o.code,r),m(o)}return i}(k(Error)),fw=um,fI=["canplay","ended","play","pause","seeking","seeked","loadedmetadata","ratechange"],fA=function(){function e(t,n){var i=this;a(this,e),this._internalSeeksIncoming=[],this._mediaElement=t,this._withMediaSource=n.withMediaSource,this._lowLatencyMode=n.lowLatencyMode,this._canceller=new uM,this._observationRef=this._createSharedReference(),this._expectedSeekingPosition=null,this._pendingSeek=null;var r=function(){if(null!==i._pendingSeek){var e=i._pendingSeek;i._pendingSeek=null,i._actuallySetCurrentTime(e)}};t.addEventListener("loadedmetadata",r),this._canceller.signal.register(function(){t.removeEventListener("loadedmetadata",r)})}return u(e,[{key:"stop",value:function(){this._canceller.cancel()}},{key:"getCurrentTime",value:function(){return this._mediaElement.currentTime}},{key:"getPlaybackRate",value:function(){return this._mediaElement.playbackRate}},{key:"getIsPaused",value:function(){return this._mediaElement.paused}},{key:"setCurrentTime",value:function(e){this._mediaElement.readyState>=1?this._actuallySetCurrentTime(e):(this._internalSeeksIncoming=[],this._pendingSeek=e,this._generateObservationForEvent("manual"))}},{key:"setPlaybackRate",value:function(e){this._mediaElement.playbackRate=e}},{key:"getReadyState",value:function(){return this._mediaElement.readyState}},{key:"getReference",value:function(){return this._observationRef}},{key:"listen",value:function(e,t){var n;if(this._canceller.isUsed()||(null==(n=null==t?void 0:t.clearSignal)?void 0:n.isCancelled())===!0)return s;this._observationRef.onUpdate(e,{clearSignal:null==t?void 0:t.clearSignal,emitCurrentValue:null==t?void 0:t.includeLastObservation})}},{key:"deriveReadOnlyObserver",value:function(e){return function e(t,n,i){var r=n(t.getReference(),i);return{getCurrentTime:function(){return t.getCurrentTime()},getReadyState:function(){return t.getReadyState()},getPlaybackRate:function(){return t.getPlaybackRate()},getIsPaused:function(){return t.getIsPaused()},getReference:function(){return r},listen:function(e,t){var n;i.isCancelled()||(null==(n=null==t?void 0:t.clearSignal)?void 0:n.isCancelled())===!0||r.onUpdate(e,{clearSignal:null==t?void 0:t.clearSignal,emitCurrentValue:null==t?void 0:t.includeLastObservation})},deriveReadOnlyObserver:function(t){return e(this,t,i)}}}(this,e,this._canceller.signal)}},{key:"_actuallySetCurrentTime",value:function(e){uw.info("API: Seeking internally",e),this._internalSeeksIncoming.push(e),this._mediaElement.currentTime=e}},{key:"_createSharedReference",value:function(){var e=this;if(void 0!==this._observationRef)return this._observationRef;var t,n=uT.getCurrent(),i=n.SAMPLING_INTERVAL_MEDIASOURCE,r=n.SAMPLING_INTERVAL_LOW_LATENCY,a=n.SAMPLING_INTERVAL_NO_MEDIASOURCE,o=new uR(this._getCurrentObservation("init"),this._canceller.signal);t=this._lowLatencyMode?r:this._withMediaSource?i:a;var s=function(){e._generateObservationForEvent("timeupdate")},u=setInterval(s,t),l=fI.map(function(n){var i=function(){clearInterval(u),u=setInterval(s,t),e._generateObservationForEvent(n)};return e._mediaElement.addEventListener(n,i),function(){e._mediaElement.removeEventListener(n,i)}});return this._canceller.signal.register(function(){clearInterval(u),l.forEach(function(e){return e()}),o.finish()}),o}},{key:"_getCurrentObservation",value:function(e){var t=e,n=void 0===this._observationRef?sW(this._mediaElement):this._observationRef.getValue(),i=!1,r=this._pendingSeek,a=sB(this._mediaElement),o=a.buffered,s=a.readyState,u=a.position,l=a.seeking;if("seeking"===t){if(this._internalSeeksIncoming.length>0){i=!0,t="internal-seeking";var d=this._internalSeeksIncoming.shift();this._expectedSeekingPosition=fw?Math.max(u,null!=d?d:0):u}else this._expectedSeekingPosition=u}else l?this._expectedSeekingPosition=Math.max(u,null!=(c=this._expectedSeekingPosition)?c:0):fw&&null!==this._expectedSeekingPosition&&u<this._expectedSeekingPosition?r=this._expectedSeekingPosition:this._expectedSeekingPosition=null;l&&1===n.seeking&&"seeking"!==e&&(i=!0);var c,f,v,h,p=null!=(f=this._expectedSeekingPosition)?f:u;!this._withMediaSource&&0===o.length&&s>=3?(v=void 0,h=void 0):h=null!==(v=P(o,p))?v.end-p:1/0;var m,g=sV({previousObservation:n,currentObservation:a,basePosition:p,observationEvent:t,lowLatencyMode:this._lowLatencyMode,withMediaSource:this._withMediaSource,bufferGap:h,currentRange:v}),y=sz(n,a,t,h);m=i?1:l?2:0;var _=uk({},a,{position:new d$(a.position,r),event:t,seeking:m,rebuffering:g,freezing:y,bufferGap:h,currentRange:v});return uw.hasLevel("DEBUG")&&uw.debug("API: current media element state tick","event",_.event,"position",_.position.getPolled(),"seeking",_.seeking,"internalSeek",i,"rebuffering",null!==_.rebuffering,"freezing",null!==_.freezing,"ended",_.ended,"paused",_.paused,"playbackRate",_.playbackRate,"readyState",_.readyState,"pendingPosition",r),_}},{key:"_generateObservationForEvent",value:function(e){var t=this._getCurrentObservation(e);uw.hasLevel("DEBUG")&&uw.debug("API: current playback timeline:\n"+sK(t.buffered,t.position.getPolled()),"\n".concat(e)),this._observationRef.setValue(t)}}]),e}(),fR=function(e){f(n,e);var t=w(n);function n(e){var i;return a(this,n),(i=t.call(this))._canceller=new uM,i._adaptationRef=e,i._updateToken=!1,i.refresh=s,m(i)}return u(n,[{key:"start",value:function(e){if(this._updateToken=!0,null===e){this._lastEmitted=null,this._updateToken=!1,this._adaptationRef.setValue(null);return}var t=this._constructLockedRepresentationsReference(e);this._updateToken&&(this._lastEmitted={adaptation:e.adaptation,switchingMode:e.switchingMode,lockedRepresentations:null},this._updateToken=!1,this._adaptationRef.setValue({adaptationId:e.adaptation.id,switchingMode:e.switchingMode,representations:t,relativeResumingPosition:void 0}))}},{key:"updateTrack",value:function(e){if(this._updateToken=!0,null===e){if(null===this._lastEmitted)return;this._updateToken=!1,this._canceller.cancel(),this._canceller=new uM,this._lastEmitted=null,this._adaptationRef.setValue(null);return}var t=e.adaptation,n=e.switchingMode,i=e.relativeResumingPosition;this._canceller.cancel(),this._canceller=new uM;var r=this._constructLockedRepresentationsReference(e);this._updateToken&&(this._lastEmitted={adaptation:t,switchingMode:n,lockedRepresentations:null},this._updateToken=!1,this._adaptationRef.setValue({adaptationId:t.id,switchingMode:n,representations:r,relativeResumingPosition:i}))}},{key:"_constructLockedRepresentationsReference",value:function(e){var t=new uR({representationIds:[],switchingMode:"lazy"}),n=this;return this.refresh=i,this._canceller.signal.register(function(){n.refresh=s}),e.lockedRepresentations.onUpdate(i,{clearSignal:this._canceller.signal,emitCurrentValue:!1}),i(),t;function i(){var i,r,a=e.lockedRepresentations.getValue();if(null===a)r=e.adaptation.representations.filter(function(e){return!0===e.isSupported&&!1!==e.decipherable}),i="lazy";else{var o=a.representationIds;if(i=a.switchingMode,0===(r=e.adaptation.representations.filter(function(e){return e_(o,e.id)}).filter(function(e){return!0===e.isSupported&&!1!==e.decipherable})).length){n.trigger("noPlayableLockedRepresentation",null);return}}if(r.length<=0){e.adaptation.isSupported=!1,n.trigger("noPlayableRepresentation",null);return}var s=t.getValue(),u=r.map(function(e){return e.id}).slice().sort();if(u.length!==s.representationIds.length){t.setValue({representationIds:u,switchingMode:i});return}for(var l=0;l<u.length;l++)if(s.representationIds[l]!==u[l]){t.setValue({representationIds:u,switchingMode:i});return}}}},{key:"dispose",value:function(){this.removeEventListener(),this._canceller.cancel(),this._adaptationRef.finish()}}]),n}(ur),fC=function(e){f(n,e);var t=w(n);function n(e){var i,r;return a(this,n),(i=t.call(this))._storedPeriodInfo=[],i._isDisposed=!1,i._cachedPeriodInfo=new WeakMap,i._isTrickModeTrackEnabled=e.preferTrickModeTracks,i._defaultAudioTrackSwitchingMode=null!=(r=e.defaultAudioTrackSwitchingMode)?r:uT.getCurrent().DEFAULT_AUDIO_TRACK_SWITCHING_MODE,m(i)}return u(n,[{key:"getAvailablePeriods",value:function(){return this._storedPeriodInfo.reduce(function(e,t){return t.isPeriodAdvertised&&e.push(sQ(t.period)),e},[])}},{key:"onManifestUpdate",value:function(e){var t=this,n=uT.getCurrent().DEFAULT_VIDEO_TRACK_SWITCHING_MODE,i=e.periods;if(ui.CURRENT_ENV===ui.DEV)for(var r=1;r<i.length;r++)W(i[r-1].start<=i[r].start);for(var a=[],o=0,s=0;s<this._storedPeriodInfo.length;s++){var u=(l=this,function(e){var t=l._storedPeriodInfo[e].period,r=i[o];if(void 0===r)for(var u=l._storedPeriodInfo.length-1;u>=e;u--)l._storedPeriodInfo[u].inManifest=!1,sq(l._storedPeriodInfo[u])&&l._removePeriodObject(u);else if(t===r){o++;var v=l._storedPeriodInfo[e].text.storedSettings;if(null!==v&&!eT(r,"text").some(function(e){return e.id===v.adaptation.id})){uw.warn("TS: Chosen text Adaptation not available anymore");var h=l._storedPeriodInfo[e];if(h.text.storedSettings=null,l.trigger("trackUpdate",{period:sQ(r),trackType:"text",reason:"missing"}),l._isDisposed)return s=e,{v:void 0};var p=sH(l._storedPeriodInfo,h.period.id);void 0!==p&&null===p.text.storedSettings&&(null==(d=p.text.dispatcher)||d.updateTrack(null))}var m=l._storedPeriodInfo[e].video.storedSettings;if(null!==m){var g=eT(r,"video");if(!g.some(function(e){return e.id===m.adaptation.id})){uw.warn("TS: Chosen video Adaptation not available anymore");var y=l._storedPeriodInfo[e],_=void 0;if(0===g.length)_=null;else{var S=g[0],b=sY(S,l._isTrickModeTrackEnabled);_={adaptationBase:S,adaptation:b,switchingMode:n,lockedRepresentations:new uR(null)}}if(y.video.storedSettings=_,l.trigger("trackUpdate",{period:sQ(r),trackType:"video",reason:"missing"}),l._isDisposed)return s=e,{v:void 0};var E=sH(l._storedPeriodInfo,y.period.id);void 0!==E&&E.video.storedSettings===_&&(null==(c=E.video.dispatcher)||c.updateTrack(_))}}var k=l._storedPeriodInfo[e].audio.storedSettings;if(null!==k){var T=eT(r,"audio");if(!T.some(function(e){return e.id===k.adaptation.id})){uw.warn("TS: Chosen audio Adaptation not available anymore");var w=l._storedPeriodInfo[e],I=0===T.length?null:{adaptation:T[0],switchingMode:l._defaultAudioTrackSwitchingMode,lockedRepresentations:new uR(null)};if(w.audio.storedSettings=I,l.trigger("trackUpdate",{period:sQ(r),trackType:"audio",reason:"missing"}),l._isDisposed)return s=e,{v:void 0};var A=sH(l._storedPeriodInfo,w.period.id);void 0!==A&&A.audio.storedSettings===I&&(null==(f=A.audio.dispatcher)||f.updateTrack(I))}}}else if(t.start<=r.start)l._storedPeriodInfo[e].inManifest=!1,sq(l._storedPeriodInfo[e])&&(l._removePeriodObject(e),e--);else{var R=sj(r,!0,l._isTrickModeTrackEnabled,l._defaultAudioTrackSwitchingMode);l._storedPeriodInfo.splice(e,0,R),a.push(R),o++}s=e}(s));if("object"===b(u))return u.v}if(o<i.length){var l,d,c,f,v,h,p,m,g=i.slice(o).map(function(e){return sj(e,!0,t._isTrickModeTrackEnabled,t._defaultAudioTrackSwitchingMode)});(m=this._storedPeriodInfo).push.apply(m,S(g)),a.push.apply(a,S(g))}var y=!0,_=!1,E=void 0;try{for(var k,T=this._storedPeriodInfo[Symbol.iterator]();!(y=(k=T.next()).done);y=!0){var w=k.value;null==(v=w.audio.dispatcher)||v.refresh(),null==(h=w.video.dispatcher)||h.refresh(),null==(p=w.text.dispatcher)||p.refresh()}}catch(e){_=!0,E=e}finally{try{y||null==T.return||T.return()}finally{if(_)throw E}}}},{key:"onDecipherabilityUpdates",value:function(){var e=!0,t=!1,n=void 0;try{for(var i,r,a,o,s=this._storedPeriodInfo[Symbol.iterator]();!(e=(o=s.next()).done);e=!0){var u=o.value;null==(i=u.audio.dispatcher)||i.refresh(),null==(r=u.video.dispatcher)||r.refresh(),null==(a=u.text.dispatcher)||a.refresh()}}catch(e){t=!0,n=e}finally{try{e||null==s.return||s.return()}finally{if(t)throw n}}}},{key:"addTrackReference",value:function(e,t,n){var r=this,a=sH(this._storedPeriodInfo,t.id);if(void 0===a){a=sj(t,!1,this._isTrickModeTrackEnabled,this._defaultAudioTrackSwitchingMode);for(var o=!1,s=0;s<this._storedPeriodInfo.length;s++)this._storedPeriodInfo[s].period.start>t.start&&(this._storedPeriodInfo.splice(s,0,a),o=!0);o||this._storedPeriodInfo.push(a)}if(a.isPeriodAdvertised||(a.isPeriodAdvertised=!0,this.trigger("newAvailablePeriods",[{id:t.id,start:t.start,end:t.end}]),!this._isDisposed)){if(null!==a[e].dispatcher){uw.error("TS: Subject already added for ".concat(e," and Period ").concat(t.start));return}var u=a[e].storedSettings,l=new fR(n);a[e].dispatcher=l,l.addEventListener("noPlayableRepresentation",function(){var n,a,o,s,u=j(null!=(n=t.adaptations[e])?n:[],function(e){return!1!==e.isSupported&&e.representations.filter(function(e){return!0===e.isSupported&&!1!==e.decipherable}).length>0});if(void 0===u){var l=new u2("NO_PLAYABLE_REPRESENTATION","No ".concat(e," Representation can be played"),{tracks:void 0});r.trigger("error",l),r.dispose();return}var d=null==(a=sH(r._storedPeriodInfo,t.id))?void 0:a[e];if(!i(d)){var c={adaptation:u,switchingMode:"audio"===e?r._defaultAudioTrackSwitchingMode:"reload",lockedRepresentations:new uR(null)};d.storedSettings=c,r.trigger("trackUpdate",{period:sQ(t),trackType:e,reason:"no-playable-representation"}),r._isDisposed||i(d=null==(o=sH(r._storedPeriodInfo,t.id))?void 0:o[e])||d.storedSettings!==c||null==(s=d.dispatcher)||s.updateTrack(c)}}),l.addEventListener("noPlayableLockedRepresentation",function(){null==u||u.lockedRepresentations.setValue(null),r.trigger("brokenRepresentationsLock",{period:{id:t.id,start:t.start,end:t.end},trackType:e})}),l.start(u)}}},{key:"removeTrackReference",value:function(e,t){var n=sG(this._storedPeriodInfo,t);if(void 0===n){uw.warn("TS: ".concat(e," not found for period"),t.start);return}var i=this._storedPeriodInfo[n],r=i[e];if((null==r?void 0:r.dispatcher)===null){uw.warn("TS: TrackDispatcher already removed for ".concat(e," and Period ").concat(t.start));return}r.dispatcher.dispose(),r.dispatcher=null,sq(i)&&this._removePeriodObject(n)}},{key:"getPeriodObjectFromPeriod",value:function(e){var t=sH(this._storedPeriodInfo,e.id);return void 0===t&&void 0!==e?this._cachedPeriodInfo.get(e):t}},{key:"getPeriodObjectFromId",value:function(e){return sH(this._storedPeriodInfo,e)}},{key:"disableVideoTrickModeTracks",value:function(){this._isTrickModeTrackEnabled&&(this._isTrickModeTrackEnabled=!1,this._resetVideoTrackChoices("trickmode-disabled"))}},{key:"enableVideoTrickModeTracks",value:function(){this._isTrickModeTrackEnabled||(this._isTrickModeTrackEnabled=!0,this._resetVideoTrackChoices("trickmode-enabled"))}},{key:"resetPeriodObjects",value:function(){for(var e,t,n,i=this._storedPeriodInfo.length-1;i>=0;i--){var r=this._storedPeriodInfo[i];null==(e=r.audio.dispatcher)||e.dispose(),r.audio.dispatcher=null,null==(t=r.video.dispatcher)||t.dispose(),r.video.dispatcher=null,null==(n=r.text.dispatcher)||n.dispose(),r.text.dispatcher=null,r.inManifest||this._removePeriodObject(i)}}},{key:"isTrickModeEnabled",value:function(){return this._isTrickModeTrackEnabled}},{key:"setAudioTrack",value:function(e){var t=e.periodRef,n=e.trackId,i=e.switchingMode,r=e.lockedRepresentations,a=e.relativeResumingPosition;return this._setAudioOrTextTrack({bufferType:"audio",periodRef:t,trackId:n,switchingMode:null!=i?i:this._defaultAudioTrackSwitchingMode,lockedRepresentations:r,relativeResumingPosition:a})}},{key:"setTextTrack",value:function(e,t){return this._setAudioOrTextTrack({bufferType:"text",periodRef:e,trackId:t,switchingMode:"direct",lockedRepresentations:null,relativeResumingPosition:void 0})}},{key:"_setAudioOrTextTrack",value:function(e){var t=e.bufferType,n=e.periodRef,i=e.trackId,r=e.switchingMode,a=e.lockedRepresentations,o=e.relativeResumingPosition,s=n.period,u=j(null!=(l=s.adaptations[t])?l:[],function(e){var t=e.id;return!0===e.isSupported&&t===i});if(void 0===u)throw Error("Wanted ".concat(t," track not found."));var l,d,c,f=n[t];c=new uR(null===a?null:{representationIds:this._getRepresentationsToLock(u,a),switchingMode:"audio"===t?this._defaultAudioTrackSwitchingMode:"direct"});var v={adaptation:u,switchingMode:r,lockedRepresentations:c,relativeResumingPosition:o};if(f.storedSettings=v,this.trigger("trackUpdate",{period:sQ(s),trackType:t,reason:"manual"}),!this._isDisposed){var h=sH(this._storedPeriodInfo,s.id);void 0!==h&&h[t].storedSettings===v&&(null==(d=h[t].dispatcher)||d.updateTrack(v))}}},{key:"setVideoTrack",value:function(e){var t=e.periodRef,n=e.trackId,i=e.switchingMode,r=e.lockedRepresentations,a=e.relativeResumingPosition,o=t.period,s=j(null!=(u=o.adaptations.video)?u:[],function(e){var t=e.id;return!0===e.isSupported&&t===n});if(void 0===s)throw Error("Wanted video track not found.");var u,l,d,c=uT.getCurrent().DEFAULT_VIDEO_TRACK_SWITCHING_MODE,f=t.video,v=sY(s,this._isTrickModeTrackEnabled);d=new uR(null===r?null:{representationIds:this._getRepresentationsToLock(s,r),switchingMode:c});var h={adaptationBase:s,switchingMode:null!=i?i:c,adaptation:v,relativeResumingPosition:a,lockedRepresentations:d};if(f.storedSettings=h,this.trigger("trackUpdate",{period:sQ(o),trackType:"video",reason:"manual"}),!this._isDisposed){var p=sH(this._storedPeriodInfo,o.id);void 0!==p&&p.video.storedSettings===h&&(null==(l=p.video.dispatcher)||l.updateTrack(h))}}},{key:"disableTrack",value:function(e,t){var n,i,r=e[t];if(null!==r.storedSettings&&("text"!==t&&(null==(n=e[t].storedSettings)||n.lockedRepresentations.finish()),r.storedSettings=null,this.trigger("trackUpdate",{period:sQ(e.period),trackType:t,reason:"manual"}),!this._isDisposed)){var a=sH(this._storedPeriodInfo,e.period.id);void 0!==a&&null===a[t].storedSettings&&(null==(i=a[t].dispatcher)||i.updateTrack(null))}}},{key:"getChosenAudioTrack",value:function(e){return null===e.audio.storedSettings?null:eC(e.audio.storedSettings.adaptation,!0)}},{key:"getChosenTextTrack",value:function(e){return null===e.text.storedSettings?null:eM(e.text.storedSettings.adaptation)}},{key:"getChosenVideoTrack",value:function(e){return null===e.video.storedSettings?null:eP(e.video.storedSettings.adaptation,!0)}},{key:"getAvailableAudioTracks",value:function(e){var t=e.audio.storedSettings,n=null!==t?t.adaptation.id:null;return eT(e.period,"audio").map(function(e){var t=null!==n&&n===e.id;return uk(eC(e,!0),{active:t})})}},{key:"getAvailableTextTracks",value:function(e){var t=e.text.storedSettings,n=null!==t?t.adaptation.id:null;return eT(e.period,"text").map(function(e){var t=null!==n&&n===e.id;return uk(eM(e),{active:t})})}},{key:"getAvailableVideoTracks",value:function(e){var t=e.video.storedSettings,n=null===t?void 0:t.adaptation.id;return eT(e.period,"video").map(function(e){var t=null!==n&&n===e.id,i=eP(e,!0),r=void 0!==i.trickModeTracks?i.trickModeTracks.map(function(e){var t=null!==n&&n===e.id;return uk(e,{active:t})}):[],a=uk(i,{active:t});return void 0!==r&&(a.trickModeTracks=r),a})}},{key:"getLockedAudioRepresentations",value:function(e){var t=e.audio.storedSettings;if(null===t)return null;var n=t.lockedRepresentations.getValue();return null===n?null:n.representationIds}},{key:"getLockedVideoRepresentations",value:function(e){var t=e.video.storedSettings;if(null===t)return null;var n=t.lockedRepresentations.getValue();return null===n?null:n.representationIds}},{key:"lockAudioRepresentations",value:function(e,t){var n,i=e.audio.storedSettings;if(null!==i){var r=uT.getCurrent().DEFAULT_AUDIO_REPRESENTATIONS_SWITCHING_MODE,a=this._getRepresentationsToLock(i.adaptation,t.representations),o=null!=(n=t.switchingMode)?n:r;i.lockedRepresentations.setValue({representationIds:a,switchingMode:o})}}},{key:"lockVideoRepresentations",value:function(e,t){var n,i=e.video.storedSettings;if(null!==i){var r=uT.getCurrent().DEFAULT_VIDEO_REPRESENTATIONS_SWITCHING_MODE,a=this._getRepresentationsToLock(i.adaptation,t.representations),o=null!=(n=t.switchingMode)?n:r;i.lockedRepresentations.setValue({representationIds:a,switchingMode:o})}}},{key:"unlockAudioRepresentations",value:function(e){var t=e.audio.storedSettings;null===t||null===t.lockedRepresentations.getValue()||t.lockedRepresentations.setValue(null)}},{key:"unlockVideoRepresentations",value:function(e){var t=e.video.storedSettings;null===t||null===t.lockedRepresentations.getValue()||t.lockedRepresentations.setValue(null)}},{key:"dispose",value:function(){for(this._isDisposed=!0;;){var e=this._storedPeriodInfo.pop();if(void 0===e)return;e.isRemoved=!0}}},{key:"_resetVideoTrackChoices",value:function(e){for(var t,n=0;n<this._storedPeriodInfo.length;n++){var i=this._storedPeriodInfo[n];if(null!==i.video.storedSettings){var r=i.video.storedSettings.adaptationBase;if(null!==r){var a=sY(r,this._isTrickModeTrackEnabled);i.video.storedSettings.adaptationBase=r,i.video.storedSettings.adaptation=a}}}for(var o=this._storedPeriodInfo.slice(),s=0;s<o.length;s++){var u=o[s].period,l=o[s].video.storedSettings;if(this.trigger("trackUpdate",{period:sQ(u),trackType:"video",reason:e}),this._isDisposed)return;var d=sH(this._storedPeriodInfo,u.id);void 0!==d&&d.video.storedSettings===l&&(null==(t=d.video.dispatcher)||t.updateTrack(l))}}},{key:"_removePeriodObject",value:function(e){ui.CURRENT_ENV===ui.DEV&&W(e<this._storedPeriodInfo.length,"Invalid index for Period removal");var t=this._storedPeriodInfo[e];this._storedPeriodInfo[e].isRemoved=!0,this._storedPeriodInfo.splice(e,1),this._cachedPeriodInfo.set(t.period,t)}},{key:"_getRepresentationsToLock",value:function(e,t){var n=t.reduce(function(t,n){var i=j(e.representations,function(e){return e.id===n});return void 0===i?uw.warn("API: Wanted locked Representation not found."):t.push(i.id),t},[]);if(0===n.length)throw Error("Cannot lock Representations: None of the given Representation id are found");return n}}]),n}(ur),fM=ey(),fP=["manifestLoader","segmentLoader"],fD=function(e){f(r,e);var n=w(r);function r(){var e,t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};a(this,r),e=n.call(this);var i=sX(t),o=i.baseBandwidth,s=i.videoResolutionLimit,u=i.maxBufferAhead,l=i.maxBufferBehind,d=i.throttleVideoBitrateWhenHidden,c=i.videoElement,f=i.wantedBufferAhead,v=i.maxVideoBufferSize;c.preload="auto",e.version="4.0.0-rc.2",e.log=uw,e.state="STOPPED",e.videoElement=c,r._priv_registerVideoElement(e.videoElement);var h=new uM;e._destroyCanceller=h,e._priv_pictureInPictureRef=tV(c,h.signal),e._priv_speed=new uR(c.playbackRate,e._destroyCanceller.signal),e._priv_preferTrickModeTracks=!1,e._priv_contentLock=new uR(!1,e._destroyCanceller.signal),e._priv_bufferOptions={wantedBufferAhead:new uR(f,e._destroyCanceller.signal),maxBufferAhead:new uR(u,e._destroyCanceller.signal),maxBufferBehind:new uR(l,e._destroyCanceller.signal),maxVideoBufferSize:new uR(v,e._destroyCanceller.signal)},e._priv_bitrateInfos={lastBitrates:{audio:o,video:o}},e._priv_throttleVideoBitrateWhenHidden=d,e._priv_videoResolutionLimit=s,e._priv_currentError=null,e._priv_contentInfos=null,e._priv_contentEventsMemory={},e._priv_reloadingMetadata={},e._priv_lastAutoPlay=!1,e._priv_worker=null;var p=function(){e.trigger("volumeChange",{volume:c.volume,muted:c.muted})};return c.addEventListener("volumechange",p),h.signal.register(function(){c.removeEventListener("volumechange",p)}),e}return u(r,[{key:"attachWorker",value:function(e){var n=this;return new Promise(function(i,r){if(!(u_&&"object"==typeof Worker||"function"==typeof Worker))return uw.warn("API: Cannot rely on a WebWorker: Worker API unavailable"),r(new fT("INCOMPATIBLE_ERROR","Worker unavailable"));if("string"==typeof e.workerUrl)n._priv_worker=new Worker(e.workerUrl);else{var a,o=URL.createObjectURL(e.workerUrl);n._priv_worker=new Worker(o),URL.revokeObjectURL(o)}n._priv_worker.onerror=function(e){null!==n._priv_worker&&(n._priv_worker.terminate(),n._priv_worker=null),uw.error("API: Unexpected worker error",v(e.error,Error)?e.error:void 0),r(new fT("UNKNOWN_ERROR",'Unexpected Worker "error" event'))};var s=function(e){var t=e.data;"init-error"===t.type?(uw.warn("API: Processing InitError worker message: detaching worker"),null!==n._priv_worker&&(n._priv_worker.removeEventListener("message",s),n._priv_worker.terminate(),n._priv_worker=null),r(new fT("SETUP_ERROR","Worker parser initialization failed: "+t.value.errorMessage))):"init-success"===t.type&&(uw.info("API: InitSuccess received from worker."),null!==n._priv_worker&&n._priv_worker.removeEventListener("message",s),i())};n._priv_worker.addEventListener("message",s),uw.debug("---> Sending To Worker:","init"),n._priv_worker.postMessage({type:"init",value:{dashWasmUrl:e.dashWasmUrl,logLevel:uw.getLevel(),sendBackLogs:t(),date:Date.now(),timestamp:uN(),hasVideo:(null==(a=n.videoElement)?void 0:a.nodeName.toLowerCase())==="video",hasMseInWorker:cI}}),uw.addEventListener("onLogLevelChange",function(e){null!==n._priv_worker&&(uw.debug("---> Sending To Worker:","log-level-update"),n._priv_worker.postMessage({type:"log-level-update",value:{logLevel:e,sendBackLogs:t()}}))},n._destroyCanceller.signal)})}},{key:"getCurrentModeInformation",value:function(){return null===this._priv_contentInfos?null:{isDirectFile:this._priv_contentInfos.isDirectFile,useWorker:this._priv_contentInfos.useWorker}}},{key:"addEventListener",value:function(e,t){return d(c(r.prototype),"addEventListener",this).call(this,e,t)}},{key:"stop",value:function(){null!==this._priv_contentInfos&&this._priv_contentInfos.currentContentCanceller.cancel(),this._priv_cleanUpCurrentContentState(),"STOPPED"!==this.state&&this._priv_setPlayerState("STOPPED")}},{key:"dispose",value:function(){this.stop(),null!==this.videoElement&&(r._priv_deregisterVideoElement(this.videoElement),tx(this.videoElement).catch(function(e){var t=v(e,Error)?e.message:"Unknown error";uw.error("API: Could not dispose decryption resources: "+t)})),this._destroyCanceller.cancel(),this._priv_reloadingMetadata={},this.videoElement=null,null!==this._priv_worker&&(this._priv_worker.terminate(),this._priv_worker=null)}},{key:"loadVideo",value:function(e){var t=sZ(e);uw.info("API: Calling loadvideo",t.url,t.transport),this._priv_reloadingMetadata={options:t},this._priv_initializeContentPlayback(t),this._priv_lastAutoPlay=t.autoPlay}},{key:"reload",value:function(e){var t,n,i,r,a,o,s=this._priv_reloadingMetadata,u=s.options,l=s.manifest,d=s.reloadPosition,c=s.reloadInPause;if(void 0===u)throw Error("API: Can't reload without having previously loaded a content.");if(s$(e),(null==(t=null==e?void 0:e.reloadAt)?void 0:t.position)!==void 0)r={position:e.reloadAt.position};else if((null==(n=null==e?void 0:e.reloadAt)?void 0:n.relative)!==void 0){if(void 0===d)throw Error("Can't reload to a relative position when previous content was not loaded.");r={position:e.reloadAt.relative+d}}else void 0!==d&&(r={position:d});(null==e?void 0:e.autoPlay)!==void 0?a=e.autoPlay:void 0!==c&&(a=!c),(null==e?void 0:e.keySystems)!==void 0?o=e.keySystems:(null==(i=this._priv_reloadingMetadata.options)?void 0:i.keySystems)!==void 0&&(o=this._priv_reloadingMetadata.options.keySystems);var f=un(ut({},u),{initialManifest:l});void 0!==r&&(f.startAt=r),void 0!==a&&(f.autoPlay=a),void 0!==o&&(f.keySystems=o),this._priv_initializeContentPlayback(f)}},{key:"createDebugElement",value:function(e){if(null===le.createDebugElement)throw Error("Feature `DEBUG_ELEMENT` not added to the RxPlayer");var t=new uM;return le.createDebugElement(e,this,t.signal),{dispose:function(){t.cancel()}}}},{key:"_priv_initializeContentPlayback",value:function(e){var t=this,n=e.autoPlay,r=e.defaultAudioTrackSwitchingMode,a=e.enableFastSwitching,o=e.initialManifest,s=e.keySystems,u=e.lowLatencyMode,l=e.minimumManifestUpdateInterval,d=e.requestConfig,c=e.onCodecSwitch,f=e.startAt,v=e.transport,h=e.checkMediaSegmentIntegrity,p=e.manifestLoader,m=e.referenceDateTime,g=e.segmentLoader,y=e.serverSyncInfos,_=e.mode,S=e.__priv_manifestUpdateUrl,b=e.__priv_patchLastSegmentInSidx,E=e.url;if(null===this.videoElement)throw Error("the attached video element is disposed");var k,T,w,I,A,R,C,M="directfile"===v,P=new uM,D=this.videoElement,x=!1,N=null;if(M){if(null===le.directfile)throw this.stop(),this._priv_currentError=null,Error("DirectFile feature not activated in your build.");if(i(E))throw Error("No URL for a DirectFile content");if(uw.info("API: Initializing DirectFile mode in the main thread"),N=this._priv_initializeMediaElementTracksStore(P.signal),P.isUsed())return;C=new le.directfile.initDirectFile({autoPlay:n,keySystems:s,speed:this._priv_speed,startAt:f,url:E})}else{var O={lowLatencyMode:u,maxRetry:null==(k=d.manifest)?void 0:k.maxRetry,requestTimeout:null==(T=d.manifest)?void 0:T.timeout,connectionTimeout:null==(w=d.manifest)?void 0:w.connectionTimeout,minimumManifestUpdateInterval:l,initialManifest:o},L=sO(),U={throttleBitrate:{},limitResolution:{}};this._priv_throttleVideoBitrateWhenHidden&&(L?U.throttleBitrate={video:K(tz(this._priv_pictureInPictureRef,P.signal),function(e){return e?1/0:0},P.signal)}:uw.warn("API: Can't apply throttleVideoBitrateWhenHidden because browser can't be trusted for visibility.")),"videoElement"===this._priv_videoResolutionLimit?L?U.limitResolution={video:tW(D,this._priv_pictureInPictureRef,P.signal)}:uw.warn("API: Can't apply videoResolutionLimit because browser can't be trusted for video size."):"screen"===this._priv_videoResolutionLimit&&(U.limitResolution={video:tK(P.signal)});var F={initialBitrates:this._priv_bitrateInfos.lastBitrates,lowLatencyMode:u,throttlers:U},B="native"===e.textTrackMode?{textTrackMode:"native"}:{textTrackMode:"html",textTrackElement:e.textTrackElement},V=uk({enableFastSwitching:a,onCodecSwitch:c},this._priv_bufferOptions),z={lowLatencyMode:u,maxRetry:null==(I=d.segment)?void 0:I.maxRetry,requestTimeout:null==(A=d.segment)?void 0:A.timeout,connectionTimeout:null==(R=d.segment)?void 0:R.connectionTimeout},G=null!==le.multithread&&null!==this._priv_worker&&"dash"===v&&fP.every(function(t){return i(e[t])})&&"function"!=typeof e.representationFilter;if("main"!==_&&("auto"!==_||G)){if(null===le.multithread)throw Error("Cannot load video in multithread mode: `MULTI_THREAD` feature not imported.");if(null===this._priv_worker)throw Error("Cannot load video in multithread mode: `attachWorker` method not called.");W("function"!=typeof e.representationFilter),x=!0,uw.info("API: Initializing MediaSource mode in a WebWorker");var H={lowLatencyMode:u,checkMediaSegmentIntegrity:h,referenceDateTime:m,serverSyncInfos:y,manifestLoader:void 0,segmentLoader:void 0,representationFilter:e.representationFilter,__priv_manifestUpdateUrl:S,__priv_patchLastSegmentInSidx:b};C=new le.multithread.init({adaptiveOptions:F,autoPlay:n,bufferOptions:V,keySystems:s,lowLatencyMode:u,transportOptions:H,manifestRequestSettings:O,segmentRequestOptions:z,speed:this._priv_speed,startAt:f,textTrackOptions:B,worker:this._priv_worker,url:E})}else{if(null===le.mainThreadMediaSourceInit)throw Error("Cannot load video, neither in a WebWorker nor with the `MEDIA_SOURCE_MAIN` feature");var q,Y=le.transports[v];if("function"!=typeof Y)throw this.stop(),this._priv_currentError=null,Error('transport "'.concat(v,'" not supported'));var j="string"==typeof e.representationFilter?(q=e.representationFilter,Function("return (".concat(q,"(arguments[0], arguments[1]))"))):e.representationFilter;uw.info("API: Initializing MediaSource mode in the main thread");var Q=Y({lowLatencyMode:u,checkMediaSegmentIntegrity:h,manifestLoader:p,referenceDateTime:m,representationFilter:j,segmentLoader:g,serverSyncInfos:y,__priv_manifestUpdateUrl:S,__priv_patchLastSegmentInSidx:b});C=new le.mainThreadMediaSourceInit({adaptiveOptions:F,autoPlay:n,bufferOptions:V,keySystems:s,lowLatencyMode:u,transport:Q,manifestRequestSettings:O,segmentRequestOptions:z,speed:this._priv_speed,startAt:f,textTrackOptions:B,url:E})}}var X={contentId:fM(),originalUrl:E,currentContentCanceller:P,defaultAudioTrackSwitchingMode:r,initializer:C,isDirectFile:M,segmentSinksStore:null,manifest:null,currentPeriod:null,activeAdaptations:null,activeRepresentations:null,tracksStore:null,mediaElementTracksStore:N,useWorker:x};C.addEventListener("error",function(e){t._priv_onFatalError(e,X)}),C.addEventListener("warning",function(e){var n=eh(e,{defaultCode:"NONE",defaultReason:"An unknown error happened."});uw.warn("API: Sending warning:",n),t.trigger("warning",n)}),C.addEventListener("reloadingMediaSource",function(e){X.segmentSinksStore=null,null!==X.tracksStore&&X.tracksStore.resetPeriodObjects(),t._priv_lastAutoPlay=e.autoPlay}),C.addEventListener("inbandEvents",function(e){return t.trigger("inbandEvents",e)}),C.addEventListener("streamEvent",function(e){return t.trigger("streamEvent",e)}),C.addEventListener("streamEventSkip",function(e){return t.trigger("streamEventSkip",e)}),C.addEventListener("activePeriodChanged",function(e){return t._priv_onActivePeriodChanged(X,e)}),C.addEventListener("periodStreamReady",function(e){return t._priv_onPeriodStreamReady(X,e)}),C.addEventListener("periodStreamCleared",function(e){return t._priv_onPeriodStreamCleared(X,e)}),C.addEventListener("representationChange",function(e){return t._priv_onRepresentationChange(X,e)}),C.addEventListener("adaptationChange",function(e){return t._priv_onAdaptationChange(X,e)}),C.addEventListener("bitrateEstimateChange",function(e){return t._priv_onBitrateEstimateChange(e)}),C.addEventListener("manifestReady",function(e){return t._priv_onManifestReady(X,e)}),C.addEventListener("manifestUpdate",function(e){return t._priv_onManifestUpdate(X,e)}),C.addEventListener("decipherabilityUpdate",function(e){return t._priv_onDecipherabilityUpdate(X,e)}),C.addEventListener("loaded",function(e){X.segmentSinksStore=e.segmentSinksStore}),C.prepare(),this.stop();var $=new fA(D,{withMediaSource:!M,lowLatencyMode:u});P.signal.register(function(){$.stop()});var Z=s1(C,D,$,P.signal);P.signal.register(function(){C.dispose()});var J=function(e){switch(e){case"STOPPED":case"RELOADING":case"LOADING":break;case"ENDED":t._priv_reloadingMetadata.reloadInPause=!0,t._priv_reloadingMetadata.reloadPosition=$.getReference().getValue().position.getPolled();break;default:var n=$.getReference().getValue();t._priv_reloadingMetadata.reloadInPause=n.paused,t._priv_reloadingMetadata.reloadPosition=n.position.getWanted()}},ee=null,et=function(e){null!==ee&&(ee.cancel(),ee=null),Z.onUpdate(function(n,i){s5(n)&&(i(),null!==ee&&ee.cancel(),(ee=new uM).linkToSignal(P.signal),!D.paused!==e&&(D.paused?t.trigger("pause",null):t.trigger("play",null)),s0(D,function(){return t.trigger("play",null)},function(){return t.trigger("pause",null)},P.signal))},{emitCurrentValue:!1,clearSignal:P.signal})};et(n),C.addEventListener("reloadingMediaSource",function(e){et(e.autoPlay)}),this._priv_currentError=null,this._priv_contentInfos=X;var en=null;Z.onUpdate(function(e){J(e),t._priv_setPlayerState(e),!P.isUsed()&&(null!==en?s5(t.state)||(en.cancel(),en=null):s5(t.state)&&((en=new uM).linkToSignal(P.signal),sJ(D,$,function(){return t.trigger("seeking",null)},function(){return t.trigger("seeked",null)},en.signal)))},{emitCurrentValue:!0,clearSignal:P.signal}),$.listen(function(e){J(t.state),t._priv_triggerPositionUpdate(X,e)},{clearSignal:P.signal}),P.signal.register(function(){C.removeEventListener()}),this._priv_contentLock.onUpdate(function(e,t){e||(t(),C.start(D,$))},{emitCurrentValue:!0,clearSignal:P.signal})}},{key:"getError",value:function(){return this._priv_currentError}},{key:"getVideoElement",value:function(){return this.videoElement}},{key:"getPlayerState",value:function(){return this.state}},{key:"isContentLoaded",value:function(){return!e_(["LOADING","RELOADING","STOPPED"],this.state)}},{key:"isBuffering",value:function(){return e_(["BUFFERING","SEEKING","LOADING","RELOADING"],this.state)}},{key:"isPaused",value:function(){return!this.videoElement||(e_(["LOADING","RELOADING"],this.state)?!this._priv_lastAutoPlay:this.videoElement.paused)}},{key:"isLive",value:function(){if(null===this._priv_contentInfos)return!1;var e=this._priv_contentInfos,t=e.isDirectFile,n=e.manifest;return!t&&null!==n&&n.isLive}},{key:"areTrickModeTracksEnabled",value:function(){return this._priv_preferTrickModeTracks}},{key:"getContentUrls",value:function(){if(null!==this._priv_contentInfos){var e=this._priv_contentInfos,t=e.isDirectFile,n=e.manifest,i=e.originalUrl;if(t)return void 0===i?void 0:[i];if(null!==n)return n.uris}}},{key:"updateContentUrls",value:function(e,t){if(null===this._priv_contentInfos)throw Error("No content loaded");var n=(null==t?void 0:t.refresh)===!0;this._priv_contentInfos.initializer.updateContentUrls(e,n)}},{key:"getMediaDuration",value:function(){if(null===this.videoElement)throw Error("Disposed player");return this.videoElement.duration}},{key:"getCurrentBufferGap",value:function(){if(null===this.videoElement)throw Error("Disposed player");var e=this.videoElement,t=O(e.buffered,e.currentTime);return t===1/0?0:t}},{key:"getWallClockTime",value:function(){if(null===this.videoElement)throw Error("Disposed player");if(null===this._priv_contentInfos)return this.videoElement.currentTime;var e=this._priv_contentInfos,t=e.isDirectFile,n=e.manifest;if(t){var i=sL(this.videoElement);return(null!=i?i:0)+this.videoElement.currentTime}return null!==n?this.videoElement.currentTime+(void 0!==n.availabilityStartTime?n.availabilityStartTime:0):0}},{key:"getPosition",value:function(){if(null===this.videoElement)throw Error("Disposed player");return this.videoElement.currentTime}},{key:"getLastStoredContentPosition",value:function(){return this._priv_reloadingMetadata.reloadPosition}},{key:"getPlaybackRate",value:function(){return this._priv_speed.getValue()}},{key:"setPlaybackRate",value:function(e,t){e!==this._priv_speed.getValue()&&this._priv_speed.setValue(e);var n,r=null==t?void 0:t.preferTrickModeTracks;if("boolean"==typeof r){this._priv_preferTrickModeTracks=r;var a=null==(n=this._priv_contentInfos)?void 0:n.tracksStore;i(a)||(r&&!a.isTrickModeEnabled()?a.enableVideoTrickModeTracks():!r&&a.isTrickModeEnabled()&&a.disableVideoTrickModeTracks())}}},{key:"getVideoRepresentation",value:function(){var e=this.__priv_getCurrentRepresentations();if(null!==e)return e.video}},{key:"getAudioRepresentation",value:function(){var e=this.__priv_getCurrentRepresentations();if(null!==e)return e.audio}},{key:"play",value:function(){var e=this;if(null===this.videoElement)throw Error("Disposed player");var t=this.videoElement.play();return i(t)||"function"!=typeof t.catch?Promise.resolve():t.catch(function(t){if("NotAllowedError"===t.name){var n=new u2("MEDIA_ERR_PLAY_NOT_ALLOWED",t.toString());e.trigger("warning",n)}throw t})}},{key:"pause",value:function(){if(null===this.videoElement)throw Error("Disposed player");this.videoElement.pause()}},{key:"seekTo",value:function(e){if(null===this.videoElement)throw Error("Disposed player");if(null===this._priv_contentInfos)throw Error("player: no content loaded");var t,n,r=this._priv_contentInfos,a=r.isDirectFile,o=r.manifest;if(!a&&null===o)throw Error("player: the content did not load yet");if("number"==typeof e)n=e;else if("object"==typeof e){var s=this.videoElement.currentTime;if(i(e.relative)){if(i(e.position)){if(i(e.wallClockTime))throw Error('invalid time object. You must set one of the following properties: "relative", "position" or "wallClockTime"');if(null!==o)n=e.wallClockTime-(null!=(t=o.availabilityStartTime)?t:0);else if(a&&null!==this.videoElement){var u=sL(this.videoElement);void 0!==u&&(n=e.wallClockTime-u)}void 0===n&&(n=e.wallClockTime)}else n=e.position}else n=s+e.relative}if(void 0===n)throw Error("invalid time given");return uw.info("API: API Seek to",n),this.videoElement.currentTime=n,n}},{key:"getVolume",value:function(){if(null===this.videoElement)throw Error("Disposed player");return this.videoElement.volume}},{key:"setVolume",value:function(e){if(null===this.videoElement)throw Error("Disposed player");var t=this.videoElement;e!==t.volume&&(t.volume=e)}},{key:"isMute",value:function(){var e;return(null==(e=this.videoElement)?void 0:e.muted)===!0}},{key:"mute",value:function(){if(null===this.videoElement)throw Error("Disposed player");this.videoElement.muted||(this.videoElement.muted=!0)}},{key:"unMute",value:function(){if(null===this.videoElement)throw Error("Disposed player");this.videoElement.muted&&(this.videoElement.muted=!1)}},{key:"setMaxBufferBehind",value:function(e){this._priv_bufferOptions.maxBufferBehind.setValue(e)}},{key:"setMaxBufferAhead",value:function(e){this._priv_bufferOptions.maxBufferAhead.setValue(e)}},{key:"setWantedBufferAhead",value:function(e){this._priv_bufferOptions.wantedBufferAhead.setValue(e)}},{key:"setMaxVideoBufferSize",value:function(e){this._priv_bufferOptions.maxVideoBufferSize.setValue(e)}},{key:"getMaxBufferBehind",value:function(){return this._priv_bufferOptions.maxBufferBehind.getValue()}},{key:"getMaxBufferAhead",value:function(){return this._priv_bufferOptions.maxBufferAhead.getValue()}},{key:"getWantedBufferAhead",value:function(){return this._priv_bufferOptions.wantedBufferAhead.getValue()}},{key:"getMaxVideoBufferSize",value:function(){return this._priv_bufferOptions.maxVideoBufferSize.getValue()}},{key:"getCurrentPeriod",value:function(){var e,t=null==(e=this._priv_contentInfos)?void 0:e.currentPeriod;return i(t)?null:{id:t.id,start:t.start,end:t.end}}},{key:"getKeySystemConfiguration",value:function(){if(null===this.videoElement)throw Error("Disposed player");var e=il(this.videoElement);return null===e?null:{keySystem:e[0],configuration:e[1]}}},{key:"getAvailablePeriods",value:function(){if(null===this._priv_contentInfos)return[];var e=this._priv_contentInfos,t=e.isDirectFile,n=e.tracksStore;return t?[]:null===n?[]:n.getAvailablePeriods().slice()}},{key:"getAvailableAudioTracks",value:function(e){if(null===this._priv_contentInfos)return[];var t,n=this._priv_contentInfos,i=n.isDirectFile,r=n.mediaElementTracksStore;return i?null!=(t=null==r?void 0:r.getAvailableAudioTracks())?t:[]:this._priv_callTracksStoreGetterSetter(e,[],function(e,t){var n;return null!=(n=e.getAvailableAudioTracks(t))?n:[]})}},{key:"getAvailableTextTracks",value:function(e){if(null===this._priv_contentInfos)return[];var t,n=this._priv_contentInfos,i=n.isDirectFile,r=n.mediaElementTracksStore;return i?null!=(t=null==r?void 0:r.getAvailableTextTracks())?t:[]:this._priv_callTracksStoreGetterSetter(e,[],function(e,t){var n;return null!=(n=e.getAvailableTextTracks(t))?n:[]})}},{key:"getAvailableVideoTracks",value:function(e){if(null===this._priv_contentInfos)return[];var t,n=this._priv_contentInfos,i=n.isDirectFile,r=n.mediaElementTracksStore;return i?null!=(t=null==r?void 0:r.getAvailableVideoTracks())?t:[]:this._priv_callTracksStoreGetterSetter(e,[],function(e,t){var n;return null!=(n=e.getAvailableVideoTracks(t))?n:[]})}},{key:"getAudioTrack",value:function(e){if(null!==this._priv_contentInfos){var t=this._priv_contentInfos,n=t.isDirectFile,i=t.mediaElementTracksStore;return n?null===i?void 0:i.getChosenAudioTrack():this._priv_callTracksStoreGetterSetter(e,void 0,function(e,t){return e.getChosenAudioTrack(t)})}}},{key:"getTextTrack",value:function(e){if(null!==this._priv_contentInfos){var t=this._priv_contentInfos,n=t.isDirectFile,i=t.mediaElementTracksStore;return n?null===i?void 0:i.getChosenTextTrack():this._priv_callTracksStoreGetterSetter(e,void 0,function(e,t){return e.getChosenTextTrack(t)})}}},{key:"getVideoTrack",value:function(e){if(null!==this._priv_contentInfos){var t=this._priv_contentInfos,n=t.isDirectFile,i=t.mediaElementTracksStore;return n?null===i?void 0:i.getChosenVideoTrack():this._priv_callTracksStoreGetterSetter(e,void 0,function(e,t){return e.getChosenVideoTrack(t)})}}},{key:"setAudioTrack",value:function(e){if(null===this._priv_contentInfos)throw Error("No content loaded");var t=this._priv_contentInfos,n=t.isDirectFile,i=t.mediaElementTracksStore;if(n)try{var r="string"==typeof e?e:e.trackId;null==i||i.setAudioTrackById(r);return}catch(e){throw Error("player: unknown audio track")}var a,o,s,u,l,d=null;return"string"==typeof e?s=e:(s=e.trackId,o=e.periodId,u=e.switchingMode,d=null!=(a=e.lockedRepresentations)?a:null,l=e.relativeResumingPosition),this._priv_callTracksStoreGetterSetter(o,void 0,function(e,t){return e.setAudioTrack({periodRef:t,trackId:s,switchingMode:u,lockedRepresentations:d,relativeResumingPosition:l})})}},{key:"setTextTrack",value:function(e){if(null===this._priv_contentInfos)throw Error("No content loaded");var t,n,i=this._priv_contentInfos,r=i.isDirectFile,a=i.mediaElementTracksStore;if(r)try{var o="string"==typeof e?e:e.trackId;null==a||a.setTextTrackById(o);return}catch(e){throw Error("player: unknown text track")}return"string"==typeof e?n=e:(n=e.trackId,t=e.periodId),this._priv_callTracksStoreGetterSetter(t,void 0,function(e,t){return e.setTextTrack(t,n)})}},{key:"disableTextTrack",value:function(e){if(null!==this._priv_contentInfos){var t=this._priv_contentInfos,n=t.isDirectFile,i=t.mediaElementTracksStore;if(n){null==i||i.disableTextTrack();return}return this._priv_callTracksStoreGetterSetter(e,void 0,function(e,t){return e.disableTrack(t,"text")})}}},{key:"setVideoTrack",value:function(e){if(null===this._priv_contentInfos)throw Error("No content loaded");var t=this._priv_contentInfos,n=t.isDirectFile,i=t.mediaElementTracksStore;if(n)try{var r="string"==typeof e?e:e.trackId;null==i||i.setVideoTrackById(r);return}catch(e){throw Error("player: unknown video track")}var a,o,s,u,l,d=null;return"string"==typeof e?s=e:(s=e.trackId,o=e.periodId,u=e.switchingMode,d=null!=(a=e.lockedRepresentations)?a:null,l=e.relativeResumingPosition),this._priv_callTracksStoreGetterSetter(o,void 0,function(e,t){return e.setVideoTrack({periodRef:t,trackId:s,switchingMode:u,lockedRepresentations:d,relativeResumingPosition:l})})}},{key:"disableVideoTrack",value:function(e){if(null!==this._priv_contentInfos){var t=this._priv_contentInfos,n=t.isDirectFile,i=t.mediaElementTracksStore;return n&&null!==i?i.disableVideoTrack():this._priv_callTracksStoreGetterSetter(e,void 0,function(e,t){return e.disableTrack(t,"video")})}}},{key:"lockVideoRepresentations",value:function(e){var t,n,i;if(null===this._priv_contentInfos)throw Error("No content loaded");if(this._priv_contentInfos.isDirectFile)throw Error("Cannot lock video Representations in directfile mode.");return Array.isArray(e)?(t=e,n=void 0):(t=e.representations,n=e.periodId,i=e.switchingMode),this._priv_callTracksStoreGetterSetter(n,void 0,function(e,n){return e.lockVideoRepresentations(n,{representations:t,switchingMode:i})})}},{key:"lockAudioRepresentations",value:function(e){var t,n,i;if(null===this._priv_contentInfos)throw Error("No content loaded");if(this._priv_contentInfos.isDirectFile)throw Error("Cannot lock audio Representations in directfile mode.");return Array.isArray(e)?(t=e,n=void 0):(t=e.representations,n=e.periodId,i=e.switchingMode),this._priv_callTracksStoreGetterSetter(n,void 0,function(e,n){return e.lockAudioRepresentations(n,{representations:t,switchingMode:i})})}},{key:"getLockedVideoRepresentations",value:function(e){return null===this._priv_contentInfos?null:this._priv_contentInfos.isDirectFile?null:this._priv_callTracksStoreGetterSetter(e,null,function(e,t){return e.getLockedVideoRepresentations(t)})}},{key:"getLockedAudioRepresentations",value:function(e){return null===this._priv_contentInfos?null:this._priv_contentInfos.isDirectFile?null:this._priv_callTracksStoreGetterSetter(e,null,function(e,t){return e.getLockedAudioRepresentations(t)})}},{key:"unlockVideoRepresentations",value:function(e){if(null!==this._priv_contentInfos&&!this._priv_contentInfos.isDirectFile)return this._priv_callTracksStoreGetterSetter(e,void 0,function(e,t){return e.unlockVideoRepresentations(t)})}},{key:"unlockAudioRepresentations",value:function(e){if(null!==this._priv_contentInfos&&!this._priv_contentInfos.isDirectFile)return this._priv_callTracksStoreGetterSetter(e,void 0,function(e,t){return e.unlockAudioRepresentations(t)})}},{key:"getMinimumPosition",value:function(){if(null===this._priv_contentInfos)return null;if(this._priv_contentInfos.isDirectFile)return 0;var e=this._priv_contentInfos.manifest;return null!==e?eb(e):null}},{key:"getLivePosition",value:function(){if(null===this._priv_contentInfos)return null;var e=this._priv_contentInfos,t=e.isDirectFile,n=e.manifest;if(!t)return(null==n?void 0:n.isLive)!==!0?null:eE(n)}},{key:"getMaximumPosition",value:function(){if(null===this._priv_contentInfos)return null;var e=this._priv_contentInfos,t=e.isDirectFile,n=e.manifest;if(t){if(null===this.videoElement)throw Error("Disposed player");return this.videoElement.duration}return null!==n?n.isDynamic||null===this.videoElement?ek(n):this.videoElement.duration:null}},{key:"__priv_getSegmentSinkContent",value:function(e){if(null===this._priv_contentInfos||null===this._priv_contentInfos.segmentSinksStore)return null;var t=this._priv_contentInfos.segmentSinksStore.getStatus(e);return"initialized"===t.type?t.value.getLastKnownInventory():null}},{key:"__priv_getManifest",value:function(){return null===this._priv_contentInfos?null:this._priv_contentInfos.manifest}},{key:"__priv_getCurrentAdaptation",value:function(){if(null===this._priv_contentInfos)return null;var e=this._priv_contentInfos,t=e.currentPeriod,n=e.activeAdaptations;return null===t||null===n||i(n[t.id])?null:n[t.id]}},{key:"__priv_getCurrentRepresentations",value:function(){if(null===this._priv_contentInfos)return null;var e=this._priv_contentInfos,t=e.currentPeriod,n=e.activeRepresentations;return null===t||null===n||i(n[t.id])?null:n[t.id]}},{key:"_priv_cleanUpCurrentContentState",value:function(){var e,t,n,r,a=this;uw.debug("Locking `contentLock` to clean-up the current content."),this._priv_contentLock.setValue(!0),null==(t=null==(e=this._priv_contentInfos)?void 0:e.tracksStore)||t.dispose(),null==(r=null==(n=this._priv_contentInfos)?void 0:n.mediaElementTracksStore)||r.dispose(),this._priv_contentInfos=null,this._priv_contentEventsMemory={};var o=function(){null!==a.videoElement&&(uw.debug("Unlocking `contentLock`. Next content can begin."),a._priv_contentLock.setValue(!1))};i(this.videoElement)?o():tN(this.videoElement).then(function(){uw.debug("API: DRM session cleaned-up with success!"),o()},function(e){uw.error("API: An error arised when trying to clean-up the DRM session:"+(v(e,Error)?e.toString():"Unknown Error")),o()})}},{key:"_priv_onManifestReady",value:function(e,t){var n,i=this;if(e.contentId===(null==(n=this._priv_contentInfos)?void 0:n.contentId)){e.manifest=t,0===t.manifestFormat&&(this._priv_reloadingMetadata.manifest=t);var r=new fC({preferTrickModeTracks:this._priv_preferTrickModeTracks,defaultAudioTrackSwitchingMode:e.defaultAudioTrackSwitchingMode});e.tracksStore=r,r.addEventListener("newAvailablePeriods",function(e){i.trigger("newAvailablePeriods",e)}),r.addEventListener("brokenRepresentationsLock",function(e){i.trigger("brokenRepresentationsLock",e)}),r.addEventListener("trackUpdate",function(e){i.trigger("trackUpdate",e);var t,n,r=null!=(n=null==(t=i._priv_contentInfos)?void 0:t.currentPeriod)?n:void 0;"no-playable-representation"===e.reason&&e.period.id===(null==r?void 0:r.id)&&i._priv_onAvailableTracksMayHaveChanged(e.trackType)}),e.tracksStore.addEventListener("warning",function(e){i.trigger("warning",e)}),e.tracksStore.addEventListener("error",function(t){i._priv_onFatalError(t,e)}),e.tracksStore.onManifestUpdate(t)}}},{key:"_priv_onManifestUpdate",value:function(e,t){if(null!==this._priv_contentInfos&&null!==this._priv_contentInfos.manifest){i(null==e?void 0:e.tracksStore)||e.tracksStore.onManifestUpdate(this._priv_contentInfos.manifest);var n=null!=(l=null==(u=this._priv_contentInfos)?void 0:u.currentPeriod)?l:void 0,r=null==(d=this._priv_contentInfos)?void 0:d.tracksStore;if(!(void 0===n||i(r))){var a=!0,o=!1,s=void 0;try{for(var u,l,d,c,f=t.updatedPeriods[Symbol.iterator]();!(a=(c=f.next()).done);a=!0){var v=c.value;if(v.period.id===n.id&&(v.result.addedAdaptations.length>0||v.result.removedAdaptations.length>0)){if(void 0===r.getPeriodObjectFromPeriod(n))return;this._priv_onAvailableTracksMayHaveChanged("audio"),this._priv_onAvailableTracksMayHaveChanged("text"),this._priv_onAvailableTracksMayHaveChanged("video")}}}catch(e){o=!0,s=e}finally{try{a||null==f.return||f.return()}finally{if(o)throw s}}}}}},{key:"_priv_onDecipherabilityUpdate",value:function(e,t){if(null!==e&&null!==e.manifest){i(null==e?void 0:e.tracksStore)||e.tracksStore.onDecipherabilityUpdates();var n=t.reduce(function(t,n){var i,r,a;if(!(void 0!==j(t,function(e){return e[0].id===n.period.id&&e[1]===n.adaptation.type}))){var o=e.tracksStore;if(null===o)return t;var s=!1,u=o.getPeriodObjectFromPeriod(n.period);if(void 0===u)return t;switch(n.adaptation.type){case"audio":s=(null==(i=o.getChosenAudioTrack(u))?void 0:i.id)===n.adaptation.id;break;case"video":s=(null==(r=o.getChosenVideoTrack(u))?void 0:r.id)===n.adaptation.id;break;case"text":s=(null==(a=o.getChosenTextTrack(u))?void 0:a.id)===n.adaptation.id}s&&t.push([n.period,n.adaptation.type])}return t},[]),r=!0,a=!1,o=void 0;try{for(var s,u=n[Symbol.iterator]();!(r=(s=u.next()).done);r=!0){var l=y(s.value,2),d=l[0],c=l[1];this._priv_triggerEventIfNotStopped("representationListUpdate",{period:{start:d.start,end:d.end,id:d.id},trackType:c,reason:"decipherability-update"},e.currentContentCanceller.signal)}}catch(e){a=!0,o=e}finally{try{r||null==u.return||u.return()}finally{if(a)throw o}}}}},{key:"_priv_onActivePeriodChanged",value:function(e,t){var n,r,a,o,s,u,l=t.period;if(e.contentId===(null==(n=this._priv_contentInfos)?void 0:n.contentId)){e.currentPeriod=l;var d=e.currentContentCanceller.signal;this._priv_contentEventsMemory.periodChange!==l&&(this._priv_contentEventsMemory.periodChange=l,this._priv_triggerEventIfNotStopped("periodChange",{start:l.start,end:l.end,id:l.id},d)),this._priv_triggerEventIfNotStopped("availableAudioTracksChange",this.getAvailableAudioTracks(),d),this._priv_triggerEventIfNotStopped("availableTextTracksChange",this.getAvailableTextTracks(),d),this._priv_triggerEventIfNotStopped("availableVideoTracksChange",this.getAvailableVideoTracks(),d);var c=null==(r=this._priv_contentInfos)?void 0:r.tracksStore;if(i(c))this._priv_triggerEventIfNotStopped("audioTrackChange",null,d),this._priv_triggerEventIfNotStopped("textTrackChange",null,d),this._priv_triggerEventIfNotStopped("videoTrackChange",null,d);else{var f=c.getPeriodObjectFromPeriod(l);if(f){var v=c.getChosenAudioTrack(f);this._priv_triggerEventIfNotStopped("audioTrackChange",v,d);var h=c.getChosenTextTrack(f);this._priv_triggerEventIfNotStopped("textTrackChange",h,d);var p=c.getChosenVideoTrack(f);this._priv_triggerEventIfNotStopped("videoTrackChange",p,d)}}var m=null!=(o=null==(a=this.__priv_getCurrentRepresentations())?void 0:a.audio)?o:null;this._priv_triggerEventIfNotStopped("audioRepresentationChange",m,d);var g=null!=(u=null==(s=this.__priv_getCurrentRepresentations())?void 0:s.video)?u:null;this._priv_triggerEventIfNotStopped("videoRepresentationChange",g,d)}}},{key:"_priv_onPeriodStreamReady",value:function(e,t){if(e.contentId===(null==(n=this._priv_contentInfos)?void 0:n.contentId)){var n,r=t.type,a=t.period,o=t.adaptationRef,s=e.tracksStore;switch(r){case"video":case"audio":case"text":i(s)?(uw.error("API: TracksStore not instanciated for a new ".concat(r," period")),o.setValue(null)):s.addTrackReference(r,a,o);break;default:H(r)}}}},{key:"_priv_onPeriodStreamCleared",value:function(e,t){if(e.contentId===(null==(n=this._priv_contentInfos)?void 0:n.contentId)){var n,r=t.type,a=t.period,o=e.tracksStore;switch(r){case"audio":case"text":case"video":i(o)||o.removeTrackReference(r,a)}var s=e.activeAdaptations,u=e.activeRepresentations;if(!i(s)&&!i(s[a.id])){var l=s[a.id];delete l[r],0===Object.keys(l).length&&delete s[a.id]}if(!i(u)&&!i(u[a.id])){var d=u[a.id];delete d[r],0===Object.keys(d).length&&delete u[a.id]}}}},{key:"_priv_onAdaptationChange",value:function(e,t){var n,r=t.type,a=t.adaptation,o=t.period;if(e.contentId===(null==(n=this._priv_contentInfos)?void 0:n.contentId)){null===e.activeAdaptations&&(e.activeAdaptations={});var s=e.activeAdaptations,u=e.currentPeriod,d=s[o.id];i(d)?s[o.id]=l({},r,a):d[r]=a;var c=e.tracksStore,f=e.currentContentCanceller.signal;if(null!==c&&null!==u&&!i(o)&&o.id===u.id){var v=c.getPeriodObjectFromPeriod(o);if(void 0===v)return;switch(r){case"audio":var h=c.getChosenAudioTrack(v);this._priv_triggerEventIfNotStopped("audioTrackChange",h,f);break;case"text":var p=c.getChosenTextTrack(v);this._priv_triggerEventIfNotStopped("textTrackChange",p,f);break;case"video":var m=c.getChosenVideoTrack(v);this._priv_triggerEventIfNotStopped("videoTrackChange",m,f)}}}}},{key:"_priv_onRepresentationChange",value:function(e,t){var n,r=t.type,a=t.period,o=t.representation;if(e.contentId===(null==(n=this._priv_contentInfos)?void 0:n.contentId)){null===e.activeRepresentations&&(e.activeRepresentations={});var s=e.activeRepresentations,u=e.currentPeriod,d=s[a.id];if(i(d)?s[a.id]=l({},r,o):d[r]=o,!i(a)&&null!==u&&u.id===a.id){var c=this._priv_contentInfos.currentContentCanceller.signal;"video"===r?this._priv_triggerEventIfNotStopped("videoRepresentationChange",o,c):"audio"===r&&this._priv_triggerEventIfNotStopped("audioRepresentationChange",o,c)}}}},{key:"_priv_onBitrateEstimateChange",value:function(e){var t=e.type,n=e.bitrate;void 0!==n&&(this._priv_bitrateInfos.lastBitrates[t]=n),this.trigger("__priv_bitrateEstimateChange",{type:t,bitrate:n})}},{key:"_priv_setPlayerState",value:function(e){this.state!==e&&(this.state=e,uw.info("API: playerStateChange event",e),this.trigger("playerStateChange",e))}},{key:"_priv_triggerPositionUpdate",value:function(e,t){if(e.contentId===(null==(n=this._priv_contentInfos)?void 0:n.contentId)){var n,r,a=e.isDirectFile,o=e.manifest;if(!(!a&&null===o||i(t))){var s=null!==o?ek(o):void 0,u={position:t.position.getPolled(),duration:t.duration,playbackRate:t.playbackRate,maximumPosition:s,bufferGap:void 0!==t.bufferGap&&isFinite(t.bufferGap)?t.bufferGap:0};if(null!==o&&o.isLive&&t.position.getPolled()>0){var l=null!=(r=o.availabilityStartTime)?r:0;u.wallClockTime=t.position.getPolled()+l;var d=eE(o);void 0!==d&&(u.liveGap=d-t.position.getPolled())}else if(a&&null!==this.videoElement){var c=sL(this.videoElement);void 0!==c&&(u.wallClockTime=c+t.position.getPolled())}this.trigger("positionUpdate",u)}}}},{key:"_priv_triggerEventIfNotStopped",value:function(e,t,n){n.isCancelled()||this.trigger(e,t)}},{key:"_priv_initializeMediaElementTracksStore",value:function(e){var t,n,i,r=this;W(null!==le.directfile,"Initializing `MediaElementTracksStore` without Directfile feature"),W(null!==this.videoElement,"Initializing `MediaElementTracksStore` on a disposed RxPlayer");var a=new le.directfile.mediaElementTracksStore(this.videoElement);return this._priv_triggerEventIfNotStopped("availableAudioTracksChange",a.getAvailableAudioTracks(),e),this._priv_triggerEventIfNotStopped("availableVideoTracksChange",a.getAvailableVideoTracks(),e),this._priv_triggerEventIfNotStopped("availableTextTracksChange",a.getAvailableTextTracks(),e),this._priv_triggerEventIfNotStopped("audioTrackChange",null!=(t=a.getChosenAudioTrack())?t:null,e),this._priv_triggerEventIfNotStopped("textTrackChange",null!=(n=a.getChosenTextTrack())?n:null,e),this._priv_triggerEventIfNotStopped("videoTrackChange",null!=(i=a.getChosenVideoTrack())?i:null,e),a.addEventListener("availableVideoTracksChange",function(e){return r.trigger("availableVideoTracksChange",e)}),a.addEventListener("availableAudioTracksChange",function(e){return r.trigger("availableAudioTracksChange",e)}),a.addEventListener("availableTextTracksChange",function(e){return r.trigger("availableTextTracksChange",e)}),a.addEventListener("audioTrackChange",function(e){return r.trigger("audioTrackChange",e)}),a.addEventListener("videoTrackChange",function(e){return r.trigger("videoTrackChange",e)}),a.addEventListener("textTrackChange",function(e){return r.trigger("textTrackChange",e)}),a}},{key:"_priv_callTracksStoreGetterSetter",value:function(e,t,n){if(null===this._priv_contentInfos||null===this._priv_contentInfos.tracksStore)return uw.warn("API: Trying to call track API too soon"),t;var i,r,a=this._priv_contentInfos.tracksStore,o=null!=(r=null==(i=this._priv_contentInfos)?void 0:i.currentPeriod)?r:void 0,s=null!=e?e:null==o?void 0:o.id;if(void 0===s)return t;var u=s===(null==o?void 0:o.id)?a.getPeriodObjectFromPeriod(o):a.getPeriodObjectFromId(s);return void 0===u?t:n(a,u)}},{key:"_priv_onAvailableTracksMayHaveChanged",value:function(e,t){var n=this._priv_contentInfos;if(null!==n){var r=n.currentPeriod,a=n.tracksStore,o=n.currentContentCanceller.signal;if(!i(r)&&null!==a){var s=null!=t?t:a.getPeriodObjectFromPeriod(r);if(void 0!==s)switch(e){case"video":var u=a.getAvailableVideoTracks(s);this._priv_triggerEventIfNotStopped("availableVideoTracksChange",null!=u?u:[],o);break;case"audio":var l=a.getAvailableAudioTracks(s);this._priv_triggerEventIfNotStopped("availableAudioTracksChange",null!=l?l:[],o);break;case"text":var d=a.getAvailableTextTracks(s);this._priv_triggerEventIfNotStopped("availableTextTracksChange",null!=d?d:[],o);break;default:H(e)}}}}},{key:"_priv_onFatalError",value:function(e,t){var n=eh(e,{defaultCode:"NONE",defaultReason:"An unknown error stopped content playback."});n.fatal=!0,t.currentContentCanceller.cancel(),this._priv_cleanUpCurrentContentState(),this._priv_currentError=n,uw.error("API: The player stopped because of an error",n),this._priv_setPlayerState("STOPPED"),this._priv_currentError===n&&this.trigger("error",n)}}],[{key:"ErrorTypes",get:function(){return uJ}},{key:"ErrorCodes",get:function(){return u0}},{key:"LogLevel",get:function(){return uw.getLevel()},set:function(e){uw.setLevel(e)}},{key:"addFeatures",value:function(e){em(e)}},{key:"_priv_registerVideoElement",value:function(e){r._priv_currentlyUsedVideoElements.has(e)&&console.warn("The video element is already attached to another RxPlayer instance.\nMake sure to dispose the previous instance with player.dispose() before creating a new player instance attaching that video element."),r._priv_currentlyUsedVideoElements.add(e)}},{key:"_priv_deregisterVideoElement",value:function(e){r._priv_currentlyUsedVideoElements.has(e)&&r._priv_currentlyUsedVideoElements.delete(e)}}]),r}(ur);fD._priv_currentlyUsedVideoElements=new WeakSet,fD.version="4.0.0-rc.2",function(){if(!uo&&!i(us.WebKitSourceBuffer)&&void 0===us.WebKitSourceBuffer.prototype.addEventListener){var e=us.WebKitSourceBuffer.prototype;for(var t in ur.prototype)ur.prototype.hasOwnProperty(t)&&(e[t]=ur.prototype[t]);e._listeners=[],e._emitUpdate=function(e,t){var n=this;uu(function(){n.trigger(e,t),n.updating=!1,n.trigger("updateend")})},e.appendBuffer=function(e){if(this.updating)throw Error("updating");this.trigger("updatestart"),this.updating=!0;try{this.append(e)}catch(e){this._emitUpdate("error",e);return}this._emitUpdate("update")}}}(),fD.addFeatures([function(e){void 0===e.transports.smooth&&(e.transports.smooth=fk),e.mainThreadMediaSourceInit=d4,e.codecSupportProber=d6},function(e){void 0===e.transports.dash&&(e.transports.dash=cw),e.dashParsers.native=ch,e.mainThreadMediaSourceInit=d4,e.codecSupportProber=d6},function(e){e.directfile={initDirectFile:cA,mediaElementTracksStore:cR}},function(e){e.decrypt=dz},function(e){e.nativeTextTracksParsers.ttml=fh,e.nativeTextDisplayer=fa},function(e){e.nativeTextTracksParsers.sami=fc,e.nativeTextDisplayer=fa},function(e){e.nativeTextTracksParsers.vtt=fp,e.nativeTextDisplayer=fa},function(e){e.nativeTextTracksParsers.srt=o6,e.nativeTextDisplayer=fa},function(e){e.htmlTextTracksParsers.ttml=c1,e.htmlTextDisplayer=cD},function(e){e.htmlTextTracksParsers.sami=cF,e.htmlTextDisplayer=cD},function(e){e.htmlTextTracksParsers.vtt=fr,e.htmlTextDisplayer=cD},function(e){e.htmlTextTracksParsers.srt=oa,e.htmlTextDisplayer=cD}]),t()?uw.setLevel("DEBUG"):ui.CURRENT_ENV===ui.DEV&&uw.setLevel("NONE")}();